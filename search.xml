<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>利用国内服务器加速v2ray访问速度和规避检查</title>
      <link href="/2023/11/19/yuque/dg4x1y8qy3sv2kud/"/>
      <url>/2023/11/19/yuque/dg4x1y8qy3sv2kud/</url>
      
        <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><h2 id="为什么用国内服务器？"><a href="#为什么用国内服务器？" class="headerlink" title="为什么用国内服务器？"></a>为什么用国内服务器？</h2><p>国内连接外网时，本地的营运商和网络服务会极大影响我们连接外网的能力。此时外网服务器的路由配置就及其重要，通常我们会选在路由较好的机房，比如使用了 CN2 之类线路的机房。但是，这种机房的成本通常是比较高的。利用国内的服务器，可以适当的提高我们连接外网的速度，同时也能规避掉流量审查。<br>国内服务器在企业网络下，一方面被监控流量的可能性比较小，另一方面延迟也会相对比较低。这样可以有效保护国外服务器 ip 和端口，免受封锁。此方法不止适用于 v2ray，其他协议比如 ssr，ss，trojan 都适用此方法。</p><h2 id="如何加速访问-v2ray？"><a href="#如何加速访问-v2ray？" class="headerlink" title="如何加速访问 v2ray？"></a>如何加速访问 v2ray？</h2><p>通过 stunnel 软件，在国内服务器上安装 stunnel 做客户端，安装了 v2ray 的国外服务器上安装 stunnel 作为服务端。<br>原来访问 v2ray 来实现连接外网，现在是将 v2ray 的请求先发送给国内服务器，然后国内服务器通过 stunnel 将请求转发给国外服务器，再连接 v2ray 服务器访问外网。</p><h2 id="谁适合阅读此文？"><a href="#谁适合阅读此文？" class="headerlink" title="谁适合阅读此文？"></a>谁适合阅读此文？</h2><p>这篇教程适合有 linux 基础的朋友阅读，对于安装好 v2ray 等加速器之后，想要进一步优化访问的朋友，可以试试去操作。很多朋友使用一键安装 v2ray，因此对 linux 指令也不是很了解，就不建议阅读了，这不是一篇傻瓜教程，遇到的一些问题需要自行解决。</p><h1 id="国内服务器的配置"><a href="#国内服务器的配置" class="headerlink" title="国内服务器的配置"></a>国内服务器的配置</h1><h2 id="2-1-服务器的选择"><a href="#2-1-服务器的选择" class="headerlink" title="2.1. 服务器的选择"></a>2.1. 服务器的选择</h2><p>国内服务器的价格都是比较昂贵的，在这里用到的服务器配置不用太高，主要需要注意的是带宽可以有 2M 以上的。阿里云的服务器，最便宜的一款新人只要一年 100 左右，腾讯云也有类似优惠。如果没有优惠了可以去淘宝试试能不能买到低价的。</p><h2 id="2-2-防火墙设置"><a href="#2-2-防火墙设置" class="headerlink" title="2.2. 防火墙设置"></a>2.2. 防火墙设置</h2><p>在购买好服务器之后，需要在服务商后台开启防火墙，只用开启一个就行，我这里开启的是 8888<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12641647/1700405143987-b24ce65f-b8f3-4ffd-8099-df5c861c7e34.png#averageHue=%23cdebd3&clientId=u96f25891-9f6b-4&from=paste&height=211&id=u234b8b00&originHeight=422&originWidth=2794&originalType=binary%E2%88%B6=2&rotation=0&showTitle=false&size=208293&status=done&style=none&taskId=u8ea28c68-5ee2-4f06-95de-3a2fd7757ef&title=&width=1397" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2023/png/12641647/1700405143987-b24ce65f-b8f3-4ffd-8099-df5c861c7e34.png#averageHue=%23cdebd3&clientId=u96f25891-9f6b-4&from=paste&height=211&id=u234b8b00&originHeight=422&originWidth=2794&originalType=binary%E2%88%B6=2&rotation=0&showTitle=false&size=208293&status=done&style=none&taskId=u8ea28c68-5ee2-4f06-95de-3a2fd7757ef&title=&width=1397" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>此外，需要在登录 linux 系统之后通过 firewall-cmd 命令在 linux 机器上来开启 8888 端口。如果没有 firewall-cmd 可以用 apt 或者 yum 指令安装。开启端口步骤如下：</p><ol><li>首先，使用以下命令检查 firewalld 服务的状态：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status firewalld</span><br></pre></td></tr></table></figure><ol start="2"><li>如果状态显示为”active”，则表示 firewalld 服务正在运行。如果状态显示为”inactive”，则需要启动 firewalld 服务：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start firewalld</span><br></pre></td></tr></table></figure><ol start="3"><li>确认 firewall-cmd 工具可用。使用以下命令检查 firewall-cmd 是否可用：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --version</span><br></pre></td></tr></table></figure><ol start="4"><li>使用以下命令添加或打开 8888 端口：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo firewall-cmd --add-port=8888/tcp --permanent</span><br></pre></td></tr></table></figure><p>这将在防火墙规则中永久性地添加 8888 端口。</p><ol start="5"><li>重新加载防火墙以使更改生效：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo firewall-cmd --reload</span><br></pre></td></tr></table></figure><p>现在，8888 端口已经通过 firewall-cmd 成功地打开了。请注意，使用 sudo 命令来获取管理员权限执行上述命令。</p><h2 id="2-3-安装和配置-stunnel"><a href="#2-3-安装和配置-stunnel" class="headerlink" title="2.3. 安装和配置 stunnel"></a>2.3. 安装和配置 stunnel</h2><ol><li>安装 stunnel，对于 Debian 和 Ubuntu：</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install stunnel</span><br></pre></td></tr></table></figure><p>对于 Centos：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install stunnel</span><br></pre></td></tr></table></figure><ol start="2"><li>生成 pem 证书</li></ol><p>证书用来建立 TSL 连接，在 stunnel 服务端和客户端使用相同的证书，生成指令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -x509 -days 3650 -nodes -out stunnel.pem -keyout stunnel.pem</span><br></pre></td></tr></table></figure><p>将证书移到/etc/stunnel/ 目录下，</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv stunnel.pem /etc/stunnel/</span><br></pre></td></tr></table></figure><ol start="3"><li>配置 stunnel，配置文件需要手动在文件中编辑，配置文件储存在/etc/stunnel/stunnel.conf 中，没有的话直接新建一个就行，stunnel 会自动读取此文件。</li></ol><p>通过 vim 打开此文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/stunnel/stunnel.conf</span><br></pre></td></tr></table></figure><p>并编辑内容如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">client = yes</span><br><span class="line">[v2ray]</span><br><span class="line">accept = 8888</span><br><span class="line">connect = 123.123.123.123:8888</span><br><span class="line">CAfile = /etc/stunnel/stunnel.pem</span><br></pre></td></tr></table></figure><p>accept 后跟我们之前开启的端口，用于监听请求，请求将被转发到 connect 后面的 ip 和端口，connect 的 ip 为 v2ray 的 ip，端口是 stunnel 服务端的端口，服务端也开启 8888 作为接受客户端请求。<br>依次按 ESC，冒号和 wq，退出编辑器并保存内容。</p><ol start="4"><li>输入指令开启 stunnel</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stunnel</span><br></pre></td></tr></table></figure><p>没有输出内容，则启动成功，也可以通过指令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -i :8888</span><br></pre></td></tr></table></figure><p>查看端口是否与 stunnel 绑定成功。</p><blockquote><p>tips：可以在另一台 linux 机器上，通过指令 telnet ip 8888 查看端口是否能建立连接，如果不行，说明防火墙没设置好</p></blockquote><h1 id="国外服务器的配置"><a href="#国外服务器的配置" class="headerlink" title="国外服务器的配置"></a>国外服务器的配置</h1><p>在安装了 v2ray 的机器上，我们需要安装 stunenl 服务端，v2ray 可以在网上找一键安装脚本安装。</p><h2 id="防火墙配置"><a href="#防火墙配置" class="headerlink" title="防火墙配置"></a>防火墙配置</h2><p>根据 2.2 章节描述，修改防火墙规则，开启 8888 端口</p><h2 id="安装和配置-stunnel-服务端"><a href="#安装和配置-stunnel-服务端" class="headerlink" title="安装和配置 stunnel 服务端"></a>安装和配置 stunnel 服务端</h2><ol><li>按照 2.3 节指导，安装 stunnel</li><li>pem 证书需要与客户端的一致，因此需要将国内服务器上 /etc/stunnel/stunnel.pem 文件拷贝到国外服务器的/etc/stunnel/stunnel.pem 文件里，可以通过 sftp，或者 mac 电脑上的 scp 指令拷贝。</li></ol><p>Mac 电脑拷贝方法是，先将文件拷贝到本地，再上传另一台服务器。<br>参考指令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp root@china_server_ip:/etc/stunnel/stunnel.pem /Users/username/</span><br></pre></td></tr></table></figure><p>这里 root 是远程服务器的用户名，china_server_ip 是 IP 地址，/Users/username 是本地路径。运行指令后，根据要求输入密码就行<br>再将本地保存的文件，上传到国外服务器。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp /Users/username/stunnel.pem root@oversea_server_ip:/etc/stunnel/stunnel.pem</span><br></pre></td></tr></table></figure><ol start="3"><li>vim 打开并修改配置文件</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cert = /etc/stunnel/stunnel.pem</span><br><span class="line">key = /etc/stunnel/stunnel.pem</span><br><span class="line">[v2ray]</span><br><span class="line">accept = 8888</span><br><span class="line">connect = localhost:443</span><br></pre></td></tr></table></figure><p>这里的 accept=8888 承接国内服务器的 connect 指令中的端口配置。connect 的地址是本地的 443 端口，由于 v2ray 配置的端口是 443，因此这里填写 443.</p><ol start="4"><li>通过 stunnel 指令运行 stunnel 服务端</li></ol><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>在配置好 stunnel 客户端和服务端之后，现在需要修改 v2ray 客户端中的原有配置，将服务器地址，从原来的国外服务器修改为国内服务器地址，将端口号由原来 v2ray 配置的 443 修改为 stunnel 客户端的 accept 端口 8888。至此，stunnel 的配置就完成了。</p><p>此教程是基于原来国外服务器已经安装好了 v2ray, ssr 等加速器的前提，并且 IP 在国内是可以 ping 通的。否则国内服务器也无法连接。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Stunnel </tag>
            
            <tag> V2ray </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>机器学习常用代码</title>
      <link href="/2023/10/24/yuque/bycwx191g5l09r4h/"/>
      <url>/2023/10/24/yuque/bycwx191g5l09r4h/</url>
      
        <content type="html"><![CDATA[<h1 id="数据分析和可视化"><a href="#数据分析和可视化" class="headerlink" title="数据分析和可视化"></a>数据分析和可视化</h1><p>在做数据模型的选择之前，通常需要对数据进行可视化，以寻找数据之间的可见关系，比如两个数据是否存在线性关系。这里列举方便快捷的可视化操作，来帮助我们快速找到数据之间的关系。</p><h2 id="单变量"><a href="#单变量" class="headerlink" title="单变量"></a>单变量</h2><h3 id="箱图"><a href="#箱图" class="headerlink" title="箱图"></a>箱图</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dataset为dataframe</span></span><br><span class="line">dataset.plot(kind=<span class="string">&#x27;box&#x27;</span>, subplots=<span class="literal">True</span>, layout=(<span class="number">2</span>,<span class="number">2</span>), sharex=<span class="literal">False</span>, sharey=<span class="literal">False</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p>下图是绘制出的 box 图，图形中，绿线为平均值，方框为 25%与 75%数值范围，上下边界值，圆圈标记异常值。<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12641647/1698154221566-4858af99-d3e8-4c6c-8ae7-1e94b052e74f.png#averageHue=%23fafafa&clientId=u1bcc1856-2bc3-4&from=paste&height=768&id=ucee1ba35&originHeight=768&originWidth=1024&originalType=binary%E2%88%B6=1&rotation=0&showTitle=false&size=43924&status=done&style=none&taskId=u8a798c9c-0a31-4553-bdfe-fa1a598568f&title=&width=1024" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2023/png/12641647/1698154221566-4858af99-d3e8-4c6c-8ae7-1e94b052e74f.png#averageHue=%23fafafa&clientId=u1bcc1856-2bc3-4&from=paste&height=768&id=ucee1ba35&originHeight=768&originWidth=1024&originalType=binary%E2%88%B6=1&rotation=0&showTitle=false&size=43924&status=done&style=none&taskId=u8a798c9c-0a31-4553-bdfe-fa1a598568f&title=&width=1024" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><h3 id="柱状图"><a href="#柱状图" class="headerlink" title="柱状图"></a>柱状图</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="comment"># histograms</span></span><br><span class="line">dataset.hist()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p>绘制柱状图<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12641647/1698154913711-6d5c4abf-1f19-446d-a309-4258202abb31.png#averageHue=%23f8f8f8&clientId=ua52ae3af-aecd-4&from=paste&height=768&id=ub694141c&originHeight=768&originWidth=1024&originalType=binary%E2%88%B6=1&rotation=0&showTitle=false&size=57748&status=done&style=none&taskId=u02a6ed0a-4fd3-4eec-aef8-ac5b3d35dfc&title=&width=1024" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2023/png/12641647/1698154913711-6d5c4abf-1f19-446d-a309-4258202abb31.png#averageHue=%23f8f8f8&clientId=ua52ae3af-aecd-4&from=paste&height=768&id=ub694141c&originHeight=768&originWidth=1024&originalType=binary%E2%88%B6=1&rotation=0&showTitle=false&size=57748&status=done&style=none&taskId=u02a6ed0a-4fd3-4eec-aef8-ac5b3d35dfc&title=&width=1024" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><h2 id="多变量"><a href="#多变量" class="headerlink" title="多变量"></a>多变量</h2><h3 id="变量之间的数据分布"><a href="#变量之间的数据分布" class="headerlink" title="变量之间的数据分布"></a>变量之间的数据分布</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pandas.plotting <span class="keyword">import</span> scatter_matrix</span><br><span class="line">...</span><br><span class="line"><span class="comment"># scatter plot matrix</span></span><br><span class="line">scatter_matrix(dataset)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p>绘制关系图<br><img src="https://cdn.nlark.com/yuque/0/2023/png/12641647/1698155111123-9dd8fe68-d9cb-4c56-96c4-697d259701a2.png#averageHue=%23f8f8f8&clientId=ua52ae3af-aecd-4&from=paste&height=768&id=XntFR&originHeight=768&originWidth=1024&originalType=binary%E2%88%B6=1&rotation=0&showTitle=false&size=157594&status=done&style=none&taskId=ua22ec8aa-b8e3-4725-ac31-0dbf1dd73a2&title=&width=1024" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2023/png/12641647/1698155111123-9dd8fe68-d9cb-4c56-96c4-697d259701a2.png#averageHue=%23f8f8f8&clientId=ua52ae3af-aecd-4&from=paste&height=768&id=XntFR&originHeight=768&originWidth=1024&originalType=binary%E2%88%B6=1&rotation=0&showTitle=false&size=157594&status=done&style=none&taskId=ua22ec8aa-b8e3-4725-ac31-0dbf1dd73a2&title=&width=1024" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"></p><h3 id="变量相关性"><a href="#变量相关性" class="headerlink" title="变量相关性"></a>变量相关性</h3><p>显示相关性数据及热图，数越大相关</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"><span class="comment"># dataset is dataframe</span></span><br><span class="line">correlation = dataset.corr()</span><br><span class="line"><span class="comment"># display(correlation)</span></span><br><span class="line">plt.figure(figsize=(<span class="number">14</span>, <span class="number">12</span>))</span><br><span class="line">heatmap = sns.heatmap(correlation, annot=<span class="literal">True</span>, linewidths=<span class="number">0</span>, vmin=<span class="number">-1</span>, cmap=<span class="string">&quot;RdBu_r&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/12641647/1698155608761-b3ae7ca0-4453-402d-afc8-aca702d7cc80.png#averageHue=%23e4e4e3&clientId=ua52ae3af-aecd-4&from=paste&height=550&id=ue2a0b23d&originHeight=550&originWidth=608&originalType=binary%E2%88%B6=1&rotation=0&showTitle=false&size=96924&status=done&style=none&taskId=u003d8816-dcba-40c2-94cf-c2147af4585&title=&width=608" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2023/png/12641647/1698155608761-b3ae7ca0-4453-402d-afc8-aca702d7cc80.png#averageHue=%23e4e4e3&clientId=ua52ae3af-aecd-4&from=paste&height=550&id=ue2a0b23d&originHeight=550&originWidth=608&originalType=binary%E2%88%B6=1&rotation=0&showTitle=false&size=96924&status=done&style=none&taskId=u003d8816-dcba-40c2-94cf-c2147af4585&title=&width=608" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Screenshot 2023-10-24 at 15.47.16.png"></p><h3 id="两个变量之间的对比"><a href="#两个变量之间的对比" class="headerlink" title="两个变量之间的对比"></a>两个变量之间的对比</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Visualize the co-relation between pH and fixed Acidity</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Create a new dataframe containing only pH and fixed acidity columns to visualize their co-relations</span></span><br><span class="line">fixedAcidity_pH = dataset[[<span class="string">&#x27;pH&#x27;</span>, <span class="string">&#x27;fixed acidity&#x27;</span>]]</span><br><span class="line"></span><br><span class="line"><span class="comment">#Initialize a joint-grid with the dataframe, using seaborn library</span></span><br><span class="line">gridA = sns.JointGrid(x=<span class="string">&quot;fixed acidity&quot;</span>, y=<span class="string">&quot;pH&quot;</span>, data=fixedAcidity_pH, size=<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#Draws a regression plot in the grid</span></span><br><span class="line">gridA = gridA.plot_joint(sns.regplot, scatter_kws=&#123;<span class="string">&quot;s&quot;</span>: <span class="number">10</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">#Draws a distribution plot in the same grid</span></span><br><span class="line">gridA = gridA.plot_marginals(sns.distplot)</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2023/png/12641647/1698156808223-245cc984-9402-4477-b9fb-d3762f78516d.png#averageHue=%23fcfcfc&clientId=ueb77f48f-bfb3-4&from=paste&height=379&id=ued7b528a&originHeight=379&originWidth=372&originalType=binary%E2%88%B6=1&rotation=0&showTitle=false&size=48332&status=done&style=none&taskId=u42b17b3d-73ea-42c5-837d-edea94234ce&title=&width=372" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2023/png/12641647/1698156808223-245cc984-9402-4477-b9fb-d3762f78516d.png#averageHue=%23fcfcfc&clientId=ueb77f48f-bfb3-4&from=paste&height=379&id=ued7b528a&originHeight=379&originWidth=372&originalType=binary%E2%88%B6=1&rotation=0&showTitle=false&size=48332&status=done&style=none&taskId=u42b17b3d-73ea-42c5-837d-edea94234ce&title=&width=372" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Screenshot 2023-10-24 at 16.07.23.png"></p><h1 id="模型选择"><a href="#模型选择" class="headerlink" title="模型选择"></a>模型选择</h1><p>sklearn 提许多模型，对于不同的数据集，不同的模型训练之后会产生不同的结果。<br>常用的模型和导入方式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.linear_model <span class="keyword">import</span> LogisticRegression</span><br><span class="line"><span class="keyword">from</span> sklearn.tree <span class="keyword">import</span> DecisionTreeClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn.neighbors <span class="keyword">import</span> KNeighborsClassifier</span><br><span class="line"><span class="keyword">from</span> sklearn.discriminant_analysis <span class="keyword">import</span> LinearDiscriminantAnalysis</span><br><span class="line"><span class="keyword">from</span> sklearn.naive_bayes <span class="keyword">import</span> GaussianNB</span><br><span class="line"><span class="keyword">from</span> sklearn.svm <span class="keyword">import</span> SVC</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="模型训练"><a href="#模型训练" class="headerlink" title="模型训练"></a>模型训练</h1><p>对于一个选择的模型，要对其进行训练。首先，需要将数据集分为训练集和验证集，然后训练模型，输出精确度。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line">...</span><br><span class="line"><span class="comment">#数据集提取x和y，x对应属性，y对应分类</span></span><br><span class="line">X_array = dataset.values[:,:<span class="number">4</span>]</span><br><span class="line">y_array = dataset.values[:,<span class="number">4</span>]</span><br><span class="line"><span class="comment">#按照1:4获取验证集和训练集</span></span><br><span class="line">X_train,X_test,y_train,y_test = train_test_split(X_array,y_array,test_size=<span class="number">0.2</span>,shuffle=<span class="literal">True</span>)</span><br><span class="line">model= SVC()</span><br><span class="line">model.fit(X_train,y_train)</span><br></pre></td></tr></table></figure><h1 id="模型打分，预测，和保存"><a href="#模型打分，预测，和保存" class="headerlink" title="模型打分，预测，和保存"></a>模型打分，预测，和保存</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">print(model.score(X_test,y_test))</span><br><span class="line">prediction = model.predict(X_test)</span><br><span class="line"><span class="keyword">import</span> joblib</span><br><span class="line"></span><br><span class="line"><span class="comment"># save the model to disk</span></span><br><span class="line">filename = <span class="string">&#x27;finalized_model.sav&#x27;</span></span><br><span class="line">joblib.dump(model, filename)</span><br><span class="line"></span><br><span class="line"><span class="comment"># some time later...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># load the model from disk</span></span><br><span class="line">loaded_model = joblib.load(filename)</span><br></pre></td></tr></table></figure><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>《<a href="https://machinelearningmastery.com/machine-learning-in-python-step-by-step/">Your First Machine Learning Project in Python Step-By-Step</a>》<br>《<a href="https://www.freecodecamp.org/news/using-data-science-to-understand-what-makes-wine-taste-good-669b496c67ee">How to Use Data Science to Understand What Makes Wine Taste Good</a>》<br>《<a href="https://machinelearningmastery.com/save-load-machine-learning-models-python-scikit-learn/">Save and Load Machine Learning Models in Python with scikit-learn</a>》</p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Data Science </tag>
            
            <tag> Machine Learning </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Matplotlib Bar3d绘制彩色带颜色标尺的3D柱形图</title>
      <link href="/2023/02/16/yuque/aha72bh3a4clcgmn/"/>
      <url>/2023/02/16/yuque/aha72bh3a4clcgmn/</url>
      
        <content type="html"><![CDATA[<p>Bar3d 的官方示例并不好看，因为它不能根据柱的高度来显示不同的颜色。虽然 bar3d 函数可以设置每个柱子的颜色，但如何设置呢？右侧的颜色标尺又如何添加？本文将详细介绍代码和必要的解释。</p><p>Matplotlib 是一个流行的 Python 可视化库，它可以用来创建各种图表，包括 3D 柱形图。bar3d 函数可以用来创建 3D 柱形图，其中每个柱子由其长度、宽度和高度定义。下面是使用 Matplotlib 创建 3D 柱形图的基本步骤： 1.导入 Matplotlib 和 Numpy 库</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> matplotlib.colors <span class="keyword">import</span> LightSource</span><br></pre></td></tr></table></figure><p>2.准备数据 为了创建 3D 柱形图，需要准备以下数据：</p><ul><li>x,y,z：每个柱子的底面中心坐标。</li><li>dx, dy, dz：每个柱子的宽度、长度和高度。</li><li>colors：每个柱子的颜色。</li></ul><p>下面是一个示例数据：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">_x = np.arange(<span class="number">4</span>)\\生成<span class="number">0</span>到<span class="number">3</span>的list</span><br><span class="line">_y = np.arange(<span class="number">5</span>)\\生成<span class="number">0</span>到<span class="number">4</span>的list</span><br><span class="line">_xx, _yy = np.meshgrid(_x, _y)\\创建一个<span class="number">4</span>行<span class="number">5</span>列的网格坐标阵列，每个坐标为一个元组(_x,_y)。_xx，和_yy则分别为对应的<span class="number">4</span>行<span class="number">5</span>列坐标的x轴和y轴值。</span><br><span class="line">x, y = _xx.ravel(), _yy.ravel()\\将x轴和y轴的<span class="number">4</span>行<span class="number">5</span>列网格的展开为一维列表。</span><br><span class="line">dz = x + y\\柱子高度为x+y</span><br><span class="line">z = np.zeros_like(dz)</span><br><span class="line"></span><br><span class="line">dx = dy = <span class="number">1</span> \\柱子长宽为<span class="number">1</span>，如果x或者y的ticks不同，比如x为[<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>]，dx设置为<span class="number">2</span>才能使柱子相互之间没有间距</span><br><span class="line">\\设置每根柱子的颜色，最小值为蓝色，最大值为红色，中间值渐变。</span><br><span class="line"><span class="keyword">if</span>((dz.max() - dz.min()) != <span class="number">0</span>):</span><br><span class="line">    colors = plt.cm.jet((dz.flatten() - dz.min()) / (dz.max() - dz.min()))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    colors = plt.cm.jet((dz.flatten() - dz.min()))</span><br></pre></td></tr></table></figure><p>3.创建图形对象并绘制柱形图</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fig = plt.figure(figsize=(<span class="number">6</span>, <span class="number">5</span>),dpi=<span class="number">300</span>)</span><br><span class="line">ax = fig.add_subplot(<span class="number">111</span>, projection=<span class="string">&#x27;3d&#x27;</span>)</span><br><span class="line">ax.bar3d(x, y, z, dx, dy, dz, color=colors,shade=<span class="literal">True</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p>这将创建一个 3D 柱形图，其中每个柱子的颜色根据柱子的高度不同而变化。如果想要添加一个颜色标尺，可以使用以下代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fig = plt.figure(figsize=(<span class="number">6</span>, <span class="number">5</span>),dpi=<span class="number">300</span>)</span><br><span class="line">ax = fig.add_subplot(<span class="number">111</span>, projection=<span class="string">&#x27;3d&#x27;</span>)</span><br><span class="line">ax.bar3d(x, y, z, dx, dy, dz, color=colors,shade=<span class="literal">True</span>)</span><br><span class="line">cbar = fig.colorbar(plt.cm.ScalarMappable(cmap = <span class="string">&#x27;jet&#x27;</span>), ax = ax,ticks=[<span class="number">0</span>, <span class="number">0.5</span>, <span class="number">1</span>], pad=<span class="number">0.1</span>)</span><br><span class="line">\\ ticks设定了标尺的标量刻度，<span class="number">0</span>为最小刻度，<span class="number">1</span>为满刻度，这里只显示三个刻度。</span><br><span class="line">cbar.ax.set_yticklabels([round(dz.min(),<span class="number">2</span>),round((dz.min()+dz.max())/<span class="number">2</span>,<span class="number">2</span>),round(dz.max(),<span class="number">2</span>)])</span><br><span class="line">\\设置刻度的显示值，分别为柱子高度的最低值，中间值和最大值。</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p>4.可选的样式和格式 可以使用 bar3d 函数的其他参数来调整柱形图的样式和格式，例如：alpha、edgecolor、linewidth 等。 5.如果图形颜色比较暗或者比较亮，可以使用 lightsource 参数调节光源的位置。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lightsource = LightSource(azdeg=<span class="number">45</span>)</span><br><span class="line">ax.bar3d(x, y, z, dx, dy, dz, color=colors,shade=<span class="literal">True</span>，lightsource=lightsource)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>LightSource 有几个参数，其中用到比较多的就是 azdeg，这个值是光源从三维图俯视角度上看下去在图里的位置，默认为 315°，表示，光源处在俯视图上，西北方向。正北方为 0°，按顺时针方向角度增加。如果默认光源不合适，可以将 azdeg 设置为 45°。 6.除了光源问题，还有柱子堆积方向的问题，由于 x 轴和 y 轴是固定从小到大排列，柱子高度可能会在 y 轴较小时比较大，导致矮的柱子被高的柱子遮挡，此时可以尝试反转轴排列方向，让 y 轴从大到小排列。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ax.set_ylim(max(y),min(y))\\y轴从大到小排列</span><br><span class="line">ax.set_xlim(max(x),min(x))\\x轴从大到小排列</span><br><span class="line">ax.bar3d(x, y, z, dx, dy, dz, color=colors,shade=<span class="literal">True</span>，lightsource=lightsource)</span><br></pre></td></tr></table></figure><p>7.柱子高度变化值相对于柱子高度值太小，比如 dz 在(666666,666699)之间。呈现出来的结果可能时，柱子高度几乎相同，但是颜色却变化很大。为了避免此问题，可以将柱子高度的范围缩小到(0,33)之间，而刻度值显示其真是大小。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">z = min(dz)</span><br><span class="line">dz=np.array(dz)-z</span><br><span class="line">ax.bar3d(x, y, z, dx, dy, dz, color=colors,shade=<span class="literal">True</span>，lightsource=lightsource)</span><br></pre></td></tr></table></figure><p>z 是柱子底面中心的坐标，原来全为 0，现在改为柱子高度最小的值，dz 为柱子的高度，现在改为原来的高度-高度最小值。那么每个柱子的高度，就是当前柱子与最短柱子的差。<br>这就是使用 Matplotlib 创建 3D 柱形图的基本步骤。通过调整数据和参数，可以创建出各种样式和格式的 3D 柱形图。<br>下面是我的数据绘制出的一个例子。<a href="https://i.328888.xyz/2023/03/02/6xvfo.png">点击可查看</a><br><a href="https://i.328888.xyz/2023/03/02/6xvfo.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/12641647/1677709082140-e9b3a1fd-186e-41e7-9ff9-869ea57e6067.png#averageHue=%23f3efec&clientId=u5b4d204a-67f4-4&from=ui&height=292&id=u81be2280&originHeight=2500&originWidth=3000&originalType=binary%E2%88%B6=2&rotation=0&showTitle=false&size=692935&status=done&style=none&taskId=u14c06928-21a6-4866-a815-2a95c36473d&title=&width=350" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2023/png/12641647/1677709082140-e9b3a1fd-186e-41e7-9ff9-869ea57e6067.png#averageHue=%23f3efec&clientId=u5b4d204a-67f4-4&from=ui&height=292&id=u81be2280&originHeight=2500&originWidth=3000&originalType=binary%E2%88%B6=2&rotation=0&showTitle=false&size=692935&status=done&style=none&taskId=u14c06928-21a6-4866-a815-2a95c36473d&title=&width=350" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="bss_effici_bss_ener_cap.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Matplotlib </tag>
            
            <tag> Bar3d </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux后台运行nostr虚荣公钥的挖掘</title>
      <link href="/2023/02/12/yuque/se6yw51mvmka3c85/"/>
      <url>/2023/02/12/yuque/se6yw51mvmka3c85/</url>
      
        <content type="html"><![CDATA[<p>挖掘 6 位以上的 npub1 公钥连号需要耗费很长的时间。在主力电脑上执行挖掘程序，对正常工作影响很大。为了能够更快的挖掘公钥，并且不影响我的工作，我在谷歌云上开了一台虚拟机，专门用来挖公钥。<br>在 Linux 终端上执行程序，终端一旦关闭，在此终端上的程序也会随之被终止。为此，可以使用 nohup 指令来使其后台继续执行。<br>cmd1:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup rana -n=8888888&amp;</span><br></pre></td></tr></table></figure><p>此命令将在执行目录下生成一个 nohup.out 文件用于储存输出。关闭终端后，rana 程序仍然会在后台执行。一段时间之后，可以通过</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi nohup.out</span><br></pre></td></tr></table></figure><p>查看 nohup.out 内容，检查虚荣公钥是否生成。<br>使用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -aux | grep <span class="string">&quot;rana&quot;</span></span><br></pre></td></tr></table></figure><p>搜索 rana 进程编号 pid。例如 pid 为 9980<br>使用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -9 9980</span><br></pre></td></tr></table></figure><p>杀死 rana 进程。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> nohup </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo博客添加Nostr NIP-05认证</title>
      <link href="/2023/02/06/yuque/yws2f9r5gek9mpxe/"/>
      <url>/2023/02/06/yuque/yws2f9r5gek9mpxe/</url>
      
        <content type="html"><![CDATA[<p>Hexo 博客部署之后可以生成一个静态网站，Nostr NIP-05 认证，要求我们在网站根目录下创建一个路径为/.well-known/nostr.json 的文件，并将认证信息放入其中。<br>为了在 Hexo 博客 public 目录（静态网站根目录）下在生成认证路径，我们可以按照以下步骤设置，</p><ol><li>在 hexo 根目录下的 sources 文件夹中新建文件夹**.well-known**</li><li>在文件夹内新建文件<strong>nostr.json</strong></li><li>将形如以下内容的 json 数据放入<strong>nostr.json</strong>，注意，下面 dca 开头的内容为 hex 格式的 public key，客户端显示的 key 都是以 npub 开头，你需要将它在网站<a href="https://damus.io/key/">https://damus.io/key/</a> 中进行转换。下面的 name 也可以换成你喜欢的字符。</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;names&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;dca5a66fed9db68c042d40e944619d1be0a6c14147f6aa54b5f02efea5551d90&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>修改博客根目录下的<strong>_config.yml</strong>文件，如下：</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Include / Exclude file(s)</span></span><br><span class="line"><span class="comment">## include:/exclude: options only apply to the &#x27;source/&#x27; folder</span></span><br><span class="line"><span class="attr">include:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">.well-known/nostr.json</span></span><br></pre></td></tr></table></figure><p>至此，当你使用<em>hexo g</em>命令生成静态文件，在 public 文件夹下会自动生成.well-known 文件夹。</p><ol start="5"><li>在 Nostr 客户端的 NIP-05 设置中，添加形如<strong><a href="mailto:&#x6e;&#x61;&#109;&#x65;&#64;&#x79;&#111;&#x75;&#114;&#x64;&#111;&#109;&#97;&#105;&#110;&#46;&#x63;&#x6f;&#x6d;">&#x6e;&#x61;&#109;&#x65;&#64;&#x79;&#111;&#x75;&#114;&#x64;&#111;&#109;&#97;&#105;&#110;&#46;&#x63;&#x6f;&#x6d;</a></strong>的配置，即可验证成功。</li></ol>]]></content>
      
      
      <categories>
          
          <category> Nostr </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> Nostr </tag>
            
            <tag> NIP-05 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nostr NIP-05认证服务简介和配置</title>
      <link href="/2023/02/06/yuque/glm9gga3y0gu8wdr/"/>
      <url>/2023/02/06/yuque/glm9gga3y0gu8wdr/</url>
      
        <content type="html"><![CDATA[<h1 id="1-NIP-05-简介"><a href="#1-NIP-05-简介" class="headerlink" title="1. NIP-05 简介"></a>1. NIP-05 简介</h1><p>NIP-05 认证服务，通过验证域名的持有身份，就可以在支持 NIP-05 的客户端里展示一个和微博 Twitter 认证类似的 V 的小图标。其基本原理是，域名持有者，在域名路径下返回一个 json 格式的数据内容，域名路径类似于：<a href="https://sci.ci/.well-known/nostr.json?name=qifei">https://sci.ci/.well-known/nostr.json?name=qifei</a>，点击此链接，你能看到返回的 json 文本为，</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;names&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;qifei&quot;</span>: <span class="string">&quot;dca5a66fed9db68c042d40e944619d1be0a6c14147f6aa54b5f02efea5551d90&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在 Nostr 客户端中，例如 Damus，配置 nip05 认证的格式为 <strong><a href="mailto:&#113;&#x69;&#102;&#101;&#x69;&#64;&#x73;&#99;&#105;&#46;&#99;&#105;">&#113;&#x69;&#102;&#101;&#x69;&#64;&#x73;&#99;&#105;&#46;&#99;&#105;</a></strong>，这里的 qifei 我们叫做 name，sci.ci 为域名。<br>这是我的 Nostr 账户的认证例子。</p><h1 id="2-免费认证服务"><a href="#2-免费认证服务" class="headerlink" title="2. 免费认证服务"></a>2. 免费认证服务</h1><p>如果你没有自己的域名或者不想更改你的 web 服务器内容，那么你可以使用现有的免费认证服务，nost.vip 提供了这项服务，在 nip05 认证信息中直接填写形如以下字符的内容，</p><blockquote><p><a href="mailto:&#x6e;&#x70;&#x75;&#x62;&#x2e;&#x2e;&#46;&#46;&#46;&#x40;&#x6e;&#x6f;&#115;&#x74;&#x2e;&#118;&#x69;&#112;">&#x6e;&#x70;&#x75;&#x62;&#x2e;&#x2e;&#46;&#46;&#46;&#x40;&#x6e;&#x6f;&#115;&#x74;&#x2e;&#118;&#x69;&#112;</a></p></blockquote><p>这里 npub 开头的字符串是你的 nostr 账户 id，比如我的账户 id 是 npub1mjj6vmldnkmgcppdgr55gcvar0s2ds2pglm254947qh0af24rkgqwelkyh<br>对应认证信息为</p><blockquote><p><a href="mailto:&#x6e;&#x70;&#117;&#x62;&#x31;&#x6d;&#x6a;&#x6a;&#54;&#118;&#x6d;&#108;&#x64;&#110;&#x6b;&#109;&#103;&#x63;&#112;&#112;&#100;&#x67;&#114;&#53;&#53;&#x67;&#99;&#x76;&#x61;&#114;&#x30;&#115;&#x32;&#100;&#x73;&#50;&#112;&#103;&#x6c;&#x6d;&#x32;&#x35;&#52;&#x39;&#x34;&#55;&#x71;&#104;&#48;&#x61;&#102;&#x32;&#x34;&#114;&#107;&#103;&#113;&#119;&#101;&#x6c;&#x6b;&#x79;&#x68;&#64;&#x6e;&#x6f;&#x73;&#x74;&#x2e;&#118;&#x69;&#x70;">&#x6e;&#x70;&#117;&#x62;&#x31;&#x6d;&#x6a;&#x6a;&#54;&#118;&#x6d;&#108;&#x64;&#110;&#x6b;&#109;&#103;&#x63;&#112;&#112;&#100;&#x67;&#114;&#53;&#53;&#x67;&#99;&#x76;&#x61;&#114;&#x30;&#115;&#x32;&#100;&#x73;&#50;&#112;&#103;&#x6c;&#x6d;&#x32;&#x35;&#52;&#x39;&#x34;&#55;&#x71;&#104;&#48;&#x61;&#102;&#x32;&#x34;&#114;&#107;&#103;&#113;&#119;&#101;&#x6c;&#x6b;&#x79;&#x68;&#64;&#x6e;&#x6f;&#x73;&#x74;&#x2e;&#118;&#x69;&#x70;</a></p></blockquote><p>这样我就有了 nost.vip 的认证</p><h1 id="3-Github-Pages-认证"><a href="#3-Github-Pages-认证" class="headerlink" title="3. Github Pages 认证"></a>3. Github Pages 认证</h1><p>如果你没有域名，或者有自己的域名但没有服务器，那么你可以使用 github pages 的域名，例如我的 github page 为 xieqifei.github.io，我就可以认证到这个域名下，当然也可以在 github 设置中添加自定义域名。</p><p>这里默认你已经了解 github pages 并用它创建过自己的博客页面。如果你不了解 github page，你可能需要其他的功课。一个简单的介绍，github pages 可以将你命名形如为 your-username.github.io 的仓库转为网站目录，你在里面防止的任何文件都可以以 your-username.github.io 加路径的方式访问。</p><p>现在开始创建一个，以你用户名开头并以.github.io 结尾的仓库，如果已有可以忽略。<br>具体步骤如下：</p><ol><li>在仓库里新建一个**.well-known**的文件夹</li><li><strong>well-known</strong>文件夹中新建一个<strong>nostr.json</strong>文件</li><li>进入网页<a href="https://damus.io/key/">https://damus.io/key/</a> 将你以 npub 开头的 damus key 转为 hex 格式的 hex key</li><li>在<strong>nostr.json</strong>文件中放入以下内容</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;names&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;yourname&quot;</span>: <span class="string">&quot;hex key&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="5"><li>修改 yourname 为任意字符串，hex key 为第三步转换的结果。保存<strong>nostr.json</strong></li><li>在仓库的根目录中创建一个文件名为**.nojekyll<strong>的文件，该文件</strong>.nojekyll**将允许 GitHub 页面为静态 json 文件提供服务。</li><li>之后前往 GitHub 存储库设置以启用 GitHub 页面。</li></ol><p>现在你应该可以通过访问 your-username.github.io/.web-known/nostr.json 获取到用于 nip05 认证的 json 信息了。<br>在 nostr 客户端中设置形如<a href="mailto:&#121;&#x6f;&#117;&#x72;&#110;&#97;&#x6d;&#x65;&#64;&#121;&#111;&#x75;&#114;&#x2d;&#117;&#x73;&#101;&#x72;&#x6e;&#97;&#x6d;&#x65;&#46;&#103;&#x69;&#x74;&#104;&#x75;&#x62;&#x2e;&#105;&#x6f;">&#121;&#x6f;&#117;&#x72;&#110;&#97;&#x6d;&#x65;&#64;&#121;&#111;&#x75;&#114;&#x2d;&#117;&#x73;&#101;&#x72;&#x6e;&#97;&#x6d;&#x65;&#46;&#103;&#x69;&#x74;&#104;&#x75;&#x62;&#x2e;&#105;&#x6f;</a>你就拥有了 V 认证。<br>你也可以在 github page 中配置自己的域名，并通过设置 <a href="mailto:&#x79;&#x6f;&#117;&#x72;&#x6e;&#x61;&#x6d;&#101;&#x40;&#x79;&#111;&#x75;&#114;&#x64;&#x6f;&#x6d;&#97;&#x69;&#110;&#46;&#99;&#111;&#x6d;">&#x79;&#x6f;&#117;&#x72;&#x6e;&#x61;&#x6d;&#101;&#x40;&#x79;&#111;&#x75;&#114;&#x64;&#x6f;&#x6d;&#97;&#x69;&#110;&#46;&#99;&#111;&#x6d;</a>，在客户端中展示你自己域名的认证。</p>]]></content>
      
      
      <categories>
          
          <category> Nostr </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nostr </tag>
            
            <tag> NIP-05 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Onedrive API大文件上传记录</title>
      <link href="/2022/12/08/yuque/xl9i86wz2ibmvgzz/"/>
      <url>/2022/12/08/yuque/xl9i86wz2ibmvgzz/</url>
      
        <content type="html"><![CDATA[<h2 id="1-获取-UploadSession"><a href="#1-获取-UploadSession" class="headerlink" title="1. 获取 UploadSession"></a>1. 获取 UploadSession</h2><p>在已经获取到 AccessToken 的条件下，发送 post 请求，获取 uploadsession</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST</span><br><span class="line">https://graph.microsoft.com/v1.0/me/drive/root:/FolderA/FolderB/FileC.txt:/createUploadSession</span><br><span class="line">Content-Type: application/json &#123; &quot;item&quot;: &#123; &quot;@odata.type&quot;:</span><br><span class="line">&quot;microsoft.graph.driveItemUploadableProperties&quot;,</span><br><span class="line">&quot;@microsoft.graph.conflictBehavior&quot;: &quot;rename&quot;, &quot;name&quot;: &quot;FileC.txt&quot; &#125; &#125;</span><br></pre></td></tr></table></figure><p>在这里，我们将文件 FileC.txt 上传到/FolderA/FolderB/路径下。rename，同名时将文件重命名。<br>看代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> requestUrl = <span class="string">`<span class="subst">$&#123;driveApi&#125;</span>/root<span class="subst">$&#123;encodePath(</span></span></span><br><span class="line"><span class="string"><span class="subst">  cleanPath</span></span></span><br><span class="line"><span class="string"><span class="subst">)&#125;</span>/<span class="subst">$&#123;filename&#125;</span>:/createUploadSession`</span>;</span><br><span class="line"><span class="keyword">const</span> reqConfig = &#123;</span><br><span class="line">  headers: &#123;</span><br><span class="line">    Authorization: <span class="string">`Bearer <span class="subst">$&#123;accessToken&#125;</span>`</span>,</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> reqData = <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">  item: &#123;</span><br><span class="line">    <span class="string">&quot;@odata.type&quot;</span>: <span class="string">&quot;microsoft.graph.driveItemUploadableProperties&quot;</span>,</span><br><span class="line">    <span class="string">&quot;@microsoft.graph.conflictBehavior&quot;</span>: <span class="string">&quot;rename&quot;</span>,</span><br><span class="line">    name: filename,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> &#123; data, status &#125; = <span class="keyword">await</span> axios.post(requestUrl, reqData, reqConfig);</span><br></pre></td></tr></table></figure><p>返回的 data</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;@odata.context&quot;</span>: <span class="string">&quot;https://graph.microsoft.com/v1.0/$metadata#microsoft.graph.uploadSession&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;expirationDateTime&quot;</span>: <span class="string">&quot;2022-12-12T20:59:36.57Z&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;nextExpectedRanges&quot;</span>: [<span class="string">&quot;0-&quot;</span>],</span><br><span class="line">  <span class="attr">&quot;uploadUrl&quot;</span>: <span class="string">&quot;https://api.onedrive.com/rup/58719e3298535c9/eyJSZXNvdXJjZUlEIjoiNTg3MTlFMzI5ODUzNUM5ITE3ODU3MSIsIlJlbGF0aW9uc2hpcE5hbWUiOiJhYmMudHh0In0/4mZis-sabj24PL04uRIPxFu8jB1QNaqhHn3eEq-i__MpQWp4mF6nKvusl4Fox5Ft0yLsU_7QiHhK-NI--fVAOFYkn9UJNhSnhmm4RKzmdOYtQ/eyJuYW1lIjoiYWJjLnR4dCIsIkBuYW1lLmNvbmZsaWN0QmVoYXZpb3IiOiJyZW5hbWUifQ/4whWhy7zc-wazWcDSDucdkL6f5fEKVs3OonVBriho3EeaCue1gPmUTmqeHSsDsRaAvWjXqVN_337TlMGrEqJvIp-DK8aZsnw-1sB_fGObZ9cZAhBUT4O8Qh5EgWvr_GQLI9WBj94gFUEQxpTpHHGs6jpPcAJJJMHY1mB7iHzDbgsSuIjeDnMG7Cta7P0fGUWPVBXXYh6A9GdgEPkixGymS6LKbhbezFnDDoG4edG1IeOtqyYc372sEmERWDPdqkIdEbJ20LFKaGxGfposh4jkzTpWlNW8ga3KeiL8GwNJDZngOIER1NI-qJ1R_fFlU5yQTzM87zZCNUW52GGZT4k7qD7ghQzfrghgZJbxrVX2w1FNKXUhp3K9UXSNYfC6ITyboCPPOEd8iJ4Bp4Vgo5lCKTLHb9zG2-fmLun5swOTE1aB2Bt98KvOlho5uNMbArfM8bOrtUFAodtp_0ZeHoj6BPixKxKgkuxXwd3ArDpGLnVJpTnOaIvw3GnUClPM0IK6KPWufVf7f6iL9M7ih5LNMJ31u84ey9DHFXso-2LvMkC-lXbS7LrILZ-oRzvq19oZTSg3lvNczxJUuuRQqpDLkSA&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过 data.uploadUrl 提取上传 url。</p><h2 id="2-获取多个文件"><a href="#2-获取多个文件" class="headerlink" title="2. 获取多个文件"></a>2. 获取多个文件</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">ref</span>=<span class="string">&#123;uploadInput&#125;</span> <span class="attr">multiple</span> <span class="attr">className</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">onChange</span>=<span class="string">&#123;handleFileEvent&#125;</span> /&gt;</span></span><br><span class="line">&lt;FloatButton tooltip=&#123;&lt;div&gt;&#123;t(&#x27;Upload files&#x27;)&#125;&lt;/div&gt;&#125; icon=&#123;&lt;UploadOutlined /&gt;&#125; onClick=&#123;() =&gt; &#123;</span><br><span class="line">          uploadInput.current?.click()</span><br><span class="line">&#125;&#125; /&gt;</span><br></pre></td></tr></table></figure><p>在 input 标签中通过 multiple 指定文件可以为多个，并在 onChange 中指定文件选择完后的运行的函数，这里是 handleFileEvent。ref 用于找到 input 标签，我们将它隐藏，用一个按钮替代它，使它更加美观。<br>当文件选择完后，在 handleFileEvent 函数中获取并处理它。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> handleFileEvent = <span class="function">(<span class="params">e: &#123; target: &#123; files: any &#125; &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> chosenFiles = <span class="built_in">Array</span>.prototype.slice.call(e.target.files);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>e 是 input 对象，我们使用 Array.prototype.slice.call(e.target.files)来获取多个文件，并将每个文件分开放入列表中，之后可以通过循环获取。</p><h2 id="3-切片"><a href="#3-切片" class="headerlink" title="3. 切片"></a>3. 切片</h2><p>每个文件都很大，由于 onedrive api 指定我们每次上传的文件不能超过 60MB 且每块都必须是 327680B 的倍数，<br>所以我们首先需要将文件切块</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sliceFile = <span class="function">(<span class="params">file: File, pieceSize = <span class="number">5</span> * <span class="number">256</span> * <span class="number">256</span> * <span class="number">30</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> totalSize = file.size; <span class="comment">//total size of file</span></span><br><span class="line">  <span class="keyword">let</span> start = <span class="number">0</span>; <span class="comment">// start byte</span></span><br><span class="line">  <span class="keyword">let</span> end = start + pieceSize; <span class="comment">// end byte</span></span><br><span class="line">  <span class="keyword">if</span> (end &gt; file.size) &#123;</span><br><span class="line">    end = file.size;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> chunks: &#123;&#125;[] = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">  <span class="keyword">while</span> (start &lt; totalSize) &#123;</span><br><span class="line">    <span class="comment">// slice the length</span></span><br><span class="line">    <span class="comment">// File inhert Blob, so it can use slice function.</span></span><br><span class="line">    <span class="keyword">let</span> blob = file.slice(start, end);</span><br><span class="line">    chunks.push(&#123; <span class="attr">start</span>: start, <span class="attr">end</span>: end - <span class="number">1</span>, <span class="attr">blob</span>: blob &#125;);</span><br><span class="line">    start = end;</span><br><span class="line">    end = start + pieceSize;</span><br><span class="line">    <span class="keyword">if</span> (end &gt; file.size) &#123;</span><br><span class="line">      end = file.size;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> chunks;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>上述将文件切块为 5 _ 256 _ 256 * 30B 大小的块，所有块放入 chunks 列表中。列表的每个元素是一个数组<br>{ ‘start’: start, ‘end’: end - 1, ‘blob’: blob }，分别表示，开始的 Byte，结束 Byte，以及这些 Byte 的二进制内容。</p><h2 id="4-分段上传"><a href="#4-分段上传" class="headerlink" title="4. 分段上传"></a>4. 分段上传</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> chunks = sliceFile(file, pieceSize);</span><br><span class="line">    <span class="keyword">while</span> (getFileStatus(isUploadDone, file) === <span class="string">&quot;uploading&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> chunk = chunks[start / pieceSize];</span><br><span class="line">      <span class="keyword">let</span> reqConfig = &#123;</span><br><span class="line">        headers: &#123;</span><br><span class="line">          <span class="string">&quot;Content-Range&quot;</span>: <span class="string">`bytes <span class="subst">$&#123;chunk[<span class="string">&quot;start&quot;</span>]&#125;</span>-<span class="subst">$&#123;chunk[<span class="string">&quot;end&quot;</span>]&#125;</span>/<span class="subst">$&#123;file.size&#125;</span>`</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="comment">//DO NOT use access token here.</span></span><br><span class="line">      <span class="keyword">let</span> res = <span class="keyword">await</span> axios.put(uploadUrl, chunk[<span class="string">&quot;blob&quot;</span>], reqConfig);</span><br><span class="line">      <span class="comment">// res.status is 202, last chunk upload success</span></span><br><span class="line">      <span class="comment">//get next range and redict</span></span><br><span class="line">      <span class="keyword">if</span> (res.status === <span class="number">202</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> &#123; nextExpectedRanges &#125; = res.data;</span><br><span class="line">        <span class="comment">// &quot;nextExpectedRanges&quot;: [</span></span><br><span class="line">        <span class="comment">//   &quot;12345-55232&quot;,</span></span><br><span class="line">        <span class="comment">//   &quot;77829-99375&quot;</span></span><br><span class="line">        <span class="comment">//   ]</span></span><br><span class="line">        start = <span class="built_in">parseInt</span>(nextExpectedRanges[<span class="number">0</span>].split(<span class="string">&quot;-&quot;</span>)[<span class="number">0</span>]);</span><br><span class="line">        isUploadDone = <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//all upload done</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (res.status === <span class="number">201</span>) &#123;</span><br><span class="line">        resolve(res.data);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//file conflict</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (res.status === <span class="number">409</span>) &#123;</span><br><span class="line">        <span class="comment">//if error, upload url need to be delete from onedrive server</span></span><br><span class="line">        reject(</span><br><span class="line">          file.name + <span class="string">&quot;: file name conflict. You upload two file with same name&quot;</span></span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    reject(file.name + <span class="string">&quot;:upload failed, msg:&quot;</span> + err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>上述代码省略了许多东西，我们主要是看它的功能实现，首先是利用 sliceFile 函数将文件切片，然后循环上传片段，由于 onedrive 在每次上传结束都会返回下次需要开始 Byte 的位置，而且不允许同时上传多个片段，所以我们需要等待上一个片段上传完毕，获取到下一个开始位置，再开始上传新的块。上传使用 put，对应 url 为最开始我们获取的 upload session。响应代码为 202 表示，没上传完，201 表示上传结束，其他则为错误代码。</p><h2 id="5-暂停错误和断点续传"><a href="#5-暂停错误和断点续传" class="headerlink" title="5. 暂停错误和断点续传"></a>5. 暂停错误和断点续传</h2><p>在上传过程中，可能遇到网络错误，或者主动暂停上传，这是我们可以在报错或者暂停逻辑中，保存上传的文件，并等待用户点击重新上传或继续上传（这两个逻辑对应相同处理方法）<br>对于报错后的处理，是将文件直接保存到一个 js 常量中</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> pausedFiles = <span class="keyword">new</span> <span class="built_in">Array</span>&lt;File&gt;</span><br><span class="line"><span class="keyword">const</span> push2PausedFiles = <span class="function">(<span class="params">file: File</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> isSameFile = pausedFiles.some(<span class="function">(<span class="params">f</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (f.name === file.name) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">if</span> (!isSameFile) &#123;</span><br><span class="line">    pausedFiles.push(file)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里我们使用 pausedFiles 来储存暂停的文件<br>然后在用户点击重新上传时，通过 get 上传会话连接获取下一个开始的 Byte 点，并按照分段上传的逻辑，对文件切片，并从开始的 byte 点开始上传。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> rep = <span class="keyword">await</span> axios.get(uploadUrl);</span><br><span class="line"><span class="keyword">let</span> &#123; nextExpectedRanges &#125; = rep.data;</span><br><span class="line"><span class="keyword">let</span> start = <span class="built_in">parseInt</span>(nextExpectedRanges[<span class="number">0</span>].split(<span class="string">&quot;-&quot;</span>)[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure><p>详细的代码逻辑在<a href="https://github.com/xieqifei/onedrive-vercel-manage/blob/main/utils/uploadFile.ts">github/xieqifei/onedrive-vercel-manage</a></p>]]></content>
      
      
      <categories>
          
          <category> 网站编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> onedrive </tag>
            
            <tag> api </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>反爬虫-如何检测有没有使用Puppeteer</title>
      <link href="/2021/10/15/yuque/sarv0k/"/>
      <url>/2021/10/15/yuque/sarv0k/</url>
      
        <content type="html"><![CDATA[<p>现在检测 Puppeteer 越来越难了，用户可以通过 js 对无头浏览器进行各种伪装，webdriver、webgl、plugins 都很难检测到爬虫，在这里有一个新思路。<br>许多网页都有检测控制台是否开启的功能，其中大多数网页会直接禁用 F12 和右键，但这似乎并没有什么用处，因为浏览器也有其他办法开启控制台，偶然的机会，我看到这篇文章《<a href="https://juejin.cn/post/6844903857227726856">判断控制台是否开启(chrome)</a>》。其中提供了一个思路来检测控制台是否开启，也就是重写某个函数的 toString 方法。当控制台开启时使用 console.log 时这个方法将被调用，从而检测到用户开启了控制台。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkOpen</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">checkOpen.toString = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.opened = <span class="literal">true</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;%c&quot;</span>, checkOpen);</span><br><span class="line"><span class="comment">// checkOpen.opened will become true if/when the console is opened</span></span><br></pre></td></tr></table></figure><p>偶然的机会，我发现当用户使用 Puppeteer 访问网页时，即便控制台没有被开启，这个方法的 this.opened 也会被置为 true，也就是说，我们用这个方法不仅可以检测到用户是否打开了控制台，用户在使用 Puppeteer 没有开启控制台的情况下也会被检测到。<br>这里的一个简单小实验是，别人提供的一个<a href="https://blog.aepkill.com/demos/devtools-detector">检测控制台开启 Demo</a>，通过 Puppeteer 测试开启并截图后，看到控制台是开启状态。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> <span class="built_in">this</span>.page.goto(<span class="string">&quot;https://blog.aepkill.com/demos/devtools-detector/&quot;</span>);</span><br><span class="line"><span class="keyword">await</span> <span class="built_in">this</span>.page.screenshot(&#123; <span class="attr">path</span>: <span class="string">&quot;aaa.png&quot;</span> &#125;);</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2021/png/12641647/1634302613686-7afd16c2-520e-4f75-b1f9-1bca435784dd.png#clientId=udb29c5f4-00bd-4&from=paste&height=143&id=u53548930&originHeight=286&originWidth=2235&originalType=binary%E2%88%B6=1&size=53437&status=done&style=none&taskId=ub416649a-78ca-4185-bac2-4fbdde70cb1&width=1117.5" class="lazyload" data-srcset="https://cdn.nlark.com/yuque/0/2021/png/12641647/1634302613686-7afd16c2-520e-4f75-b1f9-1bca435784dd.png#clientId=udb29c5f4-00bd-4&from=paste&height=143&id=u53548930&originHeight=286&originWidth=2235&originalType=binary%E2%88%B6=1&size=53437&status=done&style=none&taskId=ub416649a-78ca-4185-bac2-4fbdde70cb1&width=1117.5" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image.png"><br>刚才提到的那篇文章的作者，提供了一个开源的检测控制台模块，<a href="https://github.com/AEPKILL/devtools-detector#devtools-detector-">devtools-detector</a>，可以用做 Puppeteer 检测。</p>]]></content>
      
      
      <categories>
          
          <category> 爬虫 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 反爬虫 </tag>
            
            <tag> Puppeteer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vuejs学习笔记</title>
      <link href="/2021/08/12/yuque/tzxsoy/"/>
      <url>/2021/08/12/yuque/tzxsoy/</url>
      
        <content type="html"><![CDATA[<h1 id="1：简介"><a href="#1：简介" class="headerlink" title="1：简介"></a>1：简介</h1><p>从两年前我学习 web 编程开始，我参与或完成了好几个 web 项目，这几个 web 项目都是比较简单的、给自己练习用的，而在开发过程中，我一直使用 js+html+css+mdui。使用单纯的原生语言和最基础的一个 css 库开发，体验是很不好的，我一直想找一个好用的前端开发方案，让开发变得简单，直到认识了 vue。<br>这不是我第一次学习 vue，早在一年前，我就学习过一段时间，可惜当时没有好的 web 练手项目。导致 vue 在学习之后就荒废了，后来的项目开发也没有去使用它。经过了几个项目开发，才感觉到，我真的需要将 vue 好好的利用起来。于是在我备考之余，重新来学习 vue。之后可能还会学习 Vue Dev-ui。它提供的组件很丰富，我觉得可以完全替代 mdui。</p><h1 id="2：Hello-World"><a href="#2：Hello-World" class="headerlink" title="2：Hello World"></a>2：Hello World</h1><p>vue 使用 script 标签引入<br>一个简单的 html 实例：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">  &#123;&#123;1+1&#125;&#125; &#123;&#123;myname&#125;&#125; &#123;&#123;myhtml&#125;&#125;</span><br><span class="line">  <span class="comment">&lt;!-- v-指令 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-html</span>=<span class="string">&quot;myhtml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">    el: <span class="string">&quot;#box&quot;</span>,</span></span><br><span class="line">    data: &#123;</span><br><span class="line"><span class="javascript">      myname: <span class="string">&quot;qifei&quot;</span>,</span></span><br><span class="line"><span class="javascript">      myjob: <span class="string">&quot;student&quot;</span>,</span></span><br><span class="line"><span class="handlebars"><span class="xml">      myhtml: &quot;<span class="tag">&lt;<span class="name">b</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">b</span>&gt;</span>&quot;,</span></span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="3：v-if-和-v-show"><a href="#3：v-if-和-v-show" class="headerlink" title="3：v if 和 v show"></a>3：v if 和 v show</h1><p>v-if：创建和删除节点<br>v-show：显示和隐藏节点</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-show</span>=<span class="string">&quot;isShow&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;isCreated&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">    el: <span class="string">&quot;#box&quot;</span>,</span></span><br><span class="line">    data: &#123;</span><br><span class="line"><span class="javascript">      isShow: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">      isCreated: <span class="literal">true</span>,</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="javascript">  vm.isShow = <span class="literal">false</span>; <span class="comment">//控件显示隐藏</span></span></span><br><span class="line"><span class="javascript">  vm.isCreated = <span class="literal">false</span>; <span class="comment">//控件创建和删除</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="4：class-绑定和按钮"><a href="#4：class-绑定和按钮" class="headerlink" title="4：class 绑定和按钮"></a>4：class 绑定和按钮</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;handleClick()&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">&quot;isActive?&#x27;red&#x27;:&#x27;yellow&#x27;&quot;</span>&gt;</span>动态class-三目写法<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">&quot;classObj&quot;</span>&gt;</span>动态class-字典写法<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">:class</span>=<span class="string">&quot;classArr&quot;</span>&gt;</span>动态class-数组写法<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">    el: <span class="string">&quot;#box&quot;</span>,</span></span><br><span class="line">    data: &#123;</span><br><span class="line"><span class="javascript">      isActive: <span class="literal">true</span>,</span></span><br><span class="line">      classObj: &#123;</span><br><span class="line"><span class="javascript">        a: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">        b: <span class="literal">true</span>,</span></span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      classArr: [<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>],</span></span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      handleClick() &#123;</span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.isActive = !<span class="built_in">this</span>.isActive;</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="javascript">  vm.classObj.a = <span class="literal">false</span>;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>字典写法，不能通过添加键值对来增加 class。而数组写法，可以通过 pop()，push()方法添加元素来怎加 class</p><h1 id="5：style-绑定"><a href="#5：style-绑定" class="headerlink" title="5：style 绑定"></a>5：style 绑定</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">:style</span>=<span class="string">&quot;&#x27;background:&#x27;+(isActive?&#x27;red&#x27;:&#x27;yellow&#x27;)&quot;</span>&gt;</span></span><br><span class="line">    动态绑定style-三目写法</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">:style</span>=<span class="string">&quot;styleObj&quot;</span>&gt;</span>动态绑定style-对象写法<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">:style</span>=<span class="string">&quot;styleArr&quot;</span>&gt;</span>动态绑定style-数组写法<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">    el: <span class="string">&quot;#box&quot;</span>,</span></span><br><span class="line">    data: &#123;</span><br><span class="line"><span class="javascript">      isActive: <span class="literal">true</span>,</span></span><br><span class="line">      styleObj: &#123;</span><br><span class="line"><span class="javascript">        background: <span class="string">&quot;red&quot;</span>,</span></span><br><span class="line"><span class="javascript">        backgroundColor: <span class="string">&quot;red&quot;</span>,</span></span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      styleArr: [&#123; <span class="attr">backgroud</span>: <span class="string">&quot;red&quot;</span> &#125;],</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="javascript">  vm.classObj.a = <span class="literal">false</span>;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>数组写法，可以通过 push()添加新的样式，字典写法不能新加。</p><h1 id="6：条件渲染"><a href="#6：条件渲染" class="headerlink" title="6：条件渲染"></a>6：条件渲染</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;isCreated&quot;</span>&gt;</span>动态创建<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else</span>&gt;</span>动态创建<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;datalist.length&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;data in datalist&quot;</span>&gt;</span>&#123;&#123;data&#125;&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-else-if</span>=<span class="string">&quot;datalist.length &gt;=3&quot;</span>&gt;</span>if lager than 2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>empty<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">    el: <span class="string">&quot;#box&quot;</span>,</span></span><br><span class="line">    data: &#123;</span><br><span class="line"><span class="javascript">      isCreated: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">      datalist: [<span class="string">&quot;111&quot;</span>, <span class="string">&quot;222&quot;</span>, <span class="string">&quot;333&quot;</span>],</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="7：列表渲染"><a href="#7：列表渲染" class="headerlink" title="7：列表渲染"></a>7：列表渲染</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;data in datalist&quot;</span> <span class="attr">key</span>=<span class="string">&quot;data.id&quot;</span>&gt;</span>&#123;&#123;data&#125;&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(data,key) in dataObj&quot;</span>&gt;</span>&#123;&#123;data&#125;&#125;&#125; ---&#123;&#123;key&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">    el: <span class="string">&quot;#box&quot;</span>,</span></span><br><span class="line">    data: &#123;</span><br><span class="line"><span class="javascript">      datalist: [<span class="string">&quot;111&quot;</span>, <span class="string">&quot;222&quot;</span>, <span class="string">&quot;333&quot;</span>],</span></span><br><span class="line">      dataObj: &#123;</span><br><span class="line"><span class="javascript">        abc: <span class="string">&quot;abio&quot;</span>,</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="javascript">  vm.datalist.push(<span class="string">&quot;666&quot;</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>关键字可以是 in 也可以是 of</p><h1 id="8：列表数组检测"><a href="#8：列表数组检测" class="headerlink" title="8：列表数组检测"></a>8：列表数组检测</h1><p>filter(),contact(),map()方法对原数组没有影响，视图不会更新。<br>通过索引值修改数组，视图不会更新。<br>通过 splice 或者，<br>Vue.set(datalist,0,’111’)</p><h1 id="9：列表过滤引用"><a href="#9：列表过滤引用" class="headerlink" title="9：列表过滤引用"></a>9：列表过滤引用</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">input</span>=<span class="string">&quot;handleInput()&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;mytext&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;data in datalist&quot;</span> <span class="attr">key</span>=<span class="string">&quot;data.id&quot;</span>&gt;</span>&#123;&#123;data&#125;&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">    el: <span class="string">&quot;#box&quot;</span>,</span></span><br><span class="line">    data: &#123;</span><br><span class="line"><span class="javascript">      mytext: <span class="string">&quot;&quot;</span>,</span></span><br><span class="line"><span class="javascript">      datalist: [<span class="string">&quot;111&quot;</span>, <span class="string">&quot;222&quot;</span>, <span class="string">&quot;333&quot;</span>],</span></span><br><span class="line"><span class="javascript">      list: [<span class="string">&quot;111&quot;</span>, <span class="string">&quot;222&quot;</span>, <span class="string">&quot;333&quot;</span>],</span></span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      handleInput() &#123;</span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> datalist = <span class="built_in">this</span>.list.filter(</span></span><br><span class="line"><span class="javascript">          (item) =&gt; item.indexOf(<span class="built_in">this</span>.mytext) &gt; <span class="number">-1</span></span></span><br><span class="line">        );</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="javascript">  vm.datalist.push(<span class="string">&quot;666&quot;</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="10：事件处理"><a href="#10：事件处理" class="headerlink" title="10：事件处理"></a>10：事件处理</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;handleClick&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;handleClick()&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;javascript:&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">    el: <span class="string">&quot;#box&quot;</span>,</span></span><br><span class="line">    data: &#123;&#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      handleClick() &#123;&#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="javascript">  vm.datalist.push(<span class="string">&quot;666&quot;</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vuejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>OpenOffice连接Mysql数据库</title>
      <link href="/2021/08/02/yuque/sbv265/"/>
      <url>/2021/08/02/yuque/sbv265/</url>
      
        <content type="html"><![CDATA[<p>使用 Openoffice 连接 mysql 数据库总体体验不是很好，软件长时间处于未响应状态，并不建议使用它来操作 mysql 数据库，其他的数据库暂时不知道。<br>这里简单说下使用过程中的一些问题和解决办法。</p><ol><li>Java 环境。openoffice 能够识别的 java 环境必须是 32 位的，因此坑爹的就是，我 64 位的一直没法被识别出来，于是下了一个 32 位的，通过软件上方的，工具-&gt;选项-&gt;openoffice-&gt;Java 来手动选择 32 位 jre 的文件位置。</li><li>mysql-Java 驱动。驱动是不包含在 java 环境或者 openoffice 软件里的，需另外下载: <a href="http://mvnrepository.com/artifact/mysql/mysql-connector-java">mysql-connector</a>。选择一个版本的，下载以.jar 结尾的文件。将驱动放在 jre 文件夹里 lib/ext 目录下。</li></ol><p>现在就可以是哦那个 openoffice 连接数据库了。<br>可能是同时获取的数据库条目过多，软件的性能并不好，还是推荐使用 phpmyadmin 连接 mysql 数据库。</p>]]></content>
      
      
      <categories>
          
          <category> 其他 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Openoffice </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>安卓ToyVPN服务端从零开始读</title>
      <link href="/2021/07/27/yuque/dm1gpv/"/>
      <url>/2021/07/27/yuque/dm1gpv/</url>
      
        <content type="html"><![CDATA[<h1 id="0：导读"><a href="#0：导读" class="headerlink" title="0：导读"></a>0：导读</h1><p>这个程序是基于 c++实现的一个简单 VPN 服务器，搭配 ToyVPN 安卓客户端食用。为了从零开始了解 VPN 的原理，我决定花时间来解读服务端的代码，并在此记录。<br>代码原址：<a href="https://android.googlesource.com/platform/development/+/master/samples/ToyVpn/server/linux/ToyVpnServer.cpp">ToyVPNServer.cpp</a></p><h1 id="1：库说明"><a href="#1：库说明" class="headerlink" title="1：库说明"></a>1：库说明</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;//标准输入输出库，例如printf和scanf函数</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;//标准库，将字符串变量转为其他类型变量</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;//字符串库</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;//Unix标准库，提供通用的文件、目录、程序及进程操作的函数</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;arpa/inet.h&gt;//提供IP地址转换函数</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netinet/in.h&gt;//定义数据结构sockaddr_in</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ioctl.h&gt;//提供对I/O控制的函数</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;//提供socket函数及数据结构</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;//unix/linux系统定义文件状态所在的伪标准头文件</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;//数据类型定义</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;errno.h&gt;//提供错误号errno的定义，用于错误处理</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;//提供对文件控制的函数</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __linux__<span class="comment">//如果__linux__被定义了</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;net/if.h&gt;//套接字本地接口，</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/if_tun.h&gt;//用于建立Tun，虚拟网卡</span></span></span><br></pre></td></tr></table></figure><h1 id="2：获取接口"><a href="#2：获取接口" class="headerlink" title="2：获取接口"></a>2：获取接口</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//此方法中用到的函数，均在linux/if_tun.h中</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">get_interface</span><span class="params">(<span class="keyword">char</span> *name)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> interface = open(<span class="string">&quot;/dev/net/tun&quot;</span>, O_RDWR | O_NONBLOCK);<span class="comment">//打开tun字符设备</span></span><br><span class="line">    ifreq ifr;<span class="comment">//初始化一个ifreq结构体，见2，1节</span></span><br><span class="line">    <span class="built_in">memset</span>(픦, <span class="number">0</span>, <span class="keyword">sizeof</span>(ifr));<span class="comment">//清空结构体ifr成员变量的值，或者叫初始化</span></span><br><span class="line">    ifr.ifr_flags = IFF_TUN | IFF_NO_PI;<span class="comment">//指定网络设备的一些特性</span></span><br><span class="line">    <span class="built_in">strncpy</span>(ifr.ifr_name, name, <span class="keyword">sizeof</span>(ifr.ifr_name));<span class="comment">//把name复制给ifr.ifr_name，指定虚拟网络设备名称</span></span><br><span class="line">    <span class="keyword">if</span> (ioctl(interface, TUNSETIFF, 픦)) &#123;<span class="comment">//管理IO设备函数ioctl，创建或打开一个虚拟网络设备，返回值&lt;0则出错。见2.2节</span></span><br><span class="line">        perror(<span class="string">&quot;Cannot get TUN interface&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> interface;<span class="comment">//返回接口</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在 linux 操作系统中，可以直接向**/dev/net/tun**字符设备写入或读取 IP 数据包，写入的 IP 数据包，将被直接送到 TCP/IP 协议栈并进行发送，而接收到的 IP 数据包也可以从 tun 文件中读取。</p><ul><li>O_RDWR 以可读写方式打开文件；</li><li>O_NONBLOCK 以不可阻断的方式打开文件, 也就是无论有无数据读取或等待, 都会立即返回进程之中。</li></ul><h2 id="2-1-ifreq-结构体"><a href="#2-1-ifreq-结构体" class="headerlink" title="2.1 ifreq 结构体"></a>2.1 ifreq 结构体</h2><p>对于结构体 ifr，我们只关心其中的两个成员 ifr_name, ifr_flags。ifr_name 定义了要创建或者打开的虚拟设备名字，如果没有此名称的设备或者为空，则新建一个虚拟设备，并返回一个新建的虚拟网络上设备名称。ifr_flags 用来描述设备的一些属性：</p><blockquote><ul><li>IFF_TUN: 创建一个点对点设备</li><li>IFF_TAP: 创建一个以太网设备</li><li>IFF_NO_PI: 不包含包信息，默认的每个数据包当传到用户空间时，都将包含一个附加的包头来保存包信息</li><li>IFF_ONE_QUEUE: 采用单一队列模式，即当数据包队列满的时候，由虚拟网络设备自已丢弃以后的数据包直到数据包队列再有空闲</li></ul></blockquote><p>配置的时候，IFF_TUN 和 IFF_TAP 必须择一，其他选项则可任意组合。TAP 等同于一个以太网设备，它操作第二层数据包如以太网数据帧。TUN 模拟了网络层设备，操作第三层数据包比如 IP 数据包。可以理解为 TAP 比 TUN 封装时多了一个目标和本机的机器地址(MAC)。IFF_NO_PI 没有开启时所附加的包信息头如下:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tun_pi</span> &#123;</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">short</span> flags;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">short</span> proto;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>目前，flags 只在收取数据包的时候有效，当它的 TUN_PKT_STRIP 标志被置时，表示当前的用户空间缓冲区太小，以致数据包被截断。proto 成员表示发送/接收的数据包的协议。</p><h2 id="2-2-ioctl-函数"><a href="#2-2-ioctl-函数" class="headerlink" title="2.2 ioctl()函数"></a>2.2 ioctl()函数</h2><p>上面代码中的文件描述符 fd 除了支持 TUN_SETIFF 和其他的常规 ioctl 命令外，还支持以下命令:</p><blockquote><ul><li>TUNSETNOCSUM: 不做校验和校验。参数为 int 型的 bool 值。</li><li>TUNSETPERSIST: 把对应网络设备设置成持续模式，默认的虚拟网络设备，当其相关的文件符被关闭时，也将会伴随着与之相关的路由等信息同时消失。如果设置成持续模式，那么它将会被保留供以后使用。参数为 int 型的 bool 值。</li><li>TUNSETOWNER: 设置网络设备的属主。参数类型为 uid_t。</li><li>TUNSETLINK: 设置网络设备的链路类型，此命令只有在虚拟网络设备关闭的情况下有效。参数为 int 型。</li></ul></blockquote><p>ioctl 函数的作用是，将我们要求的配置，转换为/dev/net/tun 能够识别的字符写入到字符设备中。来建立一个 tun 接口。</p><h1 id="3：获取隧道"><a href="#3：获取隧道" class="headerlink" title="3：获取隧道"></a>3：获取隧道</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">get_tunnel</span><span class="params">(<span class="keyword">char</span> *port, <span class="keyword">char</span> *secret)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// We use an IPv6 socket to cover both IPv4 and IPv6.</span></span><br><span class="line">    <span class="keyword">int</span> tunnel = socket(AF_INET6, SOCK_DGRAM, <span class="number">0</span>);<span class="comment">//创建一个socket描述符，见3.1节</span></span><br><span class="line">    <span class="keyword">int</span> flag = <span class="number">1</span>;</span><br><span class="line">    setsockopt(tunnel, SOL_SOCKET, SO_REUSEADDR, &amp;flag, <span class="keyword">sizeof</span>(flag));<span class="comment">//打开地址复用功能</span></span><br><span class="line">    flag = <span class="number">0</span>;</span><br><span class="line">    setsockopt(tunnel, IPPROTO_IPV6, IPV6_V6ONLY, &amp;flag, <span class="keyword">sizeof</span>(flag));<span class="comment">//同时允许ipv6和ipv4</span></span><br><span class="line">    <span class="comment">// 只接收本地端口消息</span></span><br><span class="line">    sockaddr_in6 addr;<span class="comment">//IPV6结构体，成员包括地址，端口，flow information以及scope-id等</span></span><br><span class="line">    <span class="built_in">memset</span>(&amp;addr, <span class="number">0</span>, <span class="keyword">sizeof</span>(addr));<span class="comment">//初始化addr</span></span><br><span class="line">    addr.sin6_family = AF_INET6;</span><br><span class="line">    addr.sin6_port = htons(atoi(port));<span class="comment">//atoi()字符串转整数，htons()将主机字节顺序转为网络字节顺序</span></span><br><span class="line">    <span class="comment">// Call bind(2) in a loop since Linux does not have SO_REUSEPORT.</span></span><br><span class="line">    <span class="keyword">while</span> (bind(tunnel, (sockaddr *)&amp;addr, <span class="keyword">sizeof</span>(addr))) &#123;</span><br><span class="line">        <span class="keyword">if</span> (errno != EADDRINUSE) &#123;<span class="comment">//错误如果不是端口被占用，则退出。否则继续循环</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        usleep(<span class="number">100000</span>);<span class="comment">//停止0.1s，此函数包含在unistd.h中</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Receive packets till the secret matches.</span></span><br><span class="line">    <span class="keyword">char</span> packet[<span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">socklen_t</span> addrlen;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        addrlen = <span class="keyword">sizeof</span>(addr);</span><br><span class="line">        <span class="keyword">int</span> n = recvfrom(tunnel, packet, <span class="keyword">sizeof</span>(packet), <span class="number">0</span>,</span><br><span class="line">                (sockaddr *)&amp;addr, &amp;addrlen);<span class="comment">//接收数据，成功返回接收到的字符数</span></span><br><span class="line">        <span class="keyword">if</span> (n &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        packet[n] = <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">while</span> (packet[<span class="number">0</span>] != <span class="number">0</span> || <span class="built_in">strcmp</span>(secret, &amp;packet[<span class="number">1</span>]));<span class="comment">//strcmp 字符串比较，相等返回0，否则为正或者负数</span></span><br><span class="line">    <span class="comment">// Connect to the client as we only handle one client at a time.</span></span><br><span class="line">    connect(tunnel, (sockaddr *)&amp;addr, addrlen);<span class="comment">//连接客户端</span></span><br><span class="line">    <span class="keyword">return</span> tunnel;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-1-socket-函数"><a href="#3-1-socket-函数" class="headerlink" title="3.1 socket 函数"></a>3.1 socket 函数</h2><p><strong>int socket(int domain, int type, int protocol);</strong><br>对应普通文件的打开操作，文件打开返回文件描述符，而 socket 返回 soket 描述符，它唯一标识了一个 socket。通过指定不同的参数，来创建不同的 socket。<br><strong>domain：</strong>即协议域，又称为协议族（family）。常用的协议族有，AF_INET、AF_INET6、AF_LOCAL（或称 AF_UNIX，Unix 域 socket）、AF_ROUTE 等等。协议族决定了 socket 的地址类型，在通信中必须采用对应的地址。</p><blockquote><ul><li>AF_INET：决定了要用 ipv4 地址 host（32 位的）与端口号 port（16 位的）的组合。host 是一个表示为互联网域名表示法之内的主机名或者一个 IPv4 地址的字符串，例如 ‘daring.cwi.nl’ 或 ‘100.50.200.5’，port 是一个整数。对于 TCP/IP 协议族，该参数置 AF_INET。</li><li>AF_INET6：表示使用 ipv6 地址或者 ipv4 地址和端口。</li><li>AF_UNIX：决定了要用一个绝对路径名作为地址。</li></ul></blockquote><p><strong>type：</strong>指定 socket 类型。常用的 socket 类型有，流套接字类型 SOCK_STREAM、数据报套接字类型 SOCK_DGRAM、原始套接字 SOCK_RAW、SOCK_PACKET、SOCK_SEQPACKET 等等。<br><strong>protocol：</strong>就是指定协议。常用的协议有，IPPROTO_TCP、IPPROTO_UDP、IPPROTO_SCTP、IPPROTO_TIPC 等，它们分别对应 TCP 传输协议、UDP 传输协议、STCP 传输协议、TIPC 传输协议。<br>type 和 protocol 是不能够随意搭配的，比如流套接字类型不能选用 UDP 协议。<strong>当 protocol 为 0 时，会自动选择 type 类型对应的协议。</strong><br>而以下两句返回的肯定是无效套接字 INVALID_SOCKET，使用 WSAGetLastError()获取的错误代码为 10043：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SOCKET s = socket(AF_INET, SOCK_DGRAM,IPPROTO_TCP)</span><br><span class="line">SOCKET s = socket(AF_INET, SOCK_STREAM,IPPROTO_UDP)</span><br></pre></td></tr></table></figure><h2 id="3-2-setsockopt-函数"><a href="#3-2-setsockopt-函数" class="headerlink" title="3.2 setsockopt 函数"></a>3.2 setsockopt 函数</h2><p><strong>int setsockopt( int socket, int level, int option_name,const void *option_value, size_t option_len);</strong><br>第一个参数 socket 是套接字描述符。第二个参数 level 是被设置的选项的级别。<br>level 指定控制套接字的层次.可以取三种值:</p><ul><li>SOL_SOCKET:通用套接字选项..</li><li>IPPROTO_IPV6:IPV6 选项</li><li>IPPROTO_IP:IP 选项</li><li>IPPROTO_TCP:TCP 选项</li></ul><p>如果想要在套接字级别上设置选项，就必须把 level 设置为 SOL_SOCKET。 option_name 指定准备设置的选项，option_name 可以有哪些取值，这取决于 level，以 linux 2.6 内核为例（在不同的平台上，这种关系可能会有不同），在套接字级别上(SOL_SOCKET)，option_name 可以有以下取 值：</p><table><thead><tr><th>SO_BROADCAST</th><th>允许发送广播数据</th><th>int</th></tr></thead><tbody><tr><td>SO_DEBUG</td><td>允许调试</td><td>int</td></tr><tr><td>SO_DONTROUTE</td><td>不查找路由</td><td>int</td></tr><tr><td>SO_ERROR</td><td>获得套接字错误</td><td>int</td></tr><tr><td>SO_KEEPALIVE</td><td>保持连接</td><td>int</td></tr><tr><td>SO_LINGER</td><td>延迟关闭连接</td><td>struct linger</td></tr><tr><td>SO_OOBINLINE</td><td>带外数据放入正常数据流</td><td>int</td></tr><tr><td>SO_RCVBUF</td><td>接收缓冲区大小</td><td>int</td></tr><tr><td>SO_SNDBUF</td><td>发送缓冲区大小</td><td>int</td></tr><tr><td>SO_RCVLOWAT</td><td>接收缓冲区下限</td><td>int</td></tr><tr><td>SO_SNDLOWAT</td><td>发送缓冲区下限</td><td>int</td></tr><tr><td>SO_RCVTIMEO</td><td>接收超时</td><td>struct timeval</td></tr><tr><td>SO_SNDTIMEO</td><td>发送超时</td><td>struct timeval</td></tr><tr><td>SO_REUSERADDR</td><td>允许重用本地地址和端口</td><td>int</td></tr><tr><td>SO_TYPE</td><td>获得套接字类型</td><td>int</td></tr><tr><td>SO_BSDCOMPAT</td><td>与 BSD 系统兼容</td><td>int</td></tr></tbody></table><h2 id="3-3-htons-函数"><a href="#3-3-htons-函数" class="headerlink" title="3.3 htons 函数"></a>3.3 htons 函数</h2><p>将主机字节顺序转换为网络字节顺序。比如，数字 16 的 16 进制表示为 0x0010，数字 4096 的 16 进制表示为 0x1000。 由于 Intel 机器是小尾端，存储数字 16 时实际顺序为 1000，存储 4096 时实际顺序为 0010。因此在发送网络包时为了报文中数据为 0010，需要经过 htons 进行字节转换。如果用 IBM 等大尾端机器，则没有这种字节顺序转换，但为了程序的可移植性，也最好用这个函数。</p><h2 id="3-4-bind-函数"><a href="#3-4-bind-函数" class="headerlink" title="3.4 bind 函数"></a>3.4 bind 函数</h2><p>在套接口中，一个套接字只是用户程序与内核交互信息的枢纽，它自身没有太多的信息，也没有网络协议地址和 端口号等信息，在进行网络通信的时候，必须把一个套接字与一个地址相关联，这个过程就是地址绑定的过程。许多时候内核会我们自动绑定一个地址，然而有时用 户可能需要自己来完成这个绑定的过程，以满足实际应用的需要，最典型的情况是一个服务器进程需要绑定一个众所周知的地址或端口以等待客户来连接。这个事由 bind 的函数完成。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bind</span><span class="params">( <span class="keyword">int</span> sockfd, struct sockaddr * addr, <span class="keyword">socklen_t</span> addrlen )</span></span></span><br></pre></td></tr></table></figure><p>成功返回 0，失败返回-1.</p><blockquote><ul><li>sockfd:指定地址与哪个套接字绑定，这是一个由之前的 socket 函数调用返回的套接字。调用 bind 的函数之后，该套接字与一个相应的地址关联，发送到这个地址的数据可以通过这个套接字来读取与使用。</li><li>addr:指定地址。这是一个地址结构，并且是一个已经经过填写的有效的地址结构。调用 bind 之后这个地址与参数 sockfd 指定的套接字关联，从而实现上面所说的效果。</li><li>addrlen:正如大多数 socket 接口一样，内核不关心地址结构，当它复制或传递地址给驱动的时候，它依据这个值来确定需要复制多少数据。这已经成为 socket 接口中最常见的参数之一了</li></ul></blockquote><h2 id="3-5-recvfrom-函数"><a href="#3-5-recvfrom-函数" class="headerlink" title="3.5 recvfrom 函数"></a>3.5 recvfrom 函数</h2><p>用来接收远程主机经指定的 socket 传来的数据, 并把数据存到由参数 buf 指向的内存空间, 参数 len 为可接收数据的最大长度. 参数 flags 一般设 0, 其他数值定义请参考 recv(). 参数 from 用来指定欲传送的网络地址, 结构 sockaddr 请参考 bind(). 参数 fromlen 为 sockaddr 的结构长度.</p><p>返回值：成功则返回接收到的字符数, 失败则返回-1, 错误原因存于 errno 中.<br>错误代码：</p><blockquote><ul><li>EBADF 参数 s 非合法的 socket 处理代码</li><li>EFAULT 参数中有一指针指向无法存取的内存空间.</li><li>ENOTSOCK 参数 s 为一文件描述词, 非 socket.</li><li>EINTR 被信号所中断.</li><li>EAGAIN 此动作会令进程阻断, 但参数 s 的 socket 为不可阻断.</li><li>ENOBUFS 系统的缓冲内存不足</li><li>ENOMEM 核心内存不足</li><li>EINVAL 传给系统调用的参数不正确.</li></ul></blockquote><h1 id="4：构建参数"><a href="#4：构建参数" class="headerlink" title="4：构建参数"></a>4：构建参数</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">build_parameters</span><span class="params">(<span class="keyword">char</span> *parameters, <span class="keyword">int</span> size, <span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 为了简单，只是盲目的连接各个参数</span></span><br><span class="line">    <span class="keyword">int</span> offset = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">4</span>; i &lt; argc; ++i) &#123;</span><br><span class="line">        <span class="keyword">char</span> *parameter = argv[i];</span><br><span class="line">        <span class="keyword">int</span> length = <span class="built_in">strlen</span>(parameter);</span><br><span class="line">        <span class="keyword">char</span> delimiter = <span class="string">&#x27;,&#x27;</span>;</span><br><span class="line">        <span class="comment">// If it looks like an option, prepend a space instead of a comma.</span></span><br><span class="line">        <span class="keyword">if</span> (length == <span class="number">2</span> &amp;&amp; parameter[<span class="number">0</span>] == <span class="string">&#x27;-&#x27;</span>) &#123;</span><br><span class="line">            ++parameter;</span><br><span class="line">            --length;</span><br><span class="line">            delimiter = <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// This is just a demo app, really.</span></span><br><span class="line">        <span class="keyword">if</span> (offset + length &gt;= size) &#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;Parameters are too large&quot;</span>);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Append the delimiter and the parameter.</span></span><br><span class="line">        parameters[offset] = delimiter;</span><br><span class="line">        <span class="built_in">memcpy</span>(&amp;parameters[offset + <span class="number">1</span>], parameter, length);</span><br><span class="line">        offset += <span class="number">1</span> + length;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Fill the rest of the space with spaces.</span></span><br><span class="line">    <span class="built_in">memset</span>(&amp;parameters[offset], <span class="string">&#x27; &#x27;</span>, size - offset);</span><br><span class="line">    <span class="comment">// Control messages always start with zero.</span></span><br><span class="line">    parameters[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="5：主程序"><a href="#5：主程序" class="headerlink" title="5：主程序"></a>5：主程序</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (argc &lt; <span class="number">5</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Usage: %s &lt;tunN&gt; &lt;port&gt; &lt;secret&gt; options...\n&quot;</span></span><br><span class="line">               <span class="string">&quot;\n&quot;</span></span><br><span class="line">               <span class="string">&quot;Options:\n&quot;</span></span><br><span class="line">               <span class="string">&quot;  -m &lt;MTU&gt; for the maximum transmission unit\n&quot;</span></span><br><span class="line">               <span class="string">&quot;  -a &lt;address&gt; &lt;prefix-length&gt; for the private address\n&quot;</span></span><br><span class="line">               <span class="string">&quot;  -r &lt;address&gt; &lt;prefix-length&gt; for the forwarding route\n&quot;</span></span><br><span class="line">               <span class="string">&quot;  -d &lt;address&gt; for the domain name server\n&quot;</span></span><br><span class="line">               <span class="string">&quot;  -s &lt;domain&gt; for the search domain\n&quot;</span></span><br><span class="line">               <span class="string">&quot;\n&quot;</span></span><br><span class="line">               <span class="string">&quot;Note that TUN interface needs to be configured properly\n&quot;</span></span><br><span class="line">               <span class="string">&quot;BEFORE running this program. For more information, please\n&quot;</span></span><br><span class="line">               <span class="string">&quot;read the comments in the source code.\n\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Parse the arguments and set the parameters.</span></span><br><span class="line">    <span class="keyword">char</span> parameters[<span class="number">1024</span>];</span><br><span class="line">    build_parameters(parameters, <span class="keyword">sizeof</span>(parameters), argc, argv);</span><br><span class="line">    <span class="comment">// Get TUN interface.</span></span><br><span class="line">    <span class="keyword">int</span> interface = get_interface(argv[<span class="number">1</span>]);</span><br><span class="line">    <span class="comment">// Wait for a tunnel.</span></span><br><span class="line">    <span class="keyword">int</span> tunnel;</span><br><span class="line">    <span class="keyword">while</span> ((tunnel = get_tunnel(argv[<span class="number">2</span>], argv[<span class="number">3</span>])) != <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s: Here comes a new tunnel\n&quot;</span>, argv[<span class="number">1</span>]);</span><br><span class="line">        <span class="comment">// On UN*X, there are many ways to deal with multiple file</span></span><br><span class="line">        <span class="comment">// descriptors, such as poll(2), select(2), epoll(7) on Linux,</span></span><br><span class="line">        <span class="comment">// kqueue(2) on FreeBSD, pthread(3), or even fork(2). Here we</span></span><br><span class="line">        <span class="comment">// mimic everything from the client, so their source code can</span></span><br><span class="line">        <span class="comment">// be easily compared side by side.</span></span><br><span class="line">        <span class="comment">// Put the tunnel into non-blocking mode.</span></span><br><span class="line">        fcntl(tunnel, F_SETFL, O_NONBLOCK);</span><br><span class="line">        <span class="comment">// Send the parameters several times in case of packet loss.</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++i) &#123;</span><br><span class="line">            send(tunnel, parameters, <span class="keyword">sizeof</span>(parameters), MSG_NOSIGNAL);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Allocate the buffer for a single packet.</span></span><br><span class="line">        <span class="keyword">char</span> packet[<span class="number">32767</span>];</span><br><span class="line">        <span class="comment">// We use a timer to determine the status of the tunnel. It</span></span><br><span class="line">        <span class="comment">// works on both sides. A positive value means sending, and</span></span><br><span class="line">        <span class="comment">// any other means receiving. We start with receiving.</span></span><br><span class="line">        <span class="keyword">int</span> timer = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// We keep forwarding packets till something goes wrong.</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="comment">// Assume that we did not make any progress in this iteration.</span></span><br><span class="line">            <span class="keyword">bool</span> idle = <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">// Read the outgoing packet from the input stream.</span></span><br><span class="line">            <span class="keyword">int</span> length = read(interface, packet, <span class="keyword">sizeof</span>(packet));</span><br><span class="line">            <span class="keyword">if</span> (length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// Write the outgoing packet to the tunnel.</span></span><br><span class="line">                send(tunnel, packet, length, MSG_NOSIGNAL);</span><br><span class="line">                <span class="comment">// There might be more outgoing packets.</span></span><br><span class="line">                idle = <span class="literal">false</span>;</span><br><span class="line">                <span class="comment">// If we were receiving, switch to sending.</span></span><br><span class="line">                <span class="keyword">if</span> (timer &lt; <span class="number">1</span>) &#123;</span><br><span class="line">                    timer = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Read the incoming packet from the tunnel.</span></span><br><span class="line">            length = recv(tunnel, packet, <span class="keyword">sizeof</span>(packet), <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span> (length == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// Ignore control messages, which start with zero.</span></span><br><span class="line">                <span class="keyword">if</span> (packet[<span class="number">0</span>] != <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">// Write the incoming packet to the output stream.</span></span><br><span class="line">                    write(interface, packet, length);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// There might be more incoming packets.</span></span><br><span class="line">                idle = <span class="literal">false</span>;</span><br><span class="line">                <span class="comment">// If we were sending, switch to receiving.</span></span><br><span class="line">                <span class="keyword">if</span> (timer &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                    timer = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// If we are idle or waiting for the network, sleep for a</span></span><br><span class="line">            <span class="comment">// fraction of time to avoid busy looping.</span></span><br><span class="line">            <span class="keyword">if</span> (idle) &#123;</span><br><span class="line">                usleep(<span class="number">100000</span>);</span><br><span class="line">                <span class="comment">// Increase the timer. This is inaccurate but good enough,</span></span><br><span class="line">                <span class="comment">// since everything is operated in non-blocking mode.</span></span><br><span class="line">                timer += (timer &gt; <span class="number">0</span>) ? <span class="number">100</span> : <span class="number">-100</span>;</span><br><span class="line">                <span class="comment">// We are receiving for a long time but not sending.</span></span><br><span class="line">                <span class="comment">// Can you figure out why we use a different value? :)</span></span><br><span class="line">                <span class="keyword">if</span> (timer &lt; <span class="number">-16000</span>) &#123;</span><br><span class="line">                    <span class="comment">// Send empty control messages.</span></span><br><span class="line">                    packet[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; ++i) &#123;</span><br><span class="line">                        send(tunnel, packet, <span class="number">1</span>, MSG_NOSIGNAL);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// Switch to sending.</span></span><br><span class="line">                    timer = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// We are sending for a long time but not receiving.</span></span><br><span class="line">                <span class="keyword">if</span> (timer &gt; <span class="number">20000</span>) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%s: The tunnel is broken\n&quot;</span>, argv[<span class="number">1</span>]);</span><br><span class="line">        close(tunnel);</span><br><span class="line">    &#125;</span><br><span class="line">    perror(<span class="string">&quot;Cannot create tunnels&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>《<a href="https://www.zybuluo.com/zwh8800/note/816322">Linux 的 TUN/TAP 编程</a>》<br>《<a href="https://blog.csdn.net/KingCat666/article/details/75269373">linux ioctl()函数详解</a>》<br>《<a href="http://c.biancheng.net/view/231.html">memset 函数及其用法，C 语言 memset 函数详解</a>》<br>《<a href="https://blog.csdn.net/lusirking/article/details/51470752">C++ socket 函数解析</a>》<br>《<a href="https://www.cnblogs.com/cthon/p/9270778.html">setsockopt 函数功能及参数详解</a>》<br>《<a href="https://www.cnblogs.com/xianzhedeyu/p/3298649.html">LINUX 下 getsockopt 和 setsockopt 函数</a>》<br>《<a href="https://blog.csdn.net/dongliqiang2006/article/details/5824651">网络编程 socket 之 bind 函数</a>》<br>《<a href="https://www.cnblogs.com/carle-09/p/12402185.html">C++ —usleep()功能</a>》<br>《<a href="http://c.biancheng.net/cpp/html/368.html">C 语言 recvfrom()函数：经 socket 接收数据</a>》</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VPN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在控制器中用JS验证CSS Selector和Xpath</title>
      <link href="/2021/07/25/yuque/hzg0pr/"/>
      <url>/2021/07/25/yuque/hzg0pr/</url>
      
        <content type="html"><![CDATA[<h1 id="0：引言"><a href="#0：引言" class="headerlink" title="0：引言"></a>0：引言</h1><p>使用 Beautifulsoup 和 Selenuim 等网页分析工具时，经常需要自己构造一个选择器，最常用的是 CSS 选择器和 Xpath。如何验证选择器构造是否正确呢？我们可以直接在网页的开发者工具 Console 栏里使用 JS 代码来验证选择器的正确性。</p><h1 id="1：CSS-Selector-验证"><a href="#1：CSS-Selector-验证" class="headerlink" title="1：CSS Selector 验证"></a>1：CSS Selector 验证</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">css_selector = <span class="string">&quot;#bs_form_main input[value=buchen]&quot;</span>;</span><br><span class="line"><span class="built_in">document</span>.querySelector(css_selector);</span><br></pre></td></tr></table></figure><p>JS 有提供 querySelector 方法，如果返回值不为 Null，则说明选择器构造正确。</p><h1 id="2：Xpath-验证"><a href="#2：Xpath-验证" class="headerlink" title="2：Xpath 验证"></a>2：Xpath 验证</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xpath = <span class="string">&#x27;//*[@id=&quot;bs_tr3FE6EE511403&quot;]/td[9]/input&#x27;</span>;</span><br><span class="line"><span class="built_in">document</span></span><br><span class="line">  .evaluate(xpath, <span class="built_in">document</span>, <span class="literal">null</span>, XPathResult.ANY_TYPE, <span class="literal">null</span>)</span><br><span class="line">  .iterateNext();</span><br></pre></td></tr></table></figure><p>evaluate 方法返回 XpathResult 对象，通过 iterateNext 可以依次获取符合选择的 Dom。通常情况下，不需要确认是否有多个符合条件的返回值，所以如果返回不是 null，则 xpath 构造正确<br>如果需要确认，返回一个或者多个符合 xpath 的 dom，可以使用下面的方法。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">x</span>(<span class="params">xpath</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> result = <span class="built_in">document</span>.evaluate(</span><br><span class="line">    xpath,</span><br><span class="line">    <span class="built_in">document</span>,</span><br><span class="line">    <span class="literal">null</span>,</span><br><span class="line">    XPathResult.ANY_TYPE,</span><br><span class="line">    <span class="literal">null</span></span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (result.iterateNext()) &#123;</span><br><span class="line">    i++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="3：参考"><a href="#3：参考" class="headerlink" title="3：参考"></a>3：参考</h1><p>《<a href="https://cloud.tencent.com/developer/article/1702495">JavaScript 技术篇-js 通过 xpath 获取 dom 节点，js 校验 xpath 唯一性。</a>》</p>]]></content>
      
      
      <categories>
          
          <category> 网站编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RWTH自习室自动预定程序(RWTH Lernraum)</title>
      <link href="/2021/07/21/yuque/dbbkl1/"/>
      <url>/2021/07/21/yuque/dbbkl1/</url>
      
        <content type="html"><![CDATA[<h2 id="1-开篇"><a href="#1-开篇" class="headerlink" title="1.开篇"></a>1.开篇</h2><p>抢座程序分为两种，基于 selenium 的浏览器自动化程序，和基于 requests 库的 http 模拟请求程序。</p><p>为了成功运行程序，请确保你的计算机安装了 Python。如何安装 Python 可自行网上搜索。两种程序命中率均比较高。可任选一种运行。<br>项目地址：<a href="https://github.com/xieqifei/AutoLernraum">https://github.com/xieqifei/AutoLernraum</a></p><h2 id="2-基于-Requests-库的预定程序-正在测试当中，不太稳定，关注-github-更新"><a href="#2-基于-Requests-库的预定程序-正在测试当中，不太稳定，关注-github-更新" class="headerlink" title="2.基于 Requests 库的预定程序(正在测试当中，不太稳定，关注 github 更新)"></a>2.基于 Requests 库的预定程序(正在测试当中，不太稳定，关注 github 更新)</h2><ol><li>安装 Python 环境</li><li>点击 github 网页上面那个绿色的<code>Code</code>按钮，选择下载为 zip，将整个程序文件从 github 下载到本地并解压。</li><li>使用任意编辑器打开<code>test_requests.py</code>，修改变量 buchung</li></ol><blockquote><p>buchung = {‘ort’: ‘’, ‘kursnr’: ‘08411027’,’info’:{ ‘username’: ‘’, ‘email’: ‘example@gmail.com’, ‘sex’: ‘M’, ‘vorname’: ‘Ivan’, ‘name’: ‘Natanael’, ‘strasse’: ‘Pontstr.23’, ‘ort’: ‘52076 Aachen’, ‘status’: ‘S-RWTH’, ‘matnr’: ‘468389’, ‘telefon’: ‘00491748068847’}}</p><p>在变量 buchung 中,需要修改的数据如下：</p><p>kursnr:你想预定的自习室的编号。例如 08411027 为 Semi90。在图书馆的预定系统中，很容易就可以找到。图书馆系统链接：<a href="https://buchung.hsz.rwth-aachen.de/angebote/aktueller_zeitraum/_Lernraumbuchung.html">https://buchung.hsz.rwth-aachen.de/angebote/aktueller_zeitraum/_Lernraumbuchung.html</a></p><p>email:你的邮箱。</p><p>sex:性别。男：M；女:W</p><p>vorname:名字。首字母大写</p><p>name:姓。首字母大写</p><p>strasse:街道和号码</p><p>ort:邮编和地址，务必注意格式是 52076 Aachen.邮编和地址以空格隔开</p><p>matnr:六位学号</p><p>telefon:带前缀的手机号</p><p>其余内容可不修改。务必注意在每个字符串两边都有单引号</p></blockquote><ol start="3"><li>保存文件，并用 python 运行<code>test_requests.py</code>文件。若你不知道如何运行 python 文件，建议上网查询。</li><li>运行后，程序会在两分钟之内，以 2 秒为间隔刷新，直到发现你指定的自习室可以预定并完成预定，或两分钟后依然没有发现可以预定的位置为止。如果你需要抢的自习室在 8 点开始，那么建议你在 7 点 59 的时候开始运行程序。。程序结束 5 分钟后，你将收到来自学校邮箱的，预定成功邮件。若没有收到，那么抢座失败。</li></ol><h2 id="3-基于-Selenium-库的浏览器自动化程序"><a href="#3-基于-Selenium-库的浏览器自动化程序" class="headerlink" title="3.基于 Selenium 库的浏览器自动化程序"></a>3.基于 Selenium 库的浏览器自动化程序</h2><p>顾名思义，你除了需要在你的电脑中安装 Python 以外，还要在你的电脑里安装 Chrome 浏览器。如果你不想安装 Chrome 那么上面的程序应该就可以满足你的需求了。之所以使用自动化，是因为它可能会比模拟 http 请求更加可靠，但缺点也很明显，它比上面的程序会慢个几秒。不过没关系，相比于人为抢座来说，它同样非常快。那么，</p><ol><li>安装 Python 环境</li><li>安装任意版本 Chrome 浏览器</li><li>打开<code>test_selenium.py</code>文件，修改<code>buchung</code>变量里的个人信息和需要预定的自习室编号，详情看第 2 章 3 节</li><li>保存文件，用 Python 运行<code>test_selenium.py</code>。</li><li>同样的，如果你预定的程序 8 点开抢，那么建议你 7:59 运行它。它将在两分钟之内反复刷新页面，直到你指定的自习室位置可以被预定，并执行预定程序，或者两分钟之后结束运行。</li></ol><h2 id="4-随机抢座"><a href="#4-随机抢座" class="headerlink" title="4.随机抢座"></a>4.随机抢座</h2><p>也许你在抢座时头破血流，也没有抢到一个位置。那么亡羊补牢，你可能需要一个程序来尝试捡漏，如果有人放弃了他的预定，并在学校的预定系统被释放出来，那么你可以用到这个程序。他会间断的刷新，直到从学校的网页里找到一个可以预定的位置，并预定成功为止。或者，除非你手动终止它，否则他将不会停止运行。</p><ol><li>安装 Python 环境</li><li>安装任意版本 Chrome 浏览器</li><li>打开<code>random_test.py</code>文件，修改<code>buchung</code>变量里的个人信息，详情看第 2 章 3 节。自习室的编号任意填写即可。</li><li>保存文件，用 Python 运行<code>random_test.py</code>。</li><li>你可在任意时候运行它。当需要结束的时候，按住<code>ctrl+C</code>或关闭终端可终止。</li></ol><p>这个程序相当鸡肋，因为很少能够遇到可以捡漏的机会，而遇到的时候，也没抢到过。</p><h2 id="5-定时运行"><a href="#5-定时运行" class="headerlink" title="5.定时运行"></a>5.定时运行</h2><p>也许你想早起的时候睡个懒觉。那么，你可以试试使用计算机定时运行 python 程序。</p><p>Windows 和 mac 系统的定时运行方法，你可以自行谷歌搜索。因为我用到过树莓派和云函数进行定时抢座，所以这里只讲 Linux 和基于腾讯云函数的定时方法。</p><p><strong>Linux 系统下的定时运行</strong>：</p><p>你需要用到 linux 自带的定时软件 crontab。非常简单，</p><ol><li>输入指令,开始编辑时间表</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure><ol start="2"><li>按下<code>i</code>开始编辑,编辑内容如下</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0,30 8 * * * python -u /home/***/test_requests.py &gt;result.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure><p>将上述<code>/home/***/test_requestes.py</code>改为你放置该文件的地址即可。</p><p>此行代码表示。将在每日的 8 点和八点半执行 python 此程序，并将 python 的输出保存到定时程序文件夹里的 result.log 文件里</p><ol start="3"><li>按下<code>:wq</code>保存退出</li></ol><p><strong>利用腾讯云函数</strong></p><p>腾讯云函数，有非常充足的免费运行空间。可以直接把程序放到上面执行，应该很少有人会用到吧，所以简单讲讲。</p><ol><li>建立一个新函数，将完整的程序上传。</li><li>新建定时触发器，自定义触发周期如下，因为定时器是以北京时间为准，所以需要考虑时差问题。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 0,30 14 * * *</span><br></pre></td></tr></table></figure><ol start="3"><li>函数入口为<code>test_serverless.main_handler</code></li></ol><h2 id="6-结尾"><a href="#6-结尾" class="headerlink" title="6.结尾"></a>6.结尾</h2><p>如果你对程序的运行原理感兴趣，那么你可以看看<code>/myclass/lernraum.py</code>文件，所有的抢座程序都在这个文件中，因为文件经过了多次修改，所以看起来可能有点杂乱无章。另外，基于此程序我开发了一个网站，用于批量自动化抢座，<a href="https://buchung.sci.ci/">https://buchung.sci.ci</a> 功能以基本实现，但由于基于 Requests 库程序还不稳定，浏览器自动化又颇耗内存，只给我的好友提供服务，暂时未开放注册，敬请期待。</p>]]></content>
      
      
      <categories>
          
          <category> python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何利用Selenium实现更加高效的爬虫</title>
      <link href="/2021/07/10/yuque/kdo456/"/>
      <url>/2021/07/10/yuque/kdo456/</url>
      
        <content type="html"><![CDATA[<h1 id="1-导语"><a href="#1-导语" class="headerlink" title="1. 导语"></a>1. 导语</h1><p>Selenium 作为浏览器自动化工具，由于其可以直接执行 js 代码的优越性，经常被用做爬虫工具。但是，毕竟需要控制浏览器，低效率高内存始终是其难以甩掉的标签。在我个人爬虫开发中，对如何高效利用 selenium 有了一套个人的理解。</p><h1 id="2-用-js-注入代替-selenium-原生操作"><a href="#2-用-js-注入代替-selenium-原生操作" class="headerlink" title="2. 用 js 注入代替 selenium 原生操作"></a>2. 用 js 注入代替 selenium 原生操作</h1><p>selenium 库提供的 execute_script 方法使 js 注入成为可能。下面是一个 js 注入的例子</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">js=<span class="string">&quot;document.getElementsByClassName(&#x27;form-control&#x27;)[0].value=&#x27;%s&#x27;;&quot;</span>%(requestCode[i][<span class="number">0</span>].value)</span><br><span class="line">driver.execute_script(js)</span><br></pre></td></tr></table></figure><p>以 selenium 填写表单为例，python 代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vorname = driver.find_element_by_name(<span class="string">&#x27;vorname&#x27;</span>)</span><br><span class="line">vorname.send_keys(<span class="string">&#x27;vorname&#x27;</span>)</span><br></pre></td></tr></table></figure><p>使用 selenium 填写表单，执行速度是相当慢的，当 input 标签很多的时候，selenium 会从上到下依次执行表单填写，这就会导致在填写完整的表单时，填写时间其实比人为通过浏览器 autocomplete 快不了多少，甚至更慢。<br>使用 js 来执行表单填写，如下代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fill_form_script = <span class="string">&quot;bsform.vorname.value=&#x27;vorname&#x27;;bsform.submit()&quot;</span></span><br><span class="line">driver.execute_script(fill_form_script)</span><br></pre></td></tr></table></figure><p>bsform 为 form 标签的 name 属性，vorname 为 input 标签的 name 属性，通过 bsform.vorname.value 代码快速填写表单，多个 input 几乎是同时完成，在调用 submit()方法提交表单，甚至可以直接绕过浏览器的表单验证。相比 selenium 模拟操作更快，代码也更加简介。</p><h1 id="3-利用-ajax-代替-selenium-打开多个窗口"><a href="#3-利用-ajax-代替-selenium-打开多个窗口" class="headerlink" title="3. 利用 ajax 代替 selenium 打开多个窗口"></a>3. 利用 ajax 代替 selenium 打开多个窗口</h1><p>我们在使用 selenium 时，最主要还是看重，它直接可以执行网页中的 js，而无需在去分析 js 代码的特点。但是受限于，其高内存占用的缺点，很难在多线程时执行爬虫任务。利用 js 注入可以在网页中执行 js 代码，既然如此，那是否可以注入 js 直接用 ajax 来请求网页，如果可以，相比较于利用 requests 库，这样可以极大的避免被网页服务器的反爬虫机制检测到，也能绕开分析 js 来获取一些参数，甚至 ajax 可以自动的为我们的请求添加 cookie，也避免每次都需要去保存 cookie 的烦恼。。事实上，selenium 为了避免其被滥用，并没有提供 ajax 的拦截功能。也就是说，即便我们通过 js 发起了请求，也不能通过 selenium 直接获取到返回的数据。<br>对此，可以利用 js 代码，将 ajax 返回的数据渲染到网页中，再通过 selenium 提取网页数据来获取 ajax 返回的数据，获取后再将网页恢复原状。这样相比于，每打开一个网页就打开一个浏览器窗口，对内存的占用就小了很多。。</p>]]></content>
      
      
      <categories>
          
          <category> 爬虫 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Selenium </tag>
            
            <tag> 爬虫 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python如何准确的计算Http请求中的Content Length</title>
      <link href="/2021/06/14/yuque/bsbcfh/"/>
      <url>/2021/06/14/yuque/bsbcfh/</url>
      
        <content type="html"><![CDATA[<p>Content Length 表示的是 http 请求中的数据长度，也就是 requests 中的 data 对应长度。<br>通常我们给 requests 传递的 data 是字典格式的，那么直接使用 len(data)是无法获得准确的 content length 的。</p><p>在 http 中，data 是以字符串的形式传递的。那么以下的字典格式的 data 对应的字符串是什么呢？</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">data = &#123;</span><br><span class="line"><span class="string">&#x27;fid&#x27;</span>: <span class="string">&#x27;df05ef96b6407055f8690b5f30322b58db776ecc7ef099197f03353e&#x27;</span></span><br><span class="line"><span class="string">&#x27;BS_Termin_2021-06-14&#x27;</span>: <span class="string">&#x27;buchen&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其对应的在 tcp 传输中的字符串是</p><blockquote><p>fid=df05ef96b6407055f8690b5f30322b58db776ecc7ef099197f03353e&amp;BS_Termin_2021-06-14=buchen</p></blockquote><p>可以看到，键和值以’=’连接，多个参数以’&amp;’连接。下面使用 python 代码计算整个字符串长度</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_content_length</span>(<span class="params">data</span>):</span></span><br><span class="line">    <span class="comment">#计算=和&amp;的字节数</span></span><br><span class="line">    length = len(data.keys()) * <span class="number">2</span> - <span class="number">1</span></span><br><span class="line">    <span class="comment">#计算键值的字节数。最后的encode是对字符串进行utf编码，</span></span><br><span class="line">    <span class="comment">#如果键值包含中文，那么一个汉字字符对应三个字节，len()方法只能计算字符的个数</span></span><br><span class="line">    <span class="comment">#而content length是字节数</span></span><br><span class="line">    total = <span class="string">&#x27;&#x27;</span>.join(list(data.keys()) + list(data.values())).encode()</span><br><span class="line">    length += len(total)</span><br><span class="line">    <span class="keyword">return</span> str(length)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网站编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Content Length </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>破解图片等资源跨域和防盗链阻拦</title>
      <link href="/2021/02/26/yuque/lupgvk/"/>
      <url>/2021/02/26/yuque/lupgvk/</url>
      
        <content type="html"><![CDATA[<p>如果 A 站点想将 B 站点的 img 等资源放到 A 站点，通常会受到对方站点防盗链的阻拦。这里是我提供的一个思路，利用腾讯云函数的免费资源，完美绕开防盗链。因为图片不会受到浏览器的跨域阻拦，其他资源的跨域问题也能通过这个方法解决。</p><h1 id="1：什么是防盗链？"><a href="#1：什么是防盗链？" class="headerlink" title="1：什么是防盗链？"></a>1：什么是防盗链？</h1><p>防盗链是由对方站点设置的，防止未受许可的站点直接引用对方站点的资源。比如这里有一个 <code>https://www.baidu.com/abc.jpg</code>  图片链接，如果你想将它放到 <code>www.yourweb.com</code>  站点的 img 标签 src 中，将受到防盗链的阻挡，浏览器将无法加载此图片。<br>防盗链是因为浏览器在发起跨域请求时携带了，referrer 请求头，此请求头含有你的站点主机，对方识别到你非许可站点，因此拒绝返回给你图片资源。<br>我在网上找了一些解决防盗链的办法，比如，设置 meta 标签为 no-referrer，使用 iframe，反向代理等。其中，针对 B 站防盗链的 meta 标签无效，iframe 过于臃肿，不适合设置，而反向代理则需要一台服务器，价格不美丽，我直接用别人网站上的资源，不就是为了白嫖吗？<br>对此我找到了一个，免费破解防盗链的方法。</p><h1 id="2：破解防盗链"><a href="#2：破解防盗链" class="headerlink" title="2：破解防盗链"></a>2：破解防盗链</h1><p>我在腾讯云函数上写了一个 python 程序，此程序，将图片资源直径转为 base64 数据，然后返回给请求者。<br>为什么腾讯云函数？<br>腾讯云函数每个月有免费的额度，其中 100 万次 api 调用，40 万 GBs 的函数运行时长(1GBs 表示，内存 1GB 运行 1 秒)，还有大概几个 G 的外网流出流量。这美丽的免费量，足够我们做图片代理了。<br>为什么转 base64？<br>首先，腾讯云函数不支持直接返回二进制或者图片资源，它只能返回纯字符串文本，或者 json 格式的字符串。python 可以利用 base64 库，将图片转为 base64 字节流，然后对其解码生成字符串。<br>除此之外，base64 格式的字符串可以直接放入 img 标签的 src 中，而无需再转为 blob。<br>python 代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment">#返回一个字符串，可直接放到img标签src中</span></span><br><span class="line"><span class="comment">#img_url图片的url</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getImgtoBase64</span>(<span class="params">img_url</span>):</span></span><br><span class="line">    resp = requests.get(img_url)</span><br><span class="line">    img_bytes=base64.b64encode(BytesIO(resp.content).read())</span><br><span class="line">    img_str = img_bytes.decode()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;data:image/&#x27;</span>+os.path.basename(img_url)+<span class="string">&#x27;;base64,&#x27;</span>+img_str</span><br></pre></td></tr></table></figure><p>这里只有关键代码，如何通过云函数 api 向云函数中传入 imgurl，需要额外的程序，比如 post 请求中添加 url 参数，或者 get 请求参数中放入 unicode 编码后的 url。<br>更多的解决办法，需要自行了解云函数。因为我的 imgurl 是直接在 python 程序中通过爬虫爬取的，没有通过前端发送 imgurl 所以没有再贴出来。这里贴出一些云函数的可能返回方法</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#前端请求时将url编码</span></span><br><span class="line"><span class="comment">#通过get请求传入imgurl参数，https://serverless-api.com/?imgurl=www.baidu.com%2fabc.jpg</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main_handler</span>(<span class="params">event,context</span>):</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="string">&#x27;imgurl&#x27;</span> <span class="keyword">in</span> event[<span class="string">&#x27;queryString&#x27;</span>]):</span><br><span class="line">        imgurl = event[<span class="string">&#x27;queryString&#x27;</span>][<span class="string">&#x27;imgurl&#x27;</span>]</span><br><span class="line">        <span class="comment">#TODO 将imgurl进行url解码</span></span><br><span class="line">     <span class="comment">#imgurl_decoded=</span></span><br><span class="line">        img_str = getImgtoBase64(imgurl_decoded)</span><br><span class="line">        <span class="comment">#返回json格式的内容</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;isBase64Encoded&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">        <span class="string">&quot;statusCode&quot;</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="string">&quot;headers&quot;</span>: &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>:<span class="string">&#x27;*&#x27;</span>&#125;,</span><br><span class="line">        <span class="string">&quot;body&quot;</span>: &#123;<span class="string">&#x27;imgstr&#x27;</span>:img_str&#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>如果不是图片资源，加入<code>Access-Control-Allow-Origin</code>  可以解决跨域问题。</p>]]></content>
      
      
      <categories>
          
          <category> 网站编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Serverless </tag>
            
            <tag> 跨域 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Selenium-Webdriver接口</title>
      <link href="/2021/02/23/yuque/fc448d/"/>
      <url>/2021/02/23/yuque/fc448d/</url>
      
        <content type="html"><![CDATA[<p>越来越多的人开始使用 Serverless 构架搭建自己的应用，而 Serverless 的缺点显而易见，很难自定义运行时。当我尝试在云函数搭建一个基于 Webdriver 的爬虫程序时，我了解到，基于 python 的 Selenium 应用还无法在云函数上运行，这是由于云函数并没有安装 chrome 浏览器。<br>如果想在云函数上运行 Selenium，则必须使用 node.js 8.10 版本+puppeteer 插件。对于 node.js 并不熟悉的我，需要重新学习这款程序。<br>我相信，随着 Serverless 的发展，会有越来越多的人跟我一样，希望通过云函数基于 Python 实现 Selenium 爬虫。因此，我将在此方向上，迈出一步，构建一个 Selenium 的 api。此应用，应当以 url 作为参数，并返回给用户 js 处理后的 html 代码。我希望它是运行在云函数上的。<br>也许它能够成为，反向代理的一种方式。那么现在开始学习 Nodjs 吧！</p>]]></content>
      
      
      <categories>
          
          <category> 构想 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Selenium </tag>
            
            <tag> Serverless </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于Serverless的音乐下载工具</title>
      <link href="/2021/02/22/yuque/nnzrrl/"/>
      <url>/2021/02/22/yuque/nnzrrl/</url>
      
        <content type="html"><![CDATA[<h1 id="1：使用手册"><a href="#1：使用手册" class="headerlink" title="1：使用手册"></a>1：使用手册</h1><p>一个基于 python，搭建在 Serverless 云函数上的免费音乐下载程序。可剥离云函数本地运行。<br>通过构造形如<code>[https://m.sci.ci/](https://m.sci.ci/)音乐相关信息</code>这样的网址，就可在浏览器上下载喜欢的音乐了。</p><h2 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h2><p>简单的例子，想听爱的供养？<br>尝试在浏览器地址栏输入<code>m.sci.ci/爱的供养</code><br>现在试试 👉<a href="https://m.sci.ci/%E7%88%B1%E7%9A%84%E4%BE%9B%E5%85%BB">m.sci.ci/爱的供养</a><br>返回的音乐文件是杨幂版本的，不喜欢？<br>尝试重新构造链接<code>m.sci.ci/张靓颖张杰爱的供养</code><br>现在返回的就是张杰和张靓颖合唱版啦！<br>歌曲下载链接仅能保存一天！音乐文件以你的搜索内容为名。比如<code>张靓颖张杰爱的供养.mp3</code>而不是原来的名称，文件中歌曲的专辑、歌词等相关信息也是没有的。</p><h1 id="2：搭建自己的服务"><a href="#2：搭建自己的服务" class="headerlink" title="2：搭建自己的服务"></a>2：搭建自己的服务</h1><p>Serverless 又称无服务、云函数，可通过一个 api 触发你写好的程序，并返回数据给请求者。<br>项目地址：<a href="https://github.com/xieqifei/free-music">https://github.com/xieqifei/free-music</a></p><h2 id="2-1-依赖"><a href="#2-1-依赖" class="headerlink" title="2.1 依赖"></a>2.1 依赖</h2><ol><li><code>youtube-dl</code>  提供通过 youtube 视频 url，下载视频或 mp3 音乐文件，需要通过 pip 安装</li><li><code>qiniu</code>  提供音乐储存服务，需要通过 pip 安装</li><li><code>requests</code>  发送网络请求</li><li><code>json</code>  解析 json 数据</li></ol><p>需要在谷歌云函数 <code>requrements.txt</code>  中填写</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">qiniu&#x3D;&#x3D;7.3.1</span><br><span class="line">requests&#x3D;&#x3D;2.22.0</span><br><span class="line">youtube-dl&#x3D;&#x3D;2021.1.16</span><br></pre></td></tr></table></figure><h2 id="2-2-音频提取和储存"><a href="#2-2-音频提取和储存" class="headerlink" title="2.2 音频提取和储存"></a>2.2 音频提取和储存</h2><p>以下程序运行在谷歌 Serverless 服务上。需要你添加自己的七牛云储存桶，如果有必要，可以使用谷歌提供的免费 youtube api 获取搜索结果，程序会优先使用爬虫获取搜索结果，当程序频繁运行时，爬虫会失效，为了提高容错，建议添加谷歌 api，此 api 每天可以发起 100 次请求来获取 youtube 搜索结果。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@file_name    :lambda_function.py</span></span><br><span class="line"><span class="string">@description  :</span></span><br><span class="line"><span class="string">@time         :2021/02/02 22:20:14</span></span><br><span class="line"><span class="string">@author       :Qifei</span></span><br><span class="line"><span class="string">@version      :1.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> youtube_dl</span><br><span class="line"><span class="keyword">from</span> qiniu <span class="keyword">import</span> Auth</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> qiniu.services.storage.bucket <span class="keyword">import</span> BucketManager</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment">#七牛云对象储存AK和SK，以及储存桶名,储存桶的cdn域名</span></span><br><span class="line">access_key = <span class="string">&#x27;&#x27;</span></span><br><span class="line">secret_key = <span class="string">&#x27;&#x27;</span></span><br><span class="line">bucket_name = <span class="string">&#x27;&#x27;</span></span><br><span class="line">qnurl = <span class="string">&quot;https://qn.xieqifei.com/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#谷歌api，用于获取youtube搜索结果</span></span><br><span class="line">google_appKey=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">q = Auth(access_key, secret_key)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handler</span>(<span class="params">request</span>):</span></span><br><span class="line">    musicname =  request.url.split(<span class="string">&quot;/&quot;</span>)[<span class="number">-1</span>]</span><br><span class="line">    video_url = get_video_url_in_youtube_from_crawler(musicname)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#遵循同源cors协议，可跨域访问</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>: <span class="string">&#x27;*&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> video_url == <span class="number">500</span>:</span><br><span class="line">        <span class="comment">#爬虫失效，切换api</span></span><br><span class="line">        video_url = get_video_url_in_youtube_form_api(google_appKey,musicname)</span><br><span class="line">        <span class="keyword">if</span> video_url == <span class="number">500</span>:</span><br><span class="line">            <span class="keyword">return</span> (<span class="string">&quot;error&quot;</span>,<span class="number">400</span>,headers)</span><br><span class="line">    filename = dl_mp3(musicname,video_url)</span><br><span class="line">    localpath = <span class="string">&quot;/tmp&quot;</span></span><br><span class="line">    dl_url = uploadfile(localpath,filename)</span><br><span class="line">    <span class="keyword">return</span> (dl_url, <span class="number">200</span>, headers)</span><br><span class="line"></span><br><span class="line"><span class="comment">#将文件上传到七牛</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">uploadfile</span>(<span class="params">localpath,filename</span>):</span></span><br><span class="line">    <span class="comment">#上传后保存的文件名</span></span><br><span class="line">    key = filename</span><br><span class="line">    <span class="comment">#生成上传 Token，可以指定过期时间等</span></span><br><span class="line">    token = q.upload_token(bucket_name, key, <span class="number">3600</span>)</span><br><span class="line">    url = <span class="string">&#x27;https://upload-z2.qiniup.com&#x27;</span></span><br><span class="line">    files = &#123;<span class="string">&#x27;file&#x27;</span>: open(localpath+<span class="string">&quot;/&quot;</span>+filename, <span class="string">&#x27;rb&#x27;</span>)&#125;</span><br><span class="line">    data = &#123;<span class="string">&#x27;token&#x27;</span>:token,<span class="string">&#x27;fileName&#x27;</span>:filename,<span class="string">&#x27;key&#x27;</span>:key&#125;</span><br><span class="line">    response = requests.post(url, files=files, data=data)</span><br><span class="line">    set_liftime(filename)</span><br><span class="line">    url=qnurl+filename</span><br><span class="line">    delete_tmp(filename)</span><br><span class="line">    <span class="keyword">return</span> url</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置保存在七牛云上的音乐文件1天后自动删除</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_liftime</span>(<span class="params">musicname</span>):</span></span><br><span class="line">    <span class="comment">#初始化BucketManager</span></span><br><span class="line">    bucket = BucketManager(q)</span><br><span class="line">    <span class="comment">#你要测试的空间， 并且这个key在你空间中存在</span></span><br><span class="line">    key = musicname</span><br><span class="line">    <span class="comment">#您要更新的生命周期</span></span><br><span class="line">    days = <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    ret, info = bucket.delete_after_days(bucket_name, key, days)</span><br><span class="line">    print(info)</span><br><span class="line"></span><br><span class="line"><span class="comment">##下载mp3格式文件</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dl_mp3</span>(<span class="params">musicname,url</span>):</span></span><br><span class="line">    ydl_opts = &#123;</span><br><span class="line">    <span class="string">&#x27;format&#x27;</span>: <span class="string">&#x27;bestaudio/best&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;postprocessors&#x27;</span>: [&#123;</span><br><span class="line">        <span class="string">&#x27;key&#x27;</span>: <span class="string">&#x27;FFmpegExtractAudio&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;preferredcodec&#x27;</span>: <span class="string">&#x27;mp3&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;preferredquality&#x27;</span>: <span class="string">&#x27;192&#x27;</span>,</span><br><span class="line">    &#125;],</span><br><span class="line">    <span class="string">&#x27;outtmpl&#x27;</span>: <span class="string">&#x27;/tmp/&#123;&#125;.mp3&#x27;</span>.format(musicname),</span><br><span class="line">    <span class="string">&#x27;quiet&#x27;</span>: <span class="literal">False</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">with</span> youtube_dl.YoutubeDL(ydl_opts) <span class="keyword">as</span> ydl:</span><br><span class="line">        ydl.download([url])</span><br><span class="line">        <span class="comment"># info = ydl.extract_info(url, download=False)</span></span><br><span class="line">        filename = <span class="string">&quot;&#123;&#125;.mp3&quot;</span>.format(musicname)</span><br><span class="line">    <span class="keyword">return</span> filename</span><br><span class="line"></span><br><span class="line"><span class="comment">#调用谷歌api获取youtube搜索结果，返回匹配度最高的视频链接</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_video_url_in_youtube_form_api</span>(<span class="params">appKey,music_name</span>):</span></span><br><span class="line">    print(<span class="string">&quot;从google api获取数据&quot;</span>)</span><br><span class="line">    url = <span class="string">&quot;https://youtube.googleapis.com/youtube/v3/search?q=&quot;</span>+music_name+<span class="string">&quot;&amp;key=&quot;</span>+appKey</span><br><span class="line">    resp = requests.get(url)</span><br><span class="line">    resp_json = resp.json()</span><br><span class="line">    <span class="keyword">if</span> resp.status_code ==<span class="number">200</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;https://www.youtube.com/watch?v=&quot;</span>+resp_json[<span class="string">&#x27;items&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;id&#x27;</span>][<span class="string">&#x27;videoId&#x27;</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">500</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#利用爬虫获取youtube搜索结果</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_video_url_in_youtube_from_crawler</span>(<span class="params">keyword</span>):</span></span><br><span class="line">    url=<span class="string">&quot;https://m.youtube.com/results?search_query=&quot;</span>+keyword</span><br><span class="line">    print(<span class="string">&quot;通过爬虫获取数据&quot;</span>)</span><br><span class="line">    resp = requests.get(url)</span><br><span class="line">    <span class="keyword">if</span> resp.status_code==<span class="number">200</span>:</span><br><span class="line">        result_json = re.findall(<span class="string">r&#x27;ytInitialData = (.*);&lt;/script&gt;&#x27;</span>, resp.text)[<span class="number">0</span>]</span><br><span class="line">        result_obj = json.loads(result_json)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            video_url = <span class="string">&quot;https://www.youtube.com/watch?v=&quot;</span>+result_obj[<span class="string">&#x27;contents&#x27;</span>][<span class="string">&#x27;twoColumnSearchResultsRenderer&#x27;</span>][<span class="string">&#x27;primaryContents&#x27;</span>][<span class="string">&#x27;sectionListRenderer&#x27;</span>][<span class="string">&#x27;contents&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;itemSectionRenderer&#x27;</span>][<span class="string">&#x27;contents&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;videoRenderer&#x27;</span>][<span class="string">&#x27;videoId&#x27;</span>]</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">500</span></span><br><span class="line">        <span class="keyword">return</span> video_url</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">500</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete_tmp</span>(<span class="params">filename</span>):</span></span><br><span class="line">    os.system(<span class="string">&quot;rm -f  /tmp/&quot;</span>+filename)</span><br><span class="line">    print(<span class="string">&quot;从tmp删除&quot;</span>+filename)</span><br></pre></td></tr></table></figure><p>上述代码，会提取谷歌请求路径中的最后一个地址作为搜索内容，比如 <code>https://service-azkac26i-1258461674.hk.apigw.tencentcs.com/release/APIGWH-1612290368/爱的供养</code>  那么爱的供养将作为搜索关键词，下载爱的供养最匹配的视频的音频 ，再保存到七牛云对象储存桶中。</p><blockquote><p>此代码仅能用于谷歌 serverless，由于权限问题，在其他 serverless，比如腾讯、亚马逊上，在将下载的视频提取音频时，ffmpeg 没有对视频的写权限，只有谷歌无服务框架支持。所以只能在谷歌上运行。</p></blockquote><p>由于谷歌 Serverless 不支持自定义 api 网址，而谷歌的域名在国内又无法访问，因此，我们需要利用腾讯的香港 serverless 再构建一个云函数。腾讯云函数支持自定义 api。<br>我相信通过一定的代码修改，ffmpeg 是有办法处理下载的视频文件的，但是由于时间关系，我不愿意再去做尝试；额，这里就直接用了谷歌 Serverless 做视频处理，再通过腾讯 serverless 自定义 api 并返回给用户一个网页，网页里提示用户等待音频处理，并发送一个异步请求给谷歌云函数，当音频处理完毕，谷歌云函数返回给网页，音频文件在七牛云储存桶的保存地址。</p><h2 id="2-3-网页构建"><a href="#2-3-网页构建" class="headerlink" title="2.3 网页构建"></a>2.3 网页构建</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@file_name    :scf.py</span></span><br><span class="line"><span class="string">@description  :用于腾讯云函数，自定义域名，返回一个静态页面，页面异步请求谷歌云函数，谷歌下载并处理音乐。然后返回链接给静态页面</span></span><br><span class="line"><span class="string">@time         :2021/02/03 00:49:36</span></span><br><span class="line"><span class="string">@author       :Qifei</span></span><br><span class="line"><span class="string">@version      :1.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handler</span>(<span class="params">event,context</span>):</span></span><br><span class="line">    musicname =  event[<span class="string">&#x27;path&#x27;</span>].split(<span class="string">&quot;/&quot;</span>)[<span class="number">-1</span>]</span><br><span class="line">    html=<span class="string">&#x27;&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;&gt;&lt;title&gt;处理中&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;&lt;strong&gt;服务器正在处理你的请求，请不要关闭页面，音乐将在倒计数结束前抵达。。&lt;/strong&gt;&lt;/h1&gt;&lt;p id=&quot;demo&quot;&gt;&lt;/p&gt;&lt;h1 id=&quot;show&quot; name=&quot;n1&quot; &gt;&lt;/h1&gt;&lt;img src=&quot;https://qn.xieqifei.com/tipps.png&quot; alt=&quot;tipps&quot; width=&quot;300&quot;/&gt;&lt;script&gt;var xhr=new XMLHttpRequest();xhr.onload=function()&#123;window.location.replace(xhr.responseText);&#125;;xhr.onerror=function()&#123;document.getElementById(&quot;demo&quot;).innerHTML=&quot;请求出错&quot;&#125;;xhr.open(&quot;GET&quot;,&quot;https://service-azkac26i-1258461674.hk.apigw.tencentcs.com/release/APIGWHtmlDemo-1612290368/&#x27;</span>+musicname+<span class="string">&#x27;&quot;,true);xhr.send();function countdown() &#123;var n = 20;var interval;if (n &gt; 0) &#123;interval = setInterval(() =&gt; &#123;n--;document.getElementById(&quot;show&quot;).innerHTML = n;if (n&lt;= 0) &#123;clearInterval(interval)&#125;&#125;, 1000)&#125; &#125; countdown();&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;isBase64Encoded&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">        <span class="string">&quot;statusCode&quot;</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="string">&quot;headers&quot;</span>: &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html&#x27;</span>,<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>:<span class="string">&#x27;*&#x27;</span>&#125;,</span><br><span class="line">        <span class="string">&quot;body&quot;</span>: html</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>来看看网页部分，也就是上述代码中的 html 变量，格式化后</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>处理中<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">strong</span></span></span><br><span class="line"><span class="tag">        &gt;</span>服务器正在处理你的请求，请不要关闭页面，音乐将在倒计数结束前抵达。。<span class="tag">&lt;/<span class="name">strong</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;demo&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">&quot;show&quot;</span> <span class="attr">name</span>=<span class="string">&quot;n1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://qn.xieqifei.com/tipps.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;tipps&quot;</span> <span class="attr">width</span>=<span class="string">&quot;300&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span></span><br><span class="line"><span class="javascript">      xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">window</span>.location.replace(xhr.responseText);</span></span><br><span class="line">      &#125;;</span><br><span class="line"><span class="javascript">      xhr.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="built_in">document</span>.getElementById(<span class="string">&quot;demo&quot;</span>).innerHTML = <span class="string">&quot;请求出错&quot;</span></span></span><br><span class="line">      &#125;;</span><br><span class="line"><span class="javascript">      xhr.open(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;https://service-azkac26i-1258461674.hk.apigw.tencentcs.com/release/APIGWH12290368/&#x27;+musicname+&#x27;&quot;</span>, <span class="literal">true</span>);</span></span><br><span class="line">      xhr.send();</span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">countdown</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> n = <span class="number">20</span>;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> interval;</span></span><br><span class="line">          if (n &gt; 0) &#123;</span><br><span class="line"><span class="javascript">              interval = <span class="built_in">setInterval</span>(() = &gt;&#123;</span></span><br><span class="line">                  n--;</span><br><span class="line"><span class="javascript">                  <span class="built_in">document</span>.getElementById(<span class="string">&quot;show&quot;</span>).innerHTML = n;</span></span><br><span class="line">                  if (n &lt;= 0) &#123;</span><br><span class="line"><span class="javascript">                      <span class="built_in">clearInterval</span>(interval)</span></span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;,</span><br><span class="line">              1000)</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      countdown();</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>网页会有一个文字提醒，并有一个 20 秒倒计时的标签，通常视频的下载和处理都会在十几秒内完成，当谷歌上的云函数处理完音频后，会直接返回给网页音频地址，而网页通过 js 直接跳转到音乐的储存链接，可以直接播放，也可以下载。</p><h2 id="2-4-中转节点"><a href="#2-4-中转节点" class="headerlink" title="2.4 中转节点"></a>2.4 中转节点</h2><p>正如 2.2 节所讲，谷歌云函数的 api 在国内是无法访问的。当 2.3 节的网页发送到用户浏览器时，谷歌云函数 api 是本地发起的请求，如果用户在国内，那么请求将被长城防火墙拦截，导致请求失败。为了让全球用户都可以使用服务，我们需要在腾讯香港云函数上搭建一个中转节点。此节点用于接收网页的异步请求，并转发到谷歌云函数，激活音乐下载服务，并转发结果给网页。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@file_name    :scf_node.py</span></span><br><span class="line"><span class="string">@description  :解决国内用户无法直接请求谷歌api问题</span></span><br><span class="line"><span class="string">@time         :2021/02/06 12:16:35</span></span><br><span class="line"><span class="string">@author       :Qifei</span></span><br><span class="line"><span class="string">@version      :1.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handler</span>(<span class="params">event,context</span>):</span></span><br><span class="line">    musicname =  event[<span class="string">&#x27;path&#x27;</span>].split(<span class="string">&quot;/&quot;</span>)[<span class="number">-1</span>]</span><br><span class="line">    resp = requests.get(<span class="string">&quot;https://asia-east2-you*******ch-303517.cloudfunctions.net/music/&quot;</span>+musicname)</span><br><span class="line">    <span class="keyword">if</span>(resp.status_code == <span class="number">200</span>):</span><br><span class="line">        mscurl = resp.text</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;isBase64Encoded&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">            <span class="string">&quot;statusCode&quot;</span>: <span class="number">200</span>,</span><br><span class="line">            <span class="string">&quot;headers&quot;</span>: &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/html; charset=&quot;UTF-8&#x27;</span>,<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>:<span class="string">&#x27;*&#x27;</span>&#125;,</span><br><span class="line">            <span class="string">&quot;body&quot;</span>: mscurl</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">&quot;isBase64Encoded&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">            <span class="string">&quot;statusCode&quot;</span>: <span class="number">500</span>,</span><br><span class="line">            <span class="string">&quot;headers&quot;</span>: &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/plain&#x27;</span>,<span class="string">&#x27;Access-Control-Allow-Origin&#x27;</span>:<span class="string">&#x27;*&#x27;</span>&#125;,</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h1 id="3：结语"><a href="#3：结语" class="headerlink" title="3：结语"></a>3：结语</h1><p>重新梳理一遍整个过程。</p><ol><li>我们在谷歌云函数上搭建了一个 youtube 视频下载并提取其音频的服务。</li><li>然后构建了一个网页，这个网页用于向谷歌云函数发起请求。这个网页由一个腾讯云函数下发给用户。</li><li>因为网页的请求是用户发起的，那么国内用户无法访问谷歌云函数的 api，我们又在腾讯云函数香港上搭建了一个中专服务函数，此函数用于接收网页请求，代网页请求谷歌并返回音乐下载链接给网页。</li></ol><p>如果你的服务对象是国外用户，那么中专节点是不需要的。</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Serverless </tag>
            
            <tag> Youtube-dl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在ifvod上爬取m3u8播放链接</title>
      <link href="/2021/02/21/yuque/rs5ytp/"/>
      <url>/2021/02/21/yuque/rs5ytp/</url>
      
        <content type="html"><![CDATA[<h1 id="0：绪"><a href="#0：绪" class="headerlink" title="0：绪"></a>0：绪</h1><p>在上个月，我通过爬取 youtube 视频，提取 mp3，制作了一个基于云函数的搜索音乐网站。后来，我抱着解决 ifvod 广告的想法，阅读了 ifvod 的网站源码，并且通过修改 js 代码，成功删除了 ifvod 的广告。受上述两个过程的启发，我想，通过提取 ifvod 上的视频 m3u8 链接来制作一个基于云函数的视频搜索网站。</p><h1 id="1：什么是-m3u8"><a href="#1：什么是-m3u8" class="headerlink" title="1：什么是 m3u8"></a>1：什么是 m3u8</h1><p>m3u8 文件是一种文本文件，其格式如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#EXTM3U</span><br><span class="line">#EXT-X-VERSION:3</span><br><span class="line">#EXT-X-TARGETDURATION:18</span><br><span class="line">#EXTINF:10.677,</span><br><span class="line">media_0.ts?dnvodendtime&#x3D;1613939123&amp;dnvodhash&#x3D;LMkLRmsUktNRN4h-OrHuElRGhV71N32vV4nueFAQJXw%3D&amp;dnvodCustomParameter&#x3D;0_2003%3Ae3%3Af2f%3A5700%3A8417%3Aeeca%3A9a8e%3A1d35_1&amp;lb&#x3D;3c19337f6084516e1517490ee377c4b9&amp;us&#x3D;1&amp;vv&#x3D;4e5dcf3b2432cd03dd525e0489d72248&amp;pub&#x3D;1613766323672</span><br><span class="line">#EXTINF:14.515,</span><br><span class="line">media_1.ts?dnvodendtime&#x3D;1613939123&amp;dnvodhash&#x3D;LMkLRmsUktNRN4h-OrHuElRGhV71N32vV4nueFAQJXw%3D&amp;dnvodCustomParameter&#x3D;0_2003%3Ae3%3Af2f%3A5700%3A8417%3Aeeca%3A9a8e%3A1d35_1&amp;lb&#x3D;3c19337f6084516e1517490ee377c4b9&amp;us&#x3D;1&amp;vv&#x3D;4e5dcf3b2432cd03dd525e0489d72248&amp;pub&#x3D;1613766323672</span><br></pre></td></tr></table></figure><p>在这个文本中，记录了视频的源地址。。我们常见的视频格式比如 mp4，mp4 文件直接储存了视频的全部信息。可直接使用播放器播放。而 m3u 又称流媒体，这种方法，是将原来完整的视频，切割成几秒到十几秒不等的，ts 格式的视频片段，将每个片段作为一个视频内容储存在服务器，而 m3u8 文件储存的就是每个片段的 url 地址。html5 播放器通过检索 m3u8 文件的内容，逐个下载视频片段，并播放。如今有许多软件支持，根据 m3u8 文件下载或播放视频。也就是说，如果我们有了 m3u8 文件的 url，就可以在网站外下载和播放视频了。</p><h1 id="2：构造-json-请求链接"><a href="#2：构造-json-请求链接" class="headerlink" title="2：构造 json 请求链接"></a>2：构造 json 请求链接</h1><p>通过分析 ifvod 网站返回的数据，可以发现。在一个请求返回的 json 数据中，包含了我们想要的视频地址，请求是</p><blockquote><p><a href="https://m8.ifvod.tv/api/video/play?cinema=1&id=xcql1mznpF0&region=DE&device=1&ispath=true&usersign=1&vv=ad4bee064a3af6c8a41cda35111966fd&pub=1613905710379">https://m8.ifvod.tv/api/video/play?cinema=1&amp;id=xcql1mznpF0&amp;region=DE&amp;device=1&amp;ispath=true&amp;usersign=1&amp;vv=ad4bee064a3af6c8a41cda35111966fd&amp;pub=1613905710379</a></p></blockquote><p>分析这个请求 url，可以发现，其中 id 是视频的 id，直接出现在视频播放的地址栏中，vv 和 pub 是签名和公钥，有了这三个数据，我们就可以根据视频的 id 来获取视频的 m3u8 地址了。<br>尝试请求这个可以看到返回的数据是：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;ret&quot;</span>: <span class="number">200</span>,</span><br><span class="line">  <span class="attr">&quot;data&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;code&quot;</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;msg&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;info&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;id&quot;</span>: <span class="number">625223</span>,</span><br><span class="line">        <span class="attr">&quot;vl&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;add_date&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;post_Year&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;channel&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;videoType&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;contxt&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;updateweekly&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;commentNumber&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;isVideoFavrited&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">&quot;taxis&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;flvPathList&quot;</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;isHls&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;result&quot;</span>: <span class="string">&quot;https://s1-a1.dnvodcdn.me/fast/423B3C813853-70244.mp4&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;validator&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;link&quot;</span>: <span class="string">&quot;http://ppt.ifvod.tv/c/c?position%3dPI%26d%3d1169%26r%3d7&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;broker&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;backup&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;rtmp&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;needSign&quot;</span>: <span class="literal">false</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;isHls&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;result&quot;</span>: <span class="string">&quot;https://s1-a1.dnvodcdn.me/fast/A0B67356-87371.mp4&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;validator&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;link&quot;</span>: <span class="string">&quot;http://ppt.ifvod.tv/c/c?position%3dPI%26d%3d1230%26r%3d7&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;broker&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;backup&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;rtmp&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;needSign&quot;</span>: <span class="literal">false</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;isHls&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;result&quot;</span>: <span class="string">&quot;https://s1-a1.dnvodcdn.me/fast/F709860823-88837.mp4&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;validator&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;link&quot;</span>: <span class="string">&quot;http://ppt.ifvod.tv/c/c?position%3dPI%26i%3d575%26r%3d7&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;broker&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;backup&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;rtmp&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;needSign&quot;</span>: <span class="literal">false</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;isHls&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">&quot;result&quot;</span>: <span class="string">&quot;https://hss8.dnvodcdn.me/ppot/_definst_/mp4:s8/gvod/xj-fllyssx-480p-03656717C.mp4/chunklist.m3u8?dnvodendtime=1614078950&amp;dnvodhash=c7O8AgFsLq6N1O8ysAfNyp6SlvOLrVniVvvW2PEz8zU=&amp;dnvodCustomParameter=0_2003%3ae3%3af2f%3a5700%3a8417%3aeeca%3a9a8e%3a1d35_1&amp;lb=1f4a12a7923561331e23eee32ad4be8a&amp;us=1&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;validator&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;link&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;broker&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;backup&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;rtmp&quot;</span>: <span class="string">&quot;https://hss8.dnvodcdn.me/ppot/_definst_/mp4:s8/gvod/xj-fllyssx-480p-03656717C.mp4/chunklist.m3u8?dnvodendtime=1614078950&amp;dnvodhash=c7O8AgFsLq6N1O8ysAfNyp6SlvOLrVniVvvW2PEz8zU=&amp;dnvodCustomParameter=0_2003%3ae3%3af2f%3a5700%3a8417%3aeeca%3a9a8e%3a1d35_1&amp;lb=1f4a12a7923561331e23eee32ad4be8a&amp;us=1&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;needSign&quot;</span>: <span class="literal">false</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;480P&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;imgPath&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;unlockGold&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;playRecordURL&quot;</span>: <span class="string">&quot;//counter.timegate.vip/api/Counter/PlusOne?key=AddHitToMovie&amp;id=27212&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;favrateNumber&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;filterGold&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;key&quot;</span>: <span class="string">&quot;puamPfe8zf7&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;cid&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;commentStatus&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;shareCount&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;pinfenRate&quot;</span>: <span class="number">0.0</span>,</span><br><span class="line">        <span class="attr">&quot;renqiRate&quot;</span>: <span class="number">0.0</span>,</span><br><span class="line">        <span class="attr">&quot;customData&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;isGuestHasMore&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">&quot;link&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;isVIPHasMore&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">&quot;pauseData&quot;</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;isHls&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;result&quot;</span>: <span class="string">&quot;https://ppt.ifvod.tv/upload/video/202010020923422328455s.jpg&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;validator&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">&quot;link&quot;</span>: <span class="string">&quot;http://ppt.ifvod.tv/c/c?position%3dPZ%26d%3d1174%26r%3d7&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;broker&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;backup&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;rtmp&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;needSign&quot;</span>: <span class="literal">false</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;isHls&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;result&quot;</span>: <span class="string">&quot;https://ppt.ifvod.tv/upload/video/202012140947004731731s.jpg&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;validator&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">&quot;link&quot;</span>: <span class="string">&quot;http://ppt.ifvod.tv/c/c?position%3dPZ%26d%3d1173%26r%3d7&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;broker&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;backup&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;rtmp&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;needSign&quot;</span>: <span class="literal">false</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;isHls&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;result&quot;</span>: <span class="string">&quot;https://ppt.ifvod.tv/upload/video/202011032259305913218s.jpg&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;validator&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">&quot;link&quot;</span>: <span class="string">&quot;http://ppt.ifvod.tv/c/c?position%3dPZ%26d%3d2145%26r%3d7&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;broker&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;backup&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;rtmp&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;needSign&quot;</span>: <span class="literal">false</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;isHls&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;result&quot;</span>: <span class="string">&quot;https://ppt.ifvod.tv/upload/video/202102191325542507558s.jpg&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;validator&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">&quot;link&quot;</span>: <span class="string">&quot;http://ppt.ifvod.tv/c/c?position%3dPZ%26d%3d2373%26r%3d7&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;broker&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;backup&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;rtmp&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;needSign&quot;</span>: <span class="literal">false</span></span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;isHls&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;result&quot;</span>: <span class="string">&quot;https://ppt.ifvod.tv/upload/video/202102120906530682725s.jpg&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;validator&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;type&quot;</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">&quot;link&quot;</span>: <span class="string">&quot;http://ppt.ifvod.tv/c/c?position%3dPZ%26d%3d1179%26r%3d7&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;broker&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;backup&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;rtmp&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">&quot;needSign&quot;</span>: <span class="literal">false</span></span><br><span class="line">          &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">&quot;startData&quot;</span>: [],</span><br><span class="line">        <span class="attr">&quot;guestSeriesList&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;vipSeriesList&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;commentList&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;languageList&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;downloadList&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;videoServer&quot;</span>: &#123; <span class="attr">&quot;status&quot;</span>: <span class="number">0</span>, <span class="attr">&quot;info&quot;</span>: <span class="string">&quot;&quot;</span>, <span class="attr">&quot;isMp4Available&quot;</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">        <span class="attr">&quot;copyRightInfo&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;publisher&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;previewFormat&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;uniqueKey&quot;</span>: <span class="string">&quot;27212_625221&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;starImg&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;starID&quot;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;starBgColor&quot;</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">&quot;age&quot;</span>: <span class="literal">null</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;msg&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;isSpecialArea&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中 flvPathList 键放的存放着广告和视频的地址。<br>现在分析，vv 和 pub 参数。<br>通常，为了保证请求链接不被篡改，并且，请求连接不能长期有效，都会给请求连接添加一个签名，以保证它随时变化且不被篡改。pub 是 publickey 的简写，也就是公钥，相对应的，他还有私钥 privatekey。这两个值，通常都是由服务器指定的。也就是说，他们都是可变的。。分析 js 源码，可以发现，pubkey 是由 js 生成的当前毫秒时间戳。。私钥是通过 pubkey 经过一段运算，在 7 个私钥列表中选择的一个。这种算法是可笑的，因为通常公钥应该通过私钥来生成。私钥更不可能储存在本地。<br>然后是 vv 参数，vv 参数是上述请求的 url 参数加上公钥和私钥，再通过 md5 编码，返回的 32 位字符串。<br>我使用 python 书写了一个通过原始 url，来获取签名和添加公钥后的 url 的类。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Signurl</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, url: str, publicKey: int</span>):</span></span><br><span class="line">        self.publicKey = publicKey</span><br><span class="line">        self.privateKey = [<span class="string">&quot;version001&quot;</span>, <span class="string">&quot;vers1on001&quot;</span>, <span class="string">&quot;vers1on00i&quot;</span>,</span><br><span class="line">                           <span class="string">&quot;bersion001&quot;</span>, <span class="string">&quot;vcrsion001&quot;</span>, <span class="string">&quot;versi0n001&quot;</span>, <span class="string">&quot;versio_001&quot;</span>, <span class="string">&quot;version0o1&quot;</span>]</span><br><span class="line">        self.oldUrl = url</span><br><span class="line">        self.newUrl = self._getSignUrl()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_getSignUrl</span>(<span class="params">self</span>):</span></span><br><span class="line">        paramsStr = self._getParamsStr()</span><br><span class="line">        r = str(self.publicKey) + <span class="string">&quot;&amp;&quot;</span> + paramsStr + <span class="string">&quot;&amp;&quot;</span> + self._getPrivateKey()</span><br><span class="line">        hl = hashlib.md5()</span><br><span class="line">        hl.update(r.encode())</span><br><span class="line">        newUrl = self.oldUrl+<span class="string">&quot;&amp;vv=&quot;</span>+hl.hexdigest()+<span class="string">&quot;&amp;pub=&quot;</span>+str(self.publicKey)</span><br><span class="line">        <span class="keyword">return</span> newUrl</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_getParamsStr</span>(<span class="params">self</span>) -&gt; str:</span></span><br><span class="line">        paramsStr = <span class="string">&quot;&quot;</span></span><br><span class="line">        params = parse.parse_qs(parse.urlparse(self.oldUrl).query)</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> params:</span><br><span class="line">            paramsStr += key + <span class="string">&quot;=&quot;</span> + params[key][<span class="number">0</span>]</span><br><span class="line">            paramsStr += <span class="string">&quot;&amp;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> paramsStr[<span class="number">0</span>:<span class="number">-1</span>].lower()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_getPrivateKey</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.privateKey[self.publicKey % len(self.privateKey)]</span><br></pre></td></tr></table></figure><p>其中 publickey 可以通过以下代码生成，publicKey = int(time.time()*1000)</p><h1 id="3：提取-m3u8-链接"><a href="#3：提取-m3u8-链接" class="headerlink" title="3：提取 m3u8 链接"></a>3：提取 m3u8 链接</h1><p>在获取了，json 数据后，提取出 m3u8 的链接：</p><blockquote><p><a href="https://hss8.dnvodcdn.me/ppot/_definst_/mp4:s8/gvod/xj-fllyssx-480p-03656717C.mp4/chunklist.m3u8?dnvodendtime=1614078521&dnvodhash=0KnVagh-3RIHR_0fE_qVTS3X_t1ogc9iRTbuUYK5GYI=&dnvodCustomParameter=0_2003:e3:f2f:5700:8417:eeca:9a8e:1d35_1&lb=1f4a12a7923561331e23eee32ad4be8a&us=1">https://hss8.dnvodcdn.me/ppot/<em>definst</em>/mp4:s8/gvod/xj-fllyssx-480p-03656717C.mp4/chunklist.m3u8?dnvodendtime=1614078521&amp;dnvodhash=0KnVagh-3RIHR_0fE_qVTS3X_t1ogc9iRTbuUYK5GYI=&amp;dnvodCustomParameter=0_2003%3ae3%3af2f%3a5700%3a8417%3aeeca%3a9a8e%3a1d35_1&amp;lb=1f4a12a7923561331e23eee32ad4be8a&amp;us=1</a></p></blockquote><p>直接请求这个链接是，无法获取到 m3u8 文件的，因为我们还需要通过它重新构造请求，同样是使用 2 章节所用的 Signurl 类，对此 url 签名。会增加 vv 和 pub 参数在上述 url 末尾。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Video</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, id: str</span>) -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        self.publicKey = int(time.time()*<span class="number">1000</span>)</span><br><span class="line">        self.id = id</span><br><span class="line">        self.dataUrl = <span class="string">&quot;https://m8.ifvod.tv/api/video/play?cinema=1&amp;id=&quot;</span> + \</span><br><span class="line">            id+<span class="string">&quot;&amp;region=DE&amp;device=1&amp;usersign=1&quot;</span></span><br><span class="line">        self.playUrl = self._getM3u8Url()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_getM3u8Url</span>(<span class="params">self</span>) -&gt; str:</span></span><br><span class="line">        m3u8url = self._getData()</span><br><span class="line">        <span class="keyword">if</span> m3u8url:</span><br><span class="line">            <span class="keyword">return</span> Signurl(m3u8url, self.publicKey).newUrl</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_getData</span>(<span class="params">self</span>):</span></span><br><span class="line">        reqUrl = Signurl(self.dataUrl, self.publicKey).newUrl</span><br><span class="line">        rep = requests.get(reqUrl)</span><br><span class="line">        <span class="keyword">if</span> rep.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">return</span> rep.json()[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;info&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;flvPathList&#x27;</span>][<span class="number">-1</span>][<span class="string">&#x27;result&#x27;</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">print(Video(<span class="string">&quot;WdS12xLwXh6&quot;</span>).playUrl)</span><br></pre></td></tr></table></figure><p>将上述两端代码放到同一个 py 文件中执行，就可以获取 m3u8 的播放链接了。</p><h1 id="4：结语"><a href="#4：结语" class="headerlink" title="4：结语"></a>4：结语</h1><p>我尝试将此链接通过在线 m3u8 播放器进行播放，遇到的问题是，如果这个视频播放了一段时间，那么在网页播放器中，通过 m3u8 只能播放到 ifvod 网页上的位置。通过分析，我推测，ifvod 对 m3u8 链接的请求做了防盗链设置，也就是说，在其他网站上播放这个 m3u8 视频，是无法播放的，之所以出现部分片段能够播放，是因为 ifvod 播放过的片段会经过 cdn，在 cdn 上是没有防盗链的。。也就是说，想通过在线 m3u8 播放器和通过 serverless 服务搭建一个播放器的想法是不能实现的。<br>为此，我花了许多时间来尝试和搜索破解方法。其中，iframe 中添加 referrerpolicy，网页中添加 meta 标签并修改位 no-referrer 均无法使视频播放。<br>唯一的办法是使用反向代理，我在我一台服务器上，通过 nginx 反向代理，实现了这一过程。但是这个方法代价太大了，首先，serverless 是有免费额度的。而服务器需要自己掏腰包。通过代理，流量会经过服务器收费。相当不划算。没有实现的价值。<br>如果不通过自己的网站，比如使用 chrome 浏览器插件，Play HLS M3u8，可以直接在本地播放 m3u 视频，基于此，可以自己做一个插件，通过搜索，在本地播放，因为浏览器插件是可以修改 referer 的。</p>]]></content>
      
      
      <categories>
          
          <category> 爬虫 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 爬虫 </tag>
            
            <tag> m3u8 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>语雀+本地hexo博客书写</title>
      <link href="/2021/02/21/yuque/fo0ngh/"/>
      <url>/2021/02/21/yuque/fo0ngh/</url>
      
        <content type="html"><![CDATA[<p>我一直在寻找一种替代 Typora，能够实现在线书写个人博客的方法。一次偶然的阅读，我了解了语雀。在网上检索后发现，已经有不少教程讲解如何通过语雀的钩子+Github Action+云函数的方法，在线同步语雀文章到 github 博客。在这片文章里，我总结了，今天搭建语雀过程中遇到的坑，和解决过程。看这篇文章之前，你应该已经在搭建语雀博客同步过程中遇到了不少阻碍吧。<br>我本人按照《<a href="https://www.kikohk.top/article/3899/">Hexo+GitHub+Action+腾讯云函数+语雀搭建自动化个人博客</a>》文章的教程进行搭建，所以细节不再赘述。遇到的坑，将在下面说说。</p><h1 id="1：Hexo-本地博客"><a href="#1：Hexo-本地博客" class="headerlink" title="1：Hexo 本地博客"></a>1：Hexo 本地博客</h1><p>我很早就开始在本地计算机上使用 Typora+markdown 写博客了。早已习惯了 Typora 的风格和快捷键。通过 win+shift+s 截屏，然后直接粘贴到 markdown 中，Typora 通过设置连接图传，自动上传，对于图片的粘贴非常友好。。目前还不知道语雀是否能够做到。<br>将 Hexo 博客安装到本地，是为了获取博客文件目录，修改主题，安装插件等等。同时也能够本地写作。<br>安装 yuque-hexo 插件后，需要在 package.json 中添加插件配置。原文推荐如下：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;yuqueConfig&quot;:</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;baseUrl&quot;:</span> <span class="string">&quot;https://www.yuque.com/api/v2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;login&quot;:</span> <span class="string">&quot;语雀的id&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;repo&quot;:</span> <span class="string">&quot;语雀知识库名称&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;mdNameFormat&quot;:</span> <span class="string">&quot;title&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;postPath&quot;:</span> <span class="string">&quot;source/_posts&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;onlyPublished&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>但是这个配置，会将我们本地编写的博客覆盖掉，如果你过去在 hexo 本地编写过，那你应该知道，本地博文同样储存在<strong>source/_posts</strong>。为了避免语雀同步后，覆盖原本地文章，需要将上述配置中的**”postPath”: “source/_posts”<strong>，修改为</strong>“postPath”: “source/_posts/yuque”。**</p><h1 id="2：Hexo-同步-Github-仓库"><a href="#2：Hexo-同步-Github-仓库" class="headerlink" title="2：Hexo 同步 Github 仓库"></a>2：Hexo 同步 Github 仓库</h1><p>将整个博客目录同步到 Github 仓库，这样博客的许多重要配置文件，主题设置，文章 md，页面设置都将得到保存，同时可以调用这个仓库的 actions 功能生成静态文件，将博客页面同步到 github pages。。值得注意的是，Github 免费仓库是公开的，你保存在仓库的 token 将会被别人知道，这会给博客一些依赖 token 功能，比如评论、百度 seo 带来威胁，当然我们希望人们总是善良的。<br>关于同步，在配置**.gitignore<strong>文件时，建议添加</strong>public<strong>和</strong>node_modules<strong>这两个文件夹，public 是动态生成的，node_module 是 hexo 依赖，也可以动态生成，actions 都能够自动生成，因此不需要额外同步上去。<br>themes 文件夹下，是博客的主题，主题通常是从一个 github 仓库克隆过来的，在同步 hexo 博客时，如果主题文件夹下存在.git 文件夹，则这个文件夹将被认为是博客仓库的子仓库，因此不会被上传。在 github 仓库中显示为</strong>一个带右箭头的文件夹**。<br>如果要将主题上传到 github，需要删除主题文件夹下的.git 文件夹。<br>此外运行 git 指令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rm -r --cache .</span><br></pre></td></tr></table></figure><p>此命令清除 git 缓存<br>在 push 的时候使用强制 push</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -f</span><br></pre></td></tr></table></figure><h1 id="3：Action"><a href="#3：Action" class="headerlink" title="3：Action"></a>3：Action</h1><p>通过 Action，github 可以循行 hexo 指令，比如将语雀文章同步到 source/_post/yuque，生成静态文件，上传 github pages 等等。<br>目前这个 action 程序，还没有实现将语雀文章同步到 github 储存库的能力，只能本地同步，再本地同步到 github。希望后人能够补全功能。</p><h1 id="4：云函数"><a href="#4：云函数" class="headerlink" title="4：云函数"></a>4：云函数</h1><p>无论是腾讯云、阿里云还是谷歌亚马逊，都有云函数这个功能，使用上面也是大同小异。云函数的功能，在这里主要是为了接收语雀的回调，换句话说，每当我们更新删除新建知识库文章时，语雀就会向一个指定的 url 发起请求，云函数就用来接收这个请求。<br>云函数接收到请求后，调用 github 的 api，运行 action，action 再执行 hexo 指令部署博客。<br>云函数内容：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main_handler</span>(<span class="params">event, context</span>):</span></span><br><span class="line">    r = requests.post(<span class="string">&quot;https://api.github.com/repos/你的github用户名/源码仓库名/dispatches&quot;</span>,</span><br><span class="line">    json = &#123;<span class="string">&quot;event_type&quot;</span>: <span class="string">&quot;start&quot;</span>&#125;,</span><br><span class="line">    headers = &#123;<span class="string">&quot;User-Agent&quot;</span>:<span class="string">&#x27;curl/7.52.1&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;application/vnd.github.everest-preview+json&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;Authorization&#x27;</span>: <span class="string">&#x27;token github的token&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> r.status_code == <span class="number">204</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;This&#x27;s OK!&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> r.status_code</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>需要注意的是， <strong>‘Authorization’: ‘token github 的 token’**其中 token 是一串乱序字符串，在这串字符串前必须有“</strong>token **”这个字串，否则测试时会返回 404。</p><blockquote><p>‘Authorization’: ‘token 77ed8fdca6<strong>*a00f0***</strong>d73239790c6323dd’</p></blockquote><h1 id="5：语雀转-markdown"><a href="#5：语雀转-markdown" class="headerlink" title="5：语雀转 markdown"></a>5：语雀转 markdown</h1><p>从语雀同步文章到本地时，文章会自动转为 markdown 格式，而通常这个文章是没有分类和标签的，为了能够让文章同步到博客时，更加融洽，需要在编写语雀文章时，添加语雀插件自带的 Font-matter 插件的头部格式。<br>也就是说，需要在语雀编辑器中，标题一下，正文以上的部位，添加如下内容</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tags:</span> [<span class="string">语雀</span>, <span class="string">travis</span>, <span class="string">serverless</span>]</span><br><span class="line"><span class="attr">categories:</span> [<span class="string">语雀</span>]</span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>为了方便书写，建议为此知识库建立一个模板，每次写文章都应用此模板。书写更加游刃有余。</p><h1 id="6：参考资料"><a href="#6：参考资料" class="headerlink" title="6：参考资料"></a>6：参考资料</h1><p>《<a href="https://www.kikohk.top/article/3899/">Hexo+GitHub+Action+腾讯云函数+语雀搭建自动化个人博客</a>》<br>《<a href="https://www.yuque.com/gavinluo/blog/yuque-auto-2-hexo">语雀云编辑自动部署 Hexo 博客</a><strong>》</strong><br><strong>《</strong><a href="https://cloud.tencent.com/developer/article/1665753">语雀自动同步到 hexo 博客</a><strong>》</strong><br><strong>《</strong><a href="https://www.tangruiping.com/post/yque-serverless-github-actions-hexo.html">语雀文章用 Serverless 自动部署到 Hexo 博客</a><strong>》</strong></p>]]></content>
      
      
      <categories>
          
          <category> 网站编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> Serverless </tag>
            
            <tag> 语雀 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ifvod去除广告</title>
      <link href="/2021/02/16/ifvod%E5%8E%BB%E9%99%A4%E5%B9%BF%E5%91%8A/"/>
      <url>/2021/02/16/ifvod%E5%8E%BB%E9%99%A4%E5%B9%BF%E5%91%8A/</url>
      
        <content type="html"><![CDATA[<p>ifvod视频会在视频的开始、25分钟、50分钟的时候插入广告，现在仅需简单的两步，就能去除ifvod播放广告。</p><h1 id="1：安装浏览器插件"><a href="#1：安装浏览器插件" class="headerlink" title="1：安装浏览器插件"></a>1：安装浏览器插件</h1><p>点击下面的链接，将ReRes插件<code>添加至Chrome</code>。</p><p><a href="https://chrome.google.com/webstore/detail/reres/gieocpkbblidnocefjakldecahgeeica">https://chrome.google.com/webstore/detail/reres/gieocpkbblidnocefjakldecahgeeica</a></p><p>安装好后，在浏览器拓展程序中，将出现ReRes插件。</p><p>在浏览器地址栏输入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome:&#x2F;&#x2F;extensions&#x2F;</span><br></pre></td></tr></table></figure><p>查看插件，确保插件已经激活，激活时，右下角的<code>滑动按钮</code>状态如图所示。</p><p><img src="https://i.loli.net/2021/02/16/JsmNcldYvGoenX9.png" class="lazyload" data-srcset="https://i.loli.net/2021/02/16/JsmNcldYvGoenX9.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210216094238426"></p><p>点击浏览器窗口右上角的ReRes图标，应该会出现下图所示的弹窗。当然此时应当还没有任何规则。</p><p><img src="https://i.loli.net/2021/02/16/3OHyDYPJz1WrvCb.png" class="lazyload" data-srcset="https://i.loli.net/2021/02/16/3OHyDYPJz1WrvCb.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210216093951914"></p><h1 id="2：添加规则"><a href="#2：添加规则" class="headerlink" title="2：添加规则"></a>2：添加规则</h1><p>如图所示，点击<code>添加规则</code>按钮</p><p><img src="https://i.loli.net/2021/02/16/guW3XIzaKTricwv.png" class="lazyload" data-srcset="https://i.loli.net/2021/02/16/guW3XIzaKTricwv.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20210216094503703"></p><p>在<code>If URL match:</code>一栏填入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.ifvod.tv&#x2F;7-es2015.5cef6194389ec0967828.js</span><br></pre></td></tr></table></figure><p>在<code>Response:</code>一栏填入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;qn.xieqifei.com&#x2F;7-es2015.5cef6194389ec0967828.js</span><br></pre></td></tr></table></figure><p>点击保存。</p><p><strong>至此，你在ifvod观看视频，将不会有任何视频广告插入。</strong></p><h1 id="3：原理"><a href="#3：原理" class="headerlink" title="3：原理"></a>3：原理</h1><p>ifvod广告是通过js代码嵌入到播放器中的。我仔细阅读了，它的播放器代码，也就是，上面替换掉的js文件，我修改了其中，关于广告投放部分的代码。。</p><p>ReRes插件是我在网上随便找的一个插件，它的作用是，当浏览器请求一个资源时，如果它符合我在ReRes上设定的url规则，就将它重定向到另一个资源文件。这样就能实现篡改ifvod的播放器源代码。</p><p>也许你可以通过对比修改前后的js文件，来了解我具体是如何修改的。。不过，我并不推荐你阅读这个两万行代码的文件，它会让你崩溃。。我也没有完全阅读这些代码，而是通过一些逆向工程的推断，来找到核心代码，这需要一些耐心。</p>]]></content>
      
      
      <categories>
          
          <category> 网站编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>爬取Youtube搜索结果</title>
      <link href="/2021/02/06/%E7%88%AC%E5%8F%96Youtube%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C/"/>
      <url>/2021/02/06/%E7%88%AC%E5%8F%96Youtube%E6%90%9C%E7%B4%A2%E7%BB%93%E6%9E%9C/</url>
      
        <content type="html"><![CDATA[<h1 id="1：绪"><a href="#1：绪" class="headerlink" title="1：绪"></a>1：绪</h1><p>最近在做一个音乐下载软件，通过搜索音乐名称，下载youtube上信息匹配度最高的视频，提取其中的音频，来获取音乐。开源软件youtube-dl已经完成了视频下载和音频提取的全部工作，我要做的就是，获取目标视频的id或者视频链接，然后调用youtube-dl下载。</p><h1 id="2：接口"><a href="#2：接口" class="headerlink" title="2：接口"></a>2：接口</h1><p>谷歌官方其实已经提供了获取YouTube搜索结果的api，直接调用即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#调用谷歌api获取youtube搜索结果，返回匹配度最高的视频链接</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_video_url_in_youtube_form_api</span>(<span class="params">appKey,music_name</span>):</span></span><br><span class="line">    print(<span class="string">&quot;从google api获取数据&quot;</span>)</span><br><span class="line">    url = <span class="string">&quot;https://youtube.googleapis.com/youtube/v3/search?q=&quot;</span>+music_name+<span class="string">&quot;&amp;key=&quot;</span>+appKey</span><br><span class="line">    resp = requests.get(url)</span><br><span class="line">    resp_json = resp.json()</span><br><span class="line">    <span class="keyword">if</span> resp.status_code ==<span class="number">200</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;https://www.youtube.com/watch?v=&quot;</span>+resp_json[<span class="string">&#x27;items&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;id&#x27;</span>][<span class="string">&#x27;videoId&#x27;</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">500</span></span><br></pre></td></tr></table></figure><p>但是，谷歌api是有调用上限的，也就是10000个单位，每次搜索将消耗100个单位。那么我们总共可以通过api获取搜索结果的次数就是100个。这对于个人来说，实际上已经足够了，但是，如果要向他人提供服务，就不够了。</p><p>那么就只能上手爬虫了。</p><h1 id="3：爬取搜索结果"><a href="#3：爬取搜索结果" class="headerlink" title="3：爬取搜索结果"></a>3：爬取搜索结果</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#利用爬虫获取youtube搜索结果</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_video_url_in_youtube_from_crawler</span>(<span class="params">keyword</span>):</span></span><br><span class="line">    url=<span class="string">&quot;https://m.youtube.com/results?search_query=&quot;</span>+keyword</span><br><span class="line">    print(<span class="string">&quot;通过爬虫获取数据&quot;</span>)</span><br><span class="line">    resp = requests.get(url)</span><br><span class="line">    <span class="keyword">if</span> resp.status_code==<span class="number">200</span>:</span><br><span class="line">        result_json = re.findall(<span class="string">r&#x27;ytInitialData = (.*);&lt;/script&gt;&#x27;</span>, resp.text)[<span class="number">0</span>]</span><br><span class="line">        result_obj = json.loads(result_json)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            video_url = <span class="string">&quot;https://www.youtube.com/watch?v=&quot;</span>+result_obj[<span class="string">&#x27;contents&#x27;</span>][<span class="string">&#x27;twoColumnSearchResultsRenderer&#x27;</span>][<span class="string">&#x27;primaryContents&#x27;</span>][<span class="string">&#x27;sectionListRenderer&#x27;</span>][<span class="string">&#x27;contents&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;itemSectionRenderer&#x27;</span>][<span class="string">&#x27;contents&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;videoRenderer&#x27;</span>][<span class="string">&#x27;videoId&#x27;</span>]</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">500</span></span><br><span class="line">        <span class="keyword">return</span> video_url</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">500</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>通过url和搜索值，构造搜索链接。获取返回的html代码。对html格式化后，可以发现，有一串包含搜索结果的json数据，藏在一个js代码中间，通过正则，将它提取出来。</p><p>谷歌是有反爬虫的机制的，就是说，如果频繁通过上述程序请求数据，获取到的json不一定能获得想要的内容。这里需要使用Exception来避免报错，假如爬取失败，应当再调用api。如果有代理隧道，那么爬虫就更好了。</p>]]></content>
      
      
      <categories>
          
          <category> 爬虫 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> 爬虫 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ESP8266从0到1</title>
      <link href="/2020/11/26/ESP8266%E4%BB%8E0%E5%88%B01/"/>
      <url>/2020/11/26/ESP8266%E4%BB%8E0%E5%88%B01/</url>
      
        <content type="html"><![CDATA[<h1 id="0：前语"><a href="#0：前语" class="headerlink" title="0：前语"></a>0：前语</h1><p>推荐<a href="http://www.taichi-maker.com/">太极创客</a>，学习ESP8266模块的更多知识。</p><h1 id="1：连线"><a href="#1：连线" class="headerlink" title="1：连线"></a>1：连线</h1><p>ESP8266通过串口与电脑或者其他单片机实现交互，串口的使用比较简单。以最简单的ESP8266模块为例进行介绍。其他模块可能已经有了usb type-c或者其他接口，就直接用对应接口的线和设备连接就可以了。下图的模块，没有usb接口，因此需要我们自己连线。</p><p><img src="https://i.loli.net/2020/11/25/1BzINH4M5urOPnQ.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/25/1BzINH4M5urOPnQ.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>模块共引出了8个引脚，其中，</p><p>VCC：接3.3V电压，为模块供电。</p><p>GUD：接地</p><p>GPIO0：平时直接悬空。需要刷固件的时候接地。</p><p>CH_PD：通过一个10K电阻接3.3V电压，表示模块处于工作状态。否则将不工作。</p><p>串口通信引脚，</p><p>RXD：串口输入，表示这个引脚会接收其他模块传入的信息。与其他模块的TX引脚相连。</p><p>TXD：串口输出，接其他模块的RX引脚，把数据传给其他模块。</p><p>通过FTDI USB to TTL模块，可以将ESP直接和电脑连接。只需要将对应引脚与FTDI模块相连即可。</p><h1 id="2：简单开始"><a href="#2：简单开始" class="headerlink" title="2：简单开始"></a>2：简单开始</h1><p>下图为一个FTDI模块。将其引脚与ESP模块各引脚相连。</p><p>下载FTDI模块的芯片驱动，直接搜索对应芯片就能找到。安装驱动后，将连接好的FTDI模块插入电脑，在电脑设备管理器中，能找到端口一栏，多了这个模块的端口比如(COM6)</p><p><img src="https://i.loli.net/2020/11/27/o96CQ28riWtsUSv.jpg" class="lazyload" data-srcset="https://i.loli.net/2020/11/27/o96CQ28riWtsUSv.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>随意下载一个串口助手，选择FTDI模块的端口，设置波特率为115200，结束符为NL和CR。其他的默认。</p><p>在串口助手上发送：AT</p><p>串口助手的窗口会返回：OK，或者ERROR。</p><p>如果返回OK，那么就可以通过AT指令操作ESP芯片连接WIFI或者作为AP让别人连wifi了。</p><p>如果返回ERROR，那么就需要更新固件，以让ESP支持AT指令。</p><blockquote><p>未必一定要直接将ESP与电脑连接，也可以和其他单片机连接，通过对其他单片机编程，向ESP发送AT指令。重要的是，理解ESP的工作方式。</p></blockquote><h1 id="3：更新固件"><a href="#3：更新固件" class="headerlink" title="3：更新固件"></a>3：更新固件</h1><p>如果你不小心将ESP配置错了，又不知道怎么去将它出厂设置，或者你发送AT指令总是返回ERROR，那么你就需要学习如何更新芯片固件。</p><p>更新固件需要用到FTDI模块，将FTDI和ESP连接，FTDI连接电脑。</p><p>首先下载<a href="https://www.espressif.com/zh-hans/support/download/other-tools">Flash下载工具</a>。只有Windows系统能用。</p><p>然后下载最新版本的<a href="https://www.espressif.com/zh-hans/products/socs/esp8266ex/resources">ESP8266 NONOS SDK</a>。并解压。</p><p>接线，需要注意，<strong>GPIO0引脚必须接地</strong>。</p><table><thead><tr><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td><strong>序号</strong></td><td><strong>引脚名称</strong></td><td><strong>I/O</strong></td><td><strong>描述</strong></td><td><strong>DC特性</strong></td><td><strong>备注</strong></td></tr><tr><td>1</td><td>UTXD</td><td></td><td>AT 串口发送输出</td><td>3.3V</td><td>开机时禁止下拉</td></tr><tr><td>2</td><td>GND</td><td></td><td>地</td><td></td><td></td></tr><tr><td>3</td><td>CH_PD(EN)</td><td></td><td>模块断电信号</td><td>3.3V</td><td>1）高电平工作； 2）低电平模块供电关掉；</td></tr><tr><td>4</td><td>GPIO2</td><td></td><td>预留，默认悬空</td><td>3.3V</td><td>开机上电时必须为高电平，禁止硬件下拉；内部默认已拉高</td></tr><tr><td>5</td><td>GPIO16</td><td>I</td><td>复位信号(RESET)</td><td>3.3V</td><td>低电平复位，高电平工作（默认高）；</td></tr><tr><td>6</td><td>GPIO0</td><td></td><td>模块状态灯/工作模式选择</td><td>3.3V</td><td>1）默认WiFiStatus：WiFi工作状态指示灯控制信号；2）工作模式选择：上拉：FlashBoot，工作模式；下拉：UARTDownload，下载模式（下载固件）；</td></tr><tr><td>7</td><td>VCC</td><td>I</td><td>模块采用单电源供电，通过 1 个VCC 电源引脚供电，电压范围：3.0V-3.6V,电流&gt;600mA</td><td>Vmax=3.6VVmin=3.0VVnorm=3.3V</td><td>电源供电能力请大于600mA;否则可能会引起模块工作异常，或者无线性能不好。</td></tr><tr><td>8</td><td>URXD</td><td></td><td>AT 串口发送输入</td><td>3.3V</td><td></td></tr></tbody></table><p><img src="https://i.loli.net/2020/11/27/a6YnuPe1fNhdBsm.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/27/a6YnuPe1fNhdBsm.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>打开flash_download_tool_v3.8.5.exe。选择Developer模式。</p><p>选择8266芯片</p><p><img src="https://i.loli.net/2020/11/27/cTbj4kOs6VIr5mi.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/27/cTbj4kOs6VIr5mi.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>然后在之前解压的SDK中找到<code>C:\Users……\ESP8266_NONOS_SDK-3.0.4\bin\boot_v1.6.bin</code>文件刷入地址0x00000中</p><p><img src="https://i.loli.net/2020/11/27/o8Ug96EyxarKh2n.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/27/o8Ug96EyxarKh2n.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>然后点击START按钮开始，如果显示<code>等待上电</code>，在保证GPIO0接地的情况下，将RST引脚接地再断开。</p><p>至此固件等待刷新完毕。</p><h1 id="4：AT指令"><a href="#4：AT指令" class="headerlink" title="4：AT指令"></a>4：AT指令</h1><p>完整的<a href="https://www.espressif.com/sites/default/files/documentation/4a-esp8266_at_instruction_set_cn.pdf">AT指令PDF</a></p><p>常见的指令：</p><h2 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h2><ul><li>测试：AT</li><li>复位：AT+RST</li><li>恢复出厂设置：AT+RESTORE</li><li>查询本机IP和MAC：AT+CIFSR</li></ul><h2 id="模式命令"><a href="#模式命令" class="headerlink" title="模式命令"></a>模式命令</h2><ul><li>查询模式：AT+CWMODE?</li><li>设置模式 1:STA 2:AP 3:both：AT+CWMODE=1</li><li>（STA）查询当前可用AP ：AT+CWLAP</li><li>（STA）加入可用AP ：AT+CWJAP=“ssid”,“psw”</li><li>（STA）退出当前AP ：AT+CWQAP</li><li>（AP）设置AP参数，ssid+psw+chn+ecn+n+01 ：AT+CWSAP=“哈哈”,“12345678”,3,3,4,0</li><li>（AP）查询AP参数：AT+CWSAP?</li></ul><h2 id="客户端-服务器设置"><a href="#客户端-服务器设置" class="headerlink" title="客户端|服务器设置"></a>客户端|服务器设置</h2><ul><li>查询是否多连接 是1，否0 ：AT+CIPMUX?</li><li>设置启动多连接1，单链接0（重启后默认0）：AT+CIPMUX=1</li><li>（多连接）关闭服务器，就是开启多连接客户端，默认是0 ：AT+CIPSERVER=0</li><li>（多连接）开启服务器,:开启+端口号port。 此时客户端要连本机，远程地址为 IP+Port ：AT+CIPSERVER=1,8080</li><li>（多连接）发送数据 id+Byte：AT+CIPSEND=0,10</li><li>（多连接）关闭TCP/UDP连接，id：AT+CIPCLOSE=0</li><li>（客户端单连接）建立TCP/UDP连接：AT+CIPSTART=“TCP”,“192.168.4.2”,100</li><li>（客户端单连接）发送数据，Byte ：AT+CIPSEND=10</li><li>（客户端单连接）使能穿透模式：AT+CIPMODE=1</li><li>（客户端单连接）进入透传模式发送：AT+CIPSEND</li><li>（客户端单连接）退出透传：+++</li><li>（客户端单连接）关闭TCP/UDP连接：AT+CIPCLOSE</li><li>（客户端多连接）建立TCP/UDP连接，id，TCP/UDP，IP，端口：AT+CIPSTART=0,“TCP”,“192.168.4.2”,100</li></ul><h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>如果需要用到ESP通过软串口连接Arduino单片机，就需要修改ESP的波特率，ESP默认波特率是115200，而软串口只能是9600，修改波特率AT指令</p><p>AT+CIOBAUD=9600</p><p>如果返回ERROR，可以尝试</p><p>AT+UART=9600,8,1,0,0</p><h1 id="5：使用Arduino-IDE编写程序"><a href="#5：使用Arduino-IDE编写程序" class="headerlink" title="5：使用Arduino IDE编写程序"></a>5：使用Arduino IDE编写程序</h1><p>ESP8266是可以直接使用Arduino IDE上烧录程序的。为了在Arduino IDE上直接编写程序，首先需要导入ESP8266的库。</p><ol><li>在IDE的文件-&gt;首选项里边的附加开发板管理网址输入<a href="https://github.com/esp8266/Arduino/releases/download/2.5.0/package_esp8266com_index.json">https://github.com/esp8266/Arduino/releases/download/2.5.0/package_esp8266com_index.json</a></li></ol><p>或者<a href="http://arduino.esp8266.com/stable/package_esp8266com_index.json">http://arduino.esp8266.com/stable/package_esp8266com_index.json</a></p><p>之后点击好。</p><p><img src="https://i.loli.net/2020/11/28/nfQaI8zcKqG3imS.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/28/nfQaI8zcKqG3imS.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ol start="2"><li>在 工具-&gt;开发板选择最上方开发板管理器，之后搜索esp即可出现esp8266，选择版本之后进行安装即可。</li></ol><p><img src="https://i.loli.net/2020/11/28/17fGHoFmrZyERPV.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/28/17fGHoFmrZyERPV.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ol start="3"><li>在Arduino IDE 菜单&gt;工具&gt;开发板&gt;开发板管理器 中选择你正在使用的8266开发板。</li></ol><p>如果你不清楚自己使用的是哪个开发板，可以选择generic esp8266 module，这是通用板子。</p><ol start="4"><li>选择正确的端口。如果不知道自己板子连接电脑上的是哪个端口，可以打开电脑的<code>设备管理器</code>，其中有端口一栏，有详细信息。</li><li>上载程序前，将GPIO0引脚下拉接地，并将RST引脚接地在放开，上载程序时，GPIO0引脚需保持接地状态。上载完毕，将GPIO0引脚放空，并再次将RST引脚接地放开，切换到运行状态。</li></ol><h1 id="6：Https请求程序"><a href="#6：Https请求程序" class="headerlink" title="6：Https请求程序"></a>6：Https请求程序</h1><p>这里以企业微信api发送应用消息为例，简述https请求中的get和post请求。http请求更为简单。网上资料也更多。</p><p>要调取企业微信api首先需要仔细阅读其<a href="https://work.weixin.qq.com/api/doc/90000/90135/91039">开发文档</a>。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Arduino.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ESP8266HTTPClient.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;WiFiClientSecureBearSSL.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ArduinoJson.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ssid <span class="meta-string">&quot;SSID&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> password <span class="meta-string">&quot;PASSWORD&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//https://qyapi.weixin.qq.com网站的指纹。</span></span><br><span class="line"><span class="comment">//esp通过https访问网站，都需要自己通过浏览器获取指纹，获取方法可自行搜索，在参考资料中也有文章，指纹一般几个月就需要更新一次。浏览器打开https://qyapi.weixin.qq.com/cgi-bin/gettoken获取指纹，而不只是只有主机名。</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> fingerprint[] PROGMEM = <span class="string">&quot;790e6e32485bb89503ac6da87d948f5e634322a7&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"><span class="comment">// 企业微信api相关</span></span><br><span class="line"><span class="keyword">String</span> tokenUrl = <span class="string">&quot;https://qyapi.weixin.qq.com/cgi-bin/gettoken&quot;</span>;</span><br><span class="line"><span class="keyword">String</span> sendMsgUrl = <span class="string">&quot;https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=&quot;</span>;</span><br><span class="line"><span class="comment">//以下信息需要替换，这里的均不可用</span></span><br><span class="line"><span class="keyword">String</span> corpid = <span class="string">&quot;ww98b3k1b63788a7ad&quot;</span>;<span class="comment">//你的企业id</span></span><br><span class="line"><span class="keyword">String</span> corpsecret = <span class="string">&quot;Kh8asfasfaTrbSwRBGK5H0osnfasakjkmSYCqV3Tgcs&quot;</span>;<span class="comment">//你的企业应用密钥</span></span><br><span class="line"><span class="keyword">String</span> agentid = <span class="string">&quot;1000002&quot;</span>;<span class="comment">//你的企业应用id</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//获取企业微信access_token</span></span><br><span class="line"><span class="function"><span class="keyword">String</span> <span class="title">get_token</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">String</span> token = <span class="string">&quot;123&quot;</span>;</span><br><span class="line">  <span class="keyword">String</span> requestUrl = tokenUrl + <span class="string">&quot;?corpid=&quot;</span>+corpid+<span class="string">&quot;&amp;corpsecret=&quot;</span>+corpsecret;</span><br><span class="line">  <span class="comment">//https需要创建一个加密路径</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;BearSSL::WiFiClientSecure&gt;client(<span class="keyword">new</span> BearSSL::WiFiClientSecure);</span><br><span class="line">  client-&gt;setFingerprint(fingerprint);</span><br><span class="line">  <span class="comment">//创建一个HTTP客户端</span></span><br><span class="line">  HTTPClient https;</span><br><span class="line">  <span class="comment">//http和https的区别就是https.begin中的*client。如果没有*client,那么发送出去的就是http请求</span></span><br><span class="line">  <span class="comment">//建立连接</span></span><br><span class="line">  <span class="keyword">if</span> (https.<span class="built_in">begin</span>(*client, requestUrl)) &#123;  <span class="comment">// HTTPS</span></span><br><span class="line">      <span class="built_in">Serial</span>.<span class="built_in">print</span>(<span class="string">&quot;[HTTPS] GET...\n&quot;</span>);</span><br><span class="line">      <span class="comment">// 发送get请求</span></span><br><span class="line">      <span class="keyword">int</span> httpCode = https.GET();</span><br><span class="line">  <span class="comment">//如果httpCode小于零则连接错误</span></span><br><span class="line">      <span class="keyword">if</span> (httpCode &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">Serial</span>.<span class="built_in">printf</span>(<span class="string">&quot;[HTTPS] GET... code: %d\n&quot;</span>, httpCode);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// file found at server</span></span><br><span class="line">        <span class="keyword">if</span> (httpCode == HTTP_CODE_OK || httpCode == HTTP_CODE_MOVED_PERMANENTLY) &#123;</span><br><span class="line">          <span class="comment">//将返回的json序列，放到json变量</span></span><br><span class="line">          <span class="keyword">String</span> json = https.getString();</span><br><span class="line">          <span class="built_in">Serial</span>.<span class="built_in">println</span>(json);</span><br><span class="line">          <span class="comment">// 创建DynamicJsonDocument对象，json中的参数为4个。</span></span><br><span class="line">          <span class="keyword">const</span> <span class="keyword">size_t</span> capacity = JSON_OBJECT_SIZE(<span class="number">4</span>) + <span class="number">290</span>;</span><br><span class="line">          <span class="function">DynamicJsonDocument <span class="title">doc</span><span class="params">(capacity)</span></span>;</span><br><span class="line">          <span class="comment">//反序列化数据</span></span><br><span class="line">          deserializeJson(doc, json);</span><br><span class="line">          <span class="keyword">if</span>(doc[<span class="string">&quot;errcode&quot;</span>].as&lt;<span class="keyword">int</span>&gt;()==<span class="number">0</span>)&#123;</span><br><span class="line">              token = doc[<span class="string">&quot;access_token&quot;</span>].as&lt;<span class="keyword">String</span>&gt;();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">Serial</span>.<span class="built_in">printf</span>(<span class="string">&quot;[HTTPS] GET... failed, error: %s\n&quot;</span>, https.errorToString(httpCode).c_str());</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      https.<span class="built_in">end</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">Serial</span>.<span class="built_in">printf</span>(<span class="string">&quot;[HTTPS] Unable to connect\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> token;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//调用企业微信api，发送信息。</span></span><br><span class="line"> <span class="function"><span class="keyword">void</span> <span class="title">send_msg</span><span class="params">(<span class="keyword">String</span> msg)</span></span>&#123;</span><br><span class="line">   <span class="comment">//调用get_token函数，获取token</span></span><br><span class="line">   <span class="keyword">String</span> token = get_token();</span><br><span class="line">   <span class="comment">//token=123表示get_token()函数请求token失败。</span></span><br><span class="line">   <span class="comment">//如果失败，可能还需要其他步骤，比如重新获取。这里没有完善。</span></span><br><span class="line">   <span class="keyword">if</span> (token == <span class="string">&quot;123&quot;</span>)&#123;</span><br><span class="line">      <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;not get token&quot;</span>);</span><br><span class="line">     <span class="keyword">return</span>;</span><br><span class="line">   &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;got token&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="comment">//构造请求url</span></span><br><span class="line">   <span class="keyword">String</span> requestUrl = sendMsgUrl + token;</span><br><span class="line">   <span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;BearSSL::WiFiClientSecure&gt;client(<span class="keyword">new</span> BearSSL::WiFiClientSecure);</span><br><span class="line">   client-&gt;setFingerprint(fingerprint);</span><br><span class="line">   HTTPClient httpClient;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//与微信服务器建立连接</span></span><br><span class="line">   httpClient.<span class="built_in">begin</span>(*client,requestUrl);</span><br><span class="line">   <span class="comment">//构建json数据，用于发送请求内容</span></span><br><span class="line">   <span class="keyword">String</span> json = <span class="string">&quot;&#123;\&quot;touser\&quot;:\&quot;@all\&quot;,\&quot;msgtype\&quot;:\&quot;text\&quot;,\&quot;agentid\&quot;:1000002,\&quot;text\&quot;:&#123;\&quot;content\&quot;:\&quot;&quot;</span>+msg+<span class="string">&quot;\&quot;&#125;,\&quot;safe\&quot;:0,\&quot;enable_id_trans\&quot;:0,\&quot;enable_duplicate_check\&quot;:0,\&quot;duplicate_check_interval\&quot;:1800&#125;&quot;</span>;</span><br><span class="line">   <span class="comment">//发送请求内容</span></span><br><span class="line">   <span class="built_in">Serial</span>.<span class="built_in">println</span>(json);</span><br><span class="line">   <span class="comment">//将请求数据放到POST()中。</span></span><br><span class="line">   <span class="keyword">int</span> httpCode = httpClient.POST(json);</span><br><span class="line">   <span class="comment">//这里没有读取服务器返回的json数据，最好还是提取出来，判断是否发送成功。可自行添加代码</span></span><br><span class="line">   <span class="keyword">if</span> (httpCode &gt; <span class="number">0</span>) &#123;</span><br><span class="line">     <span class="comment">//将服务器响应头打印到串口</span></span><br><span class="line">     <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;[HTTP] POST... code:&quot;</span>+ httpCode);</span><br><span class="line">     <span class="comment">//将从服务器获取的数据打印到串口</span></span><br><span class="line">     <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class="line">       <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;Send success&quot;</span>);</span><br><span class="line">       <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;return str:&quot;</span>+httpClient.getString());</span><br><span class="line">     &#125;</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;send failure&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//关闭ESP8266与服务器连接</span></span><br><span class="line">   httpClient.<span class="built_in">end</span>();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Wifi init</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wifi_init</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">begin</span>(<span class="number">9600</span>);</span><br><span class="line">  <span class="built_in">WiFi</span>.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  <span class="built_in">WiFi</span>.<span class="built_in">begin</span>(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;Connecting&quot;</span>); <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">WiFi</span>.status() != WL_CONNECTED) &#123;</span><br><span class="line">    <span class="built_in">delay</span>(<span class="number">500</span>);</span><br><span class="line">    <span class="built_in">Serial</span>.<span class="built_in">print</span>(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">print</span>(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">println</span>(ssid);</span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">print</span>(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="built_in">WiFi</span>.<span class="built_in">localIP</span>()); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  wifi_init();</span><br><span class="line">  send_msg(<span class="string">&quot;hello world!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ArduinoJSON库需要在IDE库管理中搜索安装，</p><p>其他库都是随ESP8266库一起安装的。</p></blockquote><p>json格式化和转义：<a href="http://www.bejson.com/">http://www.bejson.com/</a></p><p>ArduinoJson Assistant：<a href="https://arduinojson.org/v6/assistant/">https://arduinojson.org/v6/assistant/</a></p><p>关于ArduinoJSON详细教程可见参考资料章节</p><h1 id="7：低功耗方案"><a href="#7：低功耗方案" class="headerlink" title="7：低功耗方案"></a>7：低功耗方案</h1><p>ESP8266提供三种省电模式。</p><p><img src="https://i.loli.net/2020/11/28/ISEmNwO87xsL2uJ.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/28/ISEmNwO87xsL2uJ.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>当我们的程序在某个时间段不需要使用wifi模块时，可让它进入睡眠模式，</p><p>Modem-Sleep模式：wifi与路由器保持连接，只在间断的时间里发送一个消息以保持连接。</p><p>Light-Sleep模式：在Modem-Sleep的基础上，关闭CPU。在esp循环任务长时间不需要esp工作时，会自动进入此模式。</p><p>Deep-Sleep模式：断开wifi。可用户配置。</p><p>deepsleep模式提供定时器唤醒和外部IO唤醒两种方案。</p><ol><li>定时器唤醒</li></ol><p>将RST引脚接GPIO16。</p><p><img src="https://i.loli.net/2020/11/28/fLxZXFoKgtsji9k.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/28/fLxZXFoKgtsji9k.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * ESP8266 Deep sleep mode example</span></span><br><span class="line"><span class="comment"> * Rui Santos </span></span><br><span class="line"><span class="comment"> * Complete Project Details https://randomnerdtutorials.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">begin</span>(<span class="number">115200</span>);</span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">setTimeout</span>(<span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Wait for serial to initialize.</span></span><br><span class="line">  <span class="keyword">while</span>(!<span class="built_in">Serial</span>) &#123; &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Deep sleep mode for 30 seconds, the ESP8266 wakes up by itself when GPIO 16 (D0 in NodeMCU board) is connected to the RESET pin</span></span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;I&#x27;m awake, but I&#x27;m going into deep sleep mode for 30 seconds&quot;</span>);</span><br><span class="line">  ESP.deepSleep(<span class="number">30e6</span>); </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ESP-01芯片，GPIO16引脚并没有引出，所以，很难将RST引脚与其相接。</p><p><img src="https://i.loli.net/2020/11/28/t1DKzIw8EcpknCy.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/28/t1DKzIw8EcpknCy.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ol start="2"><li>外部唤醒。</li></ol><p>将RST与外部单片机的IO口相接，当外部IO给RST一个低电平时，芯片将重启激活。</p><p>例如使用按钮来提供低电平</p><p><img src="https://i.loli.net/2020/11/28/HuzF2oGUgDsN4Sl.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/28/HuzF2oGUgDsN4Sl.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><img src="https://i.loli.net/2020/11/28/aS3wmf4FZR5plv7.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/28/aS3wmf4FZR5plv7.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * ESP8266 Deep sleep mode example</span></span><br><span class="line"><span class="comment"> * Rui Santos </span></span><br><span class="line"><span class="comment"> * Complete Project Details https://randomnerdtutorials.com</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">begin</span>(<span class="number">115200</span>);</span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">setTimeout</span>(<span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Wait for serial to initialize.</span></span><br><span class="line">  <span class="keyword">while</span>(!<span class="built_in">Serial</span>) &#123; &#125;</span><br><span class="line">    </span><br><span class="line">  <span class="comment">// Deep sleep mode until RESET pin is connected to a LOW signal (for example pushbutton or magnetic reed switch)</span></span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;I&#x27;m awake, but I&#x27;m going into deep sleep mode until RESET pin is connected to a LOW signal&quot;</span>);</span><br><span class="line">  ESP.deepSleep(<span class="number">0</span>); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>有的ESP模块上面带有LED灯，采用低功耗方案，务必将LED移除。</li></ol><h1 id="8：与其他单片机通讯"><a href="#8：与其他单片机通讯" class="headerlink" title="8：与其他单片机通讯"></a>8：与其他单片机通讯</h1><p>ESP通过串口可与其他单片机传递信息，将ESP的TX引脚连接其他单片机RX引脚，ESP的RX连接其他单片机的TX。</p><blockquote><p>注意，ESP8266是3.3V供电，VCC需要接3.3V。如果其他单片机是5V供电，ESP的RX引脚需要分压之后连接其他单片机的TX，否则进入ESP的5V电压会烧坏芯片。ESP的TX则不用分压。</p></blockquote><p>下图为ESP连接Arduino Nano的接线图，途中，ESP RX引脚，通过1K和2K的电阻分压，其实也可以直接在ESP TX引脚和单片机RX引脚之间连接一个550左右的电阻。</p><p><img src="https://i.loli.net/2020/11/27/u2Ggy1z9U87fV3i.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/27/u2Ggy1z9U87fV3i.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h1 id="9：参考资料"><a href="#9：参考资料" class="headerlink" title="9：参考资料"></a>9：参考资料</h1><p>《<a href="http://www.piaoyi.org/iot/espressif-ESP8266-MQTT-AT.html">乐鑫ESP8266烧录固件、升级最新固件、刷MQTT固件</a>》</p><p>《<a href="https://blog.csdn.net/weixin_44713763/article/details/104755899">ESP8266 WIFI模块常用AT指令汇总</a>》</p><p>《<a href="https://blog.csdn.net/qq_34020487/article/details/102766314">Arduino安装ESP8266的开发环境</a>》</p><p>《<a href="http://www.taichi-maker.com/homepage/esp8266-nodemcu-iot/iot-c/esp8266-nodemcu-web-client/esp8266-json-parse/">ESP8266 JSON解析</a>》</p><p>《<a href="http://www.taichi-maker.com/homepage/iot-development/iot-dev-reference/esp8266-c-plus-plus-reference/http-client-secure/certificate-fingerprint/">物联网开发实用知识 – 查看网站证书指纹</a>》</p><p>《<a href="https://randomnerdtutorials.com/esp8266-deep-sleep-with-arduino-ide/">ESP8266 Deep Sleep with Arduino IDE (NodeMCU)</a>》</p>]]></content>
      
      
      <categories>
          
          <category> 嵌入式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ESP8266 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于ESP8266WIFI模块和MPU6050传感器在Arduino上开发智能信箱</title>
      <link href="/2020/11/24/%E5%9F%BA%E4%BA%8EESP8266WIFI%E6%A8%A1%E5%9D%97%E5%92%8CMPU6050%E5%8A%A0%E9%80%9F%E5%BA%A6%E8%AE%A1%E5%9C%A8Arduino%E4%B8%8A%E5%BC%80%E5%8F%91%E6%99%BA%E8%83%BD%E4%BF%A1%E7%AE%B1/"/>
      <url>/2020/11/24/%E5%9F%BA%E4%BA%8EESP8266WIFI%E6%A8%A1%E5%9D%97%E5%92%8CMPU6050%E5%8A%A0%E9%80%9F%E5%BA%A6%E8%AE%A1%E5%9C%A8Arduino%E4%B8%8A%E5%BC%80%E5%8F%91%E6%99%BA%E8%83%BD%E4%BF%A1%E7%AE%B1/</url>
      
        <content type="html"><![CDATA[<h1 id="1：开篇"><a href="#1：开篇" class="headerlink" title="1：开篇"></a>1：开篇</h1><p>在德国，每家每户都有一个信箱，家庭的电气暖账单，亲人的问候，个人的信件都会装到这个小小的箱子里。。相较于送货到人的快递，信件往往被我们所忽略，常宅在家的我，一两个星期才会检查一次信箱。虽然信件通常不重要，但检查信箱还是有点麻烦。于是，我设计了一个小小的模块，让它代替我检查信箱，每当有新的信件进入信箱，它就发送一条微信消息，提醒我取信件。</p><h2 id="1-1-ESP8266-01-Wifi模块"><a href="#1-1-ESP8266-01-Wifi模块" class="headerlink" title="1.1 ESP8266-01 Wifi模块"></a>1.1 ESP8266-01 Wifi模块</h2><p>wifi模块是物联网中不可或缺的一部分，通过它连上家里的wifi，向网络发送请求。调用企业微信api，来发送微信消息。</p><p><img src="https://i.loli.net/2020/11/25/1BzINH4M5urOPnQ.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/25/1BzINH4M5urOPnQ.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>ESP8266通过串口通信与Arduino单片机通信，由3.3V直流电压供电。</p><h2 id="1-2-GY-521模块"><a href="#1-2-GY-521模块" class="headerlink" title="1.2 GY-521模块"></a>1.2 GY-521模块</h2><p>GY-521指围绕MPU6050芯片所设计的电路板。</p><p>MPU6050芯片集成了加速度计、陀螺仪、温度传感器。通过i2c与Arduino单片机通信。工作电压为5V。</p><p><img src="https://i.loli.net/2020/11/25/SW2d3zAYn6Cmv7P.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/25/SW2d3zAYn6Cmv7P.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>使用MPU6050检测信箱口的运动状态，判断是否有新的信件投入。</p><h2 id="1-3-Arduino"><a href="#1-3-Arduino" class="headerlink" title="1.3 Arduino"></a>1.3 Arduino</h2><p>Arduino是目前非常火的开源单片机，其周边开发板大多开源，因此，一块Arduino开发板价格非常便宜，Arduino pro mini仅十块钱。我采用的是Arduino nano。其带有usb接口，比较方便调试。但是耗电会比pro mini高。</p><p><img src="https://i.loli.net/2020/11/25/5eMrPLpqKmb3FG1.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/25/5eMrPLpqKmb3FG1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>在投入使用时，考虑到电池优化，建议使用pro mini。这样整个系统的运行时长会更久。</p><p>此外，Arduino拥有庞大的社区，大部分传感器模块都有其适配支持的开源库。开发更加容易，且不用花费大量时间阅读硬件说明书。对于追求性能优化而不是仅功能实践的人来说，还是有必要阅读传感器数据手册的。</p><p>Arduino用于接收传感器的数据，并处理计算，判断是否信箱口有动作，如果有，则通过wifi模块发送微信。</p><h1 id="2：电路设计"><a href="#2：电路设计" class="headerlink" title="2：电路设计"></a>2：电路设计</h1><p>这里只是简单的画了一个电路设计图，因为不需要再去制作PCB板，也就不用设计PCB板图。只要购买相应的模块，然后对照电路图连线即可。</p><p><img src="https://i.loli.net/2020/11/30/JZrCeHhQS2W4tDR.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/30/JZrCeHhQS2W4tDR.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>面包板图</p><p><img src="https://i.loli.net/2020/11/30/9ZDSA3qTaPJ1tVe.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/30/9ZDSA3qTaPJ1tVe.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h2 id="2-1-电源设计"><a href="#2-1-电源设计" class="headerlink" title="2.1 电源设计"></a>2.1 电源设计</h2><ul><li>5V电源</li></ul><p>通过4个AA电池串联，获得一个4x1.5V的直流电，理论电压为6V，而实际上都会小于6V。因为单片机供电要求在4.5~5.5V之间，如有必要可在电池正极接一个稳压二极管。稳压二极管由硅材料制成，其正向导通时，在PN结之间产生一个0.7V左右的压降。因此从稳压二极管输出的电压就能够满足单片机供电需求。我直接连接VCC供电是没有问题的。</p><p>当然也可以使用9~12V的电源连接VIN接口供电，或者直接使用充电宝，通过usb接口供电。需要注意的是，usb供电会额外增加电能损耗。</p><ul><li>3V3电源</li></ul><p>ESP8266模块使用3V3电源，4个干电池，无法提供3V电源，使用LM1117-3.3芯片将5V降压为3V。输入和输出口各加一个2.2uF的电容，用于稳压。</p><h2 id="2-2-各模块接线"><a href="#2-2-各模块接线" class="headerlink" title="2.2 各模块接线"></a>2.2 各模块接线</h2><p>GY521模块SCL、SDA分别为I2C的时钟和数据总线，与ArduinoSCL和SDA相连。GY521 Int引脚接Arduino D2(INT0)引脚。</p><p>Arduino D6引脚，输出控制电平，通过一个稳压二极管，将5V高电平转3V高电平。</p><h1 id="3：程序设计"><a href="#3：程序设计" class="headerlink" title="3：程序设计"></a>3：程序设计</h1><h2 id="3-1-wifi模块"><a href="#3-1-wifi模块" class="headerlink" title="3.1 wifi模块"></a>3.1 wifi模块</h2><p>当WIFI模块启动时，会发送一条微信消息。然后进入睡眠，当RST引脚接收到低电平-&gt;高电平时，WIFI模块将被唤醒。</p><p>我猜测我的WIFI模块是存在某种问题的，当它被唤醒时，并不会进行运行loop中的内容，而是进行了未知操作。因此，我在Arduino中不得不，向RST引脚发出两次低电平，第一次用于激活WIFI模块，第二次重置WIFI模块，因为它重启的时候，就会发送一条微信消息。所以也能实现既定功能。</p><p>ESP8266发送https请求时，不会自动获取服务器证书，所以需要自己从服务器去获取，可以直接从浏览器拷贝下来。这里没有使用证书，而是指纹，作用相同。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Arduino.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ESP8266WiFi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ESP8266HTTPClient.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;WiFiClientSecureBearSSL.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ArduinoJson.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//WiFi连接信息（注意：需要自行修改以下内容否则ESP8266无法连接WiFi）</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ssid <span class="meta-string">&quot;SSIDU&quot;</span>   <span class="comment">//WiFi名称 </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> password <span class="meta-string">&quot;Password&quot;</span>  <span class="comment">//WiFi密码</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//https://qyapi.weixin.qq.com服务器的指纹</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> fingerprint[] PROGMEM = <span class="string">&quot;790e6e32485bb89503ac6da87d948f5e634322a7&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//HTTPS端口443</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> httpsPort = <span class="number">443</span>;  </span><br><span class="line"><span class="comment">// 企业微信api相关</span></span><br><span class="line"><span class="keyword">String</span> tokenUrl = <span class="string">&quot;https://qyapi.weixin.qq.com/cgi-bin/gettoken&quot;</span>;</span><br><span class="line"><span class="keyword">String</span> sendMsgUrl = <span class="string">&quot;https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=&quot;</span>;</span><br><span class="line"><span class="keyword">String</span> corpid = <span class="string">&quot;ww98b********d&quot;</span>;</span><br><span class="line"><span class="keyword">String</span> corpsecret = <span class="string">&quot;Kh8eKMZ**********wzQoPb0SYCqV3Tgcs&quot;</span>;</span><br><span class="line"><span class="keyword">String</span> agentid = <span class="string">&quot;1000002&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//发起Https请求</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//获取企业微信access_token</span></span><br><span class="line"><span class="function"><span class="keyword">String</span> <span class="title">get_token</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">String</span> token = <span class="string">&quot;123&quot;</span>;</span><br><span class="line">  <span class="keyword">String</span> requestUrl = tokenUrl + <span class="string">&quot;?corpid=&quot;</span>+corpid+<span class="string">&quot;&amp;corpsecret=&quot;</span>+corpsecret;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;BearSSL::WiFiClientSecure&gt;client(<span class="keyword">new</span> BearSSL::WiFiClientSecure);</span><br><span class="line">  client-&gt;setFingerprint(fingerprint);</span><br><span class="line">  HTTPClient https;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (https.<span class="built_in">begin</span>(*client, requestUrl)) &#123;  <span class="comment">// HTTPS</span></span><br><span class="line">      <span class="built_in">Serial</span>.<span class="built_in">print</span>(<span class="string">&quot;[HTTPS] GET...\n&quot;</span>);</span><br><span class="line">      <span class="comment">// start connection and send HTTP header</span></span><br><span class="line">      <span class="keyword">int</span> httpCode = https.GET();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// httpCode will be negative on error</span></span><br><span class="line">      <span class="keyword">if</span> (httpCode &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// HTTP header has been send and Server response header has been handled</span></span><br><span class="line">        <span class="built_in">Serial</span>.<span class="built_in">printf</span>(<span class="string">&quot;[HTTPS] GET... code: %d\n&quot;</span>, httpCode);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// file found at server</span></span><br><span class="line">        <span class="keyword">if</span> (httpCode == HTTP_CODE_OK || httpCode == HTTP_CODE_MOVED_PERMANENTLY) &#123;</span><br><span class="line">          <span class="keyword">String</span> json = https.getString();</span><br><span class="line">          <span class="built_in">Serial</span>.<span class="built_in">println</span>(json);</span><br><span class="line">          <span class="comment">// 创建DynamicJsonDocument对象，json中的参数为4个。</span></span><br><span class="line">          <span class="keyword">const</span> <span class="keyword">size_t</span> capacity = JSON_OBJECT_SIZE(<span class="number">4</span>) + <span class="number">290</span>;</span><br><span class="line">          <span class="function">DynamicJsonDocument <span class="title">doc</span><span class="params">(capacity)</span></span>;</span><br><span class="line">          <span class="comment">//反序列化数据</span></span><br><span class="line">          deserializeJson(doc, json);</span><br><span class="line">          <span class="keyword">if</span>(doc[<span class="string">&quot;errcode&quot;</span>].as&lt;<span class="keyword">int</span>&gt;()==<span class="number">0</span>)&#123;</span><br><span class="line">              token = doc[<span class="string">&quot;access_token&quot;</span>].as&lt;<span class="keyword">String</span>&gt;();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">Serial</span>.<span class="built_in">printf</span>(<span class="string">&quot;[HTTPS] GET... failed, error: %s\n&quot;</span>, https.errorToString(httpCode).c_str());</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      https.<span class="built_in">end</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">Serial</span>.<span class="built_in">printf</span>(<span class="string">&quot;[HTTPS] Unable to connect\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> token;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//调用企业微信api，发送信息。</span></span><br><span class="line"> <span class="function"><span class="keyword">void</span> <span class="title">send_msg</span><span class="params">(<span class="keyword">String</span> msg)</span></span>&#123;</span><br><span class="line">   <span class="comment">//调用get_token函数，获取token</span></span><br><span class="line">   <span class="keyword">String</span> token = get_token();</span><br><span class="line">   <span class="comment">//token=123表示get_token()函数请求token失败。</span></span><br><span class="line">   <span class="comment">//如果失败，可能还需要其他步骤，比如重新获取。这里没有完善。</span></span><br><span class="line">   <span class="keyword">if</span> (token == <span class="string">&quot;123&quot;</span>)&#123;</span><br><span class="line">      <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;not get token&quot;</span>);</span><br><span class="line">     <span class="keyword">return</span>;</span><br><span class="line">   &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;got token&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="comment">//构造请求url</span></span><br><span class="line">   <span class="keyword">String</span> requestUrl = sendMsgUrl + token;</span><br><span class="line">   <span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;BearSSL::WiFiClientSecure&gt;client(<span class="keyword">new</span> BearSSL::WiFiClientSecure);</span><br><span class="line">   client-&gt;setFingerprint(fingerprint);</span><br><span class="line">   HTTPClient httpClient;</span><br><span class="line">   </span><br><span class="line">   httpClient.addHeader(<span class="string">&quot;Content-Type&quot;</span>,<span class="string">&quot;application/json&quot;</span>); </span><br><span class="line">   <span class="comment">//与微信服务器建立连接</span></span><br><span class="line">   httpClient.<span class="built_in">begin</span>(*client,requestUrl);</span><br><span class="line">   <span class="comment">//构建json数据，用于发送请求内容</span></span><br><span class="line">   <span class="keyword">String</span> json = <span class="string">&quot;&#123;\&quot;touser\&quot;:\&quot;@all\&quot;,\&quot;msgtype\&quot;:\&quot;text\&quot;,\&quot;agentid\&quot;:1000002,\&quot;text\&quot;:&#123;\&quot;content\&quot;:\&quot;&quot;</span>+msg+<span class="string">&quot;\&quot;&#125;,\&quot;safe\&quot;:0,\&quot;enable_id_trans\&quot;:0,\&quot;enable_duplicate_check\&quot;:0,\&quot;duplicate_check_interval\&quot;:1800&#125;&quot;</span>;</span><br><span class="line">   <span class="comment">//发送请求内容</span></span><br><span class="line">   <span class="built_in">Serial</span>.<span class="built_in">println</span>(json);</span><br><span class="line">   <span class="keyword">int</span> httpCode = httpClient.POST(json);</span><br><span class="line">   <span class="comment">//未完善，可能发送请求成功，但api调用失败，后续完善。</span></span><br><span class="line">   <span class="keyword">if</span> (httpCode &gt; <span class="number">0</span>) &#123;</span><br><span class="line">     <span class="comment">//将服务器响应头打印到串口</span></span><br><span class="line">     <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;[HTTP] POST... code:&quot;</span>+ httpCode);</span><br><span class="line">     <span class="comment">//将从服务器获取的数据打印到串口</span></span><br><span class="line">     <span class="keyword">if</span> (httpCode == HTTP_CODE_OK) &#123;</span><br><span class="line">       <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;Send success&quot;</span>);</span><br><span class="line">       <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;return str:&quot;</span>+httpClient.getString());</span><br><span class="line">     &#125;</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;send failure&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//关闭ESP8266与服务器连接</span></span><br><span class="line">   httpClient.<span class="built_in">end</span>();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Wifi init</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wifi_init</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="built_in">WiFi</span>.mode(WIFI_STA);        <span class="comment">//设置ESP8266为无线终端工作模式</span></span><br><span class="line">  </span><br><span class="line">  <span class="built_in">WiFi</span>.<span class="built_in">begin</span>(ssid, password); <span class="comment">//连接WiFi</span></span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line"> </span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;Connecting&quot;</span>); <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 等待连接</span></span><br><span class="line">  <span class="keyword">while</span> (<span class="built_in">WiFi</span>.status() != WL_CONNECTED) &#123;</span><br><span class="line">    <span class="built_in">delay</span>(<span class="number">500</span>);</span><br><span class="line">    <span class="built_in">Serial</span>.<span class="built_in">print</span>(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//成功连接后通过串口监视器显示WiFi名称以及ESP8266的IP地址。</span></span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">print</span>(<span class="string">&quot;Connected to &quot;</span>);</span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">println</span>(ssid);</span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">print</span>(<span class="string">&quot;IP address: &quot;</span>);</span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="built_in">WiFi</span>.<span class="built_in">localIP</span>()); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">begin</span>(<span class="number">9600</span>);</span><br><span class="line">  wifi_init();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  send_msg(<span class="string">&quot;你有一封新信件，请及时提取！&quot;</span>);</span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">3000</span>);</span><br><span class="line">  ESP.deepSleep(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-2-Arduino和GY521"><a href="#3-2-Arduino和GY521" class="headerlink" title="3.2 Arduino和GY521"></a>3.2 Arduino和GY521</h2><p>在这里，Arduino会对MPU6050芯片进行初始化设置，然后进入睡眠模式。在MPU中，我们将除了Z轴加速度采样以外的所有检测模块都关闭，以提高电池的持久力。并当Z轴检测到大于阈值的运动时，产生运动中断，中断将GY521的INT引脚拉低，INT引脚连接Arduino INT0引脚也就是2号引脚，Arduino将在中断发生时被唤醒。唤醒后的Arduino，通过6号引脚，向ESPwifi模块的RST发送两个低电平脉冲，用于激活并重置ESP。</p><p>MPU6050是提供一些低电平方案的，比如CYCLE模式，此模式下可以设置MPU的采样频率，最低可达1.25Hz，但设置此模式，MPU6050的运动检测功能将受限。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;MPU6050.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;Wire.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;avr/sleep.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义Arduino引脚，2号为中断引脚，当2号引脚输入低电平，Arduino从睡眠被唤醒</span></span><br><span class="line"><span class="comment">//6号引脚为输出，当6号输出低电平，ESP8266模块被激活。</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INTERRUPT_PIN 2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ESP_ACTIVATE_PIN 6</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU6050_ADDRESS 0x68</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIGNAL_PATH_RESET 0x68</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INT_PIN_CFG 0x37</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ACCEL_CONFIG 0x1C</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MOT_THR 0x1F <span class="comment">// Motion detection threshold bits [7:0]</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MOT_DUR 0x20 <span class="comment">// Duration counter threshold for motion interrupt generation, 1 kHz rate, LSB = 1 ms</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MOT_DETECT_CTRL 0x69</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INT_ENABLE 0x38</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WHO_AM_I_MPU6050 0x75 <span class="comment">// Should return 0x68</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INT_STATUS 0x3A</span></span><br><span class="line"></span><br><span class="line">MPU6050 mpu;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mpu6050_init</span><span class="params">()</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="built_in">Wire</span>.<span class="built_in">begin</span>();<span class="comment">//开启i2c通讯</span></span><br><span class="line">  mpu.initialize();</span><br><span class="line">  <span class="comment">//电源管理，将陀螺仪全部关闭，只留z轴加速度</span></span><br><span class="line">  <span class="comment">//如果全部设置为待机，运动检测中断将无法工作</span></span><br><span class="line">  mpu.setStandbyXAccelEnabled(<span class="literal">true</span>);</span><br><span class="line">  mpu.setStandbyXGyroEnabled(<span class="literal">true</span>);</span><br><span class="line">  mpu.setStandbyYAccelEnabled(<span class="literal">true</span>);</span><br><span class="line">  mpu.setStandbyYGyroEnabled(<span class="literal">true</span>);</span><br><span class="line">  mpu.setStandbyZAccelEnabled(<span class="literal">false</span>);<span class="comment">//保持z轴加速度检测活跃</span></span><br><span class="line">  mpu.setStandbyZGyroEnabled(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">//关闭温度传感器</span></span><br><span class="line">  mpu.setTempSensorEnabled(<span class="literal">false</span>);</span><br><span class="line">  <span class="comment">// mpu.setAccelerometerPowerOnDelay(3);//设置加速度计开机延迟</span></span><br><span class="line">  mpu.setInterruptMode(<span class="literal">true</span>); <span class="comment">// 中断时中断引脚发出低电平</span></span><br><span class="line">  mpu.setIntZeroMotionEnabled(<span class="literal">false</span>);<span class="comment">//关闭零运动中断检测</span></span><br><span class="line">  mpu.setIntMotionEnabled(<span class="literal">true</span>); <span class="comment">// 运动检测中断使能</span></span><br><span class="line">  mpu.setInterruptLatch(<span class="literal">true</span>); <span class="comment">// 电平保持，直到清除</span></span><br><span class="line">  mpu.setInterruptLatchClear(<span class="literal">false</span>);<span class="comment">//清除中断引脚电平的方法，false表示只有读取status寄存器才能清除，true读取任意寄存器都可以清除。</span></span><br><span class="line">  mpu.setMotionDetectionThreshold(<span class="number">2</span>);<span class="comment">//检测阈值，阈值越大，需要的震动越大，才能产生中断，单位mg</span></span><br><span class="line">  mpu.setMotionDetectionDuration(<span class="number">20</span>);<span class="comment">//运动持续的时长，越大，则运动需要持续越久，才能产生中断。单位ms</span></span><br><span class="line">  mpu.setMotionDetectionCounterDecrement(<span class="number">1</span>);</span><br><span class="line">  <span class="comment">//Write register 28 (==0x1C) to set the Digital High Pass Filter, bits 3:0. For example set it to 0x01 for 5Hz. (These 3 bits are grey in the data sheet, but they are used! Leaving them 0 means the filter always outputs 0.)</span></span><br><span class="line">  writeByte(MPU6050_ADDRESS, ACCEL_CONFIG, <span class="number">0x01</span>); </span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;MPU init finish&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sleepNow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  set_sleep_mode(SLEEP_MODE_PWR_DOWN);<span class="comment">//设置Arduino睡眠模式为power down</span></span><br><span class="line">  sleep_enable(); <span class="comment">//使能睡眠</span></span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">500</span>);</span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;now sleep!&quot;</span>);</span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">2000</span>);</span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;Interrupt attached!&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="built_in">attachInterrupt</span>(<span class="number">0</span>, wakeUp,<span class="literal">LOW</span>);<span class="comment">//开启中断，0表示INT0，对应2号引脚，wakeUP是中断发生时的处理函数，LOW：2号引脚低电平时触发</span></span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">500</span>);</span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">500</span>);</span><br><span class="line">  sleep_cpu();  <span class="comment">//进入睡眠</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//中断处理函数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">wakeUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">detachInterrupt</span>(<span class="number">0</span>);<span class="comment">//清除中断，防止中断处理过程中，再次进入中断</span></span><br><span class="line">  sleep_disable();<span class="comment">//接触睡眠模式</span></span><br><span class="line">  <span class="built_in">digitalWrite</span>(ESP_ACTIVATE_PIN,<span class="literal">LOW</span>);<span class="comment">//设置激活引脚为低电平，用于激活芯片</span></span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;wake up! reset esp&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//I2c通讯，写入一个字节到寄存器</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">writeByte</span><span class="params">(<span class="keyword">uint8_t</span> address, <span class="keyword">uint8_t</span> subAddress, <span class="keyword">uint8_t</span> data)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">Wire</span>.<span class="built_in">begin</span>();</span><br><span class="line">  <span class="built_in">Wire</span>.<span class="built_in">beginTransmission</span>(address); <span class="comment">// Initialize the Tx buffer</span></span><br><span class="line">  <span class="built_in">Wire</span>.<span class="built_in">write</span>(subAddress); <span class="comment">// Put slave register address in Tx buffer</span></span><br><span class="line">  <span class="built_in">Wire</span>.<span class="built_in">write</span>(data); <span class="comment">// Put data in Tx buffer</span></span><br><span class="line">  <span class="built_in">Wire</span>.<span class="built_in">endTransmission</span>(); <span class="comment">// Send the Tx buffer</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//初始画arduino</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">arduino_init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">Serial</span>.<span class="built_in">begin</span>(<span class="number">9600</span>);<span class="comment">//设置UART通信波特率，使用串口接收。</span></span><br><span class="line">    <span class="built_in">pinMode</span>(INTERRUPT_PIN,<span class="literal">INPUT</span>);<span class="comment">//设置INT0，即2号引脚为输入，确保初始化的时候，引脚上有高电平。</span></span><br><span class="line">    <span class="built_in">pinMode</span>(ESP_ACTIVATE_PIN,<span class="literal">OUTPUT</span>);<span class="comment">//设置6号引脚为输出，用于激活ESP模块</span></span><br><span class="line">    <span class="built_in">digitalWrite</span>(ESP_ACTIVATE_PIN,<span class="literal">HIGH</span>);<span class="comment">//设置输出为高电平，ESP的RESET引脚以低电平激活或重置芯片。</span></span><br><span class="line">    <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;arduino init finish!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span></span>&#123;</span><br><span class="line">  arduino_init();</span><br><span class="line">  mpu6050_init();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span></span>&#123;</span><br><span class="line">  sleepNow();<span class="comment">//进入睡眠</span></span><br><span class="line">  <span class="keyword">int16_t</span> zAccel = mpu.getAccelerationZ();</span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">println</span>(zAccel);</span><br><span class="line">  <span class="keyword">bool</span> detect = mpu.getIntMotionStatus();<span class="comment">//读取中断状态，以清除中断引脚电平。不清除，MPU中断引脚会一直保持低电平。</span></span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">println</span>(detect);</span><br><span class="line">  <span class="comment">//在中断函数中，发送了一个低电平激活芯片，在这里再发送一个低电平，用于重置芯片。最后回到高电平。</span></span><br><span class="line">  <span class="comment">//不能再中断函数中，发送两个电平，因为中断函数中无法使用delay()方法。而低电平必须保持一定时间才能激活ESP。</span></span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">500</span>);</span><br><span class="line">  <span class="built_in">digitalWrite</span>(ESP_ACTIVATE_PIN,<span class="literal">HIGH</span>);</span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">500</span>);</span><br><span class="line">  <span class="built_in">digitalWrite</span>(ESP_ACTIVATE_PIN,<span class="literal">LOW</span>);</span><br><span class="line">  <span class="built_in">Serial</span>.<span class="built_in">println</span>(<span class="string">&quot;rest esp&quot;</span>);</span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">500</span>);</span><br><span class="line">  <span class="built_in">digitalWrite</span>(ESP_ACTIVATE_PIN,<span class="literal">HIGH</span>);</span><br><span class="line">  <span class="built_in">delay</span>(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 嵌入式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Arduino </tag>
            
            <tag> ESP8266 </tag>
            
            <tag> MPU6050 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>人工智能——激活函数</title>
      <link href="/2020/11/15/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E2%80%94%E2%80%94%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0/"/>
      <url>/2020/11/15/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E2%80%94%E2%80%94%E6%BF%80%E6%B4%BB%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="1：什么是激活函数"><a href="#1：什么是激活函数" class="headerlink" title="1：什么是激活函数"></a>1：什么是激活函数</h1><p><img src="https://i.loli.net/2020/11/15/Fc29UrBolCvhXsu.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/15/Fc29UrBolCvhXsu.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>以一个简单的神经元为例。在没有激活函数时，神经元输出z等于$z=x_1w_1+x_2w_2+x_3w_3+b$</p><p>而激活函数将z作为输入，得到新的神经元输出$f(z)$</p><p>这里的$f(z)$即激活函数。激活函数的主要作用是使输出非线性化，即曲线化或者分段化（对应分段函数）。</p><h1 id="2：为什么要激活函数"><a href="#2：为什么要激活函数" class="headerlink" title="2：为什么要激活函数"></a>2：为什么要激活函数</h1><p>从$z=x_1w_1+x_2w_2+x_3w_3+b$不难看出，在没有激活函数时，我们的神经元输出，总是与输入$x_1,x_2,x_3$成线性关系。。</p><p>简单点的例子，$z = x_1*w+b$。</p><p><img src="https://i.loli.net/2020/11/15/YHsCFPyKq9fbWr4.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/15/YHsCFPyKq9fbWr4.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>可以知道，这是一条直线。可以解决一个简单的二分类问题。</p><p><img src="https://i.loli.net/2020/11/15/xEYhM3Lae7nyHgP.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/15/xEYhM3Lae7nyHgP.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>如果这个二分类不是用直线分割的呢？</p><p>比如，一个圆形，圆内的点是1，圆外是0。我们用直线就很难将他们区分开了。</p><p>当然，也可以使用无数条小的直线来划分这两个区域，但是对比直接使用曲线，就复杂多了。</p><p>为了让我们的输出函数，符合非线性特征，引入了激活函数的概念。</p><h1 id="3：哪些激活函数"><a href="#3：哪些激活函数" class="headerlink" title="3：哪些激活函数"></a>3：哪些激活函数</h1><p><img src="https://pic1.zhimg.com/80/v2-17708ef17113fc120b045db3de3dbaac_1440w.jpg" class="lazyload" data-srcset="https://pic1.zhimg.com/80/v2-17708ef17113fc120b045db3de3dbaac_1440w.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="img"></p><ul><li>Sigmoid函数</li></ul><p>Sigmoid函数只会输出0到1之间的正数，当输入无穷小时，输出为0，输入无穷大时，输出为1。</p><p><strong>缺点</strong>：</p><p>基于反向传播（根据链式求导法则）的参数更新，随着网络层数的增加，w更新的梯度会越来越小，并逐渐接近于零。也就是所谓的梯度消失。</p><p>下图是链式求导法则求w梯度的过程。这是某个神经网络中的一部分神经元。</p><p><img src="https://i.loli.net/2020/11/15/oNuhZldMr53q7Dx.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/15/oNuhZldMr53q7Dx.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>其中，$net_{o1}=h1<em>w5+h2</em>w6+b2$</p><p>$out_{o1}=Sigmoid(net_{o1})$</p><p>误差函数为$E_{o1}=\frac{target-out_{o1}}{2}$</p><p>获得$w_5$更新所需的梯度就是求$E_{o1}$对$w_5$求导。</p><p>根据链式法则，<br>$$<br>\frac{\partial E_{o1}}{\part w_5} = \frac{\part E_{o1}}{\part out_{o1}}* \frac{\part out_{o1}}{\part net_{o1}}* \frac{\part net_{o1}}{\part w_5}<br>$$<br>其中$\frac{\part out_{o1}}{\part net_{o1}}$就是Sigmoid函数求导。</p><p>根据Sigmoid函数求导公式，<br>$$<br>\frac{\part g(z)}{\part z} = g(z)(1-g(z))<br>$$<br><img src="https://i.loli.net/2020/11/15/Y6AES1lOiv5CX7d.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/15/Y6AES1lOiv5CX7d.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>上式，$g(z)$为Sigmoid函数，其导数最大值为0.25.</p><p>当神经元个数逐渐增多，前向w梯度，是后向w梯度做链式法则的结果，那么会有许多个$g’(z)$相乘。则，前向w的梯度会逐渐趋近于0。</p><ul><li>tanh函数</li></ul><p><img src="https://i.loli.net/2020/11/15/5gxnFPvMa1Tdq6l.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/15/5gxnFPvMa1Tdq6l.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>相比于Sigmod函数，其输出均值为0。</p><p>缺点：</p><p>仍然存在梯度消失现象。</p><ul><li>Relu函数</li></ul><p>目前最常用的函数，只需判断输入是否大于零，小于零的输入，输出为0</p><p><img src="https://i.loli.net/2020/11/15/EenTzWxGV9iAqfZ.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/15/EenTzWxGV9iAqfZ.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h1 id="4：参考资料"><a href="#4：参考资料" class="headerlink" title="4：参考资料"></a>4：参考资料</h1><p>《<a href="https://zhuanlan.zhihu.com/p/32824193">CNN入门讲解：什么是激活函数（Activation Function）</a>》</p><p>《<a href="https://blog.csdn.net/tyhj_sf/article/details/79932893">常用激活函数（激励函数）理解与总结</a>》</p><p>《<a href="https://zhuanlan.zhihu.com/p/32819991">BP（反向传播算法）公式推导及例题解析</a>》</p><p>《<a href="https://blog.csdn.net/C_Dreams/article/details/75748005">sigmoid函数的求导</a>》</p>]]></content>
      
      
      <categories>
          
          <category> 人工智能 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 人工智能 </tag>
            
            <tag> AI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>北大人工智能实践——TensorFlow2</title>
      <link href="/2020/11/12/%E5%8C%97%E5%A4%A7%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E5%AE%9E%E8%B7%B5%E2%80%94%E2%80%94TensorFlow2/"/>
      <url>/2020/11/12/%E5%8C%97%E5%A4%A7%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E5%AE%9E%E8%B7%B5%E2%80%94%E2%80%94TensorFlow2/</url>
      
        <content type="html"><![CDATA[<h1 id="1：人工智能三学派"><a href="#1：人工智能三学派" class="headerlink" title="1：人工智能三学派"></a>1：人工智能三学派</h1><ul><li>准备数据</li><li>搭建网络</li><li>优化参数</li><li>应用网络</li></ul><h1 id="2：神经网络设计过程"><a href="#2：神经网络设计过程" class="headerlink" title="2：神经网络设计过程"></a>2：神经网络设计过程</h1><p>鸢尾花的分类：</p><p>通过测量花萼长、花萼宽。</p><p>if语句case语句——<strong>专家系统</strong>把专家的经验告知计算机，计算机执行逻辑判断。给出分类</p><p>神经网络：采集大量数据对构成数据集。</p><h1 id="3：张量生成"><a href="#3：张量生成" class="headerlink" title="3：张量生成"></a>3：张量生成</h1><p>张量（Tensor）：多维数组（列表）    阶：张量的维数</p><table><thead><tr><th>阶</th><th>名字</th><th>例子</th></tr></thead><tbody><tr><td>0</td><td>标量</td><td>S=1 2 3</td></tr><tr><td>1</td><td>向量</td><td>v=[1,2,3]</td></tr><tr><td>2</td><td>矩阵</td><td></td></tr><tr><td>n</td><td>张量</td><td></td></tr></tbody></table><p>创建张量</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = tf.constan(张量内容,dtype = 数据类型)</span><br><span class="line">print(a)</span><br><span class="line">print(a.dtype)</span><br><span class="line">print(a.shape)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tf.zeros(维度)</span><br><span class="line">tf.ones(维度)</span><br><span class="line">tf.fill(维度，指定值)</span><br><span class="line">c = tf.fill([<span class="number">2</span>,<span class="number">2</span>],<span class="number">9</span>)//两行两列</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tf.random.normal(维度,mean=均值,stddev=标准差)</span><br><span class="line">tf.random.truncated_normal(维度，mean=均值,stddev=标准差)</span><br><span class="line">tf.random.uniform(维度,minval=最小值,maxval=最大值)</span><br></pre></td></tr></table></figure><h1 id="4：常用函数"><a href="#4：常用函数" class="headerlink" title="4：常用函数"></a>4：常用函数</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tf.cast(张量名,dtype&#x3D;数据类型)&#x2F;&#x2F;强制转换数据类型</span><br><span class="line">tf.reduce_min()&#x2F;&#x2F;计算最大值</span><br><span class="line">tf.reduce_max()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tf.reduce_mean(张量名,axis=操作轴)//计算张量延指定维度平均值</span><br><span class="line">tf.reduce_sum(张量名,axis=操作轴)//计算沿指定维度的和</span><br></pre></td></tr></table></figure><p>未指定操作轴，则为对全部数进行操作</p><p>变量：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tf.Variable(初始值)</span><br></pre></td></tr></table></figure><p>数学运算</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">tf.add()</span><br><span class="line">tf.subtract()</span><br><span class="line">tf.multiply()</span><br><span class="line">tf.divide()</span><br><span class="line">&#x2F;&#x2F;只有维度相同才能进行四则运算</span><br><span class="line">tf.square(张量名)平方</span><br><span class="line">tf.pow()&#x2F;&#x2F;n次方</span><br><span class="line">tf.sqrt()&#x2F;&#x2F;开方</span><br></pre></td></tr></table></figure><p>矩阵乘</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tf.matmul(矩阵<span class="number">1</span>，矩阵<span class="number">2</span>)</span><br></pre></td></tr></table></figure><p>特征和标签对应：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">features &#x3D; tf.constant([12,23,10,14])</span><br><span class="line">labels &#x3D; tf.constant([0,1,1,0])</span><br><span class="line">dataset &#x3D; tf.data.Dataset.from_tensor_slices((features,labels))</span><br></pre></td></tr></table></figure><p>计算梯度</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> tf.GradientTape() <span class="keyword">as</span> tape:</span><br><span class="line">w = tf.Variable(tf.constant(<span class="number">3.0</span>))</span><br><span class="line">loss = tf.pow(w,<span class="number">2</span>)</span><br><span class="line">grad = tape.gradient(loss,w)</span><br></pre></td></tr></table></figure><p><strong>enumerate</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">seq = [<span class="string">&#x27;one&#x27;</span>,<span class="string">&#x27;two&#x27;</span>,<span class="string">&#x27;three&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> i,element <span class="keyword">in</span> enumerate(seq):</span><br><span class="line">print(i,element)</span><br></pre></td></tr></table></figure><p>独热编码：</p><p>标记类别：1表示是，0表示否</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tf.one_hot(待转换数据，depth&#x3D;几分类)</span><br></pre></td></tr></table></figure><p>输出符合概率分布：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tf.nn.softmax(x)</span><br><span class="line"></span><br><span class="line">y = tf.constant([<span class="number">1.01</span>,<span class="number">2.01</span>,<span class="number">-0.66</span>])</span><br><span class="line">y_pro = tf.nn.softmax(y)</span><br></pre></td></tr></table></figure><p>参数自更新：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">w &#x3D; tf.Variable(4)</span><br><span class="line">w.assign_sub(1)&#x2F;&#x2F;w-&#x3D;1</span><br><span class="line">print(w)</span><br></pre></td></tr></table></figure><p>返回最大值索引</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tf.argmax(张量名，axis&#x3D;操作轴)</span><br></pre></td></tr></table></figure><p>条件语句：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tf.where(条件语句,真返回A,假返回B)</span><br></pre></td></tr></table></figure><p>返回[0,1)之间的随机数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np.random.RandomState.rand(维度)</span><br></pre></td></tr></table></figure><p>将两个数组按垂直方向叠加（一维—&gt;二维）：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np.vstack(数组<span class="number">1</span>，数组<span class="number">2</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x,y = np.mgrid[<span class="number">1</span>:<span class="number">3</span>:<span class="number">1</span>,<span class="number">2</span>:<span class="number">4</span>:<span class="number">0.5</span>]//x=[[<span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span>]</span><br><span class="line">                                     [<span class="number">2</span> <span class="number">2</span> <span class="number">2</span> <span class="number">2</span>]]</span><br><span class="line">y=[[<span class="number">2</span> <span class="number">2.5</span> <span class="number">3</span> <span class="number">3.5</span>]</span><br><span class="line">                                       [<span class="number">2</span> <span class="number">2.5</span> <span class="number">3</span> <span class="number">3.5</span>]] </span><br><span class="line">gird = np.c_[x.ravel(),y.ravel()]//ravel()降维到一维，np.c_[数组<span class="number">1</span>，数组<span class="number">2</span>]配对。</span><br></pre></td></tr></table></figure><h1 id="5：神经网络-NN-复杂度"><a href="#5：神经网络-NN-复杂度" class="headerlink" title="5：神经网络(NN)复杂度"></a>5：神经网络(NN)复杂度</h1><p>NN复杂度：多用NN层数和NN参数的个数表示。</p><ul><li>空间复杂度</li><li>时间复杂度</li></ul><p>学习率:<br>$$<br>w_{t+1} = w_t+lr<em>gradient<br>$$<br>指数衰减学习率:<br>$$<br>指数衰减学习率=初始学习率</em>学习率衰减率^{当前轮数/多少轮衰减一次}<br>\\epoch= 40<br>\\LR_BASE= 0.2<br>\\LR_DECAY= 0.99<br>\\LR_STEP=1<br>$$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> range(epoch):</span><br><span class="line">    lr = LR_BASE*LR_DECAY**(epoch/LR_STEP)</span><br><span class="line">    <span class="keyword">with</span> tf.GradientTape() <span class="keyword">as</span> tape:</span><br><span class="line">        loss = tf.square(w+<span class="number">1</span>)</span><br><span class="line">    grads = tape.gradient(loss,w)</span><br><span class="line">    w.assign_sub(lr*grads)</span><br></pre></td></tr></table></figure><h1 id="6：激活函数"><a href="#6：激活函数" class="headerlink" title="6：激活函数"></a>6：激活函数</h1><p>$$<br>y = f(wx+b)<br>$$</p><ul><li>Sigmoid函数</li></ul><p>$$<br>f(x)=\frac{1}{1+e^{-x}}<br>$$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tf.nn.sigmoid(x)</span><br></pre></td></tr></table></figure><blockquote><p>易造成梯度消失</p><p>输出非0均值，收敛慢</p><p>幂运算复杂，训练时间长</p></blockquote><ul><li>Tanh函数</li></ul><p>$$<br>f(x) = \frac{1-e^{-2x}}{1+e^{-2x}}<br>$$</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tf.math.tanh(x)</span><br></pre></td></tr></table></figure><ul><li>Relu函数</li></ul><p>$$<br>\begin{align}<br>f(x)=&amp; max(x,0)<br>\\=&amp; \begin{cases}<br>0\qquad x&lt;0\<br>x\qquad x&gt;=0<br>\end{cases}<br>\end{align}<br>$$</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tf.nn.relu(x)</span><br></pre></td></tr></table></figure><ul><li>Leaky Relu函数</li></ul><p>$$<br>f(x)=max(ax,x)<br>$$</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tf.nn.leaky_relu(x)</span><br></pre></td></tr></table></figure><blockquote><p>初学者：</p><ul><li>首选Relu函数</li><li>学习率设置较小值</li><li>输入特征标准化，让输入特征满足以0为均值，1为标准差的正态分布</li><li>初始参数中心化，让随机生成的参数满足以0为均值，sqrt(2/当前层输入特征个数)为标准差的正态分布</li></ul></blockquote><h1 id="7：损失函数"><a href="#7：损失函数" class="headerlink" title="7：损失函数"></a>7：损失函数</h1><p>loss：预测值(y)与已知答案(y_)的差距</p><ul><li>均方误差mse：</li></ul><p>$$<br>MSE(y_,y)=\frac{\sum^n_{i=1}(y-y_)^2}{n}<br>$$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loss_mse = tf.reduce_mean(tf.square(y-y_))</span><br></pre></td></tr></table></figure><ul><li>自定义损失函数</li></ul><p>y_:标准答案</p><p>y:预测答案<br>$$<br>f(y_,y)=\begin{cases}<br>PROFIT*(y_-y)\quad y&lt;y_ \ 预测的y少了，损失利润<br>\COST*(y-y_)\quad y&gt;=y_ \ 预测的y多了，损失成本<br>\end{cases}<br>$$</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loss_diy = tf.reduce_sum(tf.where(tf.greater(y,y_),COST(y-y_),PROFIT(y_-y)))//y&gt;y_?,为真COST，为假PROFIT</span><br></pre></td></tr></table></figure><ul><li>交叉熵损失函数CE：表征两个概率分布之间的距离</li></ul><p>$$<br>H(y_,y)=-\sum y_*lny<br>$$</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tf.losses.categorical_crossentropy(y_,y)</span><br></pre></td></tr></table></figure><ul><li>softmax和交叉熵结合</li></ul><p>softmax计算概率分布</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tf.nn.softmax_cross_entropy_with_logits(y_,y)</span><br></pre></td></tr></table></figure><h1 id="8：缓解过拟合"><a href="#8：缓解过拟合" class="headerlink" title="8：缓解过拟合"></a>8：缓解过拟合</h1><ul><li>正则化缓解过拟合</li></ul><p>正则化在损失函数中引入模型复杂度指标，利用给W加权值，弱化训练数据的噪声。</p><p>$$<br>loss=loss(y与y_)+REGULARIZER*losss(w)<br>$$</p><p>L2正则化</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">with tf.GradientTape() as tape:</span><br><span class="line">h1 &#x3D; tf.matmul(x_train,w1)+b1</span><br><span class="line">h1 &#x3D; tf.nn.relu(h1)</span><br><span class="line">y &#x3D; tf.matmul(h1,w2) + b2</span><br><span class="line">loss_mse &#x3D; tf.reduce_mean(tf.square(y_train - y))</span><br><span class="line">loss_regularization &#x3D; []</span><br><span class="line">loss_regularization.append(tf.nn.l2_loss(w1))</span><br><span class="line">loss_regularization.append(tf.nn.l2_loss(w2))</span><br><span class="line">loss_regularization &#x3D; tf.reduce_sum(loss_regularization)</span><br><span class="line">loss &#x3D; loss_mse + 0.03*loss_regularization</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="9：优化器"><a href="#9：优化器" class="headerlink" title="9：优化器"></a>9：优化器</h1><p>$m_t$：一阶动量(与梯度相关的函数)    $V_t$：二阶动量(与梯度平方相关的函数)</p><p>下降梯度$\eta_t=lr*m_t/\sqrt{V_t}$</p><p>更新参数$w_{t+1}=w_t-\eta_t$</p><blockquote><p>不同的优化器，只是定义了不同的动量函数</p></blockquote><ul><li>SGD，梯度下降法</li></ul><p>$m_t=g_t$   $V_t=1$</p><p>$w_{t+1}=w_t-lr*g_t$</p><ul><li>SGDM，SGD基础上增加了一阶动量</li></ul><p>$m_t=\beta*m_{t-1}+(1-\beta)*g_t$</p><p>$V_t=1$</p><ul><li>Adagrad，在SGD基础上增加二阶动量</li></ul><p>$m_t=g_t$ </p><p>$V_t=\sum^t_{\tau=1}g^2_\tau$</p><ul><li>RMSProp，SGD基础上增加二阶动量</li></ul><p>$m_t=g_t$  </p><p>$V_t=\beta*V_{t-1}+(1-\beta)*g^2_t$</p><ul><li>Adam，同时结合SGDM一阶动量和RMSProp二阶动量</li></ul><p>$m_t=\beta*m_{t-1}+(1-\beta)*g_t$</p><p>修正一阶动量的偏差：$\hat{m_t}=\frac{m_t}{1-\beta^t_1}$</p><p>$V_t=\beta*V_{t-1}+(1-\beta)*g^2_t$</p><p>修正二阶动量的偏差：$\hat{V_t}=\frac{V_t}{1-\beta^t_2}$</p><h1 id="10：搭建八股网络-Sequential"><a href="#10：搭建八股网络-Sequential" class="headerlink" title="10：搭建八股网络-Sequential"></a>10：搭建八股网络-Sequential</h1><p>tf.keras搭建网络八股</p><p>六步法：</p><ol><li>import</li><li>train,test</li><li>model = tf.keras.models.Sequential</li><li>model.compile</li><li>model.fit</li><li>model.summary</li></ol><ul><li>Sequential，描述各层网络</li></ul><p>拉直层：tf.keras.layers.Flatten()</p><p>全连接层：tf.keras.layers.Dense(神经元个数,activation=”激活函数”,kernel_regularizer=哪种正则化)</p><blockquote><p>activation：relu、softmax、sigmoid、tanh</p><p>kernel_regularizer：tf.keras.regularizers.l1()、tf.keras.regularizers.l2()</p></blockquote><p>卷积层：tf.keras.layers.Conv2D(filters = 卷积核个数,kernel_size = 卷积核尺寸,strides = 卷积步长,padding = “valid”or”same”)</p><p>LSTM层：tf.keras.layers.LSTM()</p><ul><li>Compile</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.compile(optimizer = 优化器,loss=损失函数,metrics=[<span class="string">&quot;准确率&quot;</span>])</span><br></pre></td></tr></table></figure><ul><li>Fit</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.fit(训练集的输入特征，训练集的标签，bathc_size&#x3D;,epochs&#x3D;,validation_data&#x3D;(测试集的输入特征，测试集的标签)，validation_split&#x3D;从训练集划分多少比例给测试集，validation_freq&#x3D;多少次epoch测试一次)</span><br></pre></td></tr></table></figure><ul><li>Summary</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.summary()</span><br></pre></td></tr></table></figure><h1 id="11：搭建网络八股-class"><a href="#11：搭建网络八股-class" class="headerlink" title="11：搭建网络八股-class"></a>11：搭建网络八股-class</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyModel</span>(<span class="params">Model</span>):</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">super(MyModel,self).__init__()</span><br><span class="line">        定义网络结构块</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">call</span>(<span class="params">self,x</span>):</span></span><br><span class="line">        调用网络结构块，实现前向传播</span><br><span class="line">        reutrn y</span><br><span class="line">        </span><br><span class="line"> model = MyModel()</span><br></pre></td></tr></table></figure><h1 id="12：MNIST数据集"><a href="#12：MNIST数据集" class="headerlink" title="12：MNIST数据集"></a>12：MNIST数据集</h1><p>提供6万张28*28像素点的0-9手写数字图片和标签，用于训练</p><p>1万张28*28像素点的0-9手写数组图片和标签，用于测试</p><ul><li>导入MNIST数据集</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mnist &#x3D; tf.keras.datasets.mnist</span><br><span class="line">(x_train,y_train),(x_test,y_test)&#x3D;mnist.load_data()</span><br></pre></td></tr></table></figure><ul><li>作为输入特征，将数据拉伸为一维数组</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tf.keras.layers.Flatten()</span><br></pre></td></tr></table></figure><h1 id="13：Fasion-MNIST数据集"><a href="#13：Fasion-MNIST数据集" class="headerlink" title="13：Fasion_MNIST数据集"></a>13：Fasion_MNIST数据集</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line">fasion = tf.keras.datasets.fashion_mnist</span><br><span class="line">(x_train, y_train),(x_test,y_test) = fasion.load_data()</span><br><span class="line">x_train,x_test = x_train/<span class="number">255.0</span>,x_test/<span class="number">255.0</span></span><br><span class="line"></span><br><span class="line">model = tf.keras.models.Sequential([</span><br><span class="line">    tf.keras.layers.Flatten(),</span><br><span class="line">    tf.keras.layers.Dense(<span class="number">128</span>,activation=<span class="string">&#x27;relu&#x27;</span>),</span><br><span class="line">    tf.keras.layers.Dense(<span class="number">10</span>,activation = <span class="string">&#x27;softmax&#x27;</span>)</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">model.compile(optimizer=<span class="string">&quot;adam&quot;</span>,loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=<span class="literal">False</span>),metrics=[<span class="string">&#x27;sparse_categorical_accuracy&#x27;</span>])</span><br><span class="line">model.fit(x_train,y_train,batch_size = <span class="number">32</span>,epochs=<span class="number">5</span>,validation_data=(x_test,y_test),validation_freq = <span class="number">1</span>)</span><br><span class="line">model.summary()</span><br></pre></td></tr></table></figure><h1 id="14：自制数据集"><a href="#14：自制数据集" class="headerlink" title="14：自制数据集"></a>14：自制数据集</h1><p><img src="https://i.loli.net/2020/11/15/47flBkU6oI5KuGM.png" class="lazyload" data-srcset="https://i.loli.net/2020/11/15/47flBkU6oI5KuGM.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>在<code>mnist_image_label</code>文件夹下有两个文件夹<code>mnist_train_jpg_60000</code>和<code>mnist_test_jpg_10000</code></p><p>每个文件夹分别放了对应个数的图片以及一个.txt文件，文件内容如上，jpg名+空格+标签</p><p>现在需要重写<code>(x_train,y_train),(x_test,y_test)=mnist.load_data()</code>中的load_data()方法。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generateds</span>(<span class="params">path,txt</span>):</span></span><br><span class="line">    f = open(txt,<span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">    contents = f.readlines()</span><br><span class="line">    f.close()</span><br><span class="line">    x,y_ = [],[]</span><br><span class="line">    <span class="keyword">for</span> content <span class="keyword">in</span> contents:</span><br><span class="line">        value = content.split()</span><br><span class="line">        img_path = path+value[<span class="number">0</span>]</span><br><span class="line">        img = Image.open(img_path)</span><br><span class="line">        img = np.array(img.convert(<span class="string">&#x27;L&#x27;</span>))</span><br><span class="line">        img = img/<span class="number">255.</span></span><br><span class="line">        x.append(img)</span><br><span class="line">        y_.append(value[<span class="number">1</span>])</span><br><span class="line">        print(<span class="string">&#x27;loading:&#x27;</span>+content)</span><br><span class="line">    x = np.array(x)</span><br><span class="line">    y_ = np.array(y_)</span><br><span class="line">    y_ = y_.astype(np.int64)</span><br><span class="line">    <span class="keyword">return</span> x,y_</span><br></pre></td></tr></table></figure><p>保存数据集</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np.save(保存路径带拓展,保存的内容)</span><br></pre></td></tr></table></figure><h1 id="15：数据增强"><a href="#15：数据增强" class="headerlink" title="15：数据增强"></a>15：数据增强</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">image_gen_train = tf.keras.preprocessing.image.ImageDataGenerator(</span><br><span class="line">rescale = 所有数据将乘以该数值</span><br><span class="line">rotation = 随机旋转角度值范围</span><br><span class="line">    width_shift_range = 随机宽度偏移量</span><br><span class="line">    height_shift_range = 随机高度偏移量</span><br><span class="line">    horizontal_flip = 是否随机水平翻转</span><br><span class="line">    zoom_range = 随机缩放的范围[<span class="number">1</span>-n,<span class="number">1</span>+n])</span><br><span class="line">image_gen_train.fit(x_train)</span><br></pre></td></tr></table></figure><p>fit()中的数据是四位数据，所以需要对其reshape</p><p>x_train = x_train.reshape(x_train.shape[0],28,28,1)</p><p>最后的1表示灰度值。</p><p>model.fit()方法内修改为</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.fit(image_gen_train.flow(x_train,y_train,batch_size = <span class="number">32</span>),epochs=<span class="number">5</span>,validation_data=(x_test,y_test),validation_freq = <span class="number">1</span>)</span><br></pre></td></tr></table></figure><h1 id="16：断点续训"><a href="#16：断点续训" class="headerlink" title="16：断点续训"></a>16：断点续训</h1><p>读取模型：</p><p>load_weights(路径文件名)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">checkpoint_save_path = <span class="string">&quot;./checkpoint/mnist.ckpt&quot;</span></span><br><span class="line"><span class="keyword">if</span> os.path.exists(checkpoint_save_path + <span class="string">&#x27;.index&#x27;</span>)</span><br><span class="line">print(<span class="string">&#x27;-----load the model------&#x27;</span>)</span><br><span class="line">    model.load_weights(checkpoint_save_path)</span><br></pre></td></tr></table></figure><p>保存模型</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">callback = tf.keras.callbacks.ModelCheckpoint(</span><br><span class="line">filepath = 路径文件名,</span><br><span class="line">save_weights_only=<span class="literal">True</span>/<span class="literal">False</span>,</span><br><span class="line">save_best_only = <span class="literal">True</span>/<span class="literal">False</span>)</span><br><span class="line">history = model.fit(……callbacks = [cp_callback])</span><br></pre></td></tr></table></figure><h1 id="17：参数提取"><a href="#17：参数提取" class="headerlink" title="17：参数提取"></a>17：参数提取</h1><p>model.trainable_variables 返回模型中可训练的参数</p><p>设置print输出格式</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np.set_printoptions(threshold = 超过多少省略显示)<span class="comment">#threshold=np.inf表示无限</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">np.set_printoptions(threshold = np.inf)</span><br><span class="line">print(model.trainable_variables)</span><br><span class="line">file = open(<span class="string">&#x27;./weights.txt&#x27;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> v <span class="keyword">in</span> model.trainable_variables:</span><br><span class="line">file.write(str(v.name)+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    file.write(str(v.shape)+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    file.write(str(v.numpy())+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">file.close()</span><br></pre></td></tr></table></figure><h1 id="18：acc曲线和loss曲线可视化"><a href="#18：acc曲线和loss曲线可视化" class="headerlink" title="18：acc曲线和loss曲线可视化"></a>18：acc曲线和loss曲线可视化</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">history = model.fit()</span><br><span class="line">acc = history.history[<span class="string">&#x27;sparse_categorical_accuracy&#x27;</span>]<span class="comment">#训练集准确率</span></span><br><span class="line">val_acc = history.history[<span class="string">&#x27;val_sparse_categorical_accuracy&#x27;</span>]<span class="comment">#测试集准确率</span></span><br><span class="line">loss = history.history[<span class="string">&#x27;loss&#x27;</span>]<span class="comment">#训练集loss</span></span><br><span class="line">val_loss = history.history[<span class="string">&#x27;val_loss&#x27;</span>]<span class="comment">#测试集loss</span></span><br></pre></td></tr></table></figure><p>画图</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">plt.subplot(<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line">plt.plot(acc,label=<span class="string">&quot;Training Accuracy&quot;</span>)</span><br><span class="line">plt.plot(val_acc,label=<span class="string">&quot;Validation Accuracy&quot;</span>)</span><br><span class="line">plt.title(<span class="string">&quot;Training and Validation Accuracy&quot;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">plt.subplot(<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>)</span><br><span class="line">plt.plot(loss,label=<span class="string">&quot;Training Loss&quot;</span>)</span><br><span class="line">plt.plot(val_loss,label=<span class="string">&quot;Validation Loss&quot;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Training and Validation Loss&#x27;</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h1 id="19：样例预测"><a href="#19：样例预测" class="headerlink" title="19：样例预测"></a>19：样例预测</h1><p>predict(输入特征,batch_size=整数)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#复现模型</span></span><br><span class="line">model = tf.keras.models.Sequential([</span><br><span class="line">    tf.keras.layers.Flatten(),</span><br><span class="line">    tf.keras.layers.Dense(<span class="number">128</span>,activation = <span class="string">&#x27;relu&#x27;</span>),</span><br><span class="line">    tf.keras.layers.Dense(<span class="number">10</span>,activation = <span class="string">&#x27;softmax&#x27;</span>)])</span><br><span class="line"><span class="comment">#加载参数</span></span><br><span class="line">model.load_weights(model_save_path)</span><br><span class="line"><span class="comment">#预测结果</span></span><br><span class="line">result = model.predict(x_predict)</span><br></pre></td></tr></table></figure><h1 id="20：卷积计算过程"><a href="#20：卷积计算过程" class="headerlink" title="20：卷积计算过程"></a>20：卷积计算过程</h1><p>原始彩色图片——&gt;若干层特征提取——&gt;全连接网络</p><p>主要模块：(CBAPD)</p><p>卷积(Convolutional)-&gt;批标准化(BN)-&gt;激活(Activation)-&gt;池化(Pooling)-&gt;舍弃(Dropout)</p><h1 id="21：感受野"><a href="#21：感受野" class="headerlink" title="21：感受野"></a>21：感受野</h1><p>感受野：卷积神经网络各输出特征图中的每个像素点，在原始输入图片上映射区域的大小。</p><p>比如：</p><p>1：</p><p>5x5原始图，使用3x3卷积核，生成的3x3特征图，那么其感受野是3.</p><p>将生成的3x3特征图，再次使用3x3卷积核作用，生成1x1特征图，那么这个特征图相对于原始图，感受野为5.</p><p>2：</p><p>5x5原始图，使用5x5卷积核，生成1x1特征图，其感受野同样为5</p><p>长款x大于10时，两层3x3卷积核性能优于一层5x5卷积核</p><h1 id="22：全零填充"><a href="#22：全零填充" class="headerlink" title="22：全零填充"></a>22：全零填充</h1><p>特征图一圈填充零。</p><p>特征图边长<br>$$<br>padding=\begin{cases}<br>SAME(全0填充)\ \frac{入长}{步长}\ (向上取整)<br>\VALID(不全0填充)\ \frac{入长-核长+1}{步长}\ (向上取整)<br>\end{cases}<br>$$</p><h1 id="23：描述卷积层"><a href="#23：描述卷积层" class="headerlink" title="23：描述卷积层"></a>23：描述卷积层</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">tf.keras.layers.Conv2D(</span><br><span class="line">filter = 卷积核个数,</span><br><span class="line">    kernel_size = 卷积核尺寸，<span class="comment">#正方形写核长整数，或（核高，核宽）</span></span><br><span class="line">    strides = 滑动步长,<span class="comment">#横纵相同写步长整数，或（纵向步长，横向步长）</span></span><br><span class="line">    padding = <span class="string">&quot;same&quot;</span> <span class="keyword">or</span> <span class="string">&quot;valid&quot;</span><span class="comment">#全零填充same，非全零valid</span></span><br><span class="line">    activation = <span class="string">&quot;relu&quot;</span> <span class="keyword">or</span> <span class="string">&quot;sigmoid&quot;</span>,</span><br><span class="line">    input_shape = (高，宽，通道数)<span class="comment">#输入特征图维度，可省</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><h1 id="24：批标准化（Batch-Normalization）"><a href="#24：批标准化（Batch-Normalization）" class="headerlink" title="24：批标准化（Batch Normalization）"></a>24：批标准化（Batch Normalization）</h1><p>标准化：使数据符合0均值，1为标准差的分布</p><p>批标准化：对一小批数据，做标准化<br>$$<br>H’^k_i = \frac{H^k_i-\mu^k_{batch}}{\sigma_{batch}^k}<br>$$<br>k：第k个卷积核</p><p>i：第i个像素点</p><p>H’：批标准化之后</p><p>H：批标准化之前</p><p>上述式子，要求批标准化之前的特征数据即满足正态分布。</p><p>通常使用：<br>$$<br>x^k_i=\gamma_kH’^k_i+\beta_k<br>$$<br>$\gamma_k$:缩放因子</p><p>$\beta_k$:偏移因子</p><p>调整分布的宽窄和偏移。</p><p>BN层位于，卷积层之后，激活层之前。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tf.keras.layers.BatchNormalization()</span><br></pre></td></tr></table></figure><h1 id="25：池化"><a href="#25：池化" class="headerlink" title="25：池化"></a>25：池化</h1><p>池化用于减少特征数据量。</p><p>最大池化，均值池化</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tf.keras.layers.MaxPool2D(</span><br><span class="line">pool_size=池化核尺寸</span><br><span class="line">strides=池化步长</span><br><span class="line">padding=<span class="string">&#x27;valid&#x27;</span> <span class="keyword">or</span> <span class="string">&#x27;same&#x27;</span><span class="comment">#全零填充？</span></span><br><span class="line">)</span><br><span class="line">tf.keras.layers.AveragePooling2D()</span><br></pre></td></tr></table></figure><h1 id="26：舍弃（dropout）"><a href="#26：舍弃（dropout）" class="headerlink" title="26：舍弃（dropout）"></a>26：舍弃（dropout）</h1><p>在神经网络训练时，将一部分神经元按照一定概率从神经网络中暂时舍弃，神经网络使用时，被舍弃的神经元恢复连接。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tf.keras.layers.Dropout(舍弃概率)</span><br></pre></td></tr></table></figure><h1 id="27：Cifar10数据集"><a href="#27：Cifar10数据集" class="headerlink" title="27：Cifar10数据集"></a>27：Cifar10数据集</h1><p>五万张32*32像素点的是分类彩色图片和标签，用于训练</p><p>测试1万张</p><h1 id="28：LeNet"><a href="#28：LeNet" class="headerlink" title="28：LeNet"></a>28：LeNet</h1><p>输入：32*32</p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 人工智能 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何利用ADB开发王者荣耀外挂</title>
      <link href="/2020/10/24/%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8ADB%E5%BC%80%E5%8F%91%E7%8E%8B%E8%80%85%E8%8D%A3%E8%80%80%E5%A4%96%E6%8C%82/"/>
      <url>/2020/10/24/%E5%A6%82%E4%BD%95%E5%88%A9%E7%94%A8ADB%E5%BC%80%E5%8F%91%E7%8E%8B%E8%80%85%E8%8D%A3%E8%80%80%E5%A4%96%E6%8C%82/</url>
      
        <content type="html"><![CDATA[<h1 id="1：思路"><a href="#1：思路" class="headerlink" title="1：思路"></a>1：思路</h1><p>ADB全称安卓设备调试工具，是谷歌官方提供帮助安卓开发者调试自身应用的一个轻量级工具包，总大小只有几兆。通过shell指令可以实现对安装了安卓系统的手机进行控制，包括开关机，开关应用程序，控制屏幕、音量、相机等操作。利用ADB控制屏幕的功能，可以通过程序来实现快速换装、婉儿一键上天等操作。由于ADB是一种模拟人在屏幕上操作的工具，不会修改王者荣耀的内部文件，也不用root手机，所有是不会被王者荣耀检测到，也不会被封号。只需要简单配置让安装了ADB的电脑连接手机，即可实现程序控制王者角色。因为ADB支持通过TCP/IP协议，可以让电脑脱离数据线远程调试手机。</p><p><strong>那么这个外挂完整的工作过程是什么样的呢？</strong></p><ol><li><p>在电脑上安装ADB工具，并将其目录放到系统环境或用户环境变量中。开启手机的USB调试功能，通过ADB远程调试功能连接手机。</p></li><li><p>编写一个安卓应用程序，程序使用安卓的悬浮窗功能。在王者荣耀面板上层悬浮一个按钮。点击按钮，发送一个http的get请求。</p></li><li><p>在安装了ADB的电脑上安装一个http服务器用于接收悬浮按钮发送的get请求。简单的http服务器是基于python内自带的http server。</p></li><li><p>http服务器接收到请求后，执行已经写好的ADB指令，控制手机，实现婉儿一键上天。</p></li></ol><p>看看使用效果吧！</p><div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;">    <iframe src="//player.bilibili.com/player.html?aid=415048053&bvid=BV18V411y7rw&cid=249226194&page=1&high_quality=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="position: absolute; width: 100%; height: 100%; left: 0; top: 0;">    </iframe></div><h1 id="2：ADB工具及调试手机"><a href="#2：ADB工具及调试手机" class="headerlink" title="2：ADB工具及调试手机"></a>2：ADB工具及调试手机</h1><h2 id="2-1-下载ADB"><a href="#2-1-下载ADB" class="headerlink" title="2.1 下载ADB"></a>2.1 下载ADB</h2><p>在网上下载ADB工具包：<a href="https://developer.android.com/studio/releases/platform-tools">下载地址</a>（需要连接外网）</p><p>解压后，获得一个名为<code>platform-tools</code>的工具包，包内含有<code>adb.exe</code>程序，即为安卓调试工具。</p><h2 id="2-2-设置环境"><a href="#2-2-设置环境" class="headerlink" title="2.2 设置环境"></a>2.2 设置环境</h2><p>在windows中搜索<code>huanjing</code>打开环境变量面板。</p><p><img src="https://i.loli.net/2020/10/24/RqTVla3Mpu89tnP.png" class="lazyload" data-srcset="https://i.loli.net/2020/10/24/RqTVla3Mpu89tnP.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>依次点击<code>环境变量</code>，点击系统变量下的名为<code>Path</code>的一行，点击<code>编辑</code>.</p><p><img src="https://i.loli.net/2020/10/24/NoKyh4bwWqzMSFj.png" class="lazyload" data-srcset="https://i.loli.net/2020/10/24/NoKyh4bwWqzMSFj.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>点击新建，将<code>platform-tools</code>文件夹的完整路径添加到变量中，例：我的工具包存放在<code>C:\Users\9752\.AndroidStudio3.5\platform-tools</code></p><p>点击<code>确认</code>，然后关闭此窗口。</p><p>在windows中搜索<code>cmd</code>，打开终端窗口，输入<code>adb</code>回车。</p><p><img src="https://i.loli.net/2020/10/24/ortdFpacx3NUZqK.png" class="lazyload" data-srcset="https://i.loli.net/2020/10/24/ortdFpacx3NUZqK.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>出现上文，则配置成功。</p><h2 id="2-3-连接手机"><a href="#2-3-连接手机" class="headerlink" title="2.3 连接手机"></a>2.3 连接手机</h2><p><strong>打开手机开发者模式</strong></p><p>通常是手机设置中，找到版本信息或者内核信息，然后点击七下，在设置中就会出现开发者模式了。具体方法可以自行谷歌。</p><p>打开开发者模式的<code>USB调试</code></p><p>通过<strong>原装</strong>数据线连接电脑，<strong>有的非原装数据线只能充电不能传输数据</strong>。</p><p>连接电脑后，需要在手机上允许此电脑调试，最好一律允许此电脑调试。</p><p>在终端中输入<code>adb devices</code>查看是否连接上了手机。</p><h2 id="2-4-开启远程调试"><a href="#2-4-开启远程调试" class="headerlink" title="2.4 开启远程调试"></a>2.4 开启远程调试</h2><blockquote><p>也可不用远程，直接使用数据线也是可以的。</p></blockquote><p>让手机和电脑处在相同的WiFi下</p><p>电脑通过数据线连接手机后，终端输入</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb tcpip 5555</span><br></pre></td></tr></table></figure><p>拔掉数据线。在WiFi设置里，查看手机的局域网ip地址，通常是<code>192.168.xxx.xxx</code>，或者<code>10.xxx.xxx.xxx</code></p><p>修改为你的手机ip地址，连接手机：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb connect 192.168.xxx.xxx:5555</span><br></pre></td></tr></table></figure><h2 id="2-5-主要用到的ADB指令"><a href="#2-5-主要用到的ADB指令" class="headerlink" title="2.5 主要用到的ADB指令"></a>2.5 主要用到的ADB指令</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 模拟点击，屏幕上横坐标纵坐标分别为100 120的位置</span><br><span class="line">// 要查看具体坐标值，可以打开开发者选项-&gt;指针位置</span><br><span class="line">adb shell input tap 100 120</span><br><span class="line"></span><br><span class="line">// 模拟滑动，从位置（0,1000）滑动到(800,600)</span><br><span class="line">adb shell input swipe 0 1000 800 600</span><br><span class="line"></span><br><span class="line">// 模拟长按，在位置（100,200）长按500毫秒</span><br><span class="line">adb shell input swipe 100 200 100 200 500// 开启adb服务</span><br></pre></td></tr></table></figure><p>其中位置信息，需要在手机上获取。</p><p>在<strong>开发者模式</strong>中打开<strong>显示指针</strong></p><p>通过按住屏幕，就能实时显示按压住的位置的x轴和y轴信息。</p><p>此时已经可以尝试用ADB指令控制屏幕了。</p><h2 id="2-6-控制婉儿上天"><a href="#2-6-控制婉儿上天" class="headerlink" title="2.6 控制婉儿上天"></a>2.6 控制婉儿上天</h2><p>不同的手机，需要自己寻找合适的坐标点来实现婉儿的技能释放。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">向前移动：abd shell input swipe 450 1105 544 983 600</span><br><span class="line">向后移动：adb shell input swipe 450 1105 217 1400 800</span><br><span class="line">普工：adb shell input tap 2726 1226</span><br><span class="line">一技能：adb shell input swipe 2290 1267 2748 790 100</span><br><span class="line">二技能：adb shell input swipe 2451 1010 2793 670 100</span><br><span class="line">三技能：adb shell input swipe 2721 860 2721 860 200</span><br><span class="line"></span><br><span class="line">向前直线上天：adb shell &quot;input swipe 2451 1010 2793 670 100&amp;&amp;input swipe 2721 860 2721 860 200&amp;&amp;input swipe 450 1105 544 983 600&amp;&amp;input tap 2726 1226&amp;&amp;input swipe 2290 1267 2748 790 100&amp;&amp;input swipe 450 1105 743 781 1000&quot;</span><br><span class="line">原地上天：adb shell &quot;input swipe 2451 1010 2793 670 100&amp;&amp;input swipe 2721 860 2721 860 200&amp;&amp;input swipe 450 1105 544 983 600&amp;&amp;input tap 2726 1226&amp;&amp;input swipe 2290 1267 2100 1376 100&amp;&amp;input swipe 450 1105 217 1400 800&amp;&amp;input swipe 450 1105 777 1150 500&quot;</span><br></pre></td></tr></table></figure><h2 id="2-7-一键换装"><a href="#2-7-一键换装" class="headerlink" title="2.7 一键换装"></a>2.7 一键换装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">打开商店： adb shell input tap 2873 102</span><br><span class="line">装备： adb shell input tap 2173 1278</span><br><span class="line">出售： adb shell input tap 2525 1153</span><br><span class="line">关闭商店： adb shell input tap 2624 167</span><br><span class="line">购买预选：adb shell input tap 2832 243</span><br><span class="line">完整操作链：adb shell &quot;input tap 2873 102&amp;&amp;input tap 2173 1278&amp;&amp;input tap 2525 1153&amp;&amp;input tap 2624 167&amp;&amp;input tap 2832 243&quot;</span><br></pre></td></tr></table></figure><h1 id="3：搭建http服务器"><a href="#3：搭建http服务器" class="headerlink" title="3：搭建http服务器"></a>3：搭建http服务器</h1><p>在电脑上安装好python环境。</p><p>新建一个<code>takeoff.py</code>文件。编辑文件：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> http.server <span class="keyword">import</span> BaseHTTPRequestHandler</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GetHandler</span>(<span class="params">BaseHTTPRequestHandler</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_GET</span>(<span class="params">self</span>):</span></span><br><span class="line">        parsed_path = parse.urlparse(self.path)</span><br><span class="line">        query = parse.parse_qs(parsed_path.query)</span><br><span class="line">        <span class="keyword">if</span> query[<span class="string">&#x27;skill&#x27;</span>][<span class="number">0</span>] == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            os.system(<span class="string">&#x27;adb shell &quot;input swipe 2451 1010 2793 670 100&amp;&amp;input swipe 2721 860 2721 860 200&amp;&amp;input swipe 450 1105 544 983 600&amp;&amp;input tap 2726 1226&amp;&amp;input swipe 2290 1267 2748 790 100&amp;&amp;input swipe 450 1105 743 781 1000&quot;&#x27;</span>)</span><br><span class="line">            message = <span class="string">&#x27;执行直线起飞指令&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> query[<span class="string">&#x27;skill&#x27;</span>][<span class="number">0</span>] == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">            os.system(<span class="string">&#x27;adb shell &quot;input swipe 2451 1010 2793 670 100&amp;&amp;input swipe 2721 860 2721 860 200&amp;&amp;input swipe 450 1105 544 983 600&amp;&amp;input tap 2726 1226&amp;&amp;input swipe 2290 1267 2100 1376 100&amp;&amp;input swipe 450 1105 217 1400 800&amp;&amp;input swipe 450 1105 777 1150 500&quot;&#x27;</span>)</span><br><span class="line">            message = <span class="string">&#x27;执行原地起飞指令&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> query[<span class="string">&#x27;skill&#x27;</span>][<span class="number">0</span>] == <span class="string">&#x27;3&#x27;</span>:</span><br><span class="line">            os.system(<span class="string">&#x27;adb shell &quot;input tap 2873 102&amp;&amp;input tap 2173 1278&amp;&amp;input tap 2525 1153&amp;&amp;input tap 2624 167&amp;&amp;input tap 2832 243&quot;&#x27;</span>)</span><br><span class="line">            message = <span class="string">&#x27;执行快速换装指令&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            message = <span class="string">&#x27;无指令运行&#x27;</span></span><br><span class="line">        self.send_response(<span class="number">200</span>)</span><br><span class="line">        self.send_header(<span class="string">&#x27;Content-Type&#x27;</span>,</span><br><span class="line">                         <span class="string">&#x27;text/plain; charset=utf-8&#x27;</span>)</span><br><span class="line">        self.end_headers()</span><br><span class="line">        self.wfile.write(message.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">from</span> http.server <span class="keyword">import</span> HTTPServer</span><br><span class="line">    server = HTTPServer((<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">9797</span>), GetHandler)</span><br><span class="line">    print(<span class="string">&#x27;服务器启动成功, 使用&lt;Ctrl-C&gt; 来停止。。&#x27;</span>)</span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></figure><p>需要将<code>os.system()</code>中的<strong>内容替换为自己</strong>的。</p><blockquote><p>修改上面的程序很重要，因为不同分辨率手机，需要的adb指令是不一样的，如果不修改，基本上不可能会实现理想的操作，除非你跟我用的相同的手机，三星S10+。</p></blockquote><p>通过python运行这个文件就已经建立好了http服务器。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python3 filepath/takeoff.py</span><br><span class="line"><span class="meta">#</span><span class="bash">filepath修改为takeoff.py的路径。比如C:/Users/999/Desktop/takeoff.py</span></span><br><span class="line"><span class="meta">#</span><span class="bash">显示，服务器启动成功, 使用&lt;Ctrl-C&gt; 来停止。。则启动成功</span></span><br></pre></td></tr></table></figure><p>查看电脑的局域网ip地址，终端输入</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ipconfig</span><br></pre></td></tr></table></figure><p>通常是<code>192.168.xxx.xxx</code>，或者<code>10.xxx.xxx.xxx</code></p><p>在电脑浏览器中，访问：<code>192.168.xxx.xxx:9797/?skill=1</code>就能实现直线上天了。skill =2和skill=3分别对应原地上天和一键换装。</p><p>此时，如果在手机浏览器上访问<code>192.168.xxx.xxx:9797/?skill=1</code>，应该是访问不通的，因为windows自带的防火墙，是不允许局域网下的其他设备访问未开放的端口的。你需要<strong>关闭局域网防火墙</strong>。</p><blockquote><p>关闭防火墙是存在一定风险的，如果你用的公共场所的WiFi，我建议不要关闭。如果是家庭WiFi，记得在使用完后再次开启防火墙。</p></blockquote><p>windows搜索<code>fanghuoqiang</code>注意不要用汉字搜索，用拼音。打开<strong>防火墙和网络保护</strong></p><p>如果是家庭WiFi，则点击专用网络。</p><p><img src="https://i.loli.net/2020/10/24/wJDbeTHg36ntWzm.png" class="lazyload" data-srcset="https://i.loli.net/2020/10/24/wJDbeTHg36ntWzm.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>将防火墙<strong>关闭</strong>。</p><p>此时在手机浏览器上也能访问到http服务器了。</p><h1 id="4：王者局内悬浮按钮"><a href="#4：王者局内悬浮按钮" class="headerlink" title="4：王者局内悬浮按钮"></a>4：王者局内悬浮按钮</h1><p>新建一个安卓项目，开发一个悬浮按钮，在王者内点击按钮，就能给http服务器发送请求，然后服务器通过adb再返过来控制局内角色。</p><p>开发新项目，我直接选择站在巨人肩膀上。<a href="https://github.com/dongzhong/TestForFloatingWindow">https://github.com/dongzhong/TestForFloatingWindow</a> 直接对这个仓库里提供的悬浮窗功能进行修改。。关键程序如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//FloatingButtonService2.java</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showFloatingWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (Settings.canDrawOverlays(<span class="keyword">this</span>)) &#123;</span><br><span class="line">            button2 = <span class="keyword">new</span> Button(getApplicationContext());</span><br><span class="line">            button2.setText(<span class="string">&quot;装&quot;</span>);<span class="comment">//按键上的字，表示按下这个按钮一键换装</span></span><br><span class="line">            button2.setBackgroundColor(Color.argb(<span class="number">120</span>,<span class="number">0</span>,<span class="number">255</span>,<span class="number">0</span>));</span><br><span class="line">            windowManager.addView(button2, layoutParams);</span><br><span class="line">            button2.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                    send();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            button2.setOnTouchListener(<span class="keyword">new</span> FloatingOnTouchListener());</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//开启线程，发送get请求</span></span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="comment">//value对应http服务器接收的技能</span></span><br><span class="line">                <span class="comment">//在http服务器中，设置的，skill=1，直线上天，skill=2，原地上天，skill=3，换装</span></span><br><span class="line">                <span class="keyword">char</span> value = <span class="string">&#x27;3&#x27;</span>;</span><br><span class="line">                <span class="comment">//这里修改为http服务器地址。</span></span><br><span class="line">                String path = <span class="string">&quot;http://192.168.0.109:9797/?skill=&quot;</span>+value;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    URL url = <span class="keyword">new</span> URL(path);</span><br><span class="line">                    HttpURLConnection conn = (HttpURLConnection) url.openConnection();</span><br><span class="line">                    conn.setRequestMethod(<span class="string">&quot;GET&quot;</span>);</span><br><span class="line">                    InputStream in = conn.getInputStream();</span><br><span class="line">                    conn.disconnect();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>这只是其中一个一键换装的按钮，另外还需要修改一键上天的按钮。在<code>FloatingButtonService.java</code>中，两个程序，都相似。。修改完后，直接编译，就可以使用了。</p><p>完整的项目地址：<a href="https://github.com/xieqifei/Expandskill">https://github.com/xieqifei/Expandskill</a></p><p>安卓项目，可以直接通过git克隆</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/xieqifei/Expandskill.git</span><br></pre></td></tr></table></figure><p>修改程序后，直接编译即可。</p><h1 id="5：参考资料"><a href="#5：参考资料" class="headerlink" title="5：参考资料"></a>5：参考资料</h1><p>《<a href="https://www.jianshu.com/p/85066854c9e6">android adb常用命令收集</a>》</p><p>《<a href="https://blog.csdn.net/u012785382/article/details/79171782">Android adb远程调试</a>》</p><p>《<a href="https://learnku.com/docs/pymotw/httpserver-base-classes-for-implementing-web-servers/3436">http.server — 实现 Web 服务器的基础类</a>》</p><p>《<a href="https://www.runoob.com/w3cnote/android-tutorial-httpurlconnection.html">Android HTTP请求方式:HttpURLConnection</a>》</p><p>《<a href="https://blog.csdn.net/dongzhong1990/article/details/80512706">Android悬浮窗的实现</a>》</p>]]></content>
      
      
      <categories>
          
          <category> 安卓编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ADB </tag>
            
            <tag> Python </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>已知多个地点经纬度的最优路径规划</title>
      <link href="/2020/10/19/%E5%B7%B2%E7%9F%A5%E5%A4%9A%E4%B8%AA%E5%9C%B0%E7%82%B9%E7%BB%8F%E7%BA%AC%E5%BA%A6%E7%9A%84%E6%9C%80%E4%BC%98%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/"/>
      <url>/2020/10/19/%E5%B7%B2%E7%9F%A5%E5%A4%9A%E4%B8%AA%E5%9C%B0%E7%82%B9%E7%BB%8F%E7%BA%AC%E5%BA%A6%E7%9A%84%E6%9C%80%E4%BC%98%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/</url>
      
        <content type="html"><![CDATA[<h1 id="1：为什么规划路线"><a href="#1：为什么规划路线" class="headerlink" title="1：为什么规划路线"></a>1：为什么规划路线</h1><p>这是统一美团饿了么订单后的后续工作，要求对多个指定的配送地点进行统计，并计算出从花店出发，到配送完所有地点返回花店的可能路程，并得出最优的路线。。</p><h1 id="2：设计思想"><a href="#2：设计思想" class="headerlink" title="2：设计思想"></a>2：设计思想</h1><p>假设有四个配送点ABCD，配送的路线会有24种可能，枚举所有可能，并计算从花店到第一个配送点，依次再有三个配送点，然后返回花店的距离。比较这二十四种路线的距离，距离最少的，选为最优路线。</p><p>在Python中，使用<code>itertools</code>迭代库中的<code>permutations</code>方法，对路径可能进行排列。通过<code>haversine</code>公式计算两个经纬度之间的距离。</p><h1 id="3：Python程序"><a href="#3：Python程序" class="headerlink" title="3：Python程序"></a>3：Python程序</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@file_name    :shortest_dist.py</span></span><br><span class="line"><span class="string">@description  :</span></span><br><span class="line"><span class="string">@time         :2020/10/18 20:24:21</span></span><br><span class="line"><span class="string">@author       :Qifei</span></span><br><span class="line"><span class="string">@version      :1.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> radians, cos, sin, asin, sqrt</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> permutations</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Route</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,data</span>):</span></span><br><span class="line">        self.data = data</span><br><span class="line">        self.home = &#123;<span class="string">&#x27;lng&#x27;</span>:<span class="string">&#x27;104.270910&#x27;</span>,<span class="string">&#x27;lat&#x27;</span>:<span class="string">&#x27;30.876583&#x27;</span>&#125;</span><br><span class="line">        self.distances = []</span><br><span class="line">        self.routes = []</span><br><span class="line">        <span class="comment">#排列各种可能的路线</span></span><br><span class="line">        self.iter_routes = permutations(data,len(data))</span><br><span class="line">        <span class="comment">#将排列后的迭代类型数据转为列表类型</span></span><br><span class="line">        <span class="keyword">for</span> iter_route <span class="keyword">in</span> self.iter_routes:</span><br><span class="line">            self.routes.append(list(iter_route))</span><br><span class="line">    <span class="comment">#返回最优路线的列表排序</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">best_route</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">for</span> route <span class="keyword">in</span> self.routes:</span><br><span class="line">            distance = <span class="number">0</span></span><br><span class="line">            <span class="keyword">if</span> len(route) &gt; <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> range(len(route)<span class="number">-1</span>):</span><br><span class="line">                    distance += self.calc_distance(route[i+<span class="number">1</span>][<span class="string">&#x27;lng&#x27;</span>],route[i+<span class="number">1</span>][<span class="string">&#x27;lat&#x27;</span>],route[i][<span class="string">&#x27;lng&#x27;</span>],route[i][<span class="string">&#x27;lat&#x27;</span>])</span><br><span class="line">            distance += self.calc_distance(self.home[<span class="string">&#x27;lng&#x27;</span>],self.home[<span class="string">&#x27;lat&#x27;</span>],route[<span class="number">0</span>][<span class="string">&#x27;lng&#x27;</span>],route[<span class="number">0</span>][<span class="string">&#x27;lat&#x27;</span>])</span><br><span class="line">            distance += self.calc_distance(self.home[<span class="string">&#x27;lng&#x27;</span>],self.home[<span class="string">&#x27;lat&#x27;</span>],route[<span class="number">-1</span>][<span class="string">&#x27;lng&#x27;</span>],route[<span class="number">-1</span>][<span class="string">&#x27;lat&#x27;</span>])</span><br><span class="line">            self.distances.append(distance)</span><br><span class="line">        <span class="keyword">return</span> self.routes[self.distances.index(min(self.distances))]</span><br><span class="line"></span><br><span class="line"><span class="comment">#计算两个经纬度之间的距离</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">calc_distance</span>(<span class="params">self,lon1, lat1, lon2, lat2</span>):</span></span><br><span class="line">        <span class="comment"># 将十进制度数转化为弧度</span></span><br><span class="line">        lon1, lat1, lon2, lat2 = map(radians, [float(lon1), float(lat1), float(lon2), float(lat2)])</span><br><span class="line">        <span class="comment"># haversine公式</span></span><br><span class="line">        dlon = lon2 - lon1 </span><br><span class="line">        dlat = lat2 - lat1 </span><br><span class="line">        a = sin(dlat/<span class="number">2</span>)**<span class="number">2</span> + cos(lat1) * cos(lat2) * sin(dlon/<span class="number">2</span>)**<span class="number">2</span></span><br><span class="line">        c = <span class="number">2</span> * asin(sqrt(a)) </span><br><span class="line">        r = <span class="number">6371</span> <span class="comment"># 地球平均半径，单位为公里</span></span><br><span class="line">        <span class="keyword">return</span> c * r * <span class="number">1000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    data = [&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;大弯中学&#x27;</span>,<span class="string">&#x27;lng&#x27;</span>:<span class="string">&#x27;104.278184&#x27;</span>,<span class="string">&#x27;lat&#x27;</span>:<span class="string">&#x27;30.879862&#x27;</span>&#125;,&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;怡湖公园&#x27;</span>,<span class="string">&#x27;lng&#x27;</span>:<span class="string">&#x27;104.261332&#x27;</span>,<span class="string">&#x27;lat&#x27;</span>:<span class="string">&#x27;30.878314&#x27;</span>&#125;,&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;大弯小学&#x27;</span>,<span class="string">&#x27;lng&#x27;</span>:<span class="string">&#x27;104.270611&#x27;</span>,<span class="string">&#x27;lat&#x27;</span>:<span class="string">&#x27;30.880657&#x27;</span>&#125;,&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;长河郡&#x27;</span>,<span class="string">&#x27;lng&#x27;</span>:<span class="string">&#x27;104.278201&#x27;</span>,<span class="string">&#x27;lat&#x27;</span>:<span class="string">&#x27;30.872356&#x27;</span>&#125;]</span><br><span class="line">    route = Route(data)</span><br><span class="line">    <span class="comment"># print(route.calc_distance(data[0][&#x27;lng&#x27;],data[0][&#x27;lat&#x27;],data[0][&#x27;lng&#x27;],data[0][&#x27;lat&#x27;]))</span></span><br><span class="line">    </span><br><span class="line">    best_route = route.best_route()</span><br><span class="line">    print(best_route)</span><br><span class="line">    <span class="comment"># print(route.distances)</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> -Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>外卖平台订单爬取之美团外卖商家版</title>
      <link href="/2020/10/17/%E5%A4%96%E5%8D%96%E5%B9%B3%E5%8F%B0%E8%AE%A2%E5%8D%95%E7%88%AC%E5%8F%96%E4%B9%8B%E7%BE%8E%E5%9B%A2%E5%A4%96%E5%8D%96%E5%95%86%E5%AE%B6%E7%89%88/"/>
      <url>/2020/10/17/%E5%A4%96%E5%8D%96%E5%B9%B3%E5%8F%B0%E8%AE%A2%E5%8D%95%E7%88%AC%E5%8F%96%E4%B9%8B%E7%BE%8E%E5%9B%A2%E5%A4%96%E5%8D%96%E5%95%86%E5%AE%B6%E7%89%88/</url>
      
        <content type="html"><![CDATA[<h1 id="1：root手机"><a href="#1：root手机" class="headerlink" title="1：root手机"></a>1：root手机</h1><p>昨天，我利用mitmproxy成功拦截了饿了么服务器返回的订单信息。今天，我准备故技重施，获取美团订单。残酷的现实给我炽热地心浇了一盆冷水。无论我如何调整mitmproxy和美团外卖商家版，都无法获取到美团服务器返回的数据。更确切地说，美团服务器似乎发现，有这么一个小偷，准备偷取它返回给客户端地数据。因此拒绝给客户端传递数据。</p><p>我在网上找了一些解答，在安卓7.0之后，安卓系统允许安卓应用不信任用户上传地CA证书，众所周知，在中间人攻击中，将代理服务器的CA证书添加到安卓用户证书里，这样代理服务器在客户端和https服务端之间做个信使，他们的来回信件，信使就能拆开阅读，再封好发出去。现在安卓系统允许安卓应用设置是否信任用户证书，很明显，美团外卖商家版，不支持用户自定义证书。</p><p>好在，安卓系统有个要求，就是系统证书都是被认可的。而添加系统证书，需要修改手机system文件夹，需要将手机root。</p><p>待root手机：三星S8+</p><p>工具：Odin线刷工具，第三方recovery TWRP，Tomato卡刷包（卡刷包含root）。</p><h1 id="2：添加CA证书为系统证书"><a href="#2：添加CA证书为系统证书" class="headerlink" title="2：添加CA证书为系统证书"></a>2：添加CA证书为系统证书</h1><p>mitmproxy会在其运行目录生成一个<code>.mitmproxy</code>隐藏目录，目录中的<code>mitmproxy-ca-cert.pem</code>是可以直接放到系统证书目录下的证书。首先需要将它更名为统一的格式。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">openssl版本在1.0以上的版本的执行这一句</span></span><br><span class="line">openssl x509 -inform PEM -subject_hash_old -in mitmproxy-ca-cert.pem</span><br><span class="line"><span class="meta">#</span><span class="bash">openssl版本在1.0以下的版本的执行这一句</span></span><br><span class="line">openssl x509 -inform PEM -subject_hash -in mitmproxy-ca-cert.pem</span><br></pre></td></tr></table></figure><p>生成<code>347bacb5</code>证书的hash值，然后将<code>mitmproxy-ca-cert.pem</code>更名为<code>347bacb5.0</code></p><p>将更名后的证书放到安卓系统证书目录，root后的安卓手机，可以直接打开RE管理器进入系统目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;system&#x2F;etc&#x2F;security&#x2F;cacerts</span><br></pre></td></tr></table></figure><p>重启手机。修改wifi代理，并连接mitmproxy。</p><p>打开美团外卖商家版，不再报没有网络连接的错误。此时即可以从代理中截获解码后的信息了。</p><h1 id="3：截获订单请求数据"><a href="#3：截获订单请求数据" class="headerlink" title="3：截获订单请求数据"></a>3：截获订单请求数据</h1><p>开启mitmproxy，开始收集请求。在美团上下单，可以截获下单后，美团服务器发送到客户端的订单信息。</p><p>进行中订单请求地址，部分内容已打码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;eapi.waimai.meituan.com&#x2F;api&#x2F;retail&#x2F;order&#x2F;supplement&#x2F;increment&#x2F;orders?region_id&#x3D;10***0100&amp;region_version&#x3D;153***1&amp;__skck&#x3D;8f5973b0***&amp;__skts&#x3D;16***8&amp;__skua&#x3D;d41d8c***8427e&amp;__skno&#x3D;94899011-***</span><br></pre></td></tr></table></figure><p>预订单请求地址：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;eapi.waimai.meituan.com&#x2F;api&#x2F;retail&#x2F;order&#x2F;pre&#x2F;orders?region_id&#x3D;1000510100&amp;region_version&#x3D;1534166411&amp;__skck&#x3D;8f5973b085446090f224af74e30e0181&amp;__skts&#x3D;1603035614&amp;__skua&#x3D;d41d8cd98f00b204e9800998ecf8427e&amp;__skno&#x3D;ed5fa567-5e33-4186-806a-e1ee884b5d5c&amp;__skcy&#x3D;hNEhcBUBRBinXjXwhZ%2BoMtvkMu8%3D</span><br></pre></td></tr></table></figure><p>进行中响应内容：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;msg&quot;</span>: <span class="string">&quot;Success&quot;</span>,</span><br><span class="line"><span class="attr">&quot;code&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;data&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;serverTime&quot;</span>: <span class="number">1603013219</span>,</span><br><span class="line"><span class="attr">&quot;news&quot;</span>: [&#123;</span><br><span class="line"><span class="attr">&quot;agreeBtn&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;reject_reason&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;rejectBtn&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;apply_refund_type&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;appealReason&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;pay_status&quot;</span>: <span class="number">3</span>,</span><br><span class="line"><span class="attr">&quot;payExpireTime&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;orderDescription&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;pay_status_desc&quot;</span>: <span class="string">&quot;已付款&quot;</span>,</span><br><span class="line"><span class="attr">&quot;apply_reason&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;applyRefundTime&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;rejectRefundTime&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;appealRefundTime&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;refundFinishTime&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;isPartRefundApply&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;isAllowPartRefund&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;isAllowAllRefund&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">&quot;hasMigratedToRetail&quot;</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="attr">&quot;returnSubStatus&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;logistics&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;id&quot;</span>: <span class="number">-1</span>,</span><br><span class="line"><span class="attr">&quot;type&quot;</span>: <span class="number">101</span>,</span><br><span class="line"><span class="attr">&quot;icon&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;status&quot;</span>: <span class="number">-1</span>,</span><br><span class="line"><span class="attr">&quot;statusDesc&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;sendTime&quot;</span>: <span class="number">-1</span>,</span><br><span class="line"><span class="attr">&quot;confirmTime&quot;</span>: <span class="number">-1</span>,</span><br><span class="line"><span class="attr">&quot;arrivePoiTime&quot;</span>: <span class="number">-1</span>,</span><br><span class="line"><span class="attr">&quot;selfDeliveryTime&quot;</span>: <span class="number">-1</span>,</span><br><span class="line"><span class="attr">&quot;fetchTime&quot;</span>: <span class="number">-1</span>,</span><br><span class="line"><span class="attr">&quot;completedTime&quot;</span>: <span class="number">-1</span>,</span><br><span class="line"><span class="attr">&quot;cancelTime&quot;</span>: <span class="number">-1</span>,</span><br><span class="line"><span class="attr">&quot;collectTime&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;departureTime&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;reachTime&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;takeTime&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;timeOut&quot;</span>: <span class="number">-1</span>,</span><br><span class="line"><span class="attr">&quot;code&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;valid&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;shippingFee&quot;</span>: <span class="number">0.0</span>,</span><br><span class="line"><span class="attr">&quot;tipFee&quot;</span>: <span class="number">0.0</span>,</span><br><span class="line"><span class="attr">&quot;shippingTips&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;couponAmount&quot;</span>: <span class="number">0.0</span>,</span><br><span class="line"><span class="attr">&quot;activityName&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;activityAmount&quot;</span>: <span class="number">0.0</span>,</span><br><span class="line"><span class="attr">&quot;extraFee&quot;</span>: <span class="number">0.0</span>,</span><br><span class="line"><span class="attr">&quot;payAmount&quot;</span>: <span class="number">0.0</span>,</span><br><span class="line"><span class="attr">&quot;shippingFeeBase&quot;</span>: <span class="number">0.0</span>,</span><br><span class="line"><span class="attr">&quot;payType&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;zbType&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;orderDistance&quot;</span>: <span class="number">0.0</span>,</span><br><span class="line"><span class="attr">&quot;ifSelfLogistics&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;isCanChangeSelfLogistics&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;dispatcher&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;mobile&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;icon&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;role&quot;</span>: <span class="string">&quot;配送员&quot;</span>,</span><br><span class="line"><span class="attr">&quot;type&quot;</span>: <span class="number">-1</span>,</span><br><span class="line"><span class="attr">&quot;typeName&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;dispatchMaster&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;name&quot;</span>: <span class="string">&quot;站点&quot;</span>,</span><br><span class="line"><span class="attr">&quot;mobile&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;icon&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;role&quot;</span>: <span class="string">&quot;站长&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;dispatchAssistant&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;name&quot;</span>: <span class="string">&quot;站点备用&quot;</span>,</span><br><span class="line"><span class="attr">&quot;mobile&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;icon&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;role&quot;</span>: <span class="string">&quot;站长助理&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;unionDispatcher&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;mobile&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;logisticsSubCode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;dispatchOrderId&quot;</span>: <span class="number">-1</span>,</span><br><span class="line"><span class="attr">&quot;delayPushSecond&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;delayPushMin&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;assignTime&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;thirdLogisticsCode&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;printRelayBarCode&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">&quot;utime&quot;</span>: <span class="number">1603013218</span>,</span><br><span class="line"><span class="attr">&quot;refundType&quot;</span>: <span class="number">-1</span>,</span><br><span class="line"><span class="attr">&quot;isCanChangeSelfLogistics&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;refundProcessEndTips&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;ifSelfLogistics&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;cancelButtonShow&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;foodDoneInfo&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;isShowFoodDoneBlock&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;isfoodDone&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;foodDoneStatus&quot;</span>: <span class="string">&quot;拣货完成&quot;</span>,</span><br><span class="line"><span class="attr">&quot;foodDoneTime&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;foodSendOutTimeDeadline&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;diningMinutes&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;foodSendDeviceInfo&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;logisticsAbnormalInfo&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;isLogisticsAbnormal&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;logisticsAbnormalDesc&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;logisticsAbnormalType&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;isShowLogisticsReport&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;logisticsReportDesc&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;refundOtherInfos&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;returnStatusDesc&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;returnSubStatusDesc&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;returnMaxPayAcount&quot;</span>: <span class="number">100.0</span>,</span><br><span class="line"><span class="attr">&quot;returnSubStatus&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;countDownDesc&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;refundViewId&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;serviceType&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;refundRuleUrl&quot;</span>: <span class="string">&quot;http://s3plus.sankuai.com/v1/mss_03d0d9cf21144ba0b7747ba1dc1acf6e/order/refund_rules.html&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;refundInfoList&quot;</span>: [],</span><br><span class="line"><span class="attr">&quot;refundGoodsInfoList&quot;</span>: [],</span><br><span class="line"><span class="attr">&quot;isAppealApply&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;compensationInfo&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;id&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;title&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;time&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;moneyDesc&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;reason&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;pictures&quot;</span>: [],</span><br><span class="line"><span class="attr">&quot;appealInfo&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;orderImValid&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;imGuideContent&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;imReplyDefaultContent&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;isAllowPriceDiffRefund&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">&quot;confirmDeliveryStatus&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;id&quot;</span>: <span class="number">56367</span>**<span class="number">02186</span>,</span><br><span class="line"><span class="attr">&quot;wm_poi_id&quot;</span>: <span class="number">5636780</span>,</span><br><span class="line"><span class="attr">&quot;wm_poi_order_dayseq&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;wm_order_id_view&quot;</span>: <span class="number">563678</span>***<span class="number">186</span>,</span><br><span class="line"><span class="attr">&quot;num&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;poi_name&quot;</span>: <span class="string">&quot;**鲜花店&quot;</span>,</span><br><span class="line"><span class="attr">&quot;order_source&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;order_source_desc&quot;</span>: <span class="string">&quot;手机APP下单&quot;</span>,</span><br><span class="line"><span class="attr">&quot;shipping_fee&quot;</span>: <span class="number">0.0</span>,</span><br><span class="line"><span class="attr">&quot;recipient_name&quot;</span>: <span class="string">&quot;谢先生&quot;</span>,</span><br><span class="line"><span class="attr">&quot;recipient_phone&quot;</span>: <span class="string">&quot;178**858,4109&quot;</span>,</span><br><span class="line"><span class="attr">&quot;recipient_address&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;total_after&quot;</span>: <span class="number">10.0</span>,</span><br><span class="line"><span class="attr">&quot;total_before&quot;</span>: <span class="number">10.0</span>,</span><br><span class="line"><span class="attr">&quot;boxpriceTotal&quot;</span>: <span class="number">0.0</span>,</span><br><span class="line"><span class="attr">&quot;remark&quot;</span>: <span class="string">&quot;[贺卡内容]贺卡内容 [其他备注]备注内容&quot;</span>,</span><br><span class="line"><span class="attr">&quot;environmentalFriendlyOrder&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;status&quot;</span>: <span class="number">4</span>,</span><br><span class="line"><span class="attr">&quot;order_time&quot;</span>: <span class="number">1603013207</span>,</span><br><span class="line"><span class="attr">&quot;order_time_fmt&quot;</span>: <span class="string">&quot;10-18 17:26&quot;</span>,</span><br><span class="line"><span class="attr">&quot;confirmOrderTime&quot;</span>: <span class="number">1603013218</span>,</span><br><span class="line"><span class="attr">&quot;details&quot;</span>: [&#123;</span><br><span class="line"><span class="attr">&quot;id&quot;</span>: <span class="number">1945297344</span>,</span><br><span class="line"><span class="attr">&quot;food_name&quot;</span>: <span class="string">&quot;8枝红色非洲菊 &quot;</span>,</span><br><span class="line"><span class="attr">&quot;food_price&quot;</span>: <span class="number">10.0</span>,</span><br><span class="line"><span class="attr">&quot;originalFoodPrice&quot;</span>: <span class="number">10.0</span>,</span><br><span class="line"><span class="attr">&quot;unit&quot;</span>: <span class="string">&quot;份&quot;</span>,</span><br><span class="line"><span class="attr">&quot;count&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;box_num&quot;</span>: <span class="number">1.0</span>,</span><br><span class="line"><span class="attr">&quot;box_price&quot;</span>: <span class="number">0.0</span>,</span><br><span class="line"><span class="attr">&quot;cartId&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;cartName&quot;</span>: <span class="string">&quot;1号口袋&quot;</span>,</span><br><span class="line"><span class="attr">&quot;upcCode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;skuCode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;locatorCode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;discountPoint&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;discountRemark&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;picUrl&quot;</span>: <span class="string">&quot;http://p0.meituan.net/wmproduct/d852b****0fa2d7f3d1adf7d95423.jpg&quot;</span>,</span><br><span class="line"><span class="attr">&quot;specification&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;],</span><br><span class="line"><span class="attr">&quot;discounts&quot;</span>: [],</span><br><span class="line"><span class="attr">&quot;tips&quot;</span>: [],</span><br><span class="line"><span class="attr">&quot;canBeCancelled&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;cancel_reason&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;is_pre_order&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;delivery_btime&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;pre_order_delivery_info&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;pay_utime&quot;</span>: <span class="number">1603013218</span>,</span><br><span class="line"><span class="attr">&quot;pay_utime_fmt&quot;</span>: <span class="string">&quot;2020-10-18 17:26:58&quot;</span>,</span><br><span class="line"><span class="attr">&quot;online_paid_info&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;pre_order_remind&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;pre_order_tip&quot;</span>: <span class="string">&quot;预订单：期望送达时间&quot;</span>,</span><br><span class="line"><span class="attr">&quot;overtime_paid_info&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;invoice_title&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;wm_order_pay_type&quot;</span>: <span class="number">2</span>,</span><br><span class="line"><span class="attr">&quot;actual_pay_type&quot;</span>: <span class="number">2</span>,</span><br><span class="line"><span class="attr">&quot;dispatch_code&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;longitude&quot;</span>: <span class="number">104251302</span>,</span><br><span class="line"><span class="attr">&quot;latitude&quot;</span>: <span class="number">30880900</span>,</span><br><span class="line"><span class="attr">&quot;inArea&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;orderDistance&quot;</span>: <span class="number">2120.0</span>,</span><br><span class="line"><span class="attr">&quot;addressLongitude&quot;</span>: <span class="number">104251302</span>,</span><br><span class="line"><span class="attr">&quot;addressLatitude&quot;</span>: <span class="number">30880900</span>,</span><br><span class="line"><span class="attr">&quot;riderPayment&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;zbShippingFee&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;zbShippingTips&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;tipsVos&quot;</span>: [],</span><br><span class="line"><span class="attr">&quot;status_desc&quot;</span>: <span class="string">&quot;已接单&quot;</span>,</span><br><span class="line"><span class="attr">&quot;delivery_btime_fmt&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;logistics_code&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;logisticsService&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;logistics_status&quot;</span>: <span class="number">-1</span>,</span><br><span class="line"><span class="attr">&quot;hasFrozen&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;estimateArrivalTime&quot;</span>: <span class="number">1603020418</span>,</span><br><span class="line"><span class="attr">&quot;poi_push_day&quot;</span>: <span class="number">20201018</span>,</span><br><span class="line"><span class="attr">&quot;bindedPhone&quot;</span>: <span class="string">&quot;178**858,4109&quot;</span>,</span><br><span class="line"><span class="attr">&quot;isLargeAmountOrder&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;userOrderCount&quot;</span>: <span class="number">2</span>,</span><br><span class="line"><span class="attr">&quot;pickType&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;isUsePrivacyPhone&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;privacyPhone&quot;</span>: <span class="string">&quot;1788**4858,4109&quot;</span>,</span><br><span class="line"><span class="attr">&quot;phoneShow&quot;</span>: <span class="string">&quot;178**8转4109&quot;</span>,</span><br><span class="line"><span class="attr">&quot;privacyPhoneStatus&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;recipientPhoneShow&quot;</span>: <span class="string">&quot;手机尾号2605&quot;</span>,</span><br><span class="line"><span class="attr">&quot;packageBagMoney&quot;</span>: <span class="number">0.0</span>,</span><br><span class="line"><span class="attr">&quot;wmUserId&quot;</span>: <span class="number">371311890</span>,</span><br><span class="line"><span class="attr">&quot;confirmTime&quot;</span>: <span class="number">1603013218</span>,</span><br><span class="line"><span class="attr">&quot;cansunStatus&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;cansunInfo&quot;</span>: [],</span><br><span class="line"><span class="attr">&quot;wmChargeBusiness&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;wmOrderViewId&quot;</span>: <span class="number">56367802727202186</span>,</span><br><span class="line"><span class="attr">&quot;activityAmount&quot;</span>: <span class="string">&quot;0.0&quot;</span>,</span><br><span class="line"><span class="attr">&quot;activityDetails&quot;</span>: [],</span><br><span class="line"><span class="attr">&quot;commisionAmount&quot;</span>: <span class="string">&quot;-1.0&quot;</span>,</span><br><span class="line"><span class="attr">&quot;settleAmount&quot;</span>: <span class="string">&quot;8.95&quot;</span>,</span><br><span class="line"><span class="attr">&quot;offlineOrderSkPayAmount&quot;</span>: <span class="string">&quot;0.0&quot;</span>,</span><br><span class="line"><span class="attr">&quot;shippingType&quot;</span>: <span class="string">&quot;0000&quot;</span>,</span><br><span class="line"><span class="attr">&quot;commisionDetails&quot;</span>: [&#123;</span><br><span class="line"><span class="attr">&quot;chargeAmount&quot;</span>: <span class="string">&quot;-1.0&quot;</span>,</span><br><span class="line"><span class="attr">&quot;chargeDesc&quot;</span>: <span class="string">&quot;服务费&quot;</span></span><br><span class="line">&#125;],</span><br><span class="line"><span class="attr">&quot;userOnlinePayAfter&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;discounts&quot;</span>: [],</span><br><span class="line"><span class="attr">&quot;isDowngrade&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">&quot;shippingFee&quot;</span>: <span class="string">&quot;0.0&quot;</span>,</span><br><span class="line"><span class="attr">&quot;riderPayment&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;isRiderPay&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">&quot;giftDetails&quot;</span>: [],</span><br><span class="line"><span class="attr">&quot;userPayAmount&quot;</span>: <span class="string">&quot;0.0&quot;</span>,</span><br><span class="line"><span class="attr">&quot;foodAmount&quot;</span>: <span class="string">&quot;10.0&quot;</span>,</span><br><span class="line"><span class="attr">&quot;userPayTotalAmount&quot;</span>: <span class="string">&quot;10.0&quot;</span>,</span><br><span class="line"><span class="attr">&quot;donateAmount&quot;</span>: <span class="string">&quot;-0.05&quot;</span>,</span><br><span class="line"><span class="attr">&quot;agreementAmount&quot;</span>: <span class="number">0.0</span>,</span><br><span class="line"><span class="attr">&quot;chargeMode&quot;</span>: <span class="number">1</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;userTips&quot;</span>: [&#123;</span><br><span class="line"><span class="attr">&quot;category&quot;</span>: <span class="number">17</span>,</span><br><span class="line"><span class="attr">&quot;type&quot;</span>: <span class="string">&quot;下单2次&quot;</span>,</span><br><span class="line"><span class="attr">&quot;info&quot;</span>: <span class="string">&quot;该用户过去90天完成订单数&quot;</span></span><br><span class="line">&#125;],</span><br><span class="line"><span class="attr">&quot;bindedPrivacyPhoneList&quot;</span>: [&#123;</span><br><span class="line"><span class="attr">&quot;privacyPhoneShow&quot;</span>: <span class="string">&quot;130**773转5108&quot;</span>,</span><br><span class="line"><span class="attr">&quot;privacyPhone&quot;</span>: <span class="string">&quot;13**4773,5108&quot;</span></span><br><span class="line">&#125;],</span><br><span class="line"><span class="attr">&quot;backupField&quot;</span>: [],</span><br><span class="line"><span class="attr">&quot;onTimeInsurance&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;effect&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;desc&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;status&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;foodSafeInsurance&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;effect&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;desc&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;status&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;thirdLogistics&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;courierName&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;courierPhone&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;logisticsPlatformName&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;logisticsPlatformCode&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;deliverTime&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;allowAlterType&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;preMakerValid&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;retailOrderPreMakerInfo&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;preMakerPrivacyPhoneShow&quot;</span>: <span class="string">&quot;1788**37转9232&quot;</span>,</span><br><span class="line"><span class="attr">&quot;preMakerPhoneShow&quot;</span>: <span class="string">&quot;178**7转9232&quot;</span>,</span><br><span class="line"><span class="attr">&quot;preMakerPhone&quot;</span>: <span class="string">&quot;178**137,9232&quot;</span>,</span><br><span class="line"><span class="attr">&quot;preMakerTag&quot;</span>: <span class="string">&quot;购花使者&quot;</span>,</span><br><span class="line"><span class="attr">&quot;preMakerPrivacyPhoneShowAfter&quot;</span>: <span class="string">&quot;1******8137转9232&quot;</span>,</span><br><span class="line"><span class="attr">&quot;preMakerBackupPrivacyPhone&quot;</span>: [&#123;</span><br><span class="line"><span class="attr">&quot;privacyPhoneShow&quot;</span>: <span class="string">&quot;185**029转1199&quot;</span>,</span><br><span class="line"><span class="attr">&quot;privacyPhone&quot;</span>: <span class="string">&quot;18**4029,1199&quot;</span></span><br><span class="line">&#125;]</span><br><span class="line">&#125;</span><br><span class="line">&#125;],</span><br><span class="line"><span class="attr">&quot;changes&quot;</span>: [],</span><br><span class="line"><span class="attr">&quot;orderSynCtime&quot;</span>: <span class="number">1603013219</span>,</span><br><span class="line"><span class="attr">&quot;orderSynUtime&quot;</span>: <span class="number">1603013219</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-1-确认送达时间："><a href="#3-1-确认送达时间：" class="headerlink" title="3.1 确认送达时间："></a>3.1 确认送达时间：</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;estimateArrivalTime&quot;: 1603020418,</span><br></pre></td></tr></table></figure><p>从信息中提取到送达时间的时间戳，时间戳是指，格林威治时间从1970-01-01 00:00:00到某个时间点所经历的秒数，可以表达绝对时间领域的一个时刻。其转化为我们所能够阅读的时间，是根据计算机系统时间来计算的。不同时区的计算机得到的结果是不一样的。上述时间戳，转为北京时间后是<code>2020-10-18 19:26:58</code>。在转换时，默认时根据计算机所在时区转换。所以，最好指定转换时区。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytz</span><br><span class="line">ts = <span class="number">1566395745</span></span><br><span class="line">tz = pytz.timezone(<span class="string">&#x27; Asia/Shanghai&#x27;</span>)</span><br><span class="line">dt = pytz.datetime.datetime.fromtimestamp(ts, tz)</span><br><span class="line">dt.strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line"><span class="number">12345</span></span><br></pre></td></tr></table></figure><p>结果为：<code>2019-08-21 09:55:45</code></p><h2 id="3-2-送达地点"><a href="#3-2-送达地点" class="headerlink" title="3.2 送达地点"></a>3.2 送达地点</h2><p>在信息中，是没有配送地点的内容的，如果，通过appium来点击<code>查看地址</code>在爬取地址信息，就过于麻烦。再次研究订单信息JSON数据后，我发现，在订单中，有一行数据为</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;addressLongitude&quot;: 104251302,</span><br><span class="line">&quot;addressLatitude&quot;: 30880900,</span><br></pre></td></tr></table></figure><p>这是地址编码，对应的是经纬度信息。在<a href="https://lbs.amap.com/api/webservice/guide/api/georegeo/">高德地图API接口手册</a>中，我找到了适合地址解码的api</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;restapi.amap.com&#x2F;v3&#x2F;geocode&#x2F;regeo?output&#x3D;xml&amp;location&#x3D;116.310003,39.991957&amp;key&#x3D;&lt;用户的key&gt;&amp;radius&#x3D;1000&amp;extensions&#x3D;all</span><br></pre></td></tr></table></figure><p>测试后，从api返回的地址正是收货地址。</p><p>可以看到，Longitude经度，Latitude维度。这个参数是以六位小数结尾的数据。。而订单中，是没有把小数位表现出来的，所以需要单独修改。</p><blockquote><p>为了让饿了么和美团的订单，具有相同的格式，我们需要修改之前确定的饿了么订单对象。把送达时间统一更改为时间戳，把地址信息统一转为地理编码后的经纬度。</p></blockquote><h1 id="4：Python编程"><a href="#4：Python编程" class="headerlink" title="4：Python编程"></a>4：Python编程</h1><p>下面是包含了饿了么和美团外卖的完整程序</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- encoding: utf-8 -*-</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">@file_name    :order.py</span></span><br><span class="line"><span class="string">@description  :</span></span><br><span class="line"><span class="string">@time         :2020/10/16 21:25:01</span></span><br><span class="line"><span class="string">@author       :Qifei</span></span><br><span class="line"><span class="string">@version      :1.0</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> mitmproxy.http</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment">#顾客类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name,tel</span>):</span></span><br><span class="line">        self.name = name </span><br><span class="line">        self.tel = tel</span><br><span class="line">       </span><br><span class="line"></span><br><span class="line"><span class="comment">#商品类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Good</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name,number,img</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.number = number</span><br><span class="line">        self.img = img</span><br><span class="line"></span><br><span class="line"><span class="comment">#订单类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span>(<span class="params">Customer</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,platform,name,tel,addr_long,addr_latu,note,arri_time,order_id,goods</span>):</span></span><br><span class="line">        Customer.__init__(self,name,tel)</span><br><span class="line">        self.addr_long = addr_long</span><br><span class="line">        self.addr_latu = addr_latu</span><br><span class="line">        self.note = note</span><br><span class="line">        self.arri_time = arri_time</span><br><span class="line">        self.order_id = order_id</span><br><span class="line">        self.goods = goods</span><br><span class="line">        self.platform = platform</span><br><span class="line"></span><br><span class="line"><span class="comment">#截获饿了么订单</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ElemeOrders</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.orders = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">response</span>(<span class="params">self, flow: mitmproxy.http.flow</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;bwm_newretail.recrm_order_j/queryorderapp/queryOrderInfoList?&quot;</span> <span class="keyword">in</span> flow.request.url:</span><br><span class="line">            data = json.loads(flow.response.text)[<span class="string">&quot;data&quot;</span>]</span><br><span class="line">            <span class="keyword">for</span> total_order_list <span class="keyword">in</span> data[<span class="string">&#x27;total_order_list&#x27;</span>]:</span><br><span class="line">                <span class="keyword">for</span> order_list <span class="keyword">in</span> total_order_list[<span class="string">&#x27;order_list&#x27;</span>]:</span><br><span class="line">                    goods = []</span><br><span class="line">                    <span class="keyword">for</span> good <span class="keyword">in</span> order_list[<span class="string">&#x27;order_goods&#x27;</span>][<span class="string">&#x27;goods_list&#x27;</span>]:</span><br><span class="line">                        good_buffer = Good(good[<span class="string">&#x27;name&#x27;</span>],good[<span class="string">&#x27;number&#x27;</span>],good[<span class="string">&#x27;url&#x27;</span>])</span><br><span class="line">                        goods.append(good_buffer)</span><br><span class="line">                    order = Order(<span class="string">&#x27;eleme&#x27;</span>,order_list[<span class="string">&#x27;order_basic&#x27;</span>][<span class="string">&#x27;user_real_name&#x27;</span>]+order_list[<span class="string">&#x27;order_basic&#x27;</span>][<span class="string">&#x27;sex&#x27;</span>],order_list[<span class="string">&#x27;order_basic&#x27;</span>][<span class="string">&#x27;user_phone&#x27;</span>],str(order_list[<span class="string">&#x27;order_basic&#x27;</span>][<span class="string">&#x27;user_address_lng&#x27;</span>]),str(order_list[<span class="string">&#x27;order_basic&#x27;</span>][<span class="string">&#x27;user_address_lat&#x27;</span>]),order_list[<span class="string">&#x27;order_basic&#x27;</span>][<span class="string">&#x27;user_note&#x27;</span>],order_list[<span class="string">&#x27;order_basic&#x27;</span>][<span class="string">&#x27;takeout_average_time&#x27;</span>],order_list[<span class="string">&#x27;order_basic&#x27;</span>][<span class="string">&#x27;order_id&#x27;</span>],goods)</span><br><span class="line">                    self.orders.append(order)</span><br><span class="line">            print(self.orders)</span><br><span class="line"></span><br><span class="line"> <span class="comment">#截获美团订单</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MeituanOrders</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.orders = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">response</span>(<span class="params">self, flow: mitmproxy.http.flow</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;eapi.waimai.meituan.com/api/retail/order/supplement/increment/orders?&quot;</span> <span class="keyword">in</span> flow.request.url:</span><br><span class="line">            data = json.loads(flow.response.text)[<span class="string">&quot;data&quot;</span>]</span><br><span class="line">            <span class="keyword">for</span> order_list <span class="keyword">in</span> data[<span class="string">&#x27;news&#x27;</span>]:</span><br><span class="line">                goods = []</span><br><span class="line">                <span class="keyword">for</span> good <span class="keyword">in</span> order_list[<span class="string">&#x27;details&#x27;</span>]:</span><br><span class="line">                    good_buffer = Good(good[<span class="string">&#x27;food_name&#x27;</span>],good[<span class="string">&#x27;count&#x27;</span>],good[<span class="string">&#x27;picUrl&#x27;</span>])</span><br><span class="line">                    goods.append(good_buffer)</span><br><span class="line">                order = Order(<span class="string">&#x27;meituan&#x27;</span>,order_list[<span class="string">&#x27;recipient_name&#x27;</span>],order_list[<span class="string">&#x27;recipient_phone&#x27;</span>],self.geo_format(order_list[<span class="string">&#x27;longitude&#x27;</span>]),self.geo_format(order_list[<span class="string">&#x27;latitude&#x27;</span>]),order_list[<span class="string">&#x27;remark&#x27;</span>],order_list[<span class="string">&#x27;estimateArrivalTime&#x27;</span>],order_list[<span class="string">&#x27;id&#x27;</span>],goods)</span><br><span class="line">                self.orders.append(order)</span><br><span class="line">            print(self.orders[<span class="number">0</span>].name)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#将经纬度162787612转为162.787612</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">geo_format</span>(<span class="params">self,int_geo</span>):</span></span><br><span class="line">        str_geo = str(int_geo)  <span class="comment">#162787612</span></span><br><span class="line">        list_geo = list(str_geo)    <span class="comment">#[&#x27;1&#x27;,&#x27;6&#x27;,&#x27;2&#x27;,&#x27;7&#x27;,&#x27;8&#x27;,&#x27;7&#x27;,&#x27;6&#x27;,&#x27;1&#x27;,&#x27;2&#x27;]</span></span><br><span class="line">        list_geo.insert(<span class="number">-6</span>,<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">        new_str = <span class="string">&#x27;&#x27;</span>.join(list_geo)</span><br><span class="line">        <span class="keyword">return</span> new_str</span><br><span class="line"></span><br><span class="line"><span class="comment">#mitmproxy插件</span></span><br><span class="line">addons = [</span><br><span class="line">    ElemeOrders(),</span><br><span class="line">    MeituanOrders()</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h1 id="5：参考资料"><a href="#5：参考资料" class="headerlink" title="5：参考资料"></a>5：参考资料</h1><p>《<a href="https://blog.csdn.net/djzhao627/article/details/102812783">给Android7及以上的手机安装系统级证书，实现Fiddler或者其他程序的HTTPS的抓包</a>》</p><p>《<a href="https://blog.csdn.net/Crazy_zh/article/details/100013256">python将时间戳转换为指定时区时间</a>》</p>]]></content>
      
      
      <categories>
          
          <category> 爬虫 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> -TWRP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>外卖平台订单爬取之饿了么零售商家版</title>
      <link href="/2020/10/16/%E5%A4%96%E5%8D%96%E5%B9%B3%E5%8F%B0%E8%AE%A2%E5%8D%95%E7%88%AC%E5%8F%96%E4%B9%8B%E9%A5%BF%E4%BA%86%E4%B9%88%E9%9B%B6%E5%94%AE%E5%95%86%E5%AE%B6%E7%89%88/"/>
      <url>/2020/10/16/%E5%A4%96%E5%8D%96%E5%B9%B3%E5%8F%B0%E8%AE%A2%E5%8D%95%E7%88%AC%E5%8F%96%E4%B9%8B%E9%A5%BF%E4%BA%86%E4%B9%88%E9%9B%B6%E5%94%AE%E5%95%86%E5%AE%B6%E7%89%88/</url>
      
        <content type="html"><![CDATA[<h1 id="1：简单说两句"><a href="#1：简单说两句" class="headerlink" title="1：简单说两句"></a>1：简单说两句</h1><p>这是我一个准备做的完整项目中的一个小部分。从很早以前，我就在思考，如何将美团和饿了么以及我自己做的小程序订单合并在一起，这样来实现统一的管理。。之所以要统一管理，是因为我母亲从事鲜花零售，在节假日里，会有大量的订单，而鲜花的包扎是个时间活。制作和配送，以及订单的处理，繁杂的程序会让人晕头转向。为了减轻我母亲的节假日压力，我想到了一些方法，来帮助她管理订单。</p><p>完整的项目是，汇总小程序、美团、饿了么的订单。将订单返回的信息，通过处理，按配送时间排序，经过处理后通过企业微信api推送给微信。因为，花店的配送人员都是我母亲找的，他们受教育程度低，有的因为不识字，连导航都不会用。所以，需要把订单的位置信息，通过百度地图api转为url发送给配送员。另外，还可以制作一个程序，在程序上实时更新，新订单。。每当一束花被做好，我母亲就可从程序中将该订单从等待制作的列表中移除。。每当，有一个订单被送出，也可在程序上控制美团等客户端发送对应消息。</p><p>这一切都是非常美好的，对零售商家的体验会非常友好。但是，因为我无法取得美团和饿了么的开发者资格，也就拿不到他们的接口授权。。于是，我想到了，利用利用mitmproxy获取美团饿了么的订单信息。通过appium自动化控制手机。无论是mitmrpoxy还是appium对python程序都是非常友好的。</p><p>那么现在开始我的第一步，利用mitmproxy爬取饿了么零售商家版订单信息。</p><h1 id="2：mitmproxy安装与使用"><a href="#2：mitmproxy安装与使用" class="headerlink" title="2：mitmproxy安装与使用"></a>2：mitmproxy安装与使用</h1><p><strong>安装</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install mitmproxy</span><br></pre></td></tr></table></figure><p><strong>开启</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mitmweb</span><br><span class="line"><span class="meta">#</span><span class="bash">或者mitmproxy mitmdump</span></span><br></pre></td></tr></table></figure><p><strong>与python配合</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mitmdump -s eleme.py</span><br></pre></td></tr></table></figure><p><strong>手机使用mitmproxy开启的代理</strong>：</p><p>更改wifi高级设置里的代理模式为手动，主机填写mitmproxy运行的电脑局域网ip。可通过ifconfig查看。</p><p>端口为8080</p><p>此时打开baidu.com会提示不安全，而且mitmproxy应该开始记录了。</p><p>手机打开网页<code>mitm.it</code>下载对应系统的证书文件。安卓下载后直接安装。。</p><p>再上网就不会提示不安全了。</p><h1 id="3：响应内容"><a href="#3：响应内容" class="headerlink" title="3：响应内容"></a>3：响应内容</h1><p>在开启mitmweb后，从打开的网页上可以观察到手机的整个数据流，在手机上刷新订单页，就能截获饿了么发送回来的订单信息。</p><p>将响应内容提取出来，并把JSON数据格式化，部分关键信息已打码。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;data&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;curr_page&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;order_count&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;page_count&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;page_size&quot;</span>: <span class="number">20</span>,</span><br><span class="line"><span class="attr">&quot;total_order_list&quot;</span>: [&#123;</span><br><span class="line"><span class="attr">&quot;mills&quot;</span>: <span class="number">1602518400000</span>,</span><br><span class="line"><span class="attr">&quot;order_list&quot;</span>: [&#123;</span><br><span class="line"><span class="attr">&quot;cold_chain_cost&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;price&quot;</span>: <span class="string">&quot;0.00&quot;</span>,</span><br><span class="line"><span class="attr">&quot;title&quot;</span>: <span class="string">&quot;冷链服务费&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;compensationInfo&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;enableCompensable&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">&quot;timeRemaining&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;extract_commission&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;brief_desc&quot;</span>: <span class="string">&quot;请以结算账单为准&quot;</span>,</span><br><span class="line"><span class="attr">&quot;commission_total&quot;</span>: <span class="string">&quot;15.00&quot;</span>,</span><br><span class="line"><span class="attr">&quot;title&quot;</span>: <span class="string">&quot;抽取佣金&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;goods_discount&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;discount_account&quot;</span>: <span class="string">&quot;-￥3.00&quot;</span>,</span><br><span class="line"><span class="attr">&quot;discount_list&quot;</span>: [&#123;</span><br><span class="line"><span class="attr">&quot;desc&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;hasLineBelow&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;list&quot;</span>: [&#123;</span><br><span class="line"><span class="attr">&quot;price&quot;</span>: <span class="string">&quot;￥3.00&quot;</span>,</span><br><span class="line"><span class="attr">&quot;title&quot;</span>: <span class="string">&quot;商家配送费补贴&quot;</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line"><span class="attr">&quot;price&quot;</span>: <span class="string">&quot;￥3.00&quot;</span>,</span><br><span class="line"><span class="attr">&quot;title&quot;</span>: <span class="string">&quot;小计&quot;</span></span><br><span class="line">&#125;],</span><br><span class="line"><span class="attr">&quot;title&quot;</span>: <span class="string">&quot;商户补贴金额&quot;</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line"><span class="attr">&quot;desc&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;hasLineBelow&quot;</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">&quot;list&quot;</span>: [&#123;</span><br><span class="line"><span class="attr">&quot;title&quot;</span>: <span class="string">&quot;配送费满减&quot;</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line"><span class="attr">&quot;title&quot;</span>: <span class="string">&quot;(商家补贴:￥3.00元)&quot;</span></span><br><span class="line">&#125;],</span><br><span class="line"><span class="attr">&quot;title&quot;</span>: <span class="string">&quot;活动明细&quot;</span></span><br><span class="line">&#125;],</span><br><span class="line"><span class="attr">&quot;title&quot;</span>: <span class="string">&quot;顾客优惠合计&quot;</span>,</span><br><span class="line"><span class="attr">&quot;user_discount_account&quot;</span>: <span class="string">&quot;-￥3.00&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;grayInfo&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;hummingBirdGray&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;orderSettle&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;baseLogisticsAmt&quot;</span>: <span class="string">&quot;0.00&quot;</span>,</span><br><span class="line"><span class="attr">&quot;baseLogisticsDesc&quot;</span>: <span class="string">&quot;本单收取固定物流费&quot;</span>,</span><br><span class="line"><span class="attr">&quot;commissionAmt&quot;</span>: <span class="string">&quot;15.00&quot;</span>,</span><br><span class="line"><span class="attr">&quot;commissionDesc&quot;</span>: <span class="string">&quot;请以结算账单为准&quot;</span>,</span><br><span class="line"><span class="attr">&quot;shopInAmount&quot;</span>: <span class="string">&quot;0.00&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;order_basic&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;apply_cancel_feed&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;feed_list&quot;</span>: [&#123;</span><br><span class="line"><span class="attr">&quot;cancel_content&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;cancel_extra&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;cancel_time&quot;</span>: <span class="string">&quot;10月13日 12:55&quot;</span>,</span><br><span class="line"><span class="attr">&quot;cancel_title&quot;</span>: <span class="string">&quot;订单已完成(商户)&quot;</span>,</span><br><span class="line"><span class="attr">&quot;end_time&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;left_time&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;left_time_show&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;refund_price&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;user_apply_refund_pic&quot;</span>: []</span><br><span class="line">&#125;, &#123;</span><br><span class="line"><span class="attr">&quot;cancel_content&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;cancel_extra&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;cancel_time&quot;</span>: <span class="string">&quot;10月13日 09:10&quot;</span>,</span><br><span class="line"><span class="attr">&quot;cancel_title&quot;</span>: <span class="string">&quot;商家已接单&quot;</span>,</span><br><span class="line"><span class="attr">&quot;end_time&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;left_time&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;left_time_show&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;refund_price&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;user_apply_refund_pic&quot;</span>: []</span><br><span class="line">&#125;, &#123;</span><br><span class="line"><span class="attr">&quot;cancel_content&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;cancel_extra&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;cancel_time&quot;</span>: <span class="string">&quot;10月13日 09:10&quot;</span>,</span><br><span class="line"><span class="attr">&quot;cancel_title&quot;</span>: <span class="string">&quot;订单已支付&quot;</span>,</span><br><span class="line"><span class="attr">&quot;end_time&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;left_time&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;left_time_show&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;refund_price&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;user_apply_refund_pic&quot;</span>: []</span><br><span class="line">&#125;, &#123;</span><br><span class="line"><span class="attr">&quot;cancel_content&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;cancel_extra&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;cancel_time&quot;</span>: <span class="string">&quot;10月13日 09:09&quot;</span>,</span><br><span class="line"><span class="attr">&quot;cancel_title&quot;</span>: <span class="string">&quot;创建订单&quot;</span>,</span><br><span class="line"><span class="attr">&quot;end_time&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;left_time&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;left_time_show&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;refund_price&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;user_apply_refund_pic&quot;</span>: []</span><br><span class="line">&#125;]</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;apply_cancel_status&quot;</span>: <span class="number">886</span>,</span><br><span class="line"><span class="attr">&quot;auto_confirm_order&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;batch&quot;</span>: <span class="number">2000000000000000001</span>,</span><br><span class="line"><span class="attr">&quot;business_type&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;call_delivery_delay&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;cancel_reason&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;cancel_reason_explain&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;cancel_reason_status&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line"><span class="attr">&quot;check_out_button&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;city_name&quot;</span>: <span class="string">&quot;成都市&quot;</span>,</span><br><span class="line"><span class="attr">&quot;confirmButton&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;confirm_time&quot;</span>: <span class="string">&quot;1602551413&quot;</span>,</span><br><span class="line"><span class="attr">&quot;create_time&quot;</span>: <span class="string">&quot;1602551397&quot;</span>,</span><br><span class="line"><span class="attr">&quot;delivery_delay_time&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;delivery_exception_code&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;delivery_exception_state&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;delivery_name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;delivery_party&quot;</span>: <span class="string">&quot;self&quot;</span>,</span><br><span class="line"><span class="attr">&quot;delivery_staff_phone&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;delivery_state&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line"><span class="attr">&quot;delivery_state_desc&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;delivery_tip_amount&quot;</span>: <span class="number">0.0</span>,</span><br><span class="line"><span class="attr">&quot;distance&quot;</span>: <span class="string">&quot;&lt;1.8千米&quot;</span>,</span><br><span class="line"><span class="attr">&quot;due_deliver_time_by_ofc&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;ele_fengniao_info&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;is_fengniao_call_again&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;is_fengniao_switch_self&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;no_delivery&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;ele_zhongbao_info&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;delivery_fee&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;is_show&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">&quot;op_status&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;eleme_finish_refund&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;eleme_order_id&quot;</span>: <span class="string">&quot;5009809679236497411&quot;</span>,</span><br><span class="line"><span class="attr">&quot;evoip_order&quot;</span>: <span class="number">2</span>,</span><br><span class="line"><span class="attr">&quot;express_company&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;express_id&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line"><span class="attr">&quot;feed_to_show&quot;</span>: <span class="string">&quot;order_log&quot;</span>,</span><br><span class="line"><span class="attr">&quot;finished_time&quot;</span>: <span class="string">&quot;1602564946&quot;</span>,</span><br><span class="line"><span class="attr">&quot;gift_greeting&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;gift_phone&quot;</span>: <span class="string">&quot;13***502&quot;</span>,</span><br><span class="line"><span class="attr">&quot;hbirdRunErrandsInfo&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;addTipsButton&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;callButton&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;cancelCallButton&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;payType&quot;</span>: <span class="literal">null</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;idempotentId&quot;</span>: <span class="string">&quot;20201017025815254005000100027411822742&quot;</span>,</span><br><span class="line"><span class="attr">&quot;invoice_price&quot;</span>: <span class="string">&quot;100.00&quot;</span>,</span><br><span class="line"><span class="attr">&quot;invoice_title&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;is_alipay_order&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;is_baidu_logistics&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;is_can_auto_confirm&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;is_city_delivery&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;is_cold_order&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;is_compensation_show&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;is_cook_overtime&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;is_from_tp_new_retail&quot;</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="attr">&quot;is_print&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;is_privacy_hide&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;is_ranger_show&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;is_show_express&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;ivr_tip&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;meal_num&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;need_invoice&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;orderUserPhone&quot;</span>: <span class="string">&quot;136****3502&quot;</span>,</span><br><span class="line"><span class="attr">&quot;orderUserPrivacyPhone&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;order_from&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line"><span class="attr">&quot;order_id&quot;</span>: <span class="string">&quot;50098***97411&quot;</span>,</span><br><span class="line"><span class="attr">&quot;order_index&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line"><span class="attr">&quot;order_list_type&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;is_cancel&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;is_exception&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;is_new&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;is_remind&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;is_reserve&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;is_user_part_refund&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;order_time_line&quot;</span>: [&#123;</span><br><span class="line"><span class="attr">&quot;code&quot;</span>: <span class="string">&quot;101004&quot;</span>,</span><br><span class="line"><span class="attr">&quot;time&quot;</span>: <span class="string">&quot;10/13 12:55&quot;</span>,</span><br><span class="line"><span class="attr">&quot;title&quot;</span>: <span class="string">&quot;订单已完成(商户)&quot;</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line"><span class="attr">&quot;code&quot;</span>: <span class="string">&quot;100004&quot;</span>,</span><br><span class="line"><span class="attr">&quot;time&quot;</span>: <span class="string">&quot;10/13 09:10&quot;</span>,</span><br><span class="line"><span class="attr">&quot;title&quot;</span>: <span class="string">&quot;商家已接单&quot;</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line"><span class="attr">&quot;code&quot;</span>: <span class="string">&quot;100001&quot;</span>,</span><br><span class="line"><span class="attr">&quot;time&quot;</span>: <span class="string">&quot;10/13 09:10&quot;</span>,</span><br><span class="line"><span class="attr">&quot;title&quot;</span>: <span class="string">&quot;订单已支付&quot;</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line"><span class="attr">&quot;code&quot;</span>: <span class="string">&quot;100000&quot;</span>,</span><br><span class="line"><span class="attr">&quot;time&quot;</span>: <span class="string">&quot;10/13 09:09&quot;</span>,</span><br><span class="line"><span class="attr">&quot;title&quot;</span>: <span class="string">&quot;创建订单&quot;</span></span><br><span class="line">&#125;],</span><br><span class="line"><span class="attr">&quot;order_type&quot;</span>: <span class="number">4</span>,</span><br><span class="line"><span class="attr">&quot;part_refund_support&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;pay_display&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;pay_status&quot;</span>: <span class="string">&quot;已支付&quot;</span>,</span><br><span class="line"><span class="attr">&quot;pc_order_label&quot;</span>: [],</span><br><span class="line"><span class="attr">&quot;pick_info&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;expect_finish_time&quot;</span>: <span class="string">&quot;02:58:15&quot;</span>,</span><br><span class="line"><span class="attr">&quot;left_time&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line"><span class="attr">&quot;pick_button&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line"><span class="attr">&quot;show&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line"><span class="attr">&quot;timestamp&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;privacy_phone&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;range_status&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;real_status&quot;</span>: <span class="number">5</span>,</span><br><span class="line"><span class="attr">&quot;real_status_desc&quot;</span>: <span class="string">&quot;商家已经确认订单&quot;</span>,</span><br><span class="line"><span class="attr">&quot;refund_attribute&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;refund_logs&quot;</span>: [],</span><br><span class="line"><span class="attr">&quot;refund_req_info&quot;</span>: [],</span><br><span class="line"><span class="attr">&quot;refuseButton&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;remind_undeal&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;remind_wait_time&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;responsible_party&quot;</span>: <span class="string">&quot;暂无&quot;</span>,</span><br><span class="line"><span class="attr">&quot;self_order_completed_button&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;send_time&quot;</span>: <span class="string">&quot;请10月13日 13:00送达&quot;</span>,</span><br><span class="line"><span class="attr">&quot;send_time_print&quot;</span>: <span class="string">&quot;13日 13:00送达&quot;</span>,</span><br><span class="line"><span class="attr">&quot;service_phone&quot;</span>: <span class="string">&quot;10105757&quot;</span>,</span><br><span class="line"><span class="attr">&quot;set_express&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;sex&quot;</span>: <span class="string">&quot;女士&quot;</span>,</span><br><span class="line"><span class="attr">&quot;shopPicked&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;shop_info&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;location_shop&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;latitude&quot;</span>: <span class="string">&quot;35**3**7&quot;</span>,</span><br><span class="line"><span class="attr">&quot;longitude&quot;</span>: <span class="string">&quot;***4431E7&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;shop_address&quot;</span>: <span class="literal">null</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;shop_name&quot;</span>: <span class="string">&quot;**鲜花店&quot;</span>,</span><br><span class="line"><span class="attr">&quot;shop_phone&quot;</span>: <span class="string">&quot;13***65&quot;</span>,</span><br><span class="line"><span class="attr">&quot;shop_user_distance&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;show_add_tip&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;show_cancel_button&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">&quot;show_know_button&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;show_shop_pack&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;status&quot;</span>: <span class="number">9</span>,</span><br><span class="line"><span class="attr">&quot;status_desc&quot;</span>: <span class="string">&quot; 已完结&quot;</span>,</span><br><span class="line"><span class="attr">&quot;supplier_id&quot;</span>: <span class="string">&quot;0&quot;</span>,</span><br><span class="line"><span class="attr">&quot;supplier_name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;takeout_average_time&quot;</span>: <span class="number">1602565200</span>,</span><br><span class="line"><span class="attr">&quot;takeout_phone&quot;</span>: <span class="string">&quot;136****065&quot;</span>,</span><br><span class="line"><span class="attr">&quot;taxer_id&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;thirty_min_service&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;userTags&quot;</span>: [<span class="number">2</span>],</span><br><span class="line"><span class="attr">&quot;user_address&quot;</span>: <span class="string">&quot;为了保护顾客隐私，隐藏地址信息&quot;</span>,</span><br><span class="line"><span class="attr">&quot;user_address_lat&quot;</span>: <span class="string">&quot;30.890345&quot;</span>,</span><br><span class="line"><span class="attr">&quot;user_address_lng&quot;</span>: <span class="string">&quot;104.261772&quot;</span>,</span><br><span class="line"><span class="attr">&quot;user_id&quot;</span>: <span class="string">&quot;576192986&quot;</span>,</span><br><span class="line"><span class="attr">&quot;user_note&quot;</span>: <span class="string">&quot;送给我好朋友的生日花，写几句祝福语，谢谢&quot;</span>,</span><br><span class="line"><span class="attr">&quot;user_order_num_str&quot;</span>: <span class="string">&quot;超百次下单&quot;</span>,</span><br><span class="line"><span class="attr">&quot;user_phone&quot;</span>: <span class="string">&quot;177****7520&quot;</span>,</span><br><span class="line"><span class="attr">&quot;user_phone_call&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;user_phone_star&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;user_real_name&quot;</span>: <span class="string">&quot;珊&quot;</span>,</span><br><span class="line"><span class="attr">&quot;vip_status&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;waimai_release_id&quot;</span>: <span class="string">&quot;159766693&quot;</span>,</span><br><span class="line"><span class="attr">&quot;wxIconPath&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;wxNickname&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;zone_tips_required&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;order_goods&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;cart_num&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;goods_list&quot;</span>: [&#123;</span><br><span class="line"><span class="attr">&quot;customer_price&quot;</span>: <span class="string">&quot;98.00&quot;</span>,</span><br><span class="line"><span class="attr">&quot;ext&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;attr&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;cart_id&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line"><span class="attr">&quot;cold_chain&quot;</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">&quot;combo_attr&quot;</span>: [],</span><br><span class="line"><span class="attr">&quot;customer_total_discount&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;discount_desc&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;ext_code&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;is_combo&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;process_label&quot;</span>: [],</span><br><span class="line"><span class="attr">&quot;product_index&quot;</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">&quot;property_label&quot;</span>: [],</span><br><span class="line"><span class="attr">&quot;shop_total_discount&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;store_attr&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;bar_code&quot;</span>: <span class="string">&quot;wm367**65&quot;</span>,</span><br><span class="line"><span class="attr">&quot;category_name&quot;</span>: <span class="string">&quot;爱情表白&quot;</span>,</span><br><span class="line"><span class="attr">&quot;shelf_position&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;sku_id&quot;</span>: <span class="string">&quot;1597871782222488&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;unique_id&quot;</span>: <span class="string">&quot;13***678&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;fix_weight&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;gift_info&quot;</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">&quot;gmids&quot;</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">&quot;hasgift&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;isNoReasonToReturn&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">&quot;isfreegift&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;name&quot;</span>: <span class="string">&quot;【七夕专属】19朵红玫瑰礼盒+银叶&quot;</span>,</span><br><span class="line"><span class="attr">&quot;number&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;orig_price&quot;</span>: <span class="string">&quot;98.00&quot;</span>,</span><br><span class="line"><span class="attr">&quot;orig_unit_price&quot;</span>: <span class="string">&quot;98.00&quot;</span>,</span><br><span class="line"><span class="attr">&quot;printing_price&quot;</span>: <span class="string">&quot;98.00&quot;</span>,</span><br><span class="line"><span class="attr">&quot;shop_price&quot;</span>: <span class="string">&quot;98.00&quot;</span>,</span><br><span class="line"><span class="attr">&quot;shop_unit_price&quot;</span>: <span class="string">&quot;98.00&quot;</span>,</span><br><span class="line"><span class="attr">&quot;total_weight&quot;</span>: <span class="number">999</span>,</span><br><span class="line"><span class="attr">&quot;unique_id&quot;</span>: <span class="string">&quot;130047***9119678&quot;</span>,</span><br><span class="line"><span class="attr">&quot;url&quot;</span>: <span class="string">&quot;https://img.alic***i2/111483146/O1CN01wVILGS1Z6udgswHe4_!!111483146-0-***.jpg&quot;</span>,</span><br><span class="line"><span class="attr">&quot;weight&quot;</span>: <span class="number">999</span>,</span><br><span class="line"><span class="attr">&quot;weight_can_update&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">&quot;weight_flag&quot;</span>: <span class="number">2</span></span><br><span class="line">&#125;],</span><br><span class="line"><span class="attr">&quot;goods_total&quot;</span>: <span class="number">1</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;order_meal_fee&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;price&quot;</span>: <span class="string">&quot;0.00&quot;</span>,</span><br><span class="line"><span class="attr">&quot;title&quot;</span>: <span class="string">&quot;包装费&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;order_operations&quot;</span>: [],</span><br><span class="line"><span class="attr">&quot;order_sub_total&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;discount&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;formula_desc&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;number&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;price&quot;</span>: <span class="string">&quot;98.00&quot;</span>,</span><br><span class="line"><span class="attr">&quot;title&quot;</span>: <span class="string">&quot;商品小计&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;order_total&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;customer_price&quot;</span>: <span class="string">&quot;100.00&quot;</span>,</span><br><span class="line"><span class="attr">&quot;customer_title&quot;</span>: <span class="string">&quot;本单顾客实际支付&quot;</span>,</span><br><span class="line"><span class="attr">&quot;number&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;pay_type&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;shop_price&quot;</span>: <span class="string">&quot;85.00&quot;</span>,</span><br><span class="line"><span class="attr">&quot;shop_price_final&quot;</span>: <span class="string">&quot;85.00&quot;</span>,</span><br><span class="line"><span class="attr">&quot;title&quot;</span>: <span class="string">&quot;预计收入&quot;</span>,</span><br><span class="line"><span class="attr">&quot;title_after&quot;</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">&quot;total_desc&quot;</span>: <span class="string">&quot;本单顾客实际支付100.00元&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;other_total_cost&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;price&quot;</span>: <span class="string">&quot;5.00&quot;</span>,</span><br><span class="line"><span class="attr">&quot;title&quot;</span>: <span class="string">&quot;其他费用合计&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;prescriptionDrugsInfo&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;auditButton&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;prescriptionOrder&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">&quot;processMsg&quot;</span>: <span class="string">&quot;系统正在处理中&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;prescription_info&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;is_prescription_order&quot;</span>: <span class="number">0</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;shop_other_discount&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;customer_discount_list&quot;</span>: [],</span><br><span class="line"><span class="attr">&quot;customer_discount_total&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;price&quot;</span>: <span class="string">&quot;-0.00&quot;</span>,</span><br><span class="line"><span class="attr">&quot;shop_discount_list&quot;</span>: [],</span><br><span class="line"><span class="attr">&quot;shop_discount_total&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;sub_total_desc&quot;</span>: <span class="string">&quot;以上明细为商户承担的顾客优惠费用，最终订单收入请以对账单为准。&quot;</span>,</span><br><span class="line"><span class="attr">&quot;title&quot;</span>: <span class="string">&quot;商户其他优惠&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;takeout_cost&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;price&quot;</span>: <span class="string">&quot;5.00&quot;</span>,</span><br><span class="line"><span class="attr">&quot;title&quot;</span>: <span class="string">&quot;配送费&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;],</span><br><span class="line"><span class="attr">&quot;title&quot;</span>: <span class="string">&quot;10月13日&quot;</span></span><br><span class="line">&#125;]</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;errmsg&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;errno&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;req_params&quot;</span>: [&#123;</span><br><span class="line"><span class="attr">&quot;asap_type&quot;</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">&quot;end_timestamp&quot;</span>: <span class="string">&quot;2020-10-16&quot;</span>,</span><br><span class="line"><span class="attr">&quot;is_asap&quot;</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">&quot;keyword&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;new_system&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;order_status&quot;</span>: <span class="number">9</span>,</span><br><span class="line"><span class="attr">&quot;page&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;pageSize&quot;</span>: <span class="number">20</span>,</span><br><span class="line"><span class="attr">&quot;shop_id&quot;</span>: <span class="literal">null</span>,</span><br><span class="line"><span class="attr">&quot;start_timestamp&quot;</span>: <span class="string">&quot;2020-10-10&quot;</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line"><span class="attr">&quot;appVersion&quot;</span>: <span class="string">&quot;2.2.3&quot;</span>,</span><br><span class="line"><span class="attr">&quot;authedSupplierIds&quot;</span>: [],</span><br><span class="line"><span class="attr">&quot;brand&quot;</span>: <span class="string">&quot;samsung&quot;</span>,</span><br><span class="line"><span class="attr">&quot;channel&quot;</span>: <span class="string">&quot;mobile&quot;</span>,</span><br><span class="line"><span class="attr">&quot;cuid&quot;</span>: <span class="string">&quot;12B9828F9D0D3E389BA181D5A286A514|fw+G+2QPhBBAD8Yubtg6qGDX&quot;</span>,</span><br><span class="line"><span class="attr">&quot;from&quot;</span>: <span class="string">&quot;android&quot;</span>,</span><br><span class="line"><span class="attr">&quot;isBoss&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">&quot;isManager&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">&quot;isMobile&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">&quot;isShop&quot;</span>: <span class="literal">true</span>,</span><br><span class="line"><span class="attr">&quot;isSupplier&quot;</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">&quot;manager&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;bossUserId&quot;</span>: <span class="literal">null</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;pcVersion&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;roleInfo&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;shopRoleId&quot;</span>: <span class="string">&quot;159766693&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;shopInfo&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;eleId&quot;</span>: <span class="number">159766693</span>,</span><br><span class="line"><span class="attr">&quot;wid&quot;</span>: <span class="string">&quot;159766693&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;supplierInfo&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;supplierId&quot;</span>: <span class="string">&quot;0&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">&quot;userInfo&quot;</span>: &#123;</span><br><span class="line"><span class="attr">&quot;loginRole&quot;</span>: <span class="number">1</span>,</span><br><span class="line"><span class="attr">&quot;loginSubUserType&quot;</span>: <span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;loginUserId&quot;</span>: <span class="string">&quot;1597***50001&quot;</span>,</span><br><span class="line"><span class="attr">&quot;phone&quot;</span>: <span class="string">&quot;13***65&quot;</span>,</span><br><span class="line"><span class="attr">&quot;shopUserId&quot;</span>: <span class="string">&quot;15973**001&quot;</span>,</span><br><span class="line"><span class="attr">&quot;userName&quot;</span>: <span class="string">&quot;x***65&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="4：Python程序"><a href="#4：Python程序" class="headerlink" title="4：Python程序"></a>4：Python程序</h1><p>对上述JSON数据进行分析，在Python中用json.load把JSON数据转化为字典和列表格式数据，方便我们提取信息。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mitmproxy.http</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="comment">#顾客类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name,tel</span>):</span></span><br><span class="line">        self.name = name </span><br><span class="line">        self.tel = tel</span><br><span class="line">       </span><br><span class="line"></span><br><span class="line"><span class="comment">#商品类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Good</span>(<span class="params">object</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name,number,img</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.number = number</span><br><span class="line">        self.img = img</span><br><span class="line"></span><br><span class="line"><span class="comment">#订单类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span>(<span class="params">Customer</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,platform,name,tel,addr_long,addr_latu,note,arri_time,order_id,goods</span>):</span></span><br><span class="line">        Customer.__init__(self,name,tel)</span><br><span class="line">        self.addr_long = addr_long</span><br><span class="line">        self.addr_latu = addr_latu</span><br><span class="line">        self.note = note</span><br><span class="line">        self.arri_time = arri_time</span><br><span class="line">        self.order_id = order_id</span><br><span class="line">        self.goods = goods</span><br><span class="line">        self.platform = platform</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ElemeOrders</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.orders = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">response</span>(<span class="params">self, flow: mitmproxy.http.flow</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;bwm_newretail.recrm_order_j/queryorderapp/queryOrderInfoList?&quot;</span> <span class="keyword">in</span> flow.request.url:</span><br><span class="line">            data = json.loads(flow.response.text)[<span class="string">&quot;data&quot;</span>]</span><br><span class="line">            <span class="keyword">for</span> total_order_list <span class="keyword">in</span> data[<span class="string">&#x27;total_order_list&#x27;</span>]:</span><br><span class="line">                <span class="keyword">for</span> order_list <span class="keyword">in</span> total_order_list[<span class="string">&#x27;order_list&#x27;</span>]:</span><br><span class="line">                    goods = []</span><br><span class="line">                    <span class="keyword">for</span> good <span class="keyword">in</span> order_list[<span class="string">&#x27;order_goods&#x27;</span>][<span class="string">&#x27;goods_list&#x27;</span>]:</span><br><span class="line">                        good_buffer = Good(good[<span class="string">&#x27;name&#x27;</span>],good[<span class="string">&#x27;number&#x27;</span>],good[<span class="string">&#x27;url&#x27;</span>])</span><br><span class="line">                        goods.append(good_buffer)</span><br><span class="line">                    order = Order(<span class="string">&#x27;eleme&#x27;</span>,order_list[<span class="string">&#x27;order_basic&#x27;</span>][<span class="string">&#x27;user_real_name&#x27;</span>]+order_list[<span class="string">&#x27;order_basic&#x27;</span>][<span class="string">&#x27;sex&#x27;</span>],order_list[<span class="string">&#x27;order_basic&#x27;</span>][<span class="string">&#x27;user_phone&#x27;</span>],str(order_list[<span class="string">&#x27;order_basic&#x27;</span>][<span class="string">&#x27;user_address_lng&#x27;</span>]),str(order_list[<span class="string">&#x27;order_basic&#x27;</span>][<span class="string">&#x27;user_address_lat&#x27;</span>]),order_list[<span class="string">&#x27;order_basic&#x27;</span>][<span class="string">&#x27;user_note&#x27;</span>],order_list[<span class="string">&#x27;order_basic&#x27;</span>][<span class="string">&#x27;takeout_average_time&#x27;</span>],order_list[<span class="string">&#x27;order_basic&#x27;</span>][<span class="string">&#x27;order_id&#x27;</span>],goods)</span><br><span class="line">                    self.orders.append(order)</span><br><span class="line">            print(self.orders)</span><br></pre></td></tr></table></figure><p>经过简单的测试，程序能够拿到完整的订单信息。一次性搞定，没有bug。</p><p>在这个程序中，主要需要关注的是，Mitm类中的self.orders这个变量，可以看到，这个变量是一个列表，它包含了大于等于1个订单。每个订单，都是一个Order类的实例化，Order类中最后一个变量goods是一个列表，这个列表由多个实例化的Good类组成。因为一个订单可能包含多种商品。</p><p>具体如何利用这些信息，还需要再Mitm()类中做修改。而提取单个订单类，比如第一个订单，直接使用<code>self.orders[0]</code>，要提取第一个订单中的第一件商品<code>self.orders[0].goods[0]</code>。</p><p>其他的，比如第一个订单收货人：<code>self.orders[0].name</code></p><p>第一个订单的第一件商品的名称：<code>self.orders[0].goods[0].name</code></p><p>后续我可能会将它保存到数据库中，方便下次提取和修改信息。</p><h1 id="5：参考资料"><a href="#5：参考资料" class="headerlink" title="5：参考资料"></a>5：参考资料</h1><p>《<a href="https://blog.csdn.net/freeking101/article/details/83901842">使用 mitmproxy + python 做拦截代理</a>》</p><p>《<a href="https://www.weiney.com/2072.html">APP爬虫入门，Appium+Mitmproxy强势组合实现抖音的数据爬取</a>》</p>]]></content>
      
      
      <categories>
          
          <category> 爬虫 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Mitmproxy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pandas知识总结</title>
      <link href="/2020/10/14/Pandas%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/"/>
      <url>/2020/10/14/Pandas%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h1 id="1：简介"><a href="#1：简介" class="headerlink" title="1：简介"></a>1：简介</h1><p>在我看来，Pandas是一款数据处理工具，它相比于numpy而言，更加具有针对性。比如说，Pandas提供了两种数据结构，Series和DataFrame，分别表示一维数据和二维数据，而numpy则还有更多维数据。Pandas的特色是，它可以使用自定义的索引来表示数据的特点，这和Excel表格很类似。而numpy只有固定的整数索引。</p><p>在数据中，我们可能会有这种情况，一个二维表格，每一行，表示不同的学生，每一列表示学生的不同信息。如下表所示，</p><table><thead><tr><th></th><th>年龄</th><th>班级</th></tr></thead><tbody><tr><td>小明</td><td>19</td><td>4班</td></tr><tr><td>小张</td><td>15</td><td>2班</td></tr><tr><td>小华</td><td>17</td><td>1班</td></tr></tbody></table><p>由年龄和班级构成的二维数组，在numpy中是无法建立的，因为numpy无法建立班级的字符串格式数据，且数组内不能含有多种属性的数据，比如年龄的数据格式是int，而班级则是string。</p><p>此时Pandas的作用就出来了。Pandas可以指定上述数据每一行的意义为名字，所以其行索引<code>Index</code>可以设置为[‘小明’,’小张’,’小华’]，而其纵坐标的索引<code>columns</code>设置为[‘年龄’,’班级’]。然后再向这个DataFrame中添加数据即可。</p><h1 id="2：入门"><a href="#2：入门" class="headerlink" title="2：入门"></a>2：入门</h1><h2 id="2-1-生成对象"><a href="#2-1-生成对象" class="headerlink" title="2.1 生成对象"></a>2.1 生成对象</h2><p>引入Pandas：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br></pre></td></tr></table></figure><p>生成Series：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s = pd.Series([<span class="number">1</span>,<span class="number">4</span>,<span class="number">1</span>,np.nan,<span class="number">8</span>])</span><br></pre></td></tr></table></figure><p>生成DataFrame：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dates = pd.date_range(<span class="string">&#x27;20130101&#x27;</span>,periods=<span class="number">6</span>)</span><br><span class="line"><span class="comment">#生成六个以20130101开始，间隔为一天的时间序列</span></span><br><span class="line">df = pd.DataFrame(np.random.randn(<span class="number">6</span>,<span class="number">4</span>), index=dates, columns=list(<span class="string">&#x27;ABCD&#x27;</span>))</span><br></pre></td></tr></table></figure><blockquote><p>date_range函数可以生成一个时间序列，参数有，开始时间，结束时间，序列个数，间隔单位等。</p></blockquote><p>df为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">                   A         B         C         D</span><br><span class="line">2013-01-01  0.469112 -0.282863 -1.509059 -1.135632</span><br><span class="line">2013-01-02  1.212112 -0.173215  0.119209 -1.044236</span><br><span class="line">2013-01-03 -0.861849 -2.104569 -0.494929  1.071804</span><br><span class="line">2013-01-04  0.721555 -0.706771 -1.039575  0.271860</span><br><span class="line">2013-01-05 -0.424972  0.567020  0.276232 -1.087401</span><br><span class="line">2013-01-06 -0.673690  0.113648 -1.478427  0.524988</span><br></pre></td></tr></table></figure><p>使用字典对象生成DataFrame：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">df2 = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>:<span class="number">1</span>,</span><br><span class="line">                    <span class="string">&#x27;B&#x27;</span>:pd.Timestamp(<span class="string">&#x27;20130102&#x27;</span>), </span><br><span class="line">                    <span class="string">&#x27;C&#x27;</span>:pd.Series(<span class="number">1</span>, index=list(range(<span class="number">4</span>)),dtype=<span class="string">&#x27;float332&#x27;</span>),</span><br><span class="line">                    <span class="string">&#x27;D&#x27;</span>:np.array([<span class="number">3</span>]*<span class="number">4</span>,dtype=<span class="string">&#x27;int32&#x27;</span>),</span><br><span class="line">                    <span class="string">&#x27;E&#x27;</span>:pd.Categorical([<span class="string">&quot;test&quot;</span>,<span class="string">&quot;train&quot;</span>,<span class="string">&quot;test&quot;</span>,<span class="string">&quot;train&quot;</span>]),</span><br><span class="line">                    <span class="string">&#x27;F&#x27;</span>:<span class="string">&#x27;foo&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure><h2 id="2-2-查看数据"><a href="#2-2-查看数据" class="headerlink" title="2.2 查看数据"></a>2.2 查看数据</h2><p>查看DataFrame头部和尾部数据：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df.head()</span><br><span class="line">df.tail(<span class="number">3</span>)</span><br><span class="line"><span class="comment">#可指定查看头尾部的数据行数</span></span><br></pre></td></tr></table></figure><p>显示索引和列名：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df.index</span><br><span class="line">df.columns</span><br></pre></td></tr></table></figure><p><code>df.to_numpy()</code>将DataFrame数据转为numpy数据</p><p><code>df.describe()</code>查看数据统计摘要</p><p><code>df.T</code>转置</p><p><code>df.sort_index(axis=1,ascending=False)</code>按轴上升排序</p><p><code>df.sort_values(by=&#39;B&#39;)</code>按轴排序</p><h2 id="2-3-选择数据"><a href="#2-3-选择数据" class="headerlink" title="2.3 选择数据"></a>2.3 选择数据</h2><p>产生<code>Series</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df[<span class="string">&#x27;A&#x27;</span>]</span><br><span class="line">df.A</span><br></pre></td></tr></table></figure><p>切片：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df[<span class="number">0</span>:<span class="number">3</span>]</span><br><span class="line"><span class="comment">#选择1到3行</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df[<span class="string">&#x27;20130102&#x27;</span>:<span class="string">&#x27;20130104&#x27;</span>]</span><br></pre></td></tr></table></figure><p><strong>按标签选择</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.loc[dates[<span class="number">0</span>]]</span><br></pre></td></tr></table></figure><p>用标签选多列：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.loc[:,[<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;B&#x27;</span>]]</span><br></pre></td></tr></table></figure><p>用标签切片：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.loc[<span class="string">&#x27;20130102&#x27;</span>:<span class="string">&#x27;20130104&#x27;</span>,[<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;B&#x27;</span>]]</span><br></pre></td></tr></table></figure><p>提取标量：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df.loc[dates[<span class="number">0</span>],<span class="string">&#x27;A&#x27;</span>]</span><br><span class="line">df.at[dates[<span class="number">0</span>],<span class="string">&#x27;A&#x27;</span>]</span><br></pre></td></tr></table></figure><p><strong>按位置选</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.iloc[<span class="number">3</span>]</span><br></pre></td></tr></table></figure><p>用整数切片：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.iloc[<span class="number">3</span>:<span class="number">5</span>,<span class="number">0</span>:<span class="number">2</span>]</span><br></pre></td></tr></table></figure><p>用整数列表按位置切片：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.iloc[[<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>],[<span class="number">0</span>,<span class="number">2</span>]]</span><br></pre></td></tr></table></figure><p>按位置访问标量：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df.iloc[<span class="number">1</span>,<span class="number">1</span>]</span><br><span class="line">df.iat[<span class="number">1</span>,<span class="number">1</span>]</span><br></pre></td></tr></table></figure><p><strong>布尔索引</strong>：</p><p>用单列的值：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df[df.A&gt;<span class="number">0</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Out[<span class="number">39</span>]: </span><br><span class="line">                   A         B         C         D</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>  <span class="number">0.469112</span> <span class="number">-0.282863</span> <span class="number">-1.509059</span> <span class="number">-1.135632</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.212112</span> <span class="number">-0.173215</span>  <span class="number">0.119209</span> <span class="number">-1.044236</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">0.721555</span> <span class="number">-0.706771</span> <span class="number">-1.039575</span>  <span class="number">0.271860</span></span><br></pre></td></tr></table></figure><p>选择满足条件的值：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df[df&gt;<span class="number">0</span>]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Out[<span class="number">40</span>]: </span><br><span class="line">                   A         B         C         D</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>  <span class="number">0.469112</span>       NaN       NaN       NaN</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.212112</span>       NaN  <span class="number">0.119209</span>       NaN</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>       NaN       NaN       NaN  <span class="number">1.071804</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">0.721555</span>       NaN       NaN  <span class="number">0.271860</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>       NaN  <span class="number">0.567020</span>  <span class="number">0.276232</span>       NaN</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>       NaN  <span class="number">0.113648</span>       NaN  <span class="number">0.524988</span></span><br></pre></td></tr></table></figure><p><code>isin()</code>筛选</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df2 = df.copy()</span><br><span class="line">df2[<span class="string">&#x27;E&#x27;</span>] = [<span class="string">&#x27;one&#x27;</span>,<span class="string">&#x27;two&#x27;</span>,<span class="string">&#x27;three&#x27;</span>……]</span><br><span class="line">df2[df2[<span class="string">&#x27;E&#x27;</span>].isin([<span class="string">&#x27;one&#x27;</span>,<span class="string">&#x27;two&#x27;</span>])]</span><br></pre></td></tr></table></figure><h2 id="2-4-缺失值Nan"><a href="#2-4-缺失值Nan" class="headerlink" title="2.4 缺失值Nan"></a>2.4 缺失值Nan</h2><p><code>reindex</code>重建索引，不会修改源数据</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">df1 = df.reindex(index = dates[<span class="number">0</span>:<span class="number">4</span>],columns=list(df.columns)+[<span class="string">&#x27;E&#x27;</span>])</span><br><span class="line">df1.loc[dates[<span class="number">0</span>]:dates[<span class="number">1</span>],<span class="string">&#x27;E&#x27;</span>] = <span class="number">1</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Out[<span class="number">57</span>]: </span><br><span class="line">                   A         B         C  D    F    E</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>  <span class="number">0.000000</span>  <span class="number">0.000000</span> <span class="number">-1.509059</span>  <span class="number">5</span>  NaN  <span class="number">1.0</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>  <span class="number">1.212112</span> <span class="number">-0.173215</span>  <span class="number">0.119209</span>  <span class="number">5</span>  <span class="number">1.0</span>  <span class="number">1.0</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span> <span class="number">-0.861849</span> <span class="number">-2.104569</span> <span class="number">-0.494929</span>  <span class="number">5</span>  <span class="number">2.0</span>  NaN</span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>  <span class="number">0.721555</span> <span class="number">-0.706771</span> <span class="number">-1.039575</span>  <span class="number">5</span>  <span class="number">3.0</span>  NaN</span><br></pre></td></tr></table></figure><p>删除含缺失值的行：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1.dropna(how=<span class="string">&#x27;any&#x27;</span>)</span><br></pre></td></tr></table></figure><p>填充缺失值：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df1.fillna(value=<span class="number">5</span>)</span><br></pre></td></tr></table></figure><p>提取缺失值的布尔掩码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pd.isna(df1)</span><br></pre></td></tr></table></figure><h2 id="2-5-运算"><a href="#2-5-运算" class="headerlink" title="2.5 运算"></a>2.5 运算</h2><p>一般，运算时会排除缺失值</p><p>在列上计算<strong>平均值</strong>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.mean()</span><br></pre></td></tr></table></figure><p>在行上计算：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.mean(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Out[<span class="number">62</span>]: </span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-01</span>    <span class="number">0.872735</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-02</span>    <span class="number">1.431621</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-03</span>    <span class="number">0.707731</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-04</span>    <span class="number">1.395042</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-05</span>    <span class="number">1.883656</span></span><br><span class="line"><span class="number">2013</span><span class="number">-01</span><span class="number">-06</span>    <span class="number">1.592306</span></span><br><span class="line">Freq: D, dtype: float64</span><br></pre></td></tr></table></figure><p><strong>减法：</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s = pd.Series([<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,np.nan,<span class="number">6</span>,<span class="number">8</span>], index=dates).shift(<span class="number">2</span>)</span><br><span class="line">df.sub(s,axis=<span class="string">&#x27;index&#x27;</span>)</span><br></pre></td></tr></table></figure><p>s与df的index轴是相同的，或者说在行上他们数据的个数相同，所以，sub第二个参数填写index或者0，计算时，df每列都会减去s。</p><p><code>shift</code>函数是平移函数，s各个位置上的数向下平移，由于向下平移了两个位置，0和1位置上的数没有内容可以补，用nan自动替补。</p><p><strong>Apply函数</strong>：</p><p><code>DataFrame.apply()</code> 函数则会依次将每行或列取出来作为一个Series传递到apply指定的函数中。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">matrix = [</span><br><span class="line">    [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],</span><br><span class="line">    [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>],</span><br><span class="line">    [<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(matrix, columns=list(<span class="string">&#x27;xyz&#x27;</span>), index=list(<span class="string">&#x27;abc&#x27;</span>))</span><br><span class="line">df.apply(np.square)</span><br></pre></td></tr></table></figure><p>具体使用方法：</p><p><a href="https://www.jianshu.com/p/4fdd6eee1b06">pandas apply() 函数用法</a></p><p><strong>直方图与离散化：</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s = pd.Series(np.random.randint(<span class="number">0</span>,<span class="number">7</span>,size=<span class="number">10</span>))</span><br><span class="line">s.value_counts()<span class="comment">#统计s中整数的分布情况，比如4有5个</span></span><br></pre></td></tr></table></figure><p><strong>字符串方法：</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s = pd.Series([<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;Aaba&#x27;</span>, <span class="string">&#x27;Baca&#x27;</span>, np.nan, <span class="string">&#x27;CABA&#x27;</span>, <span class="string">&#x27;dog&#x27;</span>, <span class="string">&#x27;cat&#x27;</span>])</span><br><span class="line">s.str.lower()<span class="comment">#字符串小写</span></span><br></pre></td></tr></table></figure><h2 id="2-6-合并"><a href="#2-6-合并" class="headerlink" title="2.6 合并"></a>2.6 合并</h2><p><strong>结合：</strong></p><p><code>contact()</code>将零散的df合并，合并原则根据index和columns，相同合并，不同连接。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">df = pd.DataFrame(np.random.randn(<span class="number">10</span>, <span class="number">4</span>))</span><br><span class="line">pieces = [df[:<span class="number">3</span>], df[<span class="number">3</span>:<span class="number">7</span>], df[<span class="number">7</span>:]]</span><br><span class="line">pd.concat(pieces)</span><br></pre></td></tr></table></figure><p>连接：</p><p><code>join()</code>直接将连个df连接起来。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">79</span>]: left</span><br><span class="line">Out[<span class="number">79</span>]: </span><br><span class="line">   key  lval</span><br><span class="line"><span class="number">0</span>  foo     <span class="number">1</span></span><br><span class="line"><span class="number">1</span>  foo     <span class="number">2</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">80</span>]: right</span><br><span class="line">Out[<span class="number">80</span>]: </span><br><span class="line">   key  rval</span><br><span class="line"><span class="number">0</span>  foo     <span class="number">4</span></span><br><span class="line"><span class="number">1</span>  foo     <span class="number">5</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">81</span>]: pd.merge(left, right, on=<span class="string">&#x27;key&#x27;</span>)</span><br><span class="line">Out[<span class="number">81</span>]: </span><br><span class="line">   key  lval  rval</span><br><span class="line"><span class="number">0</span>  foo     <span class="number">1</span>     <span class="number">4</span></span><br><span class="line"><span class="number">1</span>  foo     <span class="number">1</span>     <span class="number">5</span></span><br><span class="line"><span class="number">2</span>  foo     <span class="number">2</span>     <span class="number">4</span></span><br><span class="line"><span class="number">3</span>  foo     <span class="number">2</span>     <span class="number">5</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">84</span>]: left</span><br><span class="line">Out[<span class="number">84</span>]: </span><br><span class="line">   key  lval</span><br><span class="line"><span class="number">0</span>  foo     <span class="number">1</span></span><br><span class="line"><span class="number">1</span>  bar     <span class="number">2</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">85</span>]: right</span><br><span class="line">Out[<span class="number">85</span>]: </span><br><span class="line">   key  rval</span><br><span class="line"><span class="number">0</span>  foo     <span class="number">4</span></span><br><span class="line"><span class="number">1</span>  bar     <span class="number">5</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">86</span>]: pd.merge(left, right, on=<span class="string">&#x27;key&#x27;</span>)</span><br><span class="line">Out[<span class="number">86</span>]: </span><br><span class="line">   key  lval  rval</span><br><span class="line"><span class="number">0</span>  foo     <span class="number">1</span>     <span class="number">4</span></span><br><span class="line"><span class="number">1</span>  bar     <span class="number">2</span>     <span class="number">5</span></span><br></pre></td></tr></table></figure><p><strong>追加：</strong></p><p><code>append()</code>为df追加行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.append(s,ignore_index=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><h2 id="2-7-分组"><a href="#2-7-分组" class="headerlink" title="2.7 分组"></a>2.7 分组</h2><p>按照某个column或columns，将df分组，然后结合df的函数分别计算各个分组。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">92</span>]: df</span><br><span class="line">Out[<span class="number">92</span>]: </span><br><span class="line">     A      B         C         D</span><br><span class="line"><span class="number">0</span>  foo    one <span class="number">-1.202872</span> <span class="number">-0.055224</span></span><br><span class="line"><span class="number">1</span>  bar    one <span class="number">-1.814470</span>  <span class="number">2.395985</span></span><br><span class="line"><span class="number">2</span>  foo    two  <span class="number">1.018601</span>  <span class="number">1.552825</span></span><br><span class="line"><span class="number">3</span>  bar  three <span class="number">-0.595447</span>  <span class="number">0.166599</span></span><br><span class="line"><span class="number">4</span>  foo    two  <span class="number">1.395433</span>  <span class="number">0.047609</span></span><br><span class="line"><span class="number">5</span>  bar    two <span class="number">-0.392670</span> <span class="number">-0.136473</span></span><br><span class="line"><span class="number">6</span>  foo    one  <span class="number">0.007207</span> <span class="number">-0.561757</span></span><br><span class="line"><span class="number">7</span>  foo  three  <span class="number">1.928123</span> <span class="number">-1.623033</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">93</span>]: df.groupby(<span class="string">&#x27;A&#x27;</span>).sum()</span><br><span class="line">Out[<span class="number">93</span>]: </span><br><span class="line">            C        D</span><br><span class="line">A                     </span><br><span class="line">bar <span class="number">-2.802588</span>  <span class="number">2.42611</span></span><br><span class="line">foo  <span class="number">3.146492</span> <span class="number">-0.63958</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">94</span>]: df.groupby([<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>]).sum()</span><br><span class="line">Out[<span class="number">94</span>]: </span><br><span class="line">                  C         D</span><br><span class="line">A   B                        </span><br><span class="line">bar one   <span class="number">-1.814470</span>  <span class="number">2.395985</span></span><br><span class="line">    three <span class="number">-0.595447</span>  <span class="number">0.166599</span></span><br><span class="line">    two   <span class="number">-0.392670</span> <span class="number">-0.136473</span></span><br><span class="line">foo one   <span class="number">-1.195665</span> <span class="number">-0.616981</span></span><br><span class="line">    three  <span class="number">1.928123</span> <span class="number">-1.623033</span></span><br><span class="line">    two    <span class="number">2.414034</span>  <span class="number">1.600434</span></span><br></pre></td></tr></table></figure><h2 id="2-8-重塑"><a href="#2-8-重塑" class="headerlink" title="2.8 重塑"></a>2.8 重塑</h2>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pandas </tag>
            
            <tag> 数据处理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自定义Volantis主题页脚</title>
      <link href="/2020/10/10/%E8%87%AA%E5%AE%9A%E4%B9%89Volantis%E4%B8%BB%E9%A2%98%E9%A1%B5%E8%84%9A/"/>
      <url>/2020/10/10/%E8%87%AA%E5%AE%9A%E4%B9%89Volantis%E4%B8%BB%E9%A2%98%E9%A1%B5%E8%84%9A/</url>
      
        <content type="html"><![CDATA[<p>修改主题文件下的<code>_config.yml</code></p><p>找到页脚部分：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">############################### Site Footer ############################### &gt; start</span></span><br><span class="line"><span class="attr">site_footer:</span></span><br><span class="line">  <span class="comment"># layout of footer: [aplayer, social, license, info, copyright,analytics]</span></span><br><span class="line">  <span class="attr">layout:</span> [<span class="string">custom</span>]</span><br><span class="line">  <span class="comment">#custom</span></span><br><span class="line">  <span class="attr">custom:</span> <span class="string">&#x27;&lt;a style=&quot;padding-right: 1%;&quot; href=&quot;https://hexo.io/&quot;&gt;&lt;img src=&quot;https://img.shields.io/badge/Powered-Hexo-red&quot;&gt;&lt;/a&gt;&lt;a style=&quot;padding-right: 1%;&quot; href=&quot;https://volantis.js.org/&quot;&gt;&lt;img src=&quot;https://img.shields.io/badge/Theme-Volantis-blue&quot;&gt;&lt;/a&gt;&lt;a style=&quot;padding-right: 1%;&quot; href=&quot;https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh&quot;&gt;&lt;img src=&quot;https://img.shields.io/badge/License-CC%20BY--NC--SA%204.0-success&quot;&gt;&lt;/a&gt;&lt;a style=&quot;padding-right: 1%;&quot; href=&quot;https://sci.ci&quot;&gt;&lt;img src=&quot;https://img.shields.io/badge/Copyright-2019--2020%20QF-orange&quot;&gt;&lt;/a&gt;&#x27;</span></span><br><span class="line">  <span class="attr">br:</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span></span><br><span class="line"><span class="comment">############################### Site Footer ############################### &gt; end</span></span><br></pre></td></tr></table></figure><p>修改后效果：</p><p><img src="https://i.loli.net/2020/10/11/EpAmYXzWi3OGDHc.png" class="lazyload" data-srcset="https://i.loli.net/2020/10/11/EpAmYXzWi3OGDHc.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>]]></content>
      
      
      <categories>
          
          <category> 网站编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Volantis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>正则表达式</title>
      <link href="/2020/09/30/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/"/>
      <url>/2020/09/30/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="1：简介"><a href="#1：简介" class="headerlink" title="1：简介"></a>1：简介</h1><p>正则表达式，常用于匹配包含一定规律的字符串，可以从字符串中提取符合规律的字符串段，或者返回是否符合要求。也可用于替换字符串。</p><p>比如，我们设置密码时，网站通常要求，密码为字母+数字+下划线组合，并且具有一定长度如3到15位，那么它的正则表达式可以是，<code>^[a-z0-9_-]&#123;3-15&#125;$</code></p><p>其中<code>^</code>表示从开头开始匹配，<code>[a-z0-9_-]</code>表示匹配字母，数字，下划线和连接符，<code>$</code>表示匹配结束。<code>&#123;3-15&#125;</code>表示匹配3到15个字符。完整意义：从开头开始匹配，匹配包括字母数字下划线和连接符，总共15个字符。</p><h1 id="2：语法"><a href="#2：语法" class="headerlink" title="2：语法"></a>2：语法</h1><p><code>*</code>表示匹配0个或多个字符。*<em>qife</em>i**可以匹配：qifei, qifi,qifeeeei</p><p><code>?</code>表示匹配0个或1个字符。qife?i可以匹配：qifi, qifei</p><p><code>+ </code>匹配一个或者多个字符。qife+i可以匹配：qifei,qifeeeei</p><p><code>[]</code>单字符满足[]中的要求，则匹配。<code>[aui]*</code>表示字符串中aui都会被匹配出来</p><table><thead><tr><th align="left">字符</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">[ABC]</td><td align="left">匹配 <strong>[…]</strong> 中的所有字符，例如 <strong>[aeiou]</strong> 匹配字符串 “google runoob taobao” 中所有的 e o u a 字母。</td></tr><tr><td align="left">[^ABC]</td><td align="left">匹配除了 <strong>[…]</strong> 中字符的所有字符，例如 <strong>[^aeiou]</strong> 匹配字符串 “google runoob taobao” 中除了 e o u a 字母的所有字母。</td></tr><tr><td align="left">[A-Z]</td><td align="left">[A-Z] 表示一个区间，匹配所有大写字母，[a-z] 表示所有小写字母。</td></tr><tr><td align="left">.</td><td align="left">匹配除换行符（\n、\r）之外的任何单个字符，相等于 [^\n\r]</td></tr><tr><td align="left">[\s\S]</td><td align="left">匹配所有。\s 是匹配所有空白符，包括换行，\S 非空白符，包括换行。</td></tr><tr><td align="left">\w</td><td align="left">匹配字母、数字、下划线。等价于 [A-Za-z0-9_]</td></tr></tbody></table><table><thead><tr><th align="left">特别字符</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">$</td><td align="left">匹配输入字符串的结尾位置。如果设置了 RegExp 对象的 Multiline 属性，则 $ 也匹配 ‘\n’ 或 ‘\r’。要匹配 $ 字符本身，请使用 $。</td></tr><tr><td align="left">( )</td><td align="left">标记一个子表达式的开始和结束位置。子表达式可以获取供以后使用。要匹配这些字符，请使用 ( 和 )。</td></tr><tr><td align="left">*</td><td align="left">匹配前面的子表达式零次或多次。要匹配 * 字符，请使用 *。</td></tr><tr><td align="left">+</td><td align="left">匹配前面的子表达式一次或多次。要匹配 + 字符，请使用 +。</td></tr><tr><td align="left">.</td><td align="left">匹配除换行符 \n 之外的任何单字符。要匹配 . ，请使用 . 。</td></tr><tr><td align="left">[</td><td align="left">标记一个中括号表达式的开始。要匹配 [，请使用 [。</td></tr><tr><td align="left">?</td><td align="left">匹配前面的子表达式零次或一次，或指明一个非贪婪限定符。要匹配 ? 字符，请使用 ?。</td></tr><tr><td align="left">\</td><td align="left">将下一个字符标记为或特殊字符、或原义字符、或向后引用、或八进制转义符。例如， ‘n’ 匹配字符 ‘n’。’\n’ 匹配换行符。序列 ‘\‘ 匹配 “&quot;，而 ‘(‘ 则匹配 “(“。</td></tr><tr><td align="left">^</td><td align="left">匹配输入字符串的开始位置，除非在方括号表达式中使用，当该符号在方括号表达式中使用时，表示不接受该方括号表达式中的字符集合。要匹配 ^ 字符本身，请使用 ^。</td></tr><tr><td align="left">{</td><td align="left">标记限定符表达式的开始。要匹配 {，请使用 {。</td></tr><tr><td align="left">|</td><td align="left">指明两项之间的一个选择。要匹配 |，请使用 |。</td></tr></tbody></table><p><code>()</code>选择：使用<code>()</code>给需要选择到的匹配项分组，选择项，可使用列表索引获取每个选择项，匹配的值。</p><h1 id="3：元字符"><a href="#3：元字符" class="headerlink" title="3：元字符"></a>3：元字符</h1><table><thead><tr><th align="left">字符</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">\</td><td align="left">将下一个字符标记为一个特殊字符、或一个原义字符、或一个 向后引用、或一个八进制转义符。例如，’n’ 匹配字符 “n”。’\n’ 匹配一个换行符。序列 ‘\‘ 匹配 “&quot; 而 “(“ 则匹配 “(“。</td></tr><tr><td align="left">^</td><td align="left">匹配输入字符串的开始位置。如果设置了 RegExp 对象的 Multiline 属性，^ 也匹配 ‘\n’ 或 ‘\r’ 之后的位置。</td></tr><tr><td align="left">$</td><td align="left">匹配输入字符串的结束位置。如果设置了RegExp 对象的 Multiline 属性，$ 也匹配 ‘\n’ 或 ‘\r’ 之前的位置。</td></tr><tr><td align="left">*</td><td align="left">匹配前面的子表达式零次或多次。例如，zo* 能匹配 “z” 以及 “zoo”。* 等价于{0,}。</td></tr><tr><td align="left">+</td><td align="left">匹配前面的子表达式一次或多次。例如，’zo+’ 能匹配 “zo” 以及 “zoo”，但不能匹配 “z”。+ 等价于 {1,}。</td></tr><tr><td align="left">?</td><td align="left">匹配前面的子表达式零次或一次。例如，”do(es)?” 可以匹配 “do” 或 “does” 。? 等价于 {0,1}。</td></tr><tr><td align="left">{n}</td><td align="left">n 是一个非负整数。匹配确定的 n 次。例如，’o{2}’ 不能匹配 “Bob” 中的 ‘o’，但是能匹配 “food” 中的两个 o。</td></tr><tr><td align="left">{n,}</td><td align="left">n 是一个非负整数。至少匹配n 次。例如，’o{2,}’ 不能匹配 “Bob” 中的 ‘o’，但能匹配 “foooood” 中的所有 o。’o{1,}’ 等价于 ‘o+’。’o{0,}’ 则等价于 ‘o*’。</td></tr><tr><td align="left">{n,m}</td><td align="left">m 和 n 均为非负整数，其中n &lt;= m。最少匹配 n 次且最多匹配 m 次。例如，”o{1,3}” 将匹配 “fooooood” 中的前三个 o。’o{0,1}’ 等价于 ‘o?’。请注意在逗号和两个数之间不能有空格。</td></tr><tr><td align="left">?</td><td align="left">当该字符紧跟在任何一个其他限制符 (*, +, ?, {n}, {n,}, {n,m}) 后面时，匹配模式是非贪婪的。非贪婪模式尽可能少的匹配所搜索的字符串，而默认的贪婪模式则尽可能多的匹配所搜索的字符串。例如，对于字符串 “oooo”，’o+?’ 将匹配单个 “o”，而 ‘o+’ 将匹配所有 ‘o’。</td></tr><tr><td align="left">.</td><td align="left">匹配除换行符（\n、\r）之外的任何单个字符。要匹配包括 ‘\n’ 在内的任何字符，请使用像”<strong>(.|\n)</strong>“的模式。</td></tr><tr><td align="left">(pattern)</td><td align="left">匹配 pattern 并获取这一匹配。所获取的匹配可以从产生的 Matches 集合得到，在VBScript 中使用 SubMatches 集合，在JScript 中则使用 $0…$9 属性。要匹配圆括号字符，请使用 ‘(‘ 或 ‘)‘。</td></tr><tr><td align="left">(?:pattern)</td><td align="left">匹配 pattern 但不获取匹配结果，也就是说这是一个非获取匹配，不进行存储供以后使用。这在使用 “或” 字符 (|) 来组合一个模式的各个部分是很有用。例如， ‘industr(?:y|ies) 就是一个比 ‘industry|industries’ 更简略的表达式。</td></tr><tr><td align="left">(?=pattern)</td><td align="left">正向肯定预查（look ahead positive assert），在任何匹配pattern的字符串开始处匹配查找字符串。这是一个非获取匹配，也就是说，该匹配不需要获取供以后使用。例如，”Windows(?=95|98|NT|2000)”能匹配”Windows2000”中的”Windows”，但不能匹配”Windows3.1”中的”Windows”。预查不消耗字符，也就是说，在一个匹配发生后，在最后一次匹配之后立即开始下一次匹配的搜索，而不是从包含预查的字符之后开始。</td></tr><tr><td align="left">(?!pattern)</td><td align="left">正向否定预查(negative assert)，在任何不匹配pattern的字符串开始处匹配查找字符串。这是一个非获取匹配，也就是说，该匹配不需要获取供以后使用。例如”Windows(?!95|98|NT|2000)”能匹配”Windows3.1”中的”Windows”，但不能匹配”Windows2000”中的”Windows”。预查不消耗字符，也就是说，在一个匹配发生后，在最后一次匹配之后立即开始下一次匹配的搜索，而不是从包含预查的字符之后开始。</td></tr><tr><td align="left">(?&lt;=pattern)</td><td align="left">反向(look behind)肯定预查，与正向肯定预查类似，只是方向相反。例如，”`(?&lt;=95</td></tr><tr><td align="left">(?&lt;!pattern)</td><td align="left">反向否定预查，与正向否定预查类似，只是方向相反。例如”`(?&lt;!95</td></tr><tr><td align="left">x|y</td><td align="left">匹配 x 或 y。例如，’z|food’ 能匹配 “z” 或 “food”。’(z|f)ood’ 则匹配 “zood” 或 “food”。</td></tr><tr><td align="left">[xyz]</td><td align="left">字符集合。匹配所包含的任意一个字符。例如， ‘[abc]’ 可以匹配 “plain” 中的 ‘a’。</td></tr><tr><td align="left">[^xyz]</td><td align="left">负值字符集合。匹配未包含的任意字符。例如， ‘[^abc]’ 可以匹配 “plain” 中的’p’、’l’、’i’、’n’。</td></tr><tr><td align="left">[a-z]</td><td align="left">字符范围。匹配指定范围内的任意字符。例如，’[a-z]’ 可以匹配 ‘a’ 到 ‘z’ 范围内的任意小写字母字符。</td></tr><tr><td align="left">[^a-z]</td><td align="left">负值字符范围。匹配任何不在指定范围内的任意字符。例如，’[^a-z]’ 可以匹配任何不在 ‘a’ 到 ‘z’ 范围内的任意字符。</td></tr><tr><td align="left">\b</td><td align="left">匹配一个单词边界，也就是指单词和空格间的位置。例如， ‘er\b’ 可以匹配”never” 中的 ‘er’，但不能匹配 “verb” 中的 ‘er’。</td></tr><tr><td align="left">\B</td><td align="left">匹配非单词边界。’er\B’ 能匹配 “verb” 中的 ‘er’，但不能匹配 “never” 中的 ‘er’。</td></tr><tr><td align="left">\cx</td><td align="left">匹配由 x 指明的控制字符。例如， \cM 匹配一个 Control-M 或回车符。x 的值必须为 A-Z 或 a-z 之一。否则，将 c 视为一个原义的 ‘c’ 字符。</td></tr><tr><td align="left">\d</td><td align="left">匹配一个数字字符。等价于 [0-9]。</td></tr><tr><td align="left">\D</td><td align="left">匹配一个非数字字符。等价于 [^0-9]。</td></tr><tr><td align="left">\f</td><td align="left">匹配一个换页符。等价于 \x0c 和 \cL。</td></tr><tr><td align="left">\n</td><td align="left">匹配一个换行符。等价于 \x0a 和 \cJ。</td></tr><tr><td align="left">\r</td><td align="left">匹配一个回车符。等价于 \x0d 和 \cM。</td></tr><tr><td align="left">\s</td><td align="left">匹配任何空白字符，包括空格、制表符、换页符等等。等价于 [ \f\n\r\t\v]。</td></tr><tr><td align="left">\S</td><td align="left">匹配任何非空白字符。等价于 [^ \f\n\r\t\v]。</td></tr><tr><td align="left">\t</td><td align="left">匹配一个制表符。等价于 \x09 和 \cI。</td></tr><tr><td align="left">\v</td><td align="left">匹配一个垂直制表符。等价于 \x0b 和 \cK。</td></tr><tr><td align="left">\w</td><td align="left">匹配字母、数字、下划线。等价于’[A-Za-z0-9_]’。</td></tr><tr><td align="left">\W</td><td align="left">匹配非字母、数字、下划线。等价于 ‘[^A-Za-z0-9_]’。</td></tr><tr><td align="left">\xn</td><td align="left">匹配 n，其中 n 为十六进制转义值。十六进制转义值必须为确定的两个数字长。例如，’\x41’ 匹配 “A”。’\x041’ 则等价于 ‘\x04’ &amp; “1”。正则表达式中可以使用 ASCII 编码。</td></tr><tr><td align="left">\num</td><td align="left">匹配 num，其中 num 是一个正整数。对所获取的匹配的引用。例如，’(.)\1’ 匹配两个连续的相同字符。</td></tr><tr><td align="left">\n</td><td align="left">标识一个八进制转义值或一个向后引用。如果 \n 之前至少 n 个获取的子表达式，则 n 为向后引用。否则，如果 n 为八进制数字 (0-7)，则 n 为一个八进制转义值。</td></tr><tr><td align="left">\nm</td><td align="left">标识一个八进制转义值或一个向后引用。如果 \nm 之前至少有 nm 个获得子表达式，则 nm 为向后引用。如果 \nm 之前至少有 n 个获取，则 n 为一个后跟文字 m 的向后引用。如果前面的条件都不满足，若 n 和 m 均为八进制数字 (0-7)，则 \nm 将匹配八进制转义值 nm。</td></tr><tr><td align="left">\nml</td><td align="left">如果 n 为八进制数字 (0-3)，且 m 和 l 均为八进制数字 (0-7)，则匹配八进制转义值 nml。</td></tr><tr><td align="left">\un</td><td align="left">匹配 n，其中 n 是一个用四个十六进制数字表示的 Unicode 字符。例如， \u00A9 匹配版权符号 (?)。</td></tr></tbody></table><h1 id="4：在线测试"><a href="#4：在线测试" class="headerlink" title="4：在线测试"></a>4：在线测试</h1><p><a href="http://c.runoob.com/front-end/854">http://c.runoob.com/front-end/854</a></p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 正则表达式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python数据分析</title>
      <link href="/2020/09/29/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/"/>
      <url>/2020/09/29/Python%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="1：综述"><a href="#1：综述" class="headerlink" title="1：综述"></a>1：综述</h1><p><strong>为什么学习数据分析</strong></p><ol><li>岗位需求</li><li>python数据科学的基础</li><li>机器学习的课程基础</li></ol><p><strong>什么是数据分析</strong></p><p>用适当的方法对收集的大量数据进行分析</p><p>帮助人们做出判断，以便采取适当的行动</p><p><strong>jupyter notebook：</strong></p><p>Python笔记软件</p><h1 id="2：Matplotlib"><a href="#2：Matplotlib" class="headerlink" title="2：Matplotlib"></a>2：Matplotlib</h1><ol><li><p>将数据<strong>可视化</strong>，更<strong>直观</strong>的呈现</p></li><li><p>使数据更加<strong>客观</strong>、更具<strong>说服力</strong></p></li></ol><p>最流行的python底层绘图库，主要做数据可视化，模仿matlab构建</p><p><img src="https://i.loli.net/2020/09/30/LdSCfpJHt2ux7yM.png" class="lazyload" data-srcset="https://i.loli.net/2020/09/30/LdSCfpJHt2ux7yM.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt<span class="comment">#导入pyplot</span></span><br><span class="line"></span><br><span class="line">x = range(<span class="number">2</span>,<span class="number">26</span>,<span class="number">2</span>)<span class="comment">#数据在x轴的位置，是一个可迭代的对</span></span><br><span class="line">y = [<span class="number">15</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">17</span>,<span class="number">20</span>,<span class="number">25</span>,<span class="number">26</span>,<span class="number">26</span>,<span class="number">25</span>,<span class="number">22</span>,<span class="number">18</span>,<span class="number">15</span>]<span class="comment">#数据在y轴的位置，是一个可迭代的对象</span></span><br><span class="line">plt.plot(x,y)<span class="comment">#传入x和y，通过plot绘制出折线图</span></span><br><span class="line">plt.show()<span class="comment">#执行程序的时候展现图像</span></span><br></pre></td></tr></table></figure><p><strong>目前存在的问题：</strong></p><ol><li>图片大小</li><li>保存到本地</li><li>描述信息，比如x，y轴表示什么</li><li>刻度</li><li>线条样式</li><li>标记特殊点</li></ol><h2 id="2-1-设置图片大小-figure"><a href="#2-1-设置图片大小-figure" class="headerlink" title="2.1 设置图片大小-figure"></a>2.1 设置图片大小-figure</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fig = plt.figure(figsize=(<span class="number">20</span>,<span class="number">8</span>),dpi=<span class="number">80</span>)</span><br><span class="line"><span class="comment">#figure图形图标的意思，这里指画的图</span></span><br><span class="line"><span class="comment">#通过实例化一个figure并且传入参数</span></span><br><span class="line"><span class="comment">#传入像素值，dpi，让图片更清晰</span></span><br><span class="line">plt.plot(x,y)</span><br><span class="line">plt.savefig(<span class="string">&quot;./t1.png&quot;</span>)<span class="comment">#保存图片</span></span><br><span class="line"><span class="comment">#可以保存为svg矢量图格式，放大不会失真</span></span><br></pre></td></tr></table></figure><h2 id="2-2-设置x，y轴步长-xticks-yticks"><a href="#2-2-设置x，y轴步长-xticks-yticks" class="headerlink" title="2.2 设置x，y轴步长-xticks/yticks"></a>2.2 设置x，y轴步长-xticks/yticks</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">plt.xticks(x)<span class="comment">#设置步长</span></span><br><span class="line">plt.xticks(range(<span class="number">2</span>,<span class="number">25</span>))</span><br><span class="line">_xticks_labels = [i/<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>,<span class="number">49</span>)]</span><br><span class="line">plt.xticks(_xticks_labels[::<span class="number">3</span>])</span><br><span class="line"></span><br><span class="line">plt.yticks(range(min(y),max(y)+<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#显示字符串</span></span><br><span class="line">_x = list(x)[::<span class="number">3</span>]</span><br><span class="line">_xticks_labels = [<span class="string">&quot;10点&#123;&#125;分&quot;</span>.format(i) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">60</span>)]</span><br><span class="line">_xticks_labels += [<span class="string">&quot;11点&#123;&#125;分&quot;</span>.format(i) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">60</span>)]</span><br><span class="line">plt.xticks(list(_x)[::<span class="number">3</span>],_xticks_labels[::<span class="number">3</span>],rotation=<span class="number">90</span>)<span class="comment">#,前为步长列表，，后为字符串列表，与步长列表一一对应，并把刻度旋转90度显示。</span></span><br></pre></td></tr></table></figure><p><strong>上述绘图，无法显示中文</strong></p><h2 id="2-3-加入中文字体支持-FontProperties"><a href="#2-3-加入中文字体支持-FontProperties" class="headerlink" title="2.3 加入中文字体支持-FontProperties"></a>2.3 加入中文字体支持-FontProperties</h2><p>方法1：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib</span><br><span class="line">font = &#123;<span class="string">&#x27;family&#x27;</span>:<span class="string">&#x27;MicroSoft YaHei&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;weight&#x27;</span>:<span class="string">&#x27;bold&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;size&#x27;</span>:<span class="string">&#x27;larger&#x27;</span>&#125;</span><br><span class="line">matplotlib.rc(<span class="string">&quot;font&quot;</span>,**font)<span class="comment">#**可以把字典转为xx=xx格式</span></span><br><span class="line">matplotlib.rc(<span class="string">&quot;font&quot;</span>,family=<span class="string">&#x27;MicroSoft YaHei&#x27;</span>,weight=<span class="string">&#x27;bold&#x27;</span>)</span><br></pre></td></tr></table></figure><p>方法2：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> font_manager</span><br><span class="line">my_font = font_manager.FontProperties(fname=<span class="string">&quot;/System/Library/Fonts/PingFang.ttc&quot;</span>)<span class="comment">#设定字体位置</span></span><br><span class="line"><span class="comment">#查找系统字体存放位置</span></span><br><span class="line">plt.xticks(list(_x)[::<span class="number">3</span>],_xticks_labels[::<span class="number">3</span>],rotation=<span class="number">90</span>,fontproperties=my_font)</span><br><span class="line"><span class="comment">#使用字体</span></span><br></pre></td></tr></table></figure><h2 id="2-4-加入描述信息-xlabel-ylabel-title"><a href="#2-4-加入描述信息-xlabel-ylabel-title" class="headerlink" title="2.4 加入描述信息-xlabel/ylabel/title"></a>2.4 加入描述信息-xlabel/ylabel/title</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">plt.xlabel(<span class="string">&quot;时间&quot;</span>,fontproperties=my_font)</span><br><span class="line">plt.ylabel(<span class="string">&quot;温度 单位（℃）&quot;</span>,fontproperties=my_font)</span><br><span class="line">plt.title(<span class="string">&quot;10点到12点的请问变化&quot;</span>,fontproperties=my_font)</span><br></pre></td></tr></table></figure><h2 id="2-5-设置网格-grid"><a href="#2-5-设置网格-grid" class="headerlink" title="2.5 设置网格-grid"></a>2.5 设置网格-grid</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plt.grid()</span><br><span class="line">plt.grid(alpha=<span class="number">0.4</span>)<span class="comment">#设置网格透明度，1不透明，0透明</span></span><br></pre></td></tr></table></figure><h2 id="2-6-绘制两个图形-legend"><a href="#2-6-绘制两个图形-legend" class="headerlink" title="2.6 绘制两个图形-legend"></a>2.6 绘制两个图形-legend</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">plt.plot(x,y1,label=<span class="string">&quot;自己&quot;</span>,color=<span class="string">&quot;orange&quot;</span>,linestyle=<span class="string">&quot;:&quot;</span>)</span><br><span class="line">plt.plot(x,y2,label=<span class="string">&quot;同桌&quot;</span>,color=<span class="string">&quot;r&quot;</span>,linestyle=<span class="string">&quot;--&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#添加图例，解释哪个线表示哪个数据集，显示中文，格式不再是FontProperties</span></span><br><span class="line"><span class="comment">#prop字体，loc位置：0最好的位置，不设置参数则默认0</span></span><br><span class="line">plt.legend(prop=my_font,loc=<span class="number">0</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>color=’r’    颜色</p><p>linestyle=’–’    线条风格：-实线；–虚线；-.点划线；:点虚线；留空或空格，表示无线条</p><p>linewidth=5    线粗细</p><p>alpha=0.4    透明度</p></blockquote><h2 id="2-7-绘制散点图-scatter"><a href="#2-7-绘制散点图-scatter" class="headerlink" title="2.7 绘制散点图-scatter"></a>2.7 绘制散点图-scatter</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plt.scatter(x, y)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h2 id="2-8-绘制柱状图-bar"><a href="#2-8-绘制柱状图-bar" class="headerlink" title="2.8 绘制柱状图-bar"></a>2.8 绘制柱状图-bar</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#绘制电影与其对应票房</span></span><br><span class="line">a=[<span class="string">&quot;战狼2&quot;</span>,<span class="string">&quot;速度与激情8&quot;</span>,<span class="string">&quot;功夫瑜伽&quot;</span>,<span class="string">&quot;西游附魔篇&quot;</span>]</span><br><span class="line">b=[<span class="number">56</span>,<span class="number">61</span>,<span class="number">26</span>,<span class="number">94</span>]</span><br><span class="line">plt.figure(figsize=(<span class="number">20</span>,<span class="number">15</span>),dpi=<span class="number">80</span>)</span><br><span class="line"><span class="comment">#绘制柱状图</span></span><br><span class="line">plt.bar(range(a),b,width=<span class="number">0.3</span>)</span><br><span class="line"><span class="comment">#设置横轴字符串</span></span><br><span class="line">plt.xticks(range(a),a,rotation=<span class="number">45</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h2 id="2-9-绘制条形图-barh"><a href="#2-9-绘制条形图-barh" class="headerlink" title="2.9 绘制条形图-barh"></a>2.9 绘制条形图-barh</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">plt.barh(range(len(a)),b,height=<span class="number">0.3</span>,color=<span class="string">&#x27;orange&#x27;</span>)</span><br><span class="line">plt.yticks(range(len(a)),a)</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2020/10/01/EFdtgolApGN7qPa.png" class="lazyload" data-srcset="https://i.loli.net/2020/10/01/EFdtgolApGN7qPa.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h2 id="2-10-绘制直方图-hist"><a href="#2-10-绘制直方图-hist" class="headerlink" title="2.10 绘制直方图-hist"></a>2.10 绘制直方图-hist</h2><p>有250部电影的时长，统计时长分布的数量，比如100到120分钟的电影数。</p><p>组数=极差/组距。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">120</span>,<span class="number">76</span>,<span class="number">124</span>,<span class="number">161</span>……]<span class="comment">#250部电影的时长。</span></span><br><span class="line"><span class="comment">#计算组数</span></span><br><span class="line">theory_d = <span class="number">3</span><span class="comment">#假定组距</span></span><br><span class="line">num_bins = (max(a)-min(a))//d<span class="comment">#计算组数</span></span><br><span class="line"></span><br><span class="line">plt.figure(figsize = (<span class="number">20</span>,<span class="number">8</span>),dpi=<span class="number">80</span>)</span><br><span class="line">plt.hist(a,num_bins)<span class="comment">#频数分布直方图</span></span><br><span class="line">plt.hist(a,num_bins,normed=<span class="literal">True</span>)<span class="comment">#频率分布直方图</span></span><br><span class="line"><span class="comment">#设置x刻度</span></span><br><span class="line">plt.xticks(range(min(a),max(a)+d,d))</span><br><span class="line">plt.grid()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><blockquote><p>当（最大值-最小值）/假定组距 无法除尽时，根据假定组距绘制的x刻度会偏移。</p></blockquote><p>2.11 绘制其他图形</p><p><a href="https://matplotlib.org/gallery/index.html">https://matplotlib.org/gallery/index.html</a></p><p>前端画图库js——echarts：</p><p><a href="https://echarts.apache.org/examples/zh/index.html">https://echarts.apache.org/examples/zh/index.html</a></p><p>图表代码托管——Plotly:<br><a href="https://plot.ly/python">https://plot.ly/python</a></p><h1 id="2：Numpy"><a href="#2：Numpy" class="headerlink" title="2：Numpy"></a>2：Numpy</h1><p><strong>什么时numpy？</strong></p><p>一个再python中做科学计算的基础库，重在数值计算，也是大部分python科学计算库的基础库，多用于在大型、多维数组上执行数值计算。</p><h2 id="2-1-创建数组："><a href="#2-1-创建数组：" class="headerlink" title="2.1 创建数组："></a>2.1 创建数组：</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">a = np.array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">b = np.array(range(<span class="number">10</span>))</span><br><span class="line">c = np.arange(<span class="number">10</span>)<span class="comment">#作用与b的表达式相同</span></span><br><span class="line"></span><br><span class="line">print(a)</span><br><span class="line">print(type(a))</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>结果：</p><p>[1 2 3]</p><p>&lt;class ‘nmpy.ndarray’&gt;</p></blockquote><h2 id="2-2-数据类型"><a href="#2-2-数据类型" class="headerlink" title="2.2 数据类型"></a>2.2 数据类型</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">d = np.array(range(<span class="number">1</span>,<span class="number">4</span>),dtype=<span class="string">&quot;float32&quot;</span>)<span class="comment">#dtype指定数组中数据的数据类型</span></span><br><span class="line">e = np.array([<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>],dtype=bool)</span><br><span class="line">print(e.dtype)<span class="comment">#打印数组中数据的数据类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#调整数据类型</span></span><br><span class="line">f = d.astype(<span class="string">&quot;int8&quot;</span>)</span><br></pre></td></tr></table></figure><p>修改浮点型的小数位数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a &#x3D; np.array(random.random() for i in range(10))</span><br><span class="line">np.round(a,2)</span><br></pre></td></tr></table></figure><h2 id="2-3-数组形状"><a href="#2-3-数组形状" class="headerlink" title="2.3 数组形状"></a>2.3 数组形状</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">t1 = np.array([[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]])</span><br><span class="line">t1.shape</span><br><span class="line"><span class="comment">#out:(2,3)</span></span><br></pre></td></tr></table></figure><p><strong>数组的形状</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">t2 = np.arange(<span class="number">12</span>)<span class="comment">#新建一维数组</span></span><br><span class="line">t3 = t2.reshape(<span class="number">3</span>,<span class="number">4</span>)<span class="comment">#变为二维的</span></span><br><span class="line">t4 = t2.reshape(<span class="number">24</span>,)<span class="comment">#变一维数组</span></span><br><span class="line">t5 = t2.flatten()<span class="comment">#变一维数组</span></span><br></pre></td></tr></table></figure><h2 id="2-4-数组计算"><a href="#2-4-数组计算" class="headerlink" title="2.4 数组计算"></a>2.4 数组计算</h2><p><strong>数组和数</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">t6 = np.arange(<span class="number">24</span>)</span><br><span class="line">t7 = t6.reshape(<span class="number">4</span>,<span class="number">6</span>)</span><br><span class="line">t7+<span class="number">2</span><span class="comment">#数组中每个数都加2</span></span><br><span class="line">t7*<span class="number">2</span><span class="comment">#每个数都乘2</span></span><br><span class="line">t7/<span class="number">2</span><span class="comment">#每个数都除2，会得到浮点数</span></span><br></pre></td></tr></table></figure><p><strong>数组和数组</strong></p><p>形状相同：(4,6)与(4,6)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">t8 = np.arange(<span class="number">100</span>,<span class="number">124</span>).reshape(<span class="number">4</span>,<span class="number">6</span>)</span><br><span class="line">t7+t8<span class="comment">#形状相同，行列相同的数值进行运算</span></span><br><span class="line">t7*t8</span><br></pre></td></tr></table></figure><p>(4,6)与(,6)</p><p><img src="https://i.loli.net/2020/10/03/FXmBQap341rgTOf.png" class="lazyload" data-srcset="https://i.loli.net/2020/10/03/FXmBQap341rgTOf.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>(4,6)与(4,1)</p><p><img src="https://i.loli.net/2020/10/03/7iFszdVEr3KNZYf.png" class="lazyload" data-srcset="https://i.loli.net/2020/10/03/7iFszdVEr3KNZYf.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><strong>广播原则：</strong></p><p>如果两个数组的后缘维度，即从末尾开始算起的维度的轴长度相符或其中一方的长度为1，则认为他们是广播兼容的。广播会在缺失和或长度为1的维度上进行</p><h2 id="2-5-读取数据"><a href="#2-5-读取数据" class="headerlink" title="2.5 读取数据"></a>2.5 读取数据</h2><p><strong>轴</strong></p><p>一维数组只有一个轴，即0轴</p><p>二维数组有两个轴，0和1轴。(2,5)，2是0轴长度，5是1轴长度</p><p>三维数组有三个轴，0，1，2轴</p><p><strong>读取数据</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np.loadtxt(frame,dtype=np.float,delimiter=<span class="literal">None</span>,skiprows=<span class="number">0</span>,usecols=<span class="literal">None</span>,unpack=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>frame：文件、字符串或产生器</p><p>dtype：数据类型</p><p>dlimiter：分割字符串，默认是空格</p><p>skiprows：跳过前x行</p><p>usecols：读取指定的列</p><p>unpack：True表示，读入属性将分别写入不同的数组变量，False 读入数据只写入一个数组变量，默认False。<strong>转置效果</strong>。</p><p>读取的文件内容格式：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1241,1241,15346,2451</span><br><span class="line">125415,235,4135,1351</span><br><span class="line">12516,15326,1361,616</span><br><span class="line">……</span><br></pre></td></tr></table></figure><p>读取时可以按<code>,</code>分割。按行划分</p><h2 id="2-6-矩阵转置"><a href="#2-6-矩阵转置" class="headerlink" title="2.6 矩阵转置"></a>2.6 矩阵转置</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">t2.transpose()</span><br><span class="line">t2.T</span><br><span class="line">t2.swapaxes(<span class="number">1</span>,<span class="number">0</span>)<span class="comment">#交换轴，也能实现转置效果</span></span><br></pre></td></tr></table></figure><h2 id="2-7-索引和切片"><a href="#2-7-索引和切片" class="headerlink" title="2.7 索引和切片"></a>2.7 索引和切片</h2><p>取第二行：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t2[<span class="number">2</span>]</span><br></pre></td></tr></table></figure><p>取连续的多行：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t2[<span class="number">2</span>:]</span><br></pre></td></tr></table></figure><p>取不连续的多行：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t2[[<span class="number">2</span>,<span class="number">8</span>,<span class="number">10</span>]]</span><br></pre></td></tr></table></figure><p>取第一列：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t2[:,<span class="number">0</span>]</span><br></pre></td></tr></table></figure><p>取连续多列：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t2[:,<span class="number">2</span>:]</span><br></pre></td></tr></table></figure><p>取不连续的多列：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t2[:,[<span class="number">0</span>,<span class="number">2</span>,<span class="number">5</span>]]</span><br></pre></td></tr></table></figure><p>取3行四列的值：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t2[<span class="number">3</span>,<span class="number">4</span>]</span><br></pre></td></tr></table></figure><p>取多行多列：3行到5行，2列到4列，因为<code>:</code>左右是左闭右开区间，行数为索引+1</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t2[<span class="number">2</span>:<span class="number">5</span>,<span class="number">1</span>:<span class="number">4</span>]</span><br></pre></td></tr></table></figure><p>取多个不连续的点：(0,0)  (2,1)  (5,5)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t2[[0,2,5],[0,1,5]]</span><br></pre></td></tr></table></figure><h2 id="2-8-修改数值"><a href="#2-8-修改数值" class="headerlink" title="2.8 修改数值"></a>2.8 修改数值</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t[:,<span class="number">2</span>:<span class="number">4</span>] = <span class="number">0</span></span><br></pre></td></tr></table></figure><p><strong>布尔索引</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">t2&lt;<span class="number">10</span><span class="comment">#相同的矩阵，矩阵值为布尔类型，对应位置满足值小于10，则为1，否则为0</span></span><br><span class="line">t2[t2&lt;<span class="number">10</span>] = <span class="number">3</span><span class="comment">#t2中小于10的位置，赋值为3</span></span><br><span class="line">t2[t2&lt;<span class="number">10</span>]<span class="comment">#取t2中小于10的数组成新矩阵</span></span><br></pre></td></tr></table></figure><p><strong>三元运算符</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np.where(t&lt;<span class="number">10</span>,<span class="number">0</span>,<span class="number">10</span>)<span class="comment">#如果小于10，替换为0，否则替换为10</span></span><br></pre></td></tr></table></figure><p><strong>裁剪</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t.clip(<span class="number">10</span>,<span class="number">18</span>)<span class="comment">#小于10的替换为10，大于18的替换为18</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">t2 = t2.astype(float)</span><br><span class="line">t2[<span class="number">3</span>,<span class="number">3</span>] = np.nan</span><br></pre></td></tr></table></figure><h2 id="2-9-拼接数组"><a href="#2-9-拼接数组" class="headerlink" title="2.9 拼接数组"></a>2.9 拼接数组</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">np.vstack(t1,t2)<span class="comment">#竖直拼接</span></span><br><span class="line">np.hstack(t1,t2)<span class="comment">#水平拼接</span></span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2020/10/11/XpmuQc9dIC8jEws.png" class="lazyload" data-srcset="https://i.loli.net/2020/10/11/XpmuQc9dIC8jEws.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h2 id="2-10-行列交换"><a href="#2-10-行列交换" class="headerlink" title="2.10 行列交换"></a>2.10 行列交换</h2><p>行交换：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t[[<span class="number">1</span>,<span class="number">2</span>],:] = t[[<span class="number">2</span>,<span class="number">1</span>],:]</span><br></pre></td></tr></table></figure><p>列交换：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t[:,[<span class="number">0</span>,<span class="number">2</span>]] = t[:,[<span class="number">2</span>,<span class="number">0</span>]]</span><br></pre></td></tr></table></figure><h2 id="2-11-其他方法"><a href="#2-11-其他方法" class="headerlink" title="2.11 其他方法"></a>2.11 其他方法</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取最大最小值</span></span><br><span class="line">np.argmax(t,axis=<span class="number">0</span>)</span><br><span class="line">np.argmin(t,axis=<span class="number">1</span>)</span><br><span class="line"><span class="comment">#创建一个全0的数组</span></span><br><span class="line">np.zeros((<span class="number">3</span>,<span class="number">4</span>))</span><br><span class="line"><span class="comment">#创建全1数组</span></span><br><span class="line">np.ones((<span class="number">3</span>,<span class="number">4</span>))</span><br><span class="line"><span class="comment">#创建一个对角线为1的正方形数组（方阵）</span></span><br><span class="line">np.eye(<span class="number">3</span>)</span><br></pre></td></tr></table></figure><h2 id="2-12-生成随机数"><a href="#2-12-生成随机数" class="headerlink" title="2.12 生成随机数"></a>2.12 生成随机数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">np.random.rand(3,4)#均匀分布</span><br><span class="line">np.random.randn(3,4)#标准正太分布的随机数，平均数为0，标准差为1</span><br><span class="line">np.random.randint(low,high,(shape))#产生[low,high)之间的数</span><br></pre></td></tr></table></figure><p>种子：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">np.random.seed(<span class="number">10</span>)</span><br><span class="line">t = np.random.randint(<span class="number">0</span>,<span class="number">20</span>,(<span class="number">3</span>,<span class="number">4</span>))<span class="comment">#每次随机的结果相同</span></span><br></pre></td></tr></table></figure><h2 id="2-13-copy和view"><a href="#2-13-copy和view" class="headerlink" title="2.13 copy和view"></a>2.13 copy和view</h2><ol><li>a=b完全不复制，a和b相互影响。</li><li>a = b[:]，视图操作，创建新对象a，但a的数据完全由b保管，两者数据变化一致。</li><li>a = b.copy()复制，a和b互不影响。</li></ol><h2 id="2-14-nan和inf"><a href="#2-14-nan和inf" class="headerlink" title="2.14 nan和inf"></a>2.14 nan和inf</h2><p>nan(NAN,Nan)：not a number表示不是一个数字</p><p>inf(-inf,inf)：infinity，正无穷，-inf表示负无穷</p><p>一个数字除以0，python中会报错，numpy中是一个inf</p><p><strong>nan：</strong></p><ol><li>两个nan不相等</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">np.nan !=np.nan</span><br><span class="line"><span class="comment">#True</span></span><br></pre></td></tr></table></figure><ol start="2"><li>计算nan个数</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">np.count_nonzero(t2!=t2)<span class="comment">#t2!=t2，得到新矩阵，每个位置是bool类型，true表示该位置是nan</span></span><br><span class="line">np.count_nonzero(np.isnan(t2))<span class="comment">#</span></span><br></pre></td></tr></table></figure><ol start="3"><li>计算矩阵和</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">np.sum(t3)</span><br><span class="line">np.sum(t3, axis=<span class="number">0</span>)<span class="comment">#数组元素个数，与列数相同。，计算对应列上的和</span></span><br></pre></td></tr></table></figure><h2 id="2-15-常用统计函数"><a href="#2-15-常用统计函数" class="headerlink" title="2.15 常用统计函数"></a>2.15 常用统计函数</h2><p>求和：t.sum(axis=0)</p><p>均值：t.mean(axis=0)</p><p>中值：t.median(axis)</p><p>最大值：t.max</p><p>最小值:t.min</p><p>极值：np.ptp(t,axis=None)    最大值和最小值之差</p><p>标准差：t.std(axis=None)</p><p><strong>默认返回多维数组的全部统计结果</strong></p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pandas </tag>
            
            <tag> Matplotlib </tag>
            
            <tag> Numpy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>利用树莓派定时抢图书馆座位</title>
      <link href="/2020/09/27/%E5%88%A9%E7%94%A8%E6%A0%91%E8%8E%93%E6%B4%BE%E5%AE%9A%E6%97%B6%E6%8A%A2%E5%9B%BE%E4%B9%A6%E9%A6%86%E5%BA%A7%E4%BD%8D/"/>
      <url>/2020/09/27/%E5%88%A9%E7%94%A8%E6%A0%91%E8%8E%93%E6%B4%BE%E5%AE%9A%E6%97%B6%E6%8A%A2%E5%9B%BE%E4%B9%A6%E9%A6%86%E5%BA%A7%E4%BD%8D/</url>
      
        <content type="html"><![CDATA[<h1 id="1：需求分析"><a href="#1：需求分析" class="headerlink" title="1：需求分析"></a>1：需求分析</h1><p>由于新冠疫情的影响，学校图书馆和自习室必须在监管之下运行，每日提供的坐席和开放时间受限。大部分自习室被关闭，导致坐席需求很大，而供应很少。新规要求，图书馆和自习室的坐席必须在学校官网上预定，而且预定时间是周日到周四早上八点，仅能预定后一天的位置。</p><p>在考试周，座位非常难抢到，因此萌发了通过程序抢座的念头。</p><p>目前需求是，程序在周天到周日的早上八点启动，并打开抢座页面，抢座后关闭程序。抢座成功后，学校会自动发送抢座成功的邮件。</p><h1 id="2：软硬件应用"><a href="#2：软硬件应用" class="headerlink" title="2：软硬件应用"></a>2：软硬件应用</h1><p>服务器：树莓派4B+、Linux系统</p><p>语言：Python</p><p>依赖库：Selenium，date</p><p>Linux工具：crontab</p><h1 id="3：抢座程序"><a href="#3：抢座程序" class="headerlink" title="3：抢座程序"></a>3：抢座程序</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.action_chains <span class="keyword">import</span> ActionChains</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> Select</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="comment">#点击buchen按钮</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clickbucheng</span>(<span class="params">driver</span>):</span></span><br><span class="line">    inputs = driver.find_elements_by_tag_name(<span class="string">&#x27;input&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> input <span class="keyword">in</span> inputs:</span><br><span class="line">        <span class="keyword">if</span> input.get_attribute(<span class="string">&#x27;value&#x27;</span>) == <span class="string">&#x27;buchen&#x27;</span>:</span><br><span class="line">            ActionChains(driver).click(input).perform()</span><br><span class="line">            <span class="comment"># writetohtml(driver,r&quot;C:\Users\97532\OneDrive\程序仓库\getPlatzinBibliothek\1.html&quot;)</span></span><br><span class="line">            window = driver.window_handles[<span class="number">1</span>]</span><br><span class="line">            driver.switch_to.window(window)</span><br><span class="line">            driver.find_elements_by_css_selector(<span class="string">&#x27;#bs_form_main &gt; div &gt; div.bs_etvg &gt; div &gt; label &gt; div.bs_form_uni.bs_right.padding0 &gt; input&#x27;</span>)[<span class="number">0</span>].click()</span><br><span class="line">            print(datetime.datetime.now().strftime(<span class="string">&#x27;%Y.%m.%d-%H:%M:%S&#x27;</span>),<span class="string">&quot;: start buchen&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#发送表格信息</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sendform</span>(<span class="params">driver</span>):</span></span><br><span class="line">    <span class="comment"># writetohtml(driver,r&#x27;C:\Users\97532\OneDrive\程序仓库\getPlatzinBibliothek\2.html&#x27;)</span></span><br><span class="line">    <span class="comment">#sex:M/W</span></span><br><span class="line">    urinfo = &#123;<span class="string">&quot;sex&quot;</span>:<span class="string">&quot;M&quot;</span>,<span class="string">&quot;vorname&quot;</span>:<span class="string">&quot;***&quot;</span>,<span class="string">&quot;name&quot;</span>:<span class="string">&quot;***&quot;</span>,<span class="string">&quot;strasse&quot;</span>:<span class="string">&quot;Hai***1&quot;</span>,<span class="string">&quot;ort&quot;</span>:<span class="string">&quot;***&quot;</span>,<span class="string">&quot;status&quot;</span>:<span class="string">&quot;S-RWTH&quot;</span>,<span class="string">&quot;matnr&quot;</span>:<span class="string">&quot;***93&quot;</span>,<span class="string">&quot;email&quot;</span>:<span class="string">&quot;im@xieqifei.com&quot;</span>,<span class="string">&quot;telefon&quot;</span>:<span class="string">&quot;0049***4845&quot;</span>&#125;</span><br><span class="line">    radios = driver.find_elements_by_name(<span class="string">&#x27;sex&#x27;</span>)</span><br><span class="line">    vorname = driver.find_element_by_name(<span class="string">&#x27;vorname&#x27;</span>)</span><br><span class="line">    name = driver.find_element_by_name(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    strasse = driver.find_element_by_name(<span class="string">&#x27;strasse&#x27;</span>)</span><br><span class="line">    ort = driver.find_element_by_name(<span class="string">&#x27;ort&#x27;</span>)</span><br><span class="line">    status = Select(driver.find_element_by_name(<span class="string">&#x27;statusorig&#x27;</span>))</span><br><span class="line">    matnr = driver.find_element_by_name(<span class="string">&#x27;matnr&#x27;</span>)</span><br><span class="line">    email = driver.find_element_by_name(<span class="string">&#x27;email&#x27;</span>)</span><br><span class="line">    telefon = driver.find_element_by_name(<span class="string">&#x27;telefon&#x27;</span>)</span><br><span class="line">    tnbed = driver.find_element_by_name(<span class="string">&#x27;tnbed&#x27;</span>)</span><br><span class="line">    submit = driver.find_element_by_css_selector(<span class="string">&#x27;#bs_foot &gt; div.bs_form_row &gt; div.bs_right &gt; input&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> radio <span class="keyword">in</span> radios:</span><br><span class="line">        <span class="keyword">if</span> radio.get_attribute(<span class="string">&quot;value&quot;</span>) == urinfo[<span class="string">&#x27;sex&#x27;</span>]:</span><br><span class="line">            radio.click()</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    vorname.send_keys(urinfo[<span class="string">&#x27;vorname&#x27;</span>])</span><br><span class="line">    name.send_keys(urinfo[<span class="string">&#x27;name&#x27;</span>])</span><br><span class="line">    strasse.send_keys(urinfo[<span class="string">&#x27;strasse&#x27;</span>])</span><br><span class="line">    ort.send_keys(urinfo[<span class="string">&#x27;ort&#x27;</span>])</span><br><span class="line">    status.select_by_value(urinfo[<span class="string">&#x27;status&#x27;</span>])</span><br><span class="line">    matnr.send_keys(urinfo[<span class="string">&#x27;matnr&#x27;</span>])</span><br><span class="line">    email.send_keys(urinfo[<span class="string">&#x27;email&#x27;</span>])</span><br><span class="line">    telefon.send_keys(urinfo[<span class="string">&#x27;telefon&#x27;</span>])</span><br><span class="line">    tnbed.click()</span><br><span class="line">    telefon.click()</span><br><span class="line">    sleep(<span class="number">4</span>)</span><br><span class="line">    <span class="comment"># WebDriverWait(driver, 10).until(EC.element_to_be_clickable(By.XPATH,&#x27;//*[@id=&quot;bs_foot&quot;]/div[3]/div[2]/input&#x27;))</span></span><br><span class="line">    submit.click()</span><br><span class="line">    print(datetime.datetime.now().strftime(<span class="string">&#x27;%Y.%m.%d-%H:%M:%S&#x27;</span>),<span class="string">&quot;: send MsgForm&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#确认预定</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">confirm</span>(<span class="params">driver</span>):</span></span><br><span class="line">    confirm = driver.find_element_by_css_selector(<span class="string">&#x27;#bs_foot &gt; div.bs_form_row &gt; div.bs_right &gt; input&#x27;</span>)</span><br><span class="line">    confirm.click()</span><br><span class="line">    print(datetime.datetime.now().strftime(<span class="string">&#x27;%Y.%m.%d-%H:%M:%S&#x27;</span>),<span class="string">&quot;: confirm,buchen success!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#可发送用户名密码抢座</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sendpw</span>(<span class="params">driver</span>):</span></span><br><span class="line">    logininfo = &#123;<span class="string">&quot;pw_email&quot;</span>:<span class="string">&quot;im@xieqifei.com&quot;</span>,<span class="string">&quot;password&quot;</span>:<span class="string">&quot;***&quot;</span>&#125;</span><br><span class="line">    pw_email = driver.find_element_by_name(<span class="string">&#x27;pw_email&#x27;</span>)</span><br><span class="line">    pw = driver.find_element_by_css_selector(<span class="string">&#x27;#bs_pw_anm &gt; div:nth-child(3) &gt; div.bs_form_sp2 &gt; input&#x27;</span>)</span><br><span class="line">    submit2 = driver.find_element_by_css_selector(<span class="string">&#x27;#bs_pw_anm &gt; div.bs_form_foot &gt; div.bs_form_row &gt; div.bs_right &gt; input&#x27;</span>)</span><br><span class="line">    pw_email.send_keys(logininfo[<span class="string">&#x27;pw_email&#x27;</span>])</span><br><span class="line">    pw.send_keys(logininfo[<span class="string">&#x27;password&#x27;</span>])</span><br><span class="line">    <span class="comment"># sleep(3)</span></span><br><span class="line">    submit2.submit()</span><br><span class="line">    </span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">def writetohtml(driver,path):</span></span><br><span class="line"><span class="string">    f = open(path,&#x27;wb&#x27;)</span></span><br><span class="line"><span class="string">    f.write(driver.page_source.encode(&quot;utf-8&quot;, &quot;ignore&quot;))</span></span><br><span class="line"><span class="string">    f.close()   </span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>    </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment">#path = &quot;/home/pi/Programms/getPlatzinBibliothek/chromedriver&quot;</span></span><br><span class="line">    option = webdriver.ChromeOptions()</span><br><span class="line">    option.add_argument(<span class="string">&#x27;--headless&#x27;</span>)</span><br><span class="line">    driver = webdriver.Chrome(options=option)</span><br><span class="line">    print(datetime.datetime.now().strftime(<span class="string">&#x27;%Y.%m.%d-%H:%M:%S&#x27;</span>),<span class="string">&quot;: chrome start up&quot;</span>)</span><br><span class="line">    <span class="comment"># driver.get(&#x27;file:///C:/Users/97532/Desktop/Anmeldung.html&#x27;)</span></span><br><span class="line">    driver.get(<span class="string">&#x27;https://buchung.hsz.rwth-aachen.de/angebote/aktueller_zeitraum/_Lernraumbuchung.html&#x27;</span>)</span><br><span class="line">    ok = clickbucheng(driver)</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> ok != <span class="number">1</span> <span class="keyword">and</span> count &lt; <span class="number">10</span>:</span><br><span class="line">        sleep(<span class="number">1</span>)</span><br><span class="line">        driver.refresh()</span><br><span class="line">        ok = clickbucheng(driver)</span><br><span class="line">        count = count + <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> ok == <span class="number">1</span>:</span><br><span class="line">            sendform(driver)</span><br><span class="line">            confirm(driver)</span><br><span class="line">    <span class="comment">#driver.get_screenshot_as_file(r&quot;/home/pi/Programms/tushuguan.jpg&quot;)</span></span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line">    print(datetime.datetime.now().strftime(<span class="string">&#x27;%Y.%m.%d-%H:%M:%S&#x27;</span>),<span class="string">&quot;: chrome shutdown&quot;</span>)</span><br><span class="line">    driver.quit()</span><br></pre></td></tr></table></figure><p>使用Selenium驱动chrome浏览器，实行web自动化，完成抢座功能。</p><h1 id="4：定时任务"><a href="#4：定时任务" class="headerlink" title="4：定时任务"></a>4：定时任务</h1><p>在树莓派上，利用Linux定时工具crontab，指定程序在每周天到周四上午八点运行。</p><p>创建shell脚本，bibplatz.sh</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">cd /home/pi/Programms/getPlatzinBibliothek</span><br><span class="line">python3 -u getplatz.py &gt; result.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure><p>添加任务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure><p>在vim编辑器中添加任务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 8 * * 0-4 /home/pi/bibplatz.sh &amp;</span><br></pre></td></tr></table></figure><p>crontab的格式为：* * * * * command</p><p>五个*分别代表，分钟，小时，天，月，周</p><p>查看任务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -l</span><br></pre></td></tr></table></figure><h1 id="5：参考资料"><a href="#5：参考资料" class="headerlink" title="5：参考资料"></a>5：参考资料</h1><p>《<a href="https://www.cnblogs.com/intval/p/5763929.html">Linux定时任务Crontab命令详解</a>》</p><p>《<a href="https://www.jb51.net/article/156969.htm">Linux后台运行Python程序的几种方法讲解</a>》</p><p>《<a href="https://blog.csdn.net/wangshu_liang/article/details/84027148">linux下后台运行python程序并输出到日志文件中</a>》</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 树莓派 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>树莓派Chrome浏览器驱动webdriver</title>
      <link href="/2020/09/21/%E6%A0%91%E8%8E%93%E6%B4%BEChrome%E6%B5%8F%E8%A7%88%E5%99%A8%E9%A9%B1%E5%8A%A8webdriver/"/>
      <url>/2020/09/21/%E6%A0%91%E8%8E%93%E6%B4%BEChrome%E6%B5%8F%E8%A7%88%E5%99%A8%E9%A9%B1%E5%8A%A8webdriver/</url>
      
        <content type="html"><![CDATA[<p>树莓派上的系统是基于Arm内核的Linux，且是32位系统，在Google上面下载的chromedriver在selenium运行时，会报错，可以直接使用apt-get安装chromedriver。</p><p>安装命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install chromium-chromedriver</span><br></pre></td></tr></table></figure><p>会自动识别树莓派上原有的chrome浏览器版本。</p><p>在python程序中，可直接使用<code>webdriver.Chrome()</code>而无需再指定驱动路径。</p>]]></content>
      
      
      <categories>
          
          <category> 树莓派 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Selenium </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ADB参考指令</title>
      <link href="/2020/09/21/ADB%E5%8F%82%E8%80%83%E6%8C%87%E4%BB%A4/"/>
      <url>/2020/09/21/ADB%E5%8F%82%E8%80%83%E6%8C%87%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h1 id="1：参考资料"><a href="#1：参考资料" class="headerlink" title="1：参考资料"></a>1：参考资料</h1><p>《<a href="https://www.cnblogs.com/hyf20131113/p/10919586.html">使用adb命令操控Android手机（adb命令）</a>》：从连接设备，到键盘输入和点击操作</p><p>《<a href="http://www.360doc.com/content/14/0628/14/426085_390487096.shtml">adb shell getevent中获取到的屏幕事件的坐标转换</a>》</p>]]></content>
      
      
      <categories>
          
          <category> 安卓编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ADB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Selenium库常用操作记录</title>
      <link href="/2020/09/18/Selenium%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E8%AE%B0%E5%BD%95/"/>
      <url>/2020/09/18/Selenium%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h1 id="1：Selenium简介"><a href="#1：Selenium简介" class="headerlink" title="1：Selenium简介"></a>1：Selenium简介</h1><p>Selenium库是一个用于浏览器自动化pyhon库。对提高爬虫容错率有很好的效果。它可用于驱动浏览器，来帮助我们实现获取网站js脚本执行后的网页。</p><h1 id="2：Selenium安装"><a href="#2：Selenium安装" class="headerlink" title="2：Selenium安装"></a>2：Selenium安装</h1><h2 id="2-1-安装"><a href="#2-1-安装" class="headerlink" title="2.1 安装"></a>2.1 安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install selenium</span><br></pre></td></tr></table></figure><h2 id="2-2-浏览器驱动"><a href="#2-2-浏览器驱动" class="headerlink" title="2.2 浏览器驱动"></a>2.2 浏览器驱动</h2><p>下载浏览器驱动：</p><p>Firefox浏览器驱动：<a href="https://link.zhihu.com/?target=https://github.com/mozilla/geckodriver/releases">geckodriver</a></p><p>Chrome浏览器驱动：<a href="https://link.zhihu.com/?target=https://sites.google.com/a/chromium.org/chromedriver/home">chromedriver</a> , <a href="https://link.zhihu.com/?target=https://npm.taobao.org/mirrors/chromedriver">taobao备用地址</a></p><p>IE浏览器驱动：<a href="https://link.zhihu.com/?target=http://selenium-release.storage.googleapis.com/index.html">IEDriverServer</a></p><p>Edge浏览器驱动：<a href="https://link.zhihu.com/?target=https://developer.microsoft.com/en-us/microsoft-edge/tools/webdriver">MicrosoftWebDriver</a></p><p>Opera浏览器驱动：<a href="https://link.zhihu.com/?target=https://github.com/operasoftware/operachromiumdriver/releases">operadriver</a></p><p>PhantomJS浏览器驱动：<a href="https://link.zhihu.com/?target=http://phantomjs.org/">phantomjs</a></p><p>将驱动放到某个路径下，并在环境变量中指明。例如：</p><p>驱动放在目录：<code>C:/abc/webdriver.exe</code></p><p>则需要在用户或者系统环境变量中，给Path变量添加新变量：<code>C:/abc</code></p><p>或者<strong>指定驱动路径</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">path = <span class="string">&quot;/path/to/chromedriver&quot;</span> <span class="comment">#注意这个路径需要时可执行路径（chmod 777 dir or 755 dir）</span></span><br><span class="line">driver = webdriver.Chrome(executable_path=path)</span><br></pre></td></tr></table></figure><p>不同的浏览器启动方式：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">driver = webdriver.Firefox()   <span class="comment"># Firefox浏览器</span></span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome()    <span class="comment"># Chrome浏览器</span></span><br><span class="line"></span><br><span class="line">driver = webdriver.Ie()        <span class="comment"># Internet Explorer浏览器</span></span><br><span class="line"></span><br><span class="line">driver = webdriver.Edge()      <span class="comment"># Edge浏览器</span></span><br><span class="line"></span><br><span class="line">driver = webdriver.Opera()     <span class="comment"># Opera浏览器</span></span><br><span class="line"></span><br><span class="line">driver = webdriver.PhantomJS()   <span class="comment"># PhantomJS</span></span><br></pre></td></tr></table></figure><h1 id="3：浏览器选项和操作"><a href="#3：浏览器选项和操作" class="headerlink" title="3：浏览器选项和操作"></a>3：浏览器选项和操作</h1><h2 id="3-1-浏览器选项"><a href="#3-1-浏览器选项" class="headerlink" title="3.1 浏览器选项"></a>3.1 浏览器选项</h2><p>每次当selenium启动chrome浏览器的时候，chrome浏览器很干净，没有插件、没有收藏、没有历史记录，这是因为selenium在启动chrome时为了保证最快的运行效率，启动了一个裸浏览器，这就是为什么需要配置参数的原因，但是有些时候我们需要的不仅是一个裸浏览器。</p><p>selenium启动配置参数接收是ChromeOptions类，创建方式如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">option = webdriver.ChromeOptions()</span><br><span class="line"><span class="comment"># 添加启动参数</span></span><br><span class="line">option.add_argument()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加扩展应用 </span></span><br><span class="line">option.add_extension()</span><br><span class="line">option.add_encoded_extension()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加实验性质的设置参数 </span></span><br><span class="line">option.add_experimental_option()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置调试器地址</span></span><br><span class="line">option.debugger_address()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加UA</span></span><br><span class="line">options.add_argument(<span class="string">&#x27;user-agent=&quot;MQQBrowser/26 Mozilla/5.0 (Linux; U; Android 2.3.7; zh-cn; MB200 Build/GRJ22; CyanogenMod-7) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1&quot;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定浏览器分辨率</span></span><br><span class="line">options.add_argument(<span class="string">&#x27;window-size=1920x3000&#x27;</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 谷歌文档提到需要加上这个属性来规避bug</span></span><br><span class="line">chrome_options.add_argument(<span class="string">&#x27;--disable-gpu&#x27;</span>) </span><br><span class="line"></span><br><span class="line"> <span class="comment"># 隐藏滚动条, 应对一些特殊页面</span></span><br><span class="line">options.add_argument(<span class="string">&#x27;--hide-scrollbars&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不加载图片, 提升速度</span></span><br><span class="line">options.add_argument(<span class="string">&#x27;blink-settings=imagesEnabled=false&#x27;</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 浏览器不提供可视化页面. linux下如果系统不支持可视化不加这条会启动失败</span></span><br><span class="line">options.add_argument(<span class="string">&#x27;--headless&#x27;</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 以最高权限运行</span></span><br><span class="line">options.add_argument(<span class="string">&#x27;--no-sandbox&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 手动指定使用的浏览器位置</span></span><br><span class="line">options.binary_location = <span class="string">r&quot;C:\Program Files (x86)\Google\Chrome\Application\chrome.exe&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#添加crx插件</span></span><br><span class="line">option.add_extension(<span class="string">&#x27;d:\crx\AdBlock_v2.17.crx&#x27;</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁用JavaScript</span></span><br><span class="line">option.add_argument(<span class="string">&quot;--disable-javascript&quot;</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置开发者模式启动，该模式下webdriver属性为正常值</span></span><br><span class="line">options.add_experimental_option(<span class="string">&#x27;excludeSwitches&#x27;</span>, [<span class="string">&#x27;enable-automation&#x27;</span>]) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁用浏览器弹窗</span></span><br><span class="line">prefs = &#123;  </span><br><span class="line">    <span class="string">&#x27;profile.default_content_setting_values&#x27;</span> :  &#123;  </span><br><span class="line">        <span class="string">&#x27;notifications&#x27;</span> : <span class="number">2</span>  </span><br><span class="line">     &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">options.add_experimental_option(<span class="string">&#x27;prefs&#x27;</span>,prefs)</span><br><span class="line"></span><br><span class="line">driver=webdriver.Chrome(chrome_options=chrome_options)</span><br></pre></td></tr></table></figure><p>其他配置参数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">–user-data-dir=”[PATH]” </span><br><span class="line"><span class="comment"># 指定用户文件夹User Data路径，可以把书签这样的用户数据保存在系统分区以外的分区</span></span><br><span class="line"></span><br><span class="line">　　–disk-cache-dir=”[PATH]“ </span><br><span class="line"><span class="comment"># 指定缓存Cache路径</span></span><br><span class="line"></span><br><span class="line">　　–disk-cache-size= </span><br><span class="line"><span class="comment"># 指定Cache大小，单位Byte</span></span><br><span class="line"></span><br><span class="line">　　–first run </span><br><span class="line"><span class="comment"># 重置到初始状态，第一次运行</span></span><br><span class="line"></span><br><span class="line">　　–incognito </span><br><span class="line"><span class="comment"># 隐身模式启动</span></span><br><span class="line"></span><br><span class="line">　　–disable-javascript </span><br><span class="line"><span class="comment"># 禁用Javascript</span></span><br><span class="line"></span><br><span class="line">　　--omnibox-popup-count=<span class="string">&quot;num&quot;</span> </span><br><span class="line"><span class="comment"># 将地址栏弹出的提示菜单数量改为num个</span></span><br><span class="line"></span><br><span class="line">　　--user-agent=<span class="string">&quot;xxxxxxxx&quot;</span> </span><br><span class="line"><span class="comment"># 修改HTTP请求头部的Agent字符串，可以通过about:version页面查看修改效果</span></span><br><span class="line"></span><br><span class="line">　　--disable-plugins </span><br><span class="line"><span class="comment"># 禁止加载所有插件，可以增加速度。可以通过about:plugins页面查看效果</span></span><br><span class="line"></span><br><span class="line">　　--disable-javascript </span><br><span class="line"><span class="comment"># 禁用JavaScript，如果觉得速度慢在加上这个</span></span><br><span class="line"></span><br><span class="line">　　--disable-java </span><br><span class="line"><span class="comment"># 禁用java</span></span><br><span class="line"></span><br><span class="line">　　--start-maximized </span><br><span class="line"><span class="comment"># 启动就最大化</span></span><br><span class="line"></span><br><span class="line">　　--no-sandbox </span><br><span class="line"><span class="comment"># 取消沙盒模式</span></span><br><span class="line"></span><br><span class="line">　　--single-process </span><br><span class="line"><span class="comment"># 单进程运行</span></span><br><span class="line"></span><br><span class="line">　　--process-per-tab </span><br><span class="line"><span class="comment"># 每个标签使用单独进程</span></span><br><span class="line"></span><br><span class="line">　　--process-per-site </span><br><span class="line"><span class="comment"># 每个站点使用单独进程</span></span><br><span class="line"></span><br><span class="line">　　--<span class="keyword">in</span>-process-plugins </span><br><span class="line"><span class="comment"># 插件不启用单独进程</span></span><br><span class="line"></span><br><span class="line">　　--disable-popup-blocking </span><br><span class="line"><span class="comment"># 禁用弹出拦截</span></span><br><span class="line"></span><br><span class="line">　　--disable-plugins </span><br><span class="line"><span class="comment"># 禁用插件</span></span><br><span class="line"></span><br><span class="line">　　--disable-images </span><br><span class="line"><span class="comment"># 禁用图像</span></span><br><span class="line"></span><br><span class="line">　　--incognito </span><br><span class="line"><span class="comment"># 启动进入隐身模式</span></span><br><span class="line"></span><br><span class="line">　　--enable-udd-profiles </span><br><span class="line"><span class="comment"># 启用账户切换菜单</span></span><br><span class="line"></span><br><span class="line">　　--proxy-pac-url </span><br><span class="line"><span class="comment"># 使用pac代理 [via 1/2]</span></span><br><span class="line"></span><br><span class="line">　　--lang=zh-CN </span><br><span class="line"><span class="comment"># 设置语言为简体中文</span></span><br><span class="line"></span><br><span class="line">　　--disk-cache-dir </span><br><span class="line"><span class="comment"># 自定义缓存目录</span></span><br><span class="line"></span><br><span class="line">　　--disk-cache-size </span><br><span class="line"><span class="comment"># 自定义缓存最大值（单位byte）</span></span><br><span class="line"></span><br><span class="line">　　--media-cache-size </span><br><span class="line"><span class="comment"># 自定义多媒体缓存最大值（单位byte）</span></span><br><span class="line"></span><br><span class="line">　　--bookmark-menu </span><br><span class="line"><span class="comment"># 在工具 栏增加一个书签按钮</span></span><br><span class="line"></span><br><span class="line">　　--enable-sync </span><br><span class="line"><span class="comment"># 启用书签同步</span></span><br></pre></td></tr></table></figure><h2 id="3-2-浏览器操作"><a href="#3-2-浏览器操作" class="headerlink" title="3.2 浏览器操作"></a>3.2 浏览器操作</h2><ul><li>控制浏览器窗口大小</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.set_window_size(<span class="number">480</span>, <span class="number">800</span>)</span><br></pre></td></tr></table></figure><ul><li>浏览器后退，前进</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 后退 </span></span><br><span class="line">driver.back() </span><br><span class="line"><span class="comment"># 前进 </span></span><br><span class="line">driver.forward()</span><br></pre></td></tr></table></figure><ul><li>刷新</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.refresh() <span class="comment"># 刷新</span></span><br></pre></td></tr></table></figure><h1 id="4：元素定位和操作"><a href="#4：元素定位和操作" class="headerlink" title="4：元素定位和操作"></a>4：元素定位和操作</h1><h2 id="4-1-元素定位"><a href="#4-1-元素定位" class="headerlink" title="4.1 元素定位"></a>4.1 元素定位</h2><p>获取首个匹配元素：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">find_element_by_id()</span><br><span class="line">find_element_by_name()</span><br><span class="line">find_element_by_class_name()</span><br><span class="line">find_element_by_tag_name()</span><br><span class="line">find_element_by_link_text()</span><br><span class="line">find_element_by_partial_link_text()</span><br><span class="line">find_element_by_xpath()</span><br><span class="line">find_element_by_css_selector()</span><br></pre></td></tr></table></figure><p>如果具有多个匹配属性元素，可使用：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find_elements_by_class_name()</span><br></pre></td></tr></table></figure><p>即在element后加s</p><h2 id="4-2-输入、提交"><a href="#4-2-输入、提交" class="headerlink" title="4.2 输入、提交"></a>4.2 输入、提交</h2><ul><li>点击和输入</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.find_element_by_id(<span class="string">&quot;kw&quot;</span>).clear() <span class="comment"># 清楚文本 driver.find_element_by_id(&quot;kw&quot;).send_keys(&quot;selenium&quot;) # 模拟按键输入 driver.find_element_by_id(&quot;su&quot;).click() # 单机元素</span></span><br></pre></td></tr></table></figure><ul><li>提交</li></ul><p>可以在搜索框模拟回车操作</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">search_text = driver.find_element_by_id(<span class="string">&#x27;kw&#x27;</span>) search_text.send_keys(<span class="string">&#x27;selenium&#x27;</span>) </span><br><span class="line">search_text.submit()</span><br></pre></td></tr></table></figure><ul><li>其他</li></ul><p>size： 返回元素的尺寸。</p><p>text： 获取元素的文本。</p><p>get_attribute(name)： 获得属性值。</p><p>is_displayed()： 设置该元素是否用户可见。</p><h2 id="4-3-鼠标操作"><a href="#4-3-鼠标操作" class="headerlink" title="4.3 鼠标操作"></a>4.3 鼠标操作</h2><p>在 WebDriver 中， 将这些关于鼠标操作的方法封装在 ActionChains 类提供。</p><p>ActionChains 类提供了鼠标操作的常用方法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">click（on_element &#x3D; None）-鼠标左键</span><br><span class="line"></span><br><span class="line">click_and_hold（on_element &#x3D; None）-单击鼠标左键，不松开</span><br><span class="line"></span><br><span class="line">context_click（on_element &#x3D; None）-点击鼠标右键</span><br><span class="line"></span><br><span class="line">double_click（on_element &#x3D; None）-双击鼠标左键</span><br><span class="line"></span><br><span class="line">drag_and_drop（源，目标）-拖拽到某个元素然后松开</span><br><span class="line"></span><br><span class="line">drag_and_drop_by_offset（source，xoffset，yoffset）-拖拽到某个坐标然后松开</span><br><span class="line"></span><br><span class="line">key_down（value，element &#x3D; None）-点击某个键盘上的键</span><br><span class="line"></span><br><span class="line">key_up（value，element &#x3D; None）-松开某个键</span><br><span class="line"></span><br><span class="line">move_by_offset（xoffset，yoffset）-鼠标从当前位置移动到某个坐标</span><br><span class="line"></span><br><span class="line">move_to_element（to_element）-鼠标移动到某个元素</span><br><span class="line"></span><br><span class="line">move_to_element_with_offset（to_element，xoffset，yoffset）-移动到距离某个元素（左上角坐标）多少距离的位置</span><br><span class="line"></span><br><span class="line">perform（）-执行链中的所有动作</span><br><span class="line"></span><br><span class="line">释放（on_element &#x3D; None）-在某个元素位置松开鼠标左键</span><br><span class="line"></span><br><span class="line">send_keys（* keys_to_send）-发送某个键到当前焦点的元素</span><br><span class="line"></span><br><span class="line">send_keys_to_element（element，* keys_to_send）-发送某个键到指定元素</span><br></pre></td></tr></table></figure><p>举个例子：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="comment"># 引入 ActionChains 类</span></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.action_chains <span class="keyword">import</span> ActionChains</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.get(<span class="string">&quot;https://www.baidu.cn&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定位到要悬停的元素</span></span><br><span class="line">above = driver.find_element_by_link_text(<span class="string">&quot;设置&quot;</span>)</span><br><span class="line"><span class="comment"># 对定位到的元素执行鼠标悬停操作</span></span><br><span class="line">ActionChains(driver).move_to_element(above).perform()</span><br></pre></td></tr></table></figure><h2 id="4-4-键盘事件"><a href="#4-4-键盘事件" class="headerlink" title="4.4 键盘事件"></a>4.4 键盘事件</h2><p>以下为常用的键盘操作：</p><ul><li>send_keys(Keys.BACK_SPACE) 删除键（BackSpace）</li><li>send_keys(Keys.SPACE) 空格键(Space)</li><li>send_keys(Keys.TAB) 制表键(Tab)</li><li>send_keys(Keys.ESCAPE) 回退键（Esc）</li><li>send_keys(Keys.ENTER) 回车键（Enter）</li><li>send_keys(Keys.CONTROL,’a’) 全选（Ctrl+A）</li><li>send_keys(Keys.CONTROL,’c’) 复制（Ctrl+C）</li><li>send_keys(Keys.CONTROL,’x’) 剪切（Ctrl+X）</li><li>send_keys(Keys.CONTROL,’v’) 粘贴（Ctrl+V）</li><li>send_keys(Keys.F1) 键盘 F1</li><li>……</li><li>send_keys(Keys.F12) 键盘 F12</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输入框输入内容</span></span><br><span class="line">driver.find_element_by_id(<span class="string">&quot;kw&quot;</span>).send_keys(<span class="string">&quot;seleniumm&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除多输入的一个 m</span></span><br><span class="line">driver.find_element_by_id(<span class="string">&quot;kw&quot;</span>).send_keys(Keys.BACK_SPACE)</span><br></pre></td></tr></table></figure><h2 id="4-5-获取断言信息"><a href="#4-5-获取断言信息" class="headerlink" title="4.5 获取断言信息"></a>4.5 获取断言信息</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">title = driver.title <span class="comment"># 打印当前页面title</span></span><br><span class="line">now_url = driver.current_url <span class="comment"># 打印当前页面URL</span></span><br><span class="line">user = driver.find_element_by_class_name(<span class="string">&#x27;nums&#x27;</span>).text <span class="comment"># # 获取结果数目</span></span><br></pre></td></tr></table></figure><h2 id="4-6-等待页面加载完成"><a href="#4-6-等待页面加载完成" class="headerlink" title="4.6 等待页面加载完成"></a>4.6 等待页面加载完成</h2><ul><li>显示等待</li></ul><p>显式等待使WebdDriver等待某个条件成立时继续执行，否则在达到最大时长时抛出超时异常（TimeoutException）。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"></span><br><span class="line">driver = webdriver.Firefox()</span><br><span class="line">driver.get(<span class="string">&quot;http://www.baidu.com&quot;</span>)</span><br><span class="line"></span><br><span class="line">element = WebDriverWait(driver, <span class="number">5</span>, <span class="number">0.5</span>).until(</span><br><span class="line">                      EC.presence_of_element_located((By.ID, <span class="string">&quot;kw&quot;</span>))</span><br><span class="line">                      )</span><br><span class="line">element.send_keys(<span class="string">&#x27;selenium&#x27;</span>)</span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure><p>WebDriverWait类是由WebDirver 提供的等待方法。在设置时间内，默认每隔一段时间检测一次当前页面元素是否存在，如果超过设置时间检测不到则抛出异常。具体格式如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WebDriverWait(driver, timeout, poll_frequency=<span class="number">0.5</span>, ignored_exceptions=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><ul><li>driver ：浏览器驱动。</li><li>timeout ：最长超时时间，默认以秒为单位。</li><li>poll_frequency ：检测的间隔（步长）时间，默认为0.5S。</li><li>ignored_exceptions ：超时后的异常信息，默认情况下抛NoSuchElementException异常。</li><li>WebDriverWait()一般由until()或until_not()方法配合使用，下面是until()和until_not()方法的说明。</li><li>until(method, message=‘’) 调用该方法提供的驱动程序作为一个参数，直到返回值为True。</li><li>until_not(method, message=‘’) 调用该方法提供的驱动程序作为一个参数，直到返回值为False。</li></ul><p>在本例中，通过as关键字将expected_conditions 重命名为EC，并调用presence_of_element_located()方法判断元素是否存在。</p><ul><li>隐式等待</li></ul><p>如果某些元素不是立即可用的，隐式等待是告诉WebDriver去等待一定的时间后去查找元素。 默认等待时间是0秒，一旦设置该值，隐式等待是设置该WebDriver的实例的生命周期。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">driver = webdriver.Firefox()    </span><br><span class="line">driver.implicitly_wait(<span class="number">10</span>) <span class="comment"># seconds    </span></span><br><span class="line">driver.get(<span class="string">&quot;http://somedomain/url_that_delays_loading&quot;</span>)    </span><br><span class="line">myDynamicElement = driver.find_element_by_id(<span class="string">&quot;myDynamicElement&quot;</span>) </span><br></pre></td></tr></table></figure><h2 id="4-7-在不同的iframe之间移动"><a href="#4-7-在不同的iframe之间移动" class="headerlink" title="4.7 在不同的iframe之间移动"></a>4.7 在不同的iframe之间移动</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">driver.switch_to_window(<span class="string">&quot;windowName&quot;</span>)</span><br><span class="line">driver.switch_to_frame(<span class="string">&quot;frameName&quot;</span>)</span><br></pre></td></tr></table></figure><p>以直接取表单的id 或name属性。如果iframe没有可用的id和name属性，则可以通过下面的方式进行定位。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#先通过xpth定位到iframe</span></span><br><span class="line">xf = driver.find_element_by_xpath(<span class="string">&#x27;//*[@id=&quot;x-URS-iframe&quot;]&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#再将定位对象传给switch_to_frame()方法</span></span><br><span class="line">driver.switch_to_frame(xf)</span><br></pre></td></tr></table></figure><p>一旦我们完成了frame中的工作，我们可以这样返回父frame:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.switch_to_default_content()</span><br></pre></td></tr></table></figure><h2 id="4-8-警告框处理"><a href="#4-8-警告框处理" class="headerlink" title="4.8 警告框处理"></a>4.8 警告框处理</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert = driver.switch_to_alert()</span><br></pre></td></tr></table></figure><ul><li>text：返回 alert/confirm/prompt 中的文字信息。</li><li>accept()：接受现有警告框。</li><li>dismiss()：解散现有警告框。</li><li>send_keys(keysToSend)：发送文本至警告框。keysToSend：将文本发送至警告框。</li></ul><h2 id="4-9-下拉框选择"><a href="#4-9-下拉框选择" class="headerlink" title="4.9 下拉框选择"></a>4.9 下拉框选择</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from selenium import webdriver</span><br><span class="line">from selenium.webdriver.support.select import Select</span><br><span class="line">from time import sleep</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.implicitly_wait(10)</span><br><span class="line">driver.get(&#x27;http://www.baidu.com&#x27;)</span><br><span class="line">sel = driver.find_element_by_xpath(&quot;//select[@id=&#x27;nr&#x27;]&quot;)</span><br><span class="line">Select(sel).select_by_value(&#x27;50&#x27;)  # 显示50条</span><br></pre></td></tr></table></figure><h2 id="4-10-文件上传"><a href="#4-10-文件上传" class="headerlink" title="4.10 文件上传"></a>4.10 文件上传</h2><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.find_element_by_name(&quot;file&quot;).send_keys(&#x27;D:\\upload_file.txt&#x27;)  # # 定位上传按钮，添加本地文件</span><br></pre></td></tr></table></figure><h2 id="4-11-cookie操作"><a href="#4-11-cookie操作" class="headerlink" title="4.11 cookie操作"></a>4.11 cookie操作</h2><p>WebDriver操作cookie的方法：</p><ul><li>get_cookies()： 获得所有cookie信息。</li><li>get_cookie(name)： 返回字典的key为“name”的cookie信息。</li><li>add_cookie(cookie_dict) ： 添加cookie。“cookie_dict”指字典对象，必须有name 和value 值。</li><li>delete_cookie(name,optionsString)：删除cookie信息。“name”是要删除的cookie的名称，“optionsString”是该cookie的选项，目前支持的选项包括“路径”，“域”。</li><li>delete_all_cookies()： 删除所有cookie信息</li></ul><h2 id="4-12-调用JavaScript代码"><a href="#4-12-调用JavaScript代码" class="headerlink" title="4.12 调用JavaScript代码"></a>4.12 调用JavaScript代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">js=<span class="string">&quot;window.scrollTo(100,450);&quot;</span></span><br><span class="line">driver.execute_script(js) <span class="comment"># 通过javascript设置浏览器窗口的滚动条位置</span></span><br></pre></td></tr></table></figure><p>通过execute_script()方法执行JavaScripts代码来移动滚动条的位置。</p><h2 id="4-13-窗口截图"><a href="#4-13-窗口截图" class="headerlink" title="4.13 窗口截图"></a>4.13 窗口截图</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">driver.get_screenshot_as_file(<span class="string">&quot;D:\\baidu_img.jpg&quot;</span>) <span class="comment"># 截取当前窗口，并指定截图图片的保存位置</span></span><br></pre></td></tr></table></figure><h2 id="4-14-关闭浏览器"><a href="#4-14-关闭浏览器" class="headerlink" title="4.14 关闭浏览器"></a>4.14 关闭浏览器</h2><ul><li>close() 关闭单个窗口</li><li>quit() 关闭所有窗口</li></ul><h2 id="4-15-直接用cookie登录方法"><a href="#4-15-直接用cookie登录方法" class="headerlink" title="4.15 直接用cookie登录方法"></a>4.15 直接用cookie登录方法</h2><p>链接：<a href="https://link.zhihu.com/?target=https://www.jianshu.com/p/773c58406bdb">https://www.jianshu.com/p/773c58406bdb</a></p><ol><li>手动获取网页的cookie，将其序列化并存储在本地</li><li>写入代码</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> cookies:</span><br><span class="line">    driver.add_cookie(item)</span><br></pre></td></tr></table></figure><h2 id="4-16-导出html到beautifulsoup或文件"><a href="#4-16-导出html到beautifulsoup或文件" class="headerlink" title="4.16 导出html到beautifulsoup或文件"></a>4.16 导出html到beautifulsoup或文件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">soup = BeautifulSoup(driver.page_source,<span class="string">&quot;html.parser&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">writetohtml</span>(<span class="params">driver,path</span>):</span></span><br><span class="line">    f = open(path,<span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">    f.write(driver.page_source.encode(<span class="string">&quot;utf-8&quot;</span>, <span class="string">&quot;ignore&quot;</span>))</span><br><span class="line">    f.close()   </span><br></pre></td></tr></table></figure><h1 id="5：控件操作"><a href="#5：控件操作" class="headerlink" title="5：控件操作"></a>5：控件操作</h1><h2 id="5-1-Select"><a href="#5-1-Select" class="headerlink" title="5.1 Select"></a>5.1 Select</h2><p><code>Select</code>类提供了三种选择某些选项的方法：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select_by_index(index)</span><br><span class="line">select_by_value(value)</span><br><span class="line">select_by_visible_text(text)</span><br></pre></td></tr></table></figure><blockquote><p>index从0开始，第一个option为0</p><p>value是标签的属性值</p><p>visible_text是option标签中间的值，即下拉框可见值</p></blockquote><p>自然的，有选择必然有反选，即取消选择。<code>Select</code>提供了四个方法给我们取消原来的选择：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deselect_by_index(index)</span><br><span class="line">deselect_by_value(value)</span><br><span class="line">deselect_by_visible_text(text)</span><br><span class="line">deselect_all()</span><br></pre></td></tr></table></figure><p>前一种分别于<code>select</code>相对应，第四种是全部取消选择，是的，你没看错，是全部取消。有一种特殊的选择标签，即设置了<code>multiple=&quot;multiple&quot;</code>属性的<code>select</code>，这种<code>select</code>框是可以多选的，你可以通过多次<code>select</code>，选择多个选项，而通过<code>deselect_all()</code>来将他们全部取消。</p><p>当我们选择了选项之后，想要看看选择的是哪项，替代的是否是我想选的，怎么办？别担心，<code>Select</code>为你提供了相应的方法（或者应该说是属性了）：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">options</span><br><span class="line">all_selected_options</span><br><span class="line">first_selected_option</span><br></pre></td></tr></table></figure><p>上面三个属性，分别返回这个<code>select</code>元素所有的<code>options</code>，所有被选中的<code>options</code>以及第一个被选中的<code>option</code>。</p><h2 id="5-2-Radio和Checkbox"><a href="#5-2-Radio和Checkbox" class="headerlink" title="5.2 Radio和Checkbox"></a>5.2 Radio和Checkbox</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">Checkbox:</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">value</span>=<span class="string">&quot;cv1&quot;</span> <span class="attr">name</span>=<span class="string">&quot;c1&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">value</span>=<span class="string">&quot;cv2&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">value</span>=<span class="string">&quot;cv3&quot;</span> <span class="attr">name</span>=<span class="string">&quot;c1&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">value</span>=<span class="string">&quot;cv4&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">Radio:</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">value</span>=<span class="string">&quot;rv1&quot;</span> <span class="attr">name</span>=<span class="string">&quot;r1&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">value</span>=<span class="string">&quot;rv2&quot;</span> <span class="attr">name</span>=<span class="string">&quot;r1&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>选择操作即点击事件，清除选择即键盘操作</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># checkbox</span></span><br><span class="line">driver.find_element_by_xpath(<span class="string">&#x27;//input[@value=&quot;cv1&quot;]&#x27;</span>).click()  <span class="comment"># click</span></span><br><span class="line">driver.find_element_by_xpath(<span class="string">&#x27;//input[@value=&quot;cv2&quot;]&#x27;</span>).send_keys(Keys.SPACE)  <span class="comment"># send space</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># radio</span></span><br><span class="line">driver.find_element_by_xpath(<span class="string">&#x27;//input[@value=&quot;rv1&quot;]&#x27;</span>).send_keys(Keys.SPACE)  <span class="comment"># send space</span></span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">driver.find_element_by_xpath(<span class="string">&#x27;//input[@value=&quot;rv2&quot;]&#x27;</span>).click()  <span class="comment"># click</span></span><br></pre></td></tr></table></figure><h1 id="6：参考资料"><a href="#6：参考资料" class="headerlink" title="6：参考资料"></a>6：参考资料</h1><p>《<a href="https://zhuanlan.zhihu.com/p/111859925">Selenium Python 教程</a>》</p><p>《<a href="https://zhuanlan.zhihu.com/p/60852696">selenium启动Chrome配置参数问题</a>》</p><p>《<a href="https://huilansame.github.io/huilansame.github.io/archivers/mouse-and-keyboard-actionchains">Python硒-模拟鼠标键盘操作（ActionChains）</a>》</p><p>《<a href="https://huilansame.github.io/huilansame.github.io/archivers/drop-down-select">Python硒-操作选择标签的下拉选择框</a>》</p><p>《<a href="https://www.jianshu.com/p/773c58406bdb">Python+selenium使用cookie登录淘宝</a>》</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Selenium </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>利用树莓派+内网穿透搭建网站服务器</title>
      <link href="/2020/09/10/%E5%88%A9%E7%94%A8%E6%A0%91%E8%8E%93%E6%B4%BE-%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E6%90%AD%E5%BB%BA%E7%BD%91%E7%AB%99%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
      <url>/2020/09/10/%E5%88%A9%E7%94%A8%E6%A0%91%E8%8E%93%E6%B4%BE-%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8F%E6%90%AD%E5%BB%BA%E7%BD%91%E7%AB%99%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="1：前言"><a href="#1：前言" class="headerlink" title="1：前言"></a>1：前言</h1><p>在购买了树莓派之后，我一直在找寻它的用处，最近想学基于Python的网站后端框架Django，而树莓派以linux为操作系统，有天生作为网站服务器的优点。以下列举部分。</p><ol><li>相比于直接购买高配置VPS，使用树莓派+廉价低配VPS做内网穿透，更加划算。</li><li>相比于使用windows作为网站服务器联系，树莓派可以保持24*7不宕机，避免每次开启电脑都要重新运行服务器程序的麻烦。</li></ol><p>开始之前，需要说明的一些软硬件配置。</p><ol><li>4B+树莓派，4g内存+32g内存卡</li><li>一台低配置带ipv4地址的VPS。本人使用Ubuntu系统</li><li>一个域名，需要将A记录解析到VPS的ipv4地址上。非必须，可直接用vps的ip地址访问也是可以的。</li></ol><h1 id="2：树莓派上搭建Django服务器"><a href="#2：树莓派上搭建Django服务器" class="headerlink" title="2：树莓派上搭建Django服务器"></a>2：树莓派上搭建Django服务器</h1><p>安装Django教程：《<a href="https://www.runoob.com/django/django-install.html">Django安装</a>》</p><p>在树莓派上安装Django。</p><p>并<a href="https://www.runoob.com/django/django-first-app.html">创建第一个Django项目</a>。</p><p>在使用<code>python3 manage.py runserver 0.0.0.0:8000</code>打开服务后，</p><p>在shell终端上使用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl 127.0.0.1:8000</span><br></pre></td></tr></table></figure><p>是可以访问新建的网站的。</p><p>但是，使用树莓派内网ip:8000在相同局域网下的笔记本，无法访问网站，必须修改项目配置文件。后期可修改回来，因为我们需要在树莓派上也安装nginx以作为生产环境，现在只是测试。修改项目下的setting.py文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DEBUG = False</span><br><span class="line">ALLOWED_HOSTS = [&quot;*&quot;]</span><br></pre></td></tr></table></figure><p>此时，在笔记本上访问树莓派上面的网站，应该已经能够访问了。</p><h1 id="3：内网穿透"><a href="#3：内网穿透" class="headerlink" title="3：内网穿透"></a>3：内网穿透</h1><p>为了让外网的人，能够使用ip地址或者域名，访问到树莓派上的网站，需要做内网穿透，首先，需要让VPS能够访问到树莓派。</p><p>使用花生壳之类的软件也能实现内网穿透，且不用VPS，但是这类软件收费比较高，所以我们可以用VPS自己搞一个内网穿透。</p><p>使用p2p组网的内网穿透软件，比如n2n、zerotier、frp。在github上都能搜得到。frp是一个端口转发的软件，不需要借助别人提供的服务器来做导航，如果只是做网站是非常推荐的，因为这不设及后面讲的nginx做反向代理的步骤，个人是很推荐的。但，如果你有多个VPS或者多个电脑，想组成局域网，建议使用zerotier。我这里使用的是zerotier，因为它配置比较简单。并在此基础上做了网站的反向代理，以实现外网访问内网，和frp直接做端口转发的原理是不同的。</p><p>我们需要分别在树莓派和vps上安装zerotier。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s https://install.zerotier.com | sudo bash</span><br></pre></td></tr></table></figure><p>然后在<a href="https://www.zerotier.com/">zerotier官网</a>创建一个账号，并创建一个网络。可参考教程：</p><p><a href="https://www.jianshu.com/p/eefddb256ad7">内网穿透工具——ZeroTier One的使用</a></p><p>建好网络后，获得十六位网络码</p><p>然后，在树莓派和vps输入命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zerotier-cli join 网络码</span><br></pre></td></tr></table></figure><p>即可加入此网络</p><p>然后回到zerotier官网，管理这两个网络，让他们之间能够互相ping通。此间步骤比较多，需要耐心自学。</p><p>内网穿透实现后，在vps上不仅应该能够ping通树莓派虚拟局域网分配的ip，而且使用虚拟局域网ip:端口，应该能够访问到树莓派上的网站。</p><p>在vps使用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://ip:port</span><br></pre></td></tr></table></figure><p>访问。获取html代码，则内网穿透可以访问网站了。</p><h1 id="4：Nginx反向代理"><a href="#4：Nginx反向代理" class="headerlink" title="4：Nginx反向代理"></a>4：Nginx反向代理</h1><p>为了让所有外部的人，都能够通过域名或者vps公网ip访问到树莓派的网站，需要在vps上安装nginx，作反向代理。</p><p>原理大概是，外部用户，访问vps的ip，浏览器默认不输入端口则访问80端口，http对应80，https对应443。比如用户输入<code>http://x.x.x.x</code>或者<code>http://example.com</code>则默认访问vps的80端口。</p><p>我们需要为vps开放80端口，并将80端口的访问请求转到树莓派的网站端口。</p><p>安装nginx</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install nginx</span><br></pre></td></tr></table></figure><p>配置nginx，新建配置文件，并配置nginx</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch /etc/nginx/conf.d/respberry.conf#新建配置文件</span><br><span class="line">vim /etc/nginx/conf.d/respberry.conf#编辑配置文件</span><br></pre></td></tr></table></figure><p>在文件中输入配置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">listen 80</span><br><span class="line">server_name example.com#你的域名，或者vps的公网ip</span><br><span class="line">location / &#123;</span><br><span class="line">proxy_pass http://树莓派虚拟局域网ip:网站端口</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>保存退出。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service nginx restart#重启nginx</span><br></pre></td></tr></table></figure><p>这样通过域名访问vps就能将请求转给树莓派了。外网就能够访问到树莓派了。</p><h1 id="5：参考资料"><a href="#5：参考资料" class="headerlink" title="5：参考资料"></a>5：参考资料</h1><p>《<a href="https://www.jianshu.com/p/eefddb256ad7">内网穿透工具——ZeroTier One的使用</a>》</p><p>《<a href="https://www.jianshu.com/p/3e2b9964c279">Nginx配置文件nginx.conf中文详解</a>》</p>]]></content>
      
      
      <categories>
          
          <category> 网站编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Python </tag>
            
            <tag> 树莓派 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记录一次在Linux上彻底卸载nginx</title>
      <link href="/2020/09/10/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E5%9C%A8Linux%E4%B8%8A%E5%BD%BB%E5%BA%95%E5%8D%B8%E8%BD%BDnginx/"/>
      <url>/2020/09/10/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E5%9C%A8Linux%E4%B8%8A%E5%BD%BB%E5%BA%95%E5%8D%B8%E8%BD%BDnginx/</url>
      
        <content type="html"><![CDATA[<p>刚想通过nginx做反向代理，以实现内网穿透，但是80端口始终无法ping通，查看linux端口是开着的。思想简单的我，尝试重新安装nginx，然而无论如何都无法卸载干净。首先，nginx可能不是通过apt-get安装的，使用<code>apt remove</code>指令没有卸载掉，于是尝试<code>find / -name nginx -exec rm -rf &#123;&#125; \;</code>来删除所有以nginx命名的目录，然而<code>apt-get install nginx</code>安装后，任然没有把删除的目录重新安装。</p><p>查阅资料后，重新进行了删除和安装</p><p><strong>dpkg指令</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -l#查看安装的软件包</span><br></pre></td></tr></table></figure><p>尽管已经通过删除目录移除了nginx，在软件包列表里仍然存在三个包含nginx的软件，<code>nginx</code>、<code>nginx-core</code>、<code>nginx-common</code></p><p>使用指令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg -r 软件名#分别删除三个软件</span><br></pre></td></tr></table></figure><p>其中<code>nginx-common</code>无法使用上述命令删除，</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get --purge remove nginx-common</span><br></pre></td></tr></table></figure><p>至此nginx以彻底移除。</p><p>使用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install nginx</span><br></pre></td></tr></table></figure><p>重新安装nginx。</p><p>安装结束，访问ip可出现welcome to nginx网页。</p><p>如果没有出现，</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://ip</span><br></pre></td></tr></table></figure><p>如果主机上出现html文本，而浏览器外部无法访问，则是防火墙问题。</p><p>我在ubuntu上安装了firewall软件，因此导致外部无法访问80端口，使用指令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewall.service</span><br></pre></td></tr></table></figure><p>关闭firewall。也可能是iptables开启了，相同的办法可以关闭iptables防火墙。</p><p><strong>参考文献：</strong></p><p>《<a href="https://www.shuzhiduo.com/A/kvJ3Grm7Jg/">Linux之Ubuntu下如何查看已安装的软件/库文件</a>》</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计划为Hexo博客添加相册和Vlog页面</title>
      <link href="/2020/09/08/%E8%AE%A1%E5%88%92%E4%B8%BAHexo%E5%8D%9A%E5%AE%A2%E6%B7%BB%E5%8A%A0%E7%9B%B8%E5%86%8C%E5%92%8CVlog%E9%A1%B5%E9%9D%A2/"/>
      <url>/2020/09/08/%E8%AE%A1%E5%88%92%E4%B8%BAHexo%E5%8D%9A%E5%AE%A2%E6%B7%BB%E5%8A%A0%E7%9B%B8%E5%86%8C%E5%92%8CVlog%E9%A1%B5%E9%9D%A2/</url>
      
        <content type="html"><![CDATA[<p>计划内容：</p><ul><li>新建相册页面，下属图片和vlog分支</li><li>以Onedrive作为储存库，储存相册及视频</li><li>页面自动获取相册和视频，并展示</li><li>首页标题改为计时项目</li></ul><p>项目js源码：<a href="https://www.bingyublog.com/2019/02/20/hexo%E5%A2%9E%E5%8A%A0%E7%BD%91%E7%AB%99%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4%E7%BB%9F%E8%AE%A1/">https://www.bingyublog.com/2019/02/20/hexo%E5%A2%9E%E5%8A%A0%E7%BD%91%E7%AB%99%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4%E7%BB%9F%E8%AE%A1/</a></p>]]></content>
      
      
      <categories>
          
          <category> 网站编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 博客 </tag>
            
            <tag> Hexo </tag>
            
            <tag> Vlantis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>利用海贝音乐做一个自用音乐播放器</title>
      <link href="/2020/09/06/%E5%88%A9%E7%94%A8%E6%B5%B7%E8%B4%9D%E9%9F%B3%E4%B9%90%E5%81%9A%E4%B8%80%E4%B8%AA%E8%87%AA%E7%94%A8%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8/"/>
      <url>/2020/09/06/%E5%88%A9%E7%94%A8%E6%B5%B7%E8%B4%9D%E9%9F%B3%E4%B9%90%E5%81%9A%E4%B8%80%E4%B8%AA%E8%87%AA%E7%94%A8%E9%9F%B3%E4%B9%90%E6%92%AD%E6%94%BE%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="1：项目简介"><a href="#1：项目简介" class="headerlink" title="1：项目简介"></a>1：项目简介</h1><p>对于我这个经常听歌的人来说，免费的听歌软件总是很有用的。我在网上找到了一款叫做海贝音乐的播放器，这个播放器不提供音乐资源，仅仅是一个播放器，可以播放本地音乐、Onedrive云音乐，以及DLNA局域网里的音乐。对于很多人来说，将好听喜欢的音乐下载下来保存到手机，总归是个麻烦的操作，如果想在线听歌，又需要购买音乐软件的VIP。那么有没有一个方法，可以免费而又在不下载音乐在线听歌呢？</p><p>我将利用Onedrive作为音乐储存云盘，并在海贝音乐播放器上，实现在线听歌。将喜欢的音乐下载到Onedrive是个非常麻烦的步骤，为此我将在之后编写一个项目，来实现自动下载热榜音乐至云盘指定目录，并编写一个客户端，用作搜索指定音乐，并保存到云盘的接口。此项目，我将使用python进行编写，并在linux系统上运行。</p><h1 id="2：实现原理"><a href="#2：实现原理" class="headerlink" title="2：实现原理"></a>2：实现原理</h1><h2 id="2-1-音乐来源"><a href="#2-1-音乐来源" class="headerlink" title="2.1 音乐来源"></a>2.1 音乐来源</h2><p>免费音乐接口总是很难获取，甚至很不稳定，为此我们需要合法的获取音乐资源。为此，我考虑从YouTube上获取音乐资源，因为音乐MV和MP3格式的隶属不同版权，而MV往往是不收费的，所以直接从youtube上下载mv的mp4格式文件，这里利用基于python编写的you-get程序即可，然后，利用ffmpeg软件将mp4格式文件转为mp3格式。</p><h2 id="2-2-音乐获取"><a href="#2-2-音乐获取" class="headerlink" title="2.2 音乐获取"></a>2.2 音乐获取</h2><p>获取音乐当然不能一个一个的获取，我们可以在网上找到网易或者qq音乐的榜单api，获取榜单列表，根据列表内容使用程序来检索音乐。</p><p>另外在单独做一个web端，用于搜索音乐。后台根据搜索指令下载音乐。</p><p>歌词可以通过歌词迷接口<a href="https://hacpai.com/article/1364440883834">https://hacpai.com/article/1364440883834</a> 获取。</p><h2 id="2-3-音乐保存"><a href="#2-3-音乐保存" class="headerlink" title="2.3 音乐保存"></a>2.3 音乐保存</h2><p>后台转换后的音乐，可以利用onedrive提供的上传接口，把音乐上传到onedrive目录，比如榜单目录和自行搜索的like目录。</p><p>定期使用onedrive接口清除过时的音乐也很重要。</p><h2 id="2-4-音乐收听"><a href="#2-4-音乐收听" class="headerlink" title="2.4 音乐收听"></a>2.4 音乐收听</h2><p>海贝音乐app提供了从onedrive源收听音乐的功能，因此，直接在海贝音乐上授权onedrive就能够在线收听了，而一个onedrive目录就是一个播放列表。</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 音乐播放器 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>树莓派4B无网线无显示器出发</title>
      <link href="/2020/08/28/%E6%A0%91%E8%8E%93%E6%B4%BE4B%E6%97%A0%E7%BD%91%E7%BA%BF%E6%97%A0%E6%98%BE%E7%A4%BA%E5%99%A8%E5%87%BA%E5%8F%91/"/>
      <url>/2020/08/28/%E6%A0%91%E8%8E%93%E6%B4%BE4B%E6%97%A0%E7%BD%91%E7%BA%BF%E6%97%A0%E6%98%BE%E7%A4%BA%E5%99%A8%E5%87%BA%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<p>从亚马逊新入手了最新款树莓派4B以及相关配件，花了一共109欧。这是第一次把玩树莓派。因为长期浸淫于Linux系统，而受制于surface的小容量硬盘，实在不忍心在电脑上安装一个虚拟机了。之前把玩Linux也是购买的云服务器，但是云服务器是个消耗品啊，而且毕竟是外网，要操做内网设备，比如打印机，就得内网穿透，还是得依赖一个在内网能够长期在线得设备，那么树莓派的作用就不言而喻了。</p><p>树莓派自带GPIO这一点，可玩性也非常高。现在开始安装树莓派系统。</p><h1 id="一：准备工作"><a href="#一：准备工作" class="headerlink" title="一：准备工作"></a>一：准备工作</h1><h2 id="1-1-硬件准备"><a href="#1-1-硬件准备" class="headerlink" title="1.1 硬件准备"></a>1.1 硬件准备</h2><ul><li>树莓派4B及其电源设备</li><li>8G及以上内存卡</li><li>笔记本电脑一台</li><li>WIFI网络，使用手机热点或者WIFI</li></ul><h2 id="1-2-软件准备"><a href="#1-2-软件准备" class="headerlink" title="1.2 软件准备"></a>1.2 软件准备</h2><ul><li><p>SSH连接工具，比如Xshell、Putty。Putty下载，<a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html">点击下载</a></p></li><li><p>Windows 下安装镜像的工具 win32diskimager，<a href="http://file.ncnynl.com/rpi/Win32DiskImager-0.9.5-install.exe">本地下载</a> <a href="https://sourceforge.net/projects/win32diskimager/">官网下载</a></p></li><li><p>树莓派系统镜像文件，下载地址：<a href="https://shumeipai.nxez.com/download">https://shumeipai.nxez.com/download</a> </p></li><li><p>如果需要图形桌面，就下载VNC Viewer，<a href="https://www.realvnc.com/en/connect/download/viewer/">点击下载</a></p></li></ul><h1 id="二：安装系统"><a href="#二：安装系统" class="headerlink" title="二：安装系统"></a>二：安装系统</h1><p>下载树莓派镜像后，解压为.ios后缀的文件。然后利用win32diskimager烧录到SD卡中。<a href="https://www.ncnynl.com/archives/201606/201.html">点击查看详细教程</a></p><p>打开SD卡，在根目录下新建文件名为<code>ssh</code>无后缀名空文件。</p><p>在根目录下新建文件名为<code>wpa_supplicant.conf</code>的文件，文件内容为</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">country=GB</span><br><span class="line">ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev</span><br><span class="line">update_config=1</span><br><span class="line">network=&#123;</span><br><span class="line">    ssid=&quot;spzmi8&quot;</span><br><span class="line">    psk=&quot;yatoummd233&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>ssid：wifi名称</p><p>psk：wifi密码</p></blockquote><p>将SD卡插入树莓派。</p><h1 id="三：登陆树莓派"><a href="#三：登陆树莓派" class="headerlink" title="三：登陆树莓派"></a>三：登陆树莓派</h1><p>将树莓派接通电源，打开ssh软件入putty或者xshell。之后即可登陆树莓派。</p><p>使用以下信息登陆树莓派</p><table><thead><tr><th>主机名</th><th>用户名</th><th>密码</th><th>端口</th></tr></thead><tbody><tr><td>raspberrypi.local</td><td>pi</td><td>raspberry</td><td>22</td></tr></tbody></table><p>至此树莓派已连接成功。</p><h1 id="四：参考资料"><a href="#四：参考资料" class="headerlink" title="四：参考资料"></a>四：参考资料</h1><p>《<a href="https://www.jianshu.com/p/f2710991057e">无显示器、路由器、网线安装树莓派系统</a>》</p><p>《<a href="https://blog.csdn.net/Jack_Lue/article/details/82912327">树莓派3B+无显示器配置详细教程</a>》</p><p>《<a href="https://www.ncnynl.com/archives/201606/201.html">树莓派3-系统安装-Windows下利用Win32DiskImager进行系统安装</a>》</p>]]></content>
      
      
      <categories>
          
          <category> 树莓派 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> 树莓派 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>在订单中打印收货地址二维码</title>
      <link href="/2020/08/28/%E5%9C%A8%E8%AE%A2%E5%8D%95%E4%B8%AD%E6%89%93%E5%8D%B0%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80%E4%BA%8C%E7%BB%B4%E7%A0%81/"/>
      <url>/2020/08/28/%E5%9C%A8%E8%AE%A2%E5%8D%95%E4%B8%AD%E6%89%93%E5%8D%B0%E6%94%B6%E8%B4%A7%E5%9C%B0%E5%9D%80%E4%BA%8C%E7%BB%B4%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<h1 id="一：简介"><a href="#一：简介" class="headerlink" title="一：简介"></a>一：简介</h1><p>七夕节在配送过程中，发现配送员由于文化有限，在使用导航软件上有极大的障碍。这不仅拖慢了整个配送过程，也不利于业务的增长。于是我想到了，在订单上打印一个二维码，扫描二维码，则就可以导航到收货地点。</p><p>在一段时间的尝试后，我敲定了此方案的可行性。</p><p>由于美图和饿了么订单打印，已在飞鹅打印机上固定了模板，我无法修改他们的打印模板。所以，只能为小程序的订单，打印地址二维码。</p><h1 id="二：方案"><a href="#二：方案" class="headerlink" title="二：方案"></a>二：方案</h1><p>由于各个地图公司都没有提供直接的接口，让地图转为二维码，所以退而求其次，需要先将地址转为url，进入这个url可以进入地图界面，然后将url转为二维码。</p><h2 id="2-1-地图转url"><a href="#2-1-地图转url" class="headerlink" title="2.1 地图转url"></a>2.1 地图转url</h2><ol><li><strong>百度地图方案</strong></li></ol><p>在查看了几个地图技术文档后，我找到了百度地图的接口。</p><p>地址：<a href="http://lbsyun.baidu.com/index.php?title=uri/api/web">http://lbsyun.baidu.com/index.php?title=uri/api/web</a></p><p>此接口提供了免费的调起地图的url方案。由于我们只能拿到收货地址，所以可以使用下面的接口</p><p>服务地址</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;api.map.baidu.com&#x2F;geocoder   &#x2F;&#x2F;PC&amp;Webapp服务地址</span><br></pre></td></tr></table></figure><p>示例</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;api.map.baidu.com&#x2F;geocoder?address&#x3D;北京市海淀区上地信息路9号奎科科技大厦&amp;output&#x3D;html&amp;src&#x3D;webapp.baidu.openAPIdemo</span><br></pre></td></tr></table></figure><p>打开后的页面</p><p><img src="https://i.loli.net/2020/08/28/PSI5wTshfGN9z81.png" class="lazyload" data-srcset="https://i.loli.net/2020/08/28/PSI5wTshfGN9z81.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=">2</p><ol start="2"><li><strong>高德地图方案</strong></li></ol><p>高德地图提供Web调起地图的接口格式如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;uri.amap.com&#x2F;marker?position&#x3D;116.473195,39.993253</span><br></pre></td></tr></table></figure><p>url参数：</p><table><thead><tr><th align="left">参数名称</th><th align="left">值(点击可编辑)</th><th align="left">参数说明</th><th align="left">是否必选</th><th align="left">备注</th></tr></thead><tbody><tr><td align="left">position</td><td align="left">116.473195,39.993253</td><td align="left">位置点经纬度坐标，格式为: position=lon,lat</td><td align="left">是</td><td align="left">lon表示经度，lat表示纬度</td></tr><tr><td align="left">name</td><td align="left">首开广场</td><td align="left">用户自定义显示名称</td><td align="left">否</td><td align="left"></td></tr><tr><td align="left">src</td><td align="left">mypage</td><td align="left">使用方来源信息</td><td align="left">否</td><td align="left">为保证服务质量建议填写</td></tr><tr><td align="left">coordinate</td><td align="left">gaode</td><td align="left">坐标系参数coordinate=gaode,表示高德坐标（gcj02坐标），coordinate=wgs84,表示wgs84坐标（GPS原始坐标）</td><td align="left">否</td><td align="left">默认为高德坐标系（gcj02坐标系）</td></tr><tr><td align="left">callnative</td><td align="left">0</td><td align="left">是否尝试调起高德地图APP并在APP中查看，0表示不调起，1表示调起, 默认值为0</td><td align="left">否</td><td align="left">该参数仅在移动端有效</td></tr></tbody></table><p>和百度地图不同的是，这个接口不提供类似搜索功能的接口方式，其中经纬度为必填项，因此，我们必须将订单地址，先调用高德的地理名称转经纬度api，在调用此接口。</p><p>详细的地理编码api参见：<a href="https://lbs.amap.com/api/webservice/guide/api/georegeo/">https://lbs.amap.com/api/webservice/guide/api/georegeo/</a></p><p>通过上述两个api获取，地址的链接，详细php函数如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * [getAddressUrl 生成地址url]</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span>  [string] $taddress [订单地址]</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return</span> [string]       [返回地址url]</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAddressUrl</span>(<span class="params">$address</span>)</span>&#123;</span><br><span class="line">    $api = <span class="string">&quot;https://restapi.amap.com/v3/geocode/geo&quot;</span>;</span><br><span class="line">    $key = <span class="string">&quot;你申请的高德地图key&quot;</span>;</span><br><span class="line">    $request_url = $api.<span class="string">&quot;?address=&quot;</span>.$address.<span class="string">&quot;&amp;output=JSON&amp;key=&quot;</span>.$key;</span><br><span class="line">    $response = file_get_contents($request_url);</span><br><span class="line">    $obj = json_decode($response);</span><br><span class="line">    <span class="keyword">if</span>(strcmp($obj-&gt;status,<span class="string">&quot;1&quot;</span>)==<span class="number">0</span>)&#123;</span><br><span class="line">    $location_code = $obj-&gt;geocodes[<span class="string">&quot;0&quot;</span>]-&gt;location;</span><br><span class="line">    $address_url = <span class="string">&quot;https://uri.amap.com/marker?position=&quot;</span>.$location_code.<span class="string">&quot;&amp;name=&quot;</span>.$address;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $address_url;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>对比高德地图和百度地图。百度地图在编程方面更加方便，但是对于扫描二维码体验而言，百度地图必须使用浏览器扫描，或者微信扫描后根据提示打开浏览器，然后由浏览器调起百度地图进入导航。直接使用百度地图扫描二维码是无法调出导航的，而且百度地图扫描功能隐藏在搜索框之中，使用非常不方便。相对而言，用户使用高德地图api生成的二维码使用高德地图首页的扫一扫功能，可以直接进入导航界面。</p><h2 id="2-2-url转二维码"><a href="#2-2-url转二维码" class="headerlink" title="2.2 url转二维码"></a>2.2 url转二维码</h2><p>在网上能找到许多提供url转二维码的api接口。</p><p>在简书<a href="https://www.jianshu.com/p/064ab5c811cf">https://www.jianshu.com/p/064ab5c811cf</a> 里，提供了许多接口。</p><p>由于飞鹅打印机的技术文档中说明了，只需要在打印时在&lt;QR&gt;标签中输入url即可自动转换，所以，不在需要使用额外的接口。</p><blockquote><p>⭐但是需要注意的是，通过get来获取url二维码，必须先使用url_encode将url编码，否则二维码中将丢失url的参数信息。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 网站编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 电商 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>订单卡片备注自动打印系统</title>
      <link href="/2020/08/26/%E8%AE%A2%E5%8D%95%E5%8D%A1%E7%89%87%E5%A4%87%E6%B3%A8%E8%87%AA%E5%8A%A8%E6%89%93%E5%8D%B0%E7%B3%BB%E7%BB%9F/"/>
      <url>/2020/08/26/%E8%AE%A2%E5%8D%95%E5%8D%A1%E7%89%87%E5%A4%87%E6%B3%A8%E8%87%AA%E5%8A%A8%E6%89%93%E5%8D%B0%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<h1 id="一：系统设计"><a href="#一：系统设计" class="headerlink" title="一：系统设计"></a>一：系统设计</h1><p>系统思维导图：</p><p><img src="https://i.loli.net/2020/08/26/EVucX6TlpsqxiPz.png" class="lazyload" data-srcset="https://i.loli.net/2020/08/26/EVucX6TlpsqxiPz.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>各个接单平台在收到订单后，将订单信息发送给公网服务器，公网服务器从订单信息中提取卡片内容，并将卡片内容发送给和打印机处在同一个局域网环境下的树莓派，树莓派发送打印请求。</p><p>由于打印机的打印请求必须在局域网环境下发出，内网穿透就是必须的步骤，所以这里的树莓派和公网服务器缺一不可，如果有固定的公网ip，则可取消公网服务器步骤，如果打印机支持http发送api请求创建打印进程，则可取消树莓派的作用。</p><h1 id="二：准备工作"><a href="#二：准备工作" class="headerlink" title="二：准备工作"></a>二：准备工作</h1><ol><li>申请美团和饿了么API接口。</li><li>购买公网服务器，推荐阿里云和腾讯云，学生价购买轻量级应用服务器，一年100元左右。我由于已有小程序，因此和小程序公用了同一台服务器。小程序使用的是开源电商平台“ShopXO”。</li><li>树莓派4B和一台打印机。打印机可选普通的喷墨打印机或者标签打印机。喷墨打印机打印的时候需要间歇的将贺卡放入打印机，而标签机则可连续的打印标签，可将打印后的标签贴在贺卡上。各有优缺点，专门购买一个连续打印贺卡的机器通常比较贵。此系统预算在1k元人民币。其中公网服务器100元/年，树莓派可根据自身资金选择，建议在100~500，打印机在300~800。不同的打印机在树莓派编程时，涉及的指令集是不同的。细节可能在后面选好后，在修改这里的内容。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 网站编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 电商系统 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>爬虫基础</title>
      <link href="/2020/07/26/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80/"/>
      <url>/2020/07/26/%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="1-任务介绍和准备工作"><a href="#1-任务介绍和准备工作" class="headerlink" title="1: 任务介绍和准备工作"></a>1: 任务介绍和准备工作</h1><p>爬取豆瓣电影Top250的基本信息。</p><p><a href="https://movie.douban.com/top250">https://movie.douban.com/top250</a></p><p><strong>编码规范：</strong></p><p><img src="https://i.loli.net/2020/07/30/stZfEjhOwmloNMI.png" class="lazyload" data-srcset="https://i.loli.net/2020/07/30/stZfEjhOwmloNMI.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200730095154658"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span>():</span></span><br><span class="line">print(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ = <span class="string">&quot;__main__&quot;</span>:<span class="comment">#入口函数，控制函数的执行顺序</span></span><br><span class="line">hello()</span><br></pre></td></tr></table></figure><p><strong>引入模块：</strong></p><p>目录结构：</p><p>- test1</p><p>​    - t1.py</p><p>- test2</p><p>​    - t2.py</p><p>t1.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">a,b</span>):</span></span><br><span class="line"><span class="keyword">return</span> a+b</span><br><span class="line">print(add(a,b))</span><br></pre></td></tr></table></figure><p>在t2.py中引入，t1.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> test1 <span class="keyword">import</span> t1</span><br><span class="line">print(t1.add(<span class="number">3</span>,<span class="number">5</span>))</span><br></pre></td></tr></table></figure><p>引入第三方模块</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup<span class="comment">#网页解析</span></span><br><span class="line"><span class="keyword">import</span> re<span class="comment">#正则表达式</span></span><br><span class="line"><span class="keyword">import</span> urllib.request,urllib.error<span class="comment">#指定url，获取网页数据</span></span><br><span class="line"><span class="keyword">import</span> xlwt<span class="comment">#进行excel操作</span></span><br><span class="line"><span class="keyword">import</span> sqlite3<span class="comment">#进行SQLite数据库操作</span></span><br></pre></td></tr></table></figure><h1 id="2：构建流程"><a href="#2：构建流程" class="headerlink" title="2：构建流程"></a>2：构建流程</h1><h2 id="2-1-基本框架"><a href="#2-1-基本框架" class="headerlink" title="2.1 基本框架"></a>2.1 基本框架</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    baseurl = <span class="string">&quot;https://movie.douban.com/top250?start=&quot;</span></span><br><span class="line">    <span class="comment">#1.爬取网页</span></span><br><span class="line">    datalist = getData(baseurl)</span><br><span class="line">    savepath = <span class="string">&quot;.\\豆瓣电影Top250&quot;</span></span><br><span class="line">    <span class="comment">#3.保存数据</span></span><br><span class="line">saveData(savepath)</span><br><span class="line">    </span><br><span class="line"><span class="comment">#爬取网页</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getData</span>(<span class="params">baseurl</span>):</span></span><br><span class="line">    datalist = []</span><br><span class="line">    <span class="comment">#2.逐一解析数据</span></span><br><span class="line">    <span class="keyword">return</span> datalist</span><br><span class="line"></span><br><span class="line"><span class="comment">#保存数据</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">saveData</span>(<span class="params">savepath</span>):</span></span><br><span class="line">    <span class="comment">#保存</span></span><br></pre></td></tr></table></figure><h2 id="2-2-获取数据"><a href="#2-2-获取数据" class="headerlink" title="2.2 获取数据"></a>2.2 获取数据</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">askURL</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="comment">#用户代理，告诉豆瓣，浏览器类型</span></span><br><span class="line">head = &#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36&quot;</span>&#125;</span><br><span class="line">    req = urllib.request.Request(url,headers=head)</span><br><span class="line">    html = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = urllib.request.urlospen(req)</span><br><span class="line">        html = response.read().decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        print(html)</span><br><span class="line">    <span class="keyword">except</span> urllib.error.URLError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">if</span> hasattr(e,<span class="string">&quot;code&quot;</span>):s</span><br><span class="line">            print(e.code)</span><br><span class="line">        <span class="keyword">if</span> hasattr(e,<span class="string">&quot;reason&quot;</span>):</span><br><span class="line">            print(e.reason)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getData</span>(<span class="params">baseurl</span>):</span></span><br><span class="line">    datalist = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">10</span>):</span><br><span class="line">        url = baseurl + str(i*<span class="number">25</span>)</span><br><span class="line">        html = askURL(url)</span><br><span class="line">        <span class="comment">#逐一解析网页</span></span><br><span class="line">    <span class="keyword">return</span> datalist</span><br></pre></td></tr></table></figure><h1 id="3：补充Urllib库"><a href="#3：补充Urllib库" class="headerlink" title="3：补充Urllib库"></a>3：补充Urllib库</h1><p>get请求</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">response = urllib.request.urlopen(<span class="string">&quot;https://www.baidu.com&quot;</span>)</span><br><span class="line">print(response.read().decode(<span class="string">&#x27;utf-8&#x27;</span>))<span class="comment">#对获取到的源码进行解码</span></span><br></pre></td></tr></table></figure><p>Post请求</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> urllib,parse</span><br><span class="line"></span><br><span class="line">data = bytes(urllib.parse.urlencode(&#123;<span class="string">&quot;hello&quot;</span>:<span class="string">&quot;world&quot;</span>&#125;),encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">response = urlib.request.urlopen(<span class="string">&quot;http://httpbin.org/post&quot;</span>,data = data)</span><br><span class="line">print(response.read().decode(<span class="string">&quot;utf-8&quot;</span>))</span><br></pre></td></tr></table></figure><p>超时处理：0.01秒内无反应</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">response = urlib.request.urlopen(<span class="string">&quot;http://httpbin.org/get&quot;</span>,timeout = <span class="number">0.01</span>)</span><br><span class="line">    print(response.read().decode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line"><span class="keyword">except</span> urllib.error.URLError <span class="keyword">as</span> e:</span><br><span class="line">    print(<span class="string">&quot;time out&quot;</span>)</span><br></pre></td></tr></table></figure><p>响应内容：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">response.status</span><br><span class="line">response.getheader()</span><br><span class="line">response.getheader(<span class="string">&quot;Server&quot;</span>)</span><br></pre></td></tr></table></figure><p>伪装：headers内容可以在访问网站时查看，request header</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">url = <span class="string">&quot;https://www.douban.com&quot;</span></span><br><span class="line">headers = &#123;<span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36&quot;</span>&#125;</span><br><span class="line">data = bytes(urllib.parse.urlencode(&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;eric&quot;</span>&#125;),encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line"><span class="comment">#封装请求</span></span><br><span class="line">req = urllib.request.Request(url=url,data=data,headers=headers,method=method)</span><br><span class="line">response = urllib.request.urlopen(req)</span><br></pre></td></tr></table></figure><h1 id="4：补充BeautifSoup库"><a href="#4：补充BeautifSoup库" class="headerlink" title="4：补充BeautifSoup库"></a>4：补充BeautifSoup库</h1><p>将复杂的html文档转化为树形文档</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">file = open(<span class="string">&quot;./baidu.html&quot;</span>,<span class="string">&quot;rb&quot;</span>)</span><br><span class="line">html = file.read()</span><br><span class="line">bs = BeautifulSoup(html,<span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line">print(bs.title)</span><br><span class="line"><span class="comment"># &lt;title&gt;The Dormouse&#x27;s story&lt;/title&gt;</span></span><br><span class="line">print(bs.title.string)</span><br><span class="line"><span class="comment">#The Dormouse&#x27;s story</span></span><br><span class="line">print(bs.a.attrs)</span><br><span class="line"><span class="comment">#获取所有属性</span></span><br><span class="line"><span class="comment">#find_all()查找所有的a标签</span></span><br><span class="line">t_lists = bs.find_all(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">t_lists = bs.find_all(re.compile(<span class="string">&quot;a&quot;</span>))</span><br><span class="line"></span><br><span class="line">t_lists = bs.find_all(class=&quot;head&quot;)</span><br><span class="line">t_lists = bs.find_all(class_=<span class="literal">True</span>)</span><br><span class="line">t_lists = bs.find_all(text = re.compile(<span class="string">&quot;\d&quot;</span>))<span class="comment">#查找带数字的文字</span></span><br><span class="line">t_lists = bs.find_all(<span class="string">&quot;a&quot;</span>,limit=<span class="number">3</span>)<span class="comment">#限定三个元素</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Css选择器</span></span><br><span class="line">bs.select(<span class="string">&#x27;title&#x27;</span>)</span><br><span class="line"><span class="comment">#&lt;title&gt;sbianm&lt;title&gt;</span></span><br><span class="line">bs.select(<span class="string">&quot;.mnav&quot;</span>)</span><br><span class="line"><span class="comment">#按类名查找</span></span><br><span class="line">bs.select(<span class="string">&quot;#u1&quot;</span>)</span><br><span class="line"><span class="comment">#按id查找</span></span><br><span class="line">bs.select(<span class="string">&quot;a[class=&#x27;bri&#x27;]&quot;</span>)</span><br><span class="line"><span class="comment">#按照属性查找</span></span><br><span class="line">bs.select(<span class="string">&quot;head&gt;title&quot;</span>)</span><br><span class="line"><span class="comment">#通过子标签来查找</span></span><br><span class="line">bs.select(<span class="string">&quot;.mnv ~ .bri&quot;</span>)</span><br><span class="line"><span class="comment">#查找.mnv类的兄弟标签，且类名为bri</span></span><br></pre></td></tr></table></figure><p>更多内容：<a href="https://beautifulsoup.readthedocs.io/zh_CN/v4.4.0/">https://beautifulsoup.readthedocs.io/zh_CN/v4.4.0/</a></p><h1 id="5：补充正则表达式"><a href="#5：补充正则表达式" class="headerlink" title="5：补充正则表达式"></a>5：补充正则表达式</h1>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 爬虫 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>httponly的Cookie</title>
      <link href="/2020/07/22/httponly%E7%9A%84Cookie/"/>
      <url>/2020/07/22/httponly%E7%9A%84Cookie/</url>
      
        <content type="html"><![CDATA[<p>JS获取cookie的程序是<code>document.cookie</code>，但是为了网站安全。服务器可以设置某些cookie不能使用js获取。这种类型的cookie即使httponly的cookie，而且只有服务器能发送此类cookie。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setcookie(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;test&quot;</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>, <span class="literal">TRUE</span>); </span><br></pre></td></tr></table></figure><p>在最新php中设置cookie的httponly属性，需要将第七个值设置为true。</p><p>在浏览器如何获取httponly属性的cookie呢。需要进入控制台，打开<code>Application</code></p><p><img src="https://i.loli.net/2020/07/22/rxhTneIsZE1cJzq.png" class="lazyload" data-srcset="https://i.loli.net/2020/07/22/rxhTneIsZE1cJzq.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200722173318918"></p><p>设置httponly属性，对于cookie安全非常重要，这样可以防止XSS攻击，攻击者通过植入JS代码，获取网站的cookie，从而以用户身份浏览服务器。</p><p>另外设置cookie过期时间与会话Session时间相同，也能有效保护用户信息安全。</p>]]></content>
      
      
      <categories>
          
          <category> 网站编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cookie </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python基础</title>
      <link href="/2020/07/22/Python%E5%9F%BA%E7%A1%80/"/>
      <url>/2020/07/22/Python%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<h1 id="1-Hello-World"><a href="#1-Hello-World" class="headerlink" title="1: Hello World"></a>1: Hello World</h1><p>windows <code>win</code>+<code>R</code>打开运行菜单，输入<code>CMD</code>，进入终端。输入<code>python</code>进入python终端程序。输入<code>print(&quot;hello,world&quot;)</code>打印文字。</p><p><code>import this</code>打印python之禅</p><p>结束命令提示符：</p><p><code>exit()</code></p><p><code>ctrl</code>+<code>z</code></p><blockquote><p>命令提示符中的每一行是相关联的。</p></blockquote><p>执行以<code>.py</code>结尾文件。</p><p>命令提示符中输入<code>python hello.world.py</code></p><h1 id="2-基础"><a href="#2-基础" class="headerlink" title="2: 基础"></a>2: 基础</h1><h2 id="2-1-注释"><a href="#2-1-注释" class="headerlink" title="2.1 注释"></a>2.1 注释</h2><p><code>#注释</code>：单行注释</p><p><code>***注释***</code>：多行注释 </p><h2 id="2-2-标准化输出"><a href="#2-2-标准化输出" class="headerlink" title="2.2 标准化输出"></a>2.2 标准化输出</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#常规输出</span></span><br><span class="line">print(<span class="string">&quot;标准化输出字符串&quot;</span>)</span><br><span class="line">a = <span class="number">10</span></span><br><span class="line"><span class="comment">#字符连接变量</span></span><br><span class="line">print(<span class="string">&quot;这是变量&quot;</span>, a)</span><br><span class="line"><span class="comment">#变量占位</span></span><br><span class="line">print(<span class="string">&quot;我的年纪是：%d 岁&quot;</span>%a)</span><br><span class="line"><span class="comment">#多变量占位</span></span><br><span class="line">print(<span class="string">&quot;我的名字是%s，我的国籍是%s&quot;</span>%(<span class="string">&quot;小张&quot;</span>,<span class="string">&quot;中国&quot;</span>))</span><br><span class="line"><span class="comment">#多个字符串，空格隔开</span></span><br><span class="line">print(<span class="string">&quot;aaa&quot;</span>,<span class="string">&quot;bbb&quot;</span>,<span class="string">&quot;ccc&quot;</span>)</span><br><span class="line"><span class="comment">#多个字符串，指定.隔开</span></span><br><span class="line">print(<span class="string">&quot;www&quot;</span>,<span class="string">&quot;baidu&quot;</span>,<span class="string">&quot;com&quot;</span>,sep=<span class="string">&quot;.&quot;</span>)</span><br><span class="line"><span class="comment">#无字符串结尾</span></span><br><span class="line">print(<span class="string">&quot;hello&quot;</span>,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="comment">#以空格结尾</span></span><br><span class="line">print(<span class="string">&quot;world&quot;</span>,end=<span class="string">&quot;\t&quot;</span>)</span><br><span class="line"><span class="comment">#以回车符结尾</span></span><br><span class="line">print(<span class="string">&quot;python&quot;</span>,end=<span class="string">&quot;\n&quot;</span>)</span><br></pre></td></tr></table></figure><p>输出：</p><blockquote><p>标准化输出字符串<br>这是变量 10<br>我的年纪是：10 岁<br>我的名字是小张，我的国籍是中国<br>aaa bbb ccc<br><a href="http://www.baidu.com/">www.baidu.com</a><br>helloworld      python</p></blockquote><p>占位符：</p><p><img src="https://i.loli.net/2020/07/22/57QSZPcBOEqXw2m.png" class="lazyload" data-srcset="https://i.loli.net/2020/07/22/57QSZPcBOEqXw2m.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200722151300301"></p><h2 id="2-3-标准化输入"><a href="#2-3-标准化输入" class="headerlink" title="2.3 标准化输入"></a>2.3 标准化输入</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">password = input(<span class="string">&quot;请输入密码&quot;</span>)</span><br><span class="line">print(<span class="string">&quot;您刚才输入的密码是&quot;</span>,password)</span><br><span class="line"><span class="comment">#测试变量类型</span></span><br><span class="line">print(type(password))</span><br></pre></td></tr></table></figure><p>输出：</p><blockquote><p>请输入密码123<br>您刚才输入的密码是 123<br>&lt;class ‘str’&gt;</p></blockquote><p><strong>即使输入数字，input也是字符串</strong></p><p>如果想要输入整型数。使用强制类型转换</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = int(<span class="string">&quot;123&quot;</span>)</span><br><span class="line">print(type(a))</span><br><span class="line">print(<span class="string">&quot;输出的是整型%d&quot;</span>%a)</span><br></pre></td></tr></table></figure><h2 id="2-4-运算符"><a href="#2-4-运算符" class="headerlink" title="2.4 运算符"></a>2.4 运算符</h2><p><img src="https://i.loli.net/2020/07/22/IPZJTEy8KjevLF4.png" class="lazyload" data-srcset="https://i.loli.net/2020/07/22/IPZJTEy8KjevLF4.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200722153157538"></p><p><img src="https://i.loli.net/2020/07/22/xa3uNCHrgq5fwsh.png" class="lazyload" data-srcset="https://i.loli.net/2020/07/22/xa3uNCHrgq5fwsh.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200722153241400"></p><p><img src="https://i.loli.net/2020/07/22/MQloegHN3BLOYsK.png" class="lazyload" data-srcset="https://i.loli.net/2020/07/22/MQloegHN3BLOYsK.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200722153320987"></p><h1 id="3-判断和循环语句"><a href="#3-判断和循环语句" class="headerlink" title="3: 判断和循环语句"></a>3: 判断和循环语句</h1><h2 id="3-1-判断语句："><a href="#3-1-判断语句：" class="headerlink" title="3.1 判断语句："></a>3.1 判断语句：</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> conditino1:</span><br><span class="line">codes</span><br><span class="line"><span class="keyword">elif</span> condition2:</span><br><span class="line">codes</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">codes</span><br></pre></td></tr></table></figure><p>:warning:<strong>缩进</strong>、<strong>冒号</strong>很重要</p><h2 id="3-2-随机生成数："><a href="#3-2-随机生成数：" class="headerlink" title="3.2 随机生成数："></a>3.2 随机生成数：</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="comment">#随机生成[0,2]之间的整数，0、1、2</span></span><br><span class="line">x = random.randint(<span class="number">0</span>,<span class="number">2</span>) </span><br></pre></td></tr></table></figure><h2 id="3-3-导入模块和函数"><a href="#3-3-导入模块和函数" class="headerlink" title="3.3 导入模块和函数"></a>3.3 导入模块和函数</h2><p>导入整个模块：<code>import module</code></p><p>从某个模块中导入某个函数：<code>from module import function</code></p><p>从某个模块导入多个函数：<code>from module import function1, function2</code></p><p>将某个模块的函数全部导入：<code>from module import *</code></p><h2 id="3-4-循环"><a href="#3-4-循环" class="headerlink" title="3.4 循环"></a>3.4 循环</h2><h3 id="3-4-1-for循环"><a href="#3-4-1-for循环" class="headerlink" title="3.4.1 for循环"></a>3.4.1 for循环</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#[0,4]</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">print(i)</span><br><span class="line"></span><br><span class="line"><span class="comment">#步长为3，[0,10]</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">10</span>,<span class="number">3</span>):</span><br><span class="line">    print(i) </span><br><span class="line"></span><br><span class="line"><span class="comment">#打印每个字符 </span></span><br><span class="line">name = <span class="string">&quot;chengdu&quot;</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> name:</span><br><span class="line">    print(x,end=<span class="string">&quot;\t&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#打印列表</span></span><br><span class="line">a = [<span class="string">&quot;aa&quot;</span>,<span class="string">&quot;bb&quot;</span>,<span class="string">&quot;cc&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)):</span><br><span class="line">print(i,a[i])</span><br></pre></td></tr></table></figure><h3 id="3-4-2-while循环"><a href="#3-4-2-while循环" class="headerlink" title="3.4.2 while循环"></a>3.4.2 while循环</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">i=<span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> i&lt;<span class="number">5</span> :</span><br><span class="line">print(i)</span><br><span class="line">i += <span class="number">1</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">print(<span class="string">&quot;while结束&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="3-4-3-break和continue"><a href="#3-4-3-break和continue" class="headerlink" title="3.4.3 break和continue"></a>3.4.3 break和continue</h3><p>break：结束所有循环；</p><p>continue：结束本次循环，进入下次循环。</p><p>pass：占位，什么也不执行，但pass后的同级语句会执行，和空行没区别。</p><h1 id="4-核心数据类型"><a href="#4-核心数据类型" class="headerlink" title="4: 核心数据类型"></a>4: 核心数据类型</h1><h2 id="4-1-字符串"><a href="#4-1-字符串" class="headerlink" title="4.1 字符串"></a>4.1 字符串</h2><p>可使用：单引号、双引号和三引号（三个单或双引号），使用反斜杠<code>\</code>转义</p><h3 id="4-1-1-字符串作为数组"><a href="#4-1-1-字符串作为数组" class="headerlink" title="4.1.1 字符串作为数组"></a>4.1.1 字符串作为数组</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">str = <span class="string">&quot;chengdu&quot;</span></span><br><span class="line">print(str)</span><br><span class="line">print(str[<span class="number">0</span>])</span><br><span class="line">print(str[<span class="number">5</span>:])      <span class="comment">#从索引5到最后</span></span><br><span class="line">print(str[<span class="number">0</span>:<span class="number">5</span>:<span class="number">2</span>])   <span class="comment">#[起始位置:结束位置:步进值]</span></span><br></pre></td></tr></table></figure><blockquote><p>chengdu</p><p>c</p><p>du</p><p>ceg</p></blockquote><h3 id="4-1-2-字符串连接"><a href="#4-1-2-字符串连接" class="headerlink" title="4.1.2 字符串连接"></a>4.1.2 字符串连接</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">print(str+<span class="string">&quot;,nihao&quot;</span>)   <span class="comment">#chengdu,nihao</span></span><br><span class="line">print(str*<span class="number">3</span>)   <span class="comment">#连续打印三次</span></span><br><span class="line">print(<span class="string">&quot;hello\nchengdu&quot;</span>)    <span class="comment">#\n转义为换行</span></span><br><span class="line">print(<span class="string">r&quot;hello\nchengdu&quot;</span>)     <span class="comment">#转义字符不起作用，直接显示</span></span><br></pre></td></tr></table></figure><h3 id="4-1-3-字符串操作函数"><a href="#4-1-3-字符串操作函数" class="headerlink" title="4.1.3 字符串操作函数"></a>4.1.3 字符串操作函数</h3><p><code>bytes.decode</code>字符串解码</p><p><code>isalnum()</code>包含至少一个字母或数字 </p><p><code>isalpha()</code>至少一个且全为字母</p><p><code>isdigit()</code>至少一个且全为数字</p><p><code>join(seq)</code>指定字符串做分隔符，合并新的字符串</p><p><code>split()</code>拆分字符串</p><p><code>lstrip()</code>截掉字符串左边的空格或指定字符</p><p><code>rstrip()</code>截掉右边</p><h2 id="4-2-列表"><a href="#4-2-列表" class="headerlink" title="4.2 列表"></a>4.2 列表</h2><h3 id="4-2-1-定义列表"><a href="#4-2-1-定义列表" class="headerlink" title="4.2.1 定义列表"></a>4.2.1 定义列表</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">list = []</span><br><span class="line">namelist = [<span class="string">&quot;zhang&quot;</span>,<span class="string">&quot;wang&quot;</span>,<span class="number">3</span>]   <span class="comment">#列表中可以存储混合类型</span></span><br></pre></td></tr></table></figure><h3 id="4-2-2-打印"><a href="#4-2-2-打印" class="headerlink" title="4.2.2 打印"></a>4.2.2 打印</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">print(namelist[<span class="number">0</span>])</span><br><span class="line">print(namelist[<span class="number">1</span>])</span><br><span class="line">print(namelist[<span class="number">2</span>])</span><br></pre></td></tr></table></figure><h3 id="4-2-3-遍历列表"><a href="#4-2-3-遍历列表" class="headerlink" title="4.2.3 遍历列表"></a>4.2.3 遍历列表</h3><p>for:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> namelist:</span><br><span class="line">print(name)</span><br><span class="line">print(len(namelist))   <span class="comment">#len()获取列表长度</span></span><br></pre></td></tr></table></figure><p>while:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> i&lt;len(namelist):</span><br><span class="line">print(namelist[i])</span><br><span class="line">i++</span><br></pre></td></tr></table></figure><h3 id="4-2-4-列表操作函数"><a href="#4-2-4-列表操作函数" class="headerlink" title="4.2.4 列表操作函数"></a>4.2.4 列表操作函数</h3><p><code>[ : : ]</code>列表切片</p><p><code>append</code>新增数据到列表尾部</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">namelist.append(<span class="string">&quot;qian&quot;</span>)</span><br><span class="line"></span><br><span class="line">a=[<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">b=[<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">a.append(b)</span><br><span class="line"><span class="comment">#输出[1,2,[3,4]]   将列表作为一个元素加入到a中</span></span><br><span class="line"></span><br><span class="line">a.extend(b)    <span class="comment">#将b中的每个元素逐一追加到a中</span></span><br><span class="line"><span class="comment">#输出[1,2,[3,4],3,4]</span></span><br></pre></td></tr></table></figure><p><code>insert</code>指定下标位置插入元素，</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">a.insert(<span class="number">1</span>,<span class="number">3</span>)<span class="comment">#第一个表示索引下标，第二个表示插入的元素（对象）</span></span><br><span class="line"><span class="comment">#输出[0,3,1,2]</span></span><br></pre></td></tr></table></figure><p><code>del list[index]</code> 在指定位置删除元素</p><p><code>list.pop()</code>弹出末尾最后一个元素</p><p><code>list.remove(&quot;钢铁侠&quot;)</code>直接删除第一个指定内容的元素，还有的同名元素不会被删除。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">movieName = [<span class="string">&quot;加勒比海盗&quot;</span>,<span class="string">&quot;复仇者&quot;</span>,<span class="string">&quot;钢铁侠&quot;</span>,<span class="string">&quot;蜘蛛侠&quot;</span>]</span><br><span class="line"><span class="keyword">del</span> movieName[<span class="number">2</span>]<span class="comment">#删除钢铁侠</span></span><br></pre></td></tr></table></figure><p><code>in</code>某元素是否在列表中</p><p><code>not in</code>不在列表中</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">name = <span class="string">&quot;wang&quot;</span></span><br><span class="line"><span class="keyword">if</span> name <span class="keyword">in</span> namelist:</span><br><span class="line">print(<span class="string">&quot;找到名字wang&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">print(<span class="string">&quot;没找到&quot;</span>)</span><br></pre></td></tr></table></figure><p><code>index</code>查找指定下标范围的元素，返回元素在列表中的索引下标，范围区间，左闭右开</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>,<span class="string">&quot;d&quot;</span>,<span class="string">&quot;e&quot;</span>]</span><br><span class="line">a.index(<span class="string">&quot;c&quot;</span>,<span class="number">1</span>,<span class="number">4</span>)   <span class="comment">#范围是[1,4)</span></span><br><span class="line"><span class="comment">#输出2</span></span><br><span class="line"><span class="comment">#如果没找到会报错</span></span><br></pre></td></tr></table></figure><p><code>count()</code>查找有多少个元素</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a.count(<span class="string">&quot;c&quot;</span>)   </span><br><span class="line"><span class="comment">#输出1</span></span><br></pre></td></tr></table></figure><p><code>reverse()</code>将列表元素从后向前反转</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">1</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">a.reverce()</span><br><span class="line"><span class="comment">#输出[3,2,4,1]</span></span><br></pre></td></tr></table></figure><p><code>sort()</code>排序</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a.sort()</span><br><span class="line"><span class="comment">#输出[1,2,3,4]</span></span><br><span class="line">a.sort(reverse=<span class="literal">True</span>)</span><br><span class="line"><span class="comment">#输出[4,3,2,1]</span></span><br></pre></td></tr></table></figure><h2 id="4-3-元组"><a href="#4-3-元组" class="headerlink" title="4.3 元组"></a>4.3 元组</h2><p>tuple(元组):与list相似，但tuple元素不能修改。</p><p>元组的元素不能改，但包含的对象可以修改。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tup1 = ()<span class="comment">#创建空元组，带引成tuple类型</span></span><br><span class="line">tup2 = (<span class="number">58</span>)<span class="comment">#会打印成整型</span></span><br><span class="line">tup3 = (<span class="number">58</span>,)<span class="comment">#打印成tuple类型</span></span><br></pre></td></tr></table></figure><p>元组寻址：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tup1 = (<span class="string">&quot;abc&quot;</span>,<span class="string">&quot;def&quot;</span>,<span class="number">1421</span>)</span><br><span class="line">print(tup1[<span class="number">0</span>])</span><br><span class="line">print(tup1[<span class="number">-1</span>])<span class="comment">#倒数第一个</span></span><br></pre></td></tr></table></figure><p>元组不能修改：</p><p><del>tup[0] = 1;</del></p><p>元组增：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tup1 = (<span class="number">12</span>,<span class="number">34</span>,<span class="number">56</span>)</span><br><span class="line">tup2 = (<span class="string">&quot;abc&quot;</span>,xyz)</span><br><span class="line">tup3 = tup1 + tup2</span><br></pre></td></tr></table></figure><p>元组删：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">del</span> tup</span><br></pre></td></tr></table></figure><h2 id="4-4-字典"><a href="#4-4-字典" class="headerlink" title="4.4 字典"></a>4.4 字典</h2><p>无序的对象集合，使用键值储存。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">info = &#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;吴彦祖&quot;</span>,<span class="string">&quot;age&quot;</span>:<span class="number">18</span>&#125;</span><br><span class="line">print(info[<span class="string">&quot;name&quot;</span>])</span><br></pre></td></tr></table></figure><p>访问可能不存在的键：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">print(info[<span class="string">&quot;gender&quot;</span>])</span><br><span class="line"><span class="comment">#报错</span></span><br><span class="line">print(info.get(<span class="string">&quot;gender&quot;</span>))</span><br><span class="line"><span class="comment">#输出None</span></span><br><span class="line">print(info,get(<span class="string">&quot;gender&quot;</span>,<span class="string">&quot;m&quot;</span>))</span><br><span class="line"><span class="comment">#没找到默认为m，找到时显示找到的值</span></span><br></pre></td></tr></table></figure><p>字典增：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info[<span class="string">&quot;id&quot;</span>] = <span class="number">12</span></span><br></pre></td></tr></table></figure><p>字典删：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">del</span> info[<span class="string">&quot;name&quot;</span>]<span class="comment">#删除键值对。直接访问键会报错。</span></span><br><span class="line">info.clear<span class="comment">#清空数组，打印：info = &#123;&#125;</span></span><br></pre></td></tr></table></figure><p>字典改：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">info[<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;成龙&quot;</span></span><br></pre></td></tr></table></figure><p>字典查：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">info.keys()<span class="comment">#得到所有的键，列表形式</span></span><br><span class="line">info.values()<span class="comment">#得到所有的值</span></span><br><span class="line">info.items()<span class="comment">#得到所有的项</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#遍历</span></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> info.keys():</span><br><span class="line">print(key)</span><br><span class="line"><span class="keyword">for</span> values <span class="keyword">in</span> info.values():</span><br><span class="line">    print(value)</span><br><span class="line"><span class="keyword">for</span> key,value <span class="keyword">in</span> info.items():</span><br><span class="line">    print(<span class="string">&quot;key=$s,value=%s&quot;</span>%(key,value))</span><br><span class="line"></span><br><span class="line">mylist = [<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>]</span><br><span class="line"><span class="comment">#enumerate枚举类型对象</span></span><br><span class="line"><span class="keyword">for</span> i,x <span class="keyword">in</span> enumerate(mylist):</span><br><span class="line">    print(i,x)</span><br></pre></td></tr></table></figure><h2 id="4-5-集合"><a href="#4-5-集合" class="headerlink" title="4.5 集合"></a>4.5 集合</h2><p>与字典相似，是key的集合，但是key不能重复。</p><p>set可以用来去重。</p><p>小结：</p><p><img src="https://i.loli.net/2020/07/26/Zs3cgdvoN8UrWqQ.png" class="lazyload" data-srcset="https://i.loli.net/2020/07/26/Zs3cgdvoN8UrWqQ.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200726090258027"></p><h1 id="5-函数"><a href="#5-函数" class="headerlink" title="5: 函数"></a>5: 函数</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">printInfo</span>():</span></span><br><span class="line">    print(<span class="string">&quot;---------------------------&quot;</span>)</span><br><span class="line">    print(<span class="string">&quot;     人生苦短，我用python    &quot;</span>)</span><br><span class="line">    print(<span class="string">&quot;---------------------------&quot;</span>)</span><br><span class="line">printInfo()</span><br></pre></td></tr></table></figure><p>带参数的函数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add2Num</span>(<span class="params">a,b</span>):</span></span><br><span class="line">c = a + b</span><br><span class="line">    print(c)</span><br><span class="line">add2Num(<span class="number">11</span>,<span class="number">22</span>)</span><br></pre></td></tr></table></figure><p>带返回值的函数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add2Num</span>(<span class="params">a,b</span>):</span></span><br><span class="line"><span class="keyword">return</span> a+b</span><br><span class="line">result = add2Num(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p>返回多个值：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">divid</span>(<span class="params">a,b</span>):</span></span><br><span class="line">shang = a/b</span><br><span class="line">    yushu = a%b</span><br><span class="line">    <span class="keyword">return</span> shang,yushu</span><br><span class="line">sh,yu = divid(<span class="number">5</span>,<span class="number">2</span>)</span><br><span class="line">print(sh,yu)</span><br></pre></td></tr></table></figure><blockquote><p>函数类，局部变量优先于全局变量</p></blockquote><p>在函数中使用全局变量：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">100</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test1</span>():</span></span><br><span class="line"><span class="keyword">global</span> a<span class="comment">#全局变量标识符</span></span><br><span class="line">    print(a)</span><br><span class="line">    a = <span class="number">200</span></span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure><h1 id="6-文件操作"><a href="#6-文件操作" class="headerlink" title="6: 文件操作"></a>6: 文件操作</h1><h2 id="6-1-打开关闭"><a href="#6-1-打开关闭" class="headerlink" title="6.1 打开关闭"></a>6.1 打开关闭</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">f = open(<span class="string">&quot;test.txt&quot;</span>,<span class="string">&quot;w&quot;</span>)<span class="comment">#打开文件，写模式，不存在文件时，在函数目录路径新建这个文件。</span></span><br><span class="line">f.close()<span class="comment">#关闭文件</span></span><br></pre></td></tr></table></figure><table><thead><tr><th align="left">模式</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">t</td><td align="left">文本模式 (默认)。</td></tr><tr><td align="left">x</td><td align="left">写模式，新建一个文件，如果该文件已存在则会报错。</td></tr><tr><td align="left">b</td><td align="left">二进制模式。</td></tr><tr><td align="left">+</td><td align="left">打开一个文件进行更新(可读可写)。</td></tr><tr><td align="left">U</td><td align="left">通用换行模式（不推荐）。</td></tr><tr><td align="left">r</td><td align="left">以只读方式打开文件。文件的指针将会放在文件的开头。这是默认模式。</td></tr><tr><td align="left">rb</td><td align="left">以二进制格式打开一个文件用于只读。文件指针将会放在文件的开头。这是默认模式。一般用于非文本文件如图片等。</td></tr><tr><td align="left">r+</td><td align="left">打开一个文件用于读写。文件指针将会放在文件的开头。</td></tr><tr><td align="left">rb+</td><td align="left">以二进制格式打开一个文件用于读写。文件指针将会放在文件的开头。一般用于非文本文件如图片等。</td></tr><tr><td align="left">w</td><td align="left">打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。</td></tr><tr><td align="left">wb</td><td align="left">以二进制格式打开一个文件只用于写入。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。一般用于非文本文件如图片等。</td></tr><tr><td align="left">w+</td><td align="left">打开一个文件用于读写。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。</td></tr><tr><td align="left">wb+</td><td align="left">以二进制格式打开一个文件用于读写。如果该文件已存在则打开文件，并从开头开始编辑，即原有内容会被删除。如果该文件不存在，创建新文件。一般用于非文本文件如图片等。</td></tr><tr><td align="left">a</td><td align="left">打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。</td></tr><tr><td align="left">ab</td><td align="left">以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。也就是说，新的内容将会被写入到已有内容之后。如果该文件不存在，创建新文件进行写入。</td></tr><tr><td align="left">a+</td><td align="left">打开一个文件用于读写。如果该文件已存在，文件指针将会放在文件的结尾。文件打开时会是追加模式。如果该文件不存在，创建新文件用于读写。</td></tr><tr><td align="left">ab+</td><td align="left">以二进制格式打开一个文件用于追加。如果该文件已存在，文件指针将会放在文件的结尾。如果该文件不存在，创建新文件用于读写。</td></tr></tbody></table><h2 id="6-2-读取字符"><a href="#6-2-读取字符" class="headerlink" title="6.2 读取字符"></a>6.2 读取字符</h2><p>读取全部行</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">f = open(<span class="string">&quot;test.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">content = f.read(<span class="number">5</span>)<span class="comment">#读五个字符，读取后，指针向后移到5的位置</span></span><br><span class="line">content1 = f.readlines()<span class="comment">#将文档全部读取出来，按行作为一个元素放在列表里。</span></span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure><p>读取一行：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">f = open(<span class="string">&quot;test.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">content1 = f.readline()<span class="comment">#读取一行，指针后移</span></span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure><h2 id="6-3-os库"><a href="#6-3-os库" class="headerlink" title="6.3 os库"></a>6.3 os库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">os.rename(&quot;test.txt&quot;,&quot;abc.txt&quot;)</span><br></pre></td></tr></table></figure><h1 id="7-错误与异常"><a href="#7-错误与异常" class="headerlink" title="7: 错误与异常"></a>7: 错误与异常</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f = open(<span class="string">&quot;123.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)<span class="comment">#如果没有这个文件，就会报错</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">print(<span class="string">&quot;---1---&quot;</span>)</span><br><span class="line">f = open(<span class="string">&quot;123.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">print(<span class="string">&quot;---2---&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> IOError:<span class="comment">#文件没找到属于IO异常</span></span><br><span class="line">    <span class="keyword">pass</span><span class="comment">#捕获异常后的处理</span></span><br></pre></td></tr></table></figure><p>要捕获异常类型，才不会报错</p><p>捕获多个异常：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">print(<span class="string">&quot;---1---&quot;</span>)</span><br><span class="line">f = open(<span class="string">&quot;123.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">print(<span class="string">&quot;---2---&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> (IOError,NameError):</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p>获取错误描述：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">print(<span class="string">&quot;---1---&quot;</span>)</span><br><span class="line">f = open(<span class="string">&quot;123.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">print(<span class="string">&quot;---2---&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> IOError <span class="keyword">as</span> result:</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure><p>捕获所有异常：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">print(<span class="string">&quot;---1---&quot;</span>)</span><br><span class="line">f = open(<span class="string">&quot;123.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">print(<span class="string">&quot;---2---&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> result:</span><br><span class="line">    print(result)<span class="comment">#捕获异常后的处理</span></span><br></pre></td></tr></table></figure><p>try finally:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">f = open(<span class="string">&quot;123.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> result:</span><br><span class="line">print(result)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>php和js中的JSON操作</title>
      <link href="/2020/07/17/php%E5%92%8Cjs%E4%B8%AD%E7%9A%84JSON%E6%93%8D%E4%BD%9C/"/>
      <url>/2020/07/17/php%E5%92%8Cjs%E4%B8%AD%E7%9A%84JSON%E6%93%8D%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<h1 id="1：基本知识"><a href="#1：基本知识" class="headerlink" title="1：基本知识"></a>1：基本知识</h1><p><em>JSON</em>(JavaScript Object Notation, JS 对象简谱) 是一种轻量级的数据交换格式。这种格式的特点如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;[&#123;&quot;name&quot;:&quot;zhangsan&quot;,&quot;age&quot;:54&#125;],</span><br><span class="line">[&#123;&quot;name&quot;:&quot;lisi&quot;,&quot;age&quot;:56&#125;]&#125;</span><br></pre></td></tr></table></figure><p><strong>说明：</strong></p><ul><li><p>以上JSON数据包含了一个对象，最外侧的<code>&#123;&#125;</code>，对象内部包含了两个数组<code>[]</code>,每个数组内都有一个结构类似的对象，内侧的<code>&#123;&#125;</code>。</p></li><li><p>对象和数组是构成JSON的基本要素，数组的出现是为了让结构相同，即键名<code>例如：name、age</code>相同的对象，排列更加整齐，也方便我们用数组的方法提取。</p></li></ul><p>由于前后端数据传递的特点，<strong>对象或者数组格式的数据不能直接从php传递到前端js</strong>。因此，我们将php中的对象/数组数据，转为字符串格式的JSON数据，然后传递到前端，前端js再将其转为对象或数组格式。反之亦然。</p><h1 id="2：php中的json处理"><a href="#2：php中的json处理" class="headerlink" title="2：php中的json处理"></a>2：php中的json处理</h1><p>php中主要有两个函数处理json数据: <code>json_encode</code>、<code>json_decode</code></p><h2 id="2-1-json-encode"><a href="#2-1-json-encode" class="headerlink" title="2.1 json_encode"></a>2.1 json_encode</h2><p>json_encode:将数组、对象转为json格式的字符串。</p><ul><li>例如：php中有一个数组，其包含键名和键值。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$arr = [</span><br><span class="line">    <span class="string">&#x27;appid&#x27;</span> =&gt; <span class="string">&#x27;121434352&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;appkey&#x27;</span> =&gt; <span class="string">&#x27;19b8b372c501e1fbedead782d46199a&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;callback&#x27;</span> =&gt; <span class="string">&#x27;http://example.com/callback.php&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;scope&#x27;</span> =&gt; <span class="string">&#x27;add_t,add_pic_t,del_t&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;errorReport&#x27;</span> =&gt; <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&#x27;storageType&#x27;</span> =&gt; <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;host&#x27;</span> =&gt; <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;user&#x27;</span> =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span> =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;database&#x27;</span> =&gt; <span class="string">&#x27;test&#x27;</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure><p>使用将其转为字符串</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$str = json_encode($arr);</span><br><span class="line"><span class="keyword">echo</span> $str;</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;appid&quot;</span>:<span class="string">&quot;121434352&quot;</span>,<span class="attr">&quot;appkey&quot;</span>:<span class="string">&quot;19b8b372c501e1fbedead782d46199a&quot;</span>,<span class="attr">&quot;callback&quot;</span>:<span class="string">&quot;http:\/\/example.com\/callback.php&quot;</span>,<span class="attr">&quot;scope&quot;</span>:<span class="string">&quot;add_t,add_pic_t,del_t&quot;</span>,<span class="attr">&quot;errorReport&quot;</span>:<span class="literal">true</span>,<span class="attr">&quot;storageType&quot;</span>:<span class="string">&quot;file&quot;</span>,<span class="attr">&quot;host&quot;</span>:<span class="string">&quot;localhost&quot;</span>,<span class="attr">&quot;user&quot;</span>:<span class="string">&quot;root&quot;</span>,<span class="attr">&quot;password&quot;</span>:<span class="string">&quot;root&quot;</span>,<span class="attr">&quot;database&quot;</span>:<span class="string">&quot;test&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>可以看到，数组被转换成了一个对象样式的JSON数据。</p><ul><li>如果一个数组，索引为数字。</li></ul><p>例如：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$arr = <span class="keyword">array</span>(<span class="string">&#x27;a&#x27;</span> , <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>);</span><br><span class="line">json_encode($arr);</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>]</span><br></pre></td></tr></table></figure><p>可看到其输出仍为数组格式。</p><ul><li>如果希望将键名键值格式的数组转换后格式仍保留。可以对其排序，排序后，会丢失键名。索引统一变为数字。</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$arr = <span class="keyword">array</span>(<span class="string">&#x27;1&#x27;</span> =&gt; <span class="string">&#x27;a&#x27;</span> , <span class="string">&#x27;2&#x27;</span> =&gt; <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;3&#x27;</span> =&gt; <span class="string">&#x27;c&#x27;</span>);</span><br><span class="line">sort($arr);</span><br><span class="line">json_encode($arr);</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]</span><br></pre></td></tr></table></figure><h2 id="2-2-json-decode"><a href="#2-2-json-decode" class="headerlink" title="2.2 json_decode"></a>2.2 json_decode</h2><p>json_decode:将字符串转为对象/数组格式。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$str = <span class="string">&#x27;&#123;&quot;appid&quot;:&quot;121434352&quot;,&quot;appkey&quot;:&quot;19b8b372c501e1fbedead782d46199a&quot;,&quot;callback&quot;:&quot;http:\/\/example.com\/callback.php&quot;,&quot;scope&quot;:&quot;add_t,add_pic_t,del_t&quot;,&quot;errorReport&quot;:true,&quot;storageType&quot;:&quot;file&quot;,&quot;host&quot;:&quot;localhost&quot;,&quot;user&quot;:&quot;root&quot;,&quot;password&quot;:&quot;root&quot;,&quot;database&quot;:&quot;test&quot;&#125;&#x27;</span>;</span><br><span class="line">$obj = json_decode($str);</span><br><span class="line">print_r($obj);</span><br></pre></td></tr></table></figure><p>由于<code>echo</code>只能输出字符串格式数据，<code>print_r</code>和<code>var_dump</code>可以将数组和对象用特定的格式输出。所以这里使用了print_r。</p><p>输出：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">stdClass</span> <span class="keyword">Object</span></span><br><span class="line">(</span><br><span class="line">    [appid] =&gt; <span class="number">121434352</span></span><br><span class="line">    [appkey] =&gt; <span class="number">19</span>b8b372c501e1fbedead782d46199a</span><br><span class="line">    [callback] =&gt; http:<span class="comment">//example.com/callback.php</span></span><br><span class="line">    [scope] =&gt; add_t,add_pic_t,del_t</span><br><span class="line">    [errorReport] =&gt; <span class="number">1</span></span><br><span class="line">    [storageType] =&gt; file</span><br><span class="line">    [host] =&gt; localhost</span><br><span class="line">    [user] =&gt; root</span><br><span class="line">    [password] =&gt; root</span><br><span class="line">    [database] =&gt; test</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>可以看到，json数据被转换成了一个对象。</p><p><strong>也可以修改json_decode参数，将json转为数组</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$str = <span class="string">&#x27;&#123;&quot;appid&quot;:&quot;121434352&quot;,&quot;appkey&quot;:&quot;19b8b372c501e1fbedead782d46199a&quot;,&quot;callback&quot;:&quot;http:\/\/example.com\/callback.php&quot;,&quot;scope&quot;:&quot;add_t,add_pic_t,del_t&quot;,&quot;errorReport&quot;:true,&quot;storageType&quot;:&quot;file&quot;,&quot;host&quot;:&quot;localhost&quot;,&quot;user&quot;:&quot;root&quot;,&quot;password&quot;:&quot;root&quot;,&quot;database&quot;:&quot;test&quot;&#125;&#x27;</span>;</span><br><span class="line">$arr = json_decode($str, <span class="literal">true</span>);</span><br><span class="line">var_dump($arr);</span><br></pre></td></tr></table></figure><p>这里，再json_decode参数里添加true，表示将json转为数组。并使用var_dump来输出数组。</p><p>var_dump输出结果：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">array</span>(<span class="number">10</span>) &#123;</span><br><span class="line">  [<span class="string">&quot;appid&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;121434352&quot;</span></span><br><span class="line">  [<span class="string">&quot;appkey&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">31</span>) <span class="string">&quot;19b8b372c501e1fbedead782d46199a&quot;</span></span><br><span class="line">  [<span class="string">&quot;callback&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">31</span>) <span class="string">&quot;http://example.com/callback.php&quot;</span></span><br><span class="line">  [<span class="string">&quot;scope&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">21</span>) <span class="string">&quot;add_t,add_pic_t,del_t&quot;</span></span><br><span class="line">  [<span class="string">&quot;errorReport&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">bool</span>(<span class="literal">true</span>)</span><br><span class="line">  [<span class="string">&quot;storageType&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;file&quot;</span></span><br><span class="line">  [<span class="string">&quot;host&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;localhost&quot;</span></span><br><span class="line">  [<span class="string">&quot;user&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;root&quot;</span></span><br><span class="line">  [<span class="string">&quot;password&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;root&quot;</span></span><br><span class="line">  [<span class="string">&quot;database&quot;</span>]=&gt;</span><br><span class="line">  <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;test&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对比print_r输出结果：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Array</span></span><br><span class="line">(</span><br><span class="line">    [appid] =&gt; <span class="number">121434352</span></span><br><span class="line">    [appkey] =&gt; <span class="number">19</span>b8b372c501e1fbedead782d46199a</span><br><span class="line">    [callback] =&gt; http:<span class="comment">//example.com/callback.php</span></span><br><span class="line">    [scope] =&gt; add_t,add_pic_t,del_t</span><br><span class="line">    [errorReport] =&gt; <span class="number">1</span></span><br><span class="line">    [storageType] =&gt; file</span><br><span class="line">    [host] =&gt; localhost</span><br><span class="line">    [user] =&gt; root</span><br><span class="line">    [password] =&gt; root</span><br><span class="line">    [database] =&gt; test</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2-3-对象数组操作"><a href="#2-3-对象数组操作" class="headerlink" title="2.3 对象数组操作"></a>2.3 对象数组操作</h2><h3 id="2-3-1-对象操作"><a href="#2-3-1-对象操作" class="headerlink" title="2.3.1 对象操作"></a>2.3.1 对象操作</h3><p>php中，根据对象键名获取键值的方式是<code>-&gt;</code></p><p>比如我们转换了以下对象，</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$str = <span class="string">&#x27;&#123;&quot;appid&quot;:&quot;121434352&quot;,&quot;appkey&quot;:&quot;19b8b372c501e1fbedead782d46199a&quot;,&quot;callback&quot;:&quot;http:\/\/example.com\/callback.php&quot;,&quot;scope&quot;:&quot;add_t,add_pic_t,del_t&quot;,&quot;errorReport&quot;:true,&quot;storageType&quot;:&quot;file&quot;,&quot;host&quot;:&quot;localhost&quot;,&quot;user&quot;:&quot;root&quot;,&quot;password&quot;:&quot;root&quot;,&quot;database&quot;:&quot;test&quot;&#125;&#x27;</span>;</span><br><span class="line">$obj = json_decode($str);</span><br></pre></td></tr></table></figure><p>现在获取appkey</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$appkey = $obj-&gt;appkey;</span><br><span class="line"><span class="keyword">echo</span> $appkey;</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">19</span>b8b372c501e1fbedead782d46199a</span><br></pre></td></tr></table></figure><h3 id="2-3-2-数组操作"><a href="#2-3-2-数组操作" class="headerlink" title="2.3.2 数组操作"></a>2.3.2 数组操作</h3><p>转换的数组：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$str = <span class="string">&#x27;&#123;&quot;appid&quot;:&quot;121434352&quot;,&quot;appkey&quot;:&quot;19b8b372c501e1fbedead782d46199a&quot;,&quot;callback&quot;:&quot;http:\/\/example.com\/callback.php&quot;,&quot;scope&quot;:&quot;add_t,add_pic_t,del_t&quot;,&quot;errorReport&quot;:true,&quot;storageType&quot;:&quot;file&quot;,&quot;host&quot;:&quot;localhost&quot;,&quot;user&quot;:&quot;root&quot;,&quot;password&quot;:&quot;root&quot;,&quot;database&quot;:&quot;test&quot;&#125;&#x27;</span>;</span><br><span class="line">$arr = json_decode($str, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure><p>操作数组，获取appkey：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$appkey = $arr[<span class="string">&#x27;appkey&#x27;</span>];</span><br><span class="line"><span class="keyword">echo</span> $appkey</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">19b8b372c501e1fbedead782d46199a</span><br></pre></td></tr></table></figure><h1 id="3：JS中的json处理"><a href="#3：JS中的json处理" class="headerlink" title="3：JS中的json处理"></a>3：JS中的json处理</h1><p>与php中处理方式相对应，存在<code>JSON.stringify</code>和<code>JSON.parse</code>两个函数</p><h2 id="3-1-JSON-stringify"><a href="#3-1-JSON-stringify" class="headerlink" title="3.1 JSON.stringify"></a>3.1 JSON.stringify</h2><p>对象、数组转为字符串格式。</p><p>对象字符串化：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Person=&#123;&#125;;   <span class="comment">//等同于var Person =new Object();</span></span><br><span class="line"><span class="keyword">var</span> Person=&#123;</span><br><span class="line">name:<span class="string">&quot;Jason&quot;</span>,</span><br><span class="line">age:<span class="number">21</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> str=<span class="built_in">JSON</span>.stringify(Person)</span><br><span class="line">alert(str);</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;Jason&quot;</span>,<span class="string">&quot;age&quot;</span>:<span class="number">21</span>&#125;</span><br></pre></td></tr></table></figure><p>数组字符串化：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mycars=<span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">mycars[<span class="number">0</span>]=<span class="string">&quot;Saab&quot;</span>;</span><br><span class="line">mycars[<span class="number">1</span>]=<span class="string">&quot;Volvo&quot;</span>;</span><br><span class="line">mycars[<span class="number">2</span>]=<span class="string">&quot;BMW&quot;</span>;</span><br><span class="line">alert(<span class="built_in">JSON</span>.stringify(mycars));</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;Saab&quot;</span>,<span class="string">&quot;Volvo&quot;</span>,<span class="string">&quot;BMW&quot;</span>]</span><br></pre></td></tr></table></figure><h2 id="3-2-JSON-parse"><a href="#3-2-JSON-parse" class="headerlink" title="3.2 JSON.parse"></a>3.2 JSON.parse</h2><p>字符串转数组、对象。</p><ul><li>转对象：</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;&#123;&quot;appid&quot;:&quot;121434352&quot;,&quot;appkey&quot;:&quot;19b8b372c501e1fbedead782d46199a&quot;,&quot;callback&quot;:&quot;http:\/\/example.com\/callback.php&quot;,&quot;scope&quot;:&quot;add_t,add_pic_t,del_t&quot;,&quot;errorReport&quot;:true,&quot;storageType&quot;:&quot;file&quot;,&quot;host&quot;:&quot;localhost&quot;,&quot;user&quot;:&quot;root&quot;,&quot;password&quot;:&quot;root&quot;,&quot;database&quot;:&quot;test&quot;&#125;&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> obj= <span class="built_in">JSON</span>.parse(str);</span><br><span class="line">alert(obj);</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[object <span class="built_in">Object</span>]</span><br></pre></td></tr></table></figure><p>以上说明输出的数据格式为对象。</p><ul><li>转数组：</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">&#x27;[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> arr= <span class="built_in">JSON</span>.parse(str);</span><br><span class="line">alert(arr);</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a,b,c</span><br></pre></td></tr></table></figure><h2 id="3-3-对象数组操作"><a href="#3-3-对象数组操作" class="headerlink" title="3.3 对象数组操作"></a>3.3 对象数组操作</h2><h3 id="3-3-1-对象操作"><a href="#3-3-1-对象操作" class="headerlink" title="3.3.1 对象操作"></a>3.3.1 对象操作</h3><p>创建对象：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Person=&#123;&#125;;   <span class="comment">//等同于var Person =new Object();</span></span><br><span class="line"><span class="keyword">var</span> Person=&#123;</span><br><span class="line">name:<span class="string">&quot;Jason&quot;</span>,</span><br><span class="line">age:<span class="number">21</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>获取name对应的键值：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = Person.name;</span><br><span class="line">alert(name);</span><br></pre></td></tr></table></figure><p>或者：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = Person[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">alert(name);</span><br></pre></td></tr></table></figure><h3 id="3-3-2-数组操作"><a href="#3-3-2-数组操作" class="headerlink" title="3.3.2 数组操作"></a>3.3.2 数组操作</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">alert(arr[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网站编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JSON </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git使用记录</title>
      <link href="/2020/07/12/git%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/"/>
      <url>/2020/07/12/git%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h1 id="1：git指令"><a href="#1：git指令" class="headerlink" title="1：git指令"></a>1：git指令</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/user/repo/program.git</span><br></pre></td></tr></table></figure><p>将远程仓库克隆到git打开的目录。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git switch -c dev</span><br></pre></td></tr></table></figure><p>新建并切换至dev分支。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git switch dev</span><br></pre></td></tr></table></figure><p>切换到dev分支</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br></pre></td></tr></table></figure><p>将所有变更提交至缓冲区</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m &quot;message&quot;</span><br></pre></td></tr></table></figure><p>为缓冲区的变更添加更新的提示</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin dev</span><br></pre></td></tr></table></figure><p>将本地缓冲区的变更更新到远程仓库dev分支。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge dev</span><br></pre></td></tr></table></figure><p>将dev分支的内容更新至当前所在分支。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull origin dev</span><br></pre></td></tr></table></figure><p>拉去远程仓库dev分支的内容到本地仓库</p><h1 id="2：-gitignore"><a href="#2：-gitignore" class="headerlink" title="2：.gitignore"></a>2：.gitignore</h1><p>在更新远程仓库时，可以指定部分本地仓库的文件/文件夹不推送至远程仓库。</p><p>在仓库根目录下新建<code>.gitignore</code>文件，直接编辑内容即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;config&#x2F;*</span><br></pre></td></tr></table></figure><p>忽略根目录下的/config文件夹下的所有文件。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config&#x2F;*</span><br></pre></td></tr></table></figure><p>忽略任意路径下的/config文件夹下的所有文件。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;config&#x2F;*!README.md</span><br></pre></td></tr></table></figure><p>忽略根目录下的/config文件夹下除README.md以外的所有文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;config&#x2F;README.md</span><br></pre></td></tr></table></figure><p>忽略根目录下的/config文件夹下的README.md文件</p><h1 id="3：版本控制"><a href="#3：版本控制" class="headerlink" title="3：版本控制"></a>3：版本控制</h1><p>release版本，有助于保存阶段性成果。</p>]]></content>
      
      
      <categories>
          
          <category> 其他 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用JsDelivr给静态资源加速</title>
      <link href="/2020/07/11/%E4%BD%BF%E7%94%A8JsDelivr%E7%BB%99%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%8A%A0%E9%80%9F/"/>
      <url>/2020/07/11/%E4%BD%BF%E7%94%A8JsDelivr%E7%BB%99%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%8A%A0%E9%80%9F/</url>
      
        <content type="html"><![CDATA[<p>github仓库里的js、css静态资源是无法被直接放在网页的静态资源url里的，因此，需要借助第三方工具来引用。</p><p>这里使用JsDelivr。</p><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>打开<a href="https://www.jsdelivr.com/">jsDeliver官网</a>，可以看到使用方式：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; load any GitHub release or commit</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; note: we recommend using npm for projects that support it</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;user&#x2F;repo@version&#x2F;file</span><br></pre></td></tr></table></figure><blockquote><p>user：github用户名</p><p>repo：仓库名</p><p>version：(Tag)版本名</p><p>file：文件路径</p></blockquote><h3 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h3><p>第一步：将静态资源push到仓库</p><p>第二步：release一个版本</p><p>第三步：根据上面的cdn方式，获取静态资源cdn资源。</p><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p>《<a href="https://sparkydogx.github.io/2018/10/12/use-github-js-css/">使用Github托管js和css文件</a>》</p>]]></content>
      
      
      <categories>
          
          <category> 网站编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JsDelivr </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Oneindex+YAAW增加后台离线上传</title>
      <link href="/2020/06/25/Oneindex-YAAW%E5%A2%9E%E5%8A%A0%E5%90%8E%E5%8F%B0%E7%A6%BB%E7%BA%BF%E4%B8%8A%E4%BC%A0/"/>
      <url>/2020/06/25/Oneindex-YAAW%E5%A2%9E%E5%8A%A0%E5%90%8E%E5%8F%B0%E7%A6%BB%E7%BA%BF%E4%B8%8A%E4%BC%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="一：简介"><a href="#一：简介" class="headerlink" title="一：简介"></a>一：简介</h1><p>Yaaw是个开源的aria2的WebUI，通过这个UI可以使用aria2的rpc功能，向aria2发送下载某文件的指令。我将yaaw嵌入到了Oneindex后台，同时在前台也部署了yaaw供游客使用。</p><p>项目地址：<a href="https://github.com/xieqifei/OneindexN">https://github.com/xieqifei/OneindexN</a></p><p>Demo：<a href="https://pan.sci.ci/">https://pan.sci.ci</a></p><p>后台预览：</p><p><img src="https://i.loli.net/2020/06/25/f2SZynlY4DQixwL.png" class="lazyload" data-srcset="https://i.loli.net/2020/06/25/f2SZynlY4DQixwL.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h1 id="二：部署网站"><a href="#二：部署网站" class="headerlink" title="二：部署网站"></a>二：部署网站</h1><p>网站环境尽量使用nginx。后面会用nginx做反代，可以避免修改yaaw的rpc参数。</p><p>在github上将网站下载下来。可以直接下载为zip压缩包</p><p><img src="https://i.loli.net/2020/06/25/T4RShHIUQ9NVEnx.png" class="lazyload" data-srcset="https://i.loli.net/2020/06/25/T4RShHIUQ9NVEnx.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>将文件解压到网站根目录。</p><p>进入网站首页。配置网站。</p><h1 id="三：修改Nginx配置"><a href="#三：修改Nginx配置" class="headerlink" title="三：修改Nginx配置"></a>三：修改Nginx配置</h1><p>添加</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F;jsonrpc &#123;</span><br><span class="line">        proxy_pass http:&#x2F;&#x2F;localhost:6800&#x2F;jsonrpc;</span><br><span class="line">        proxy_redirect off;</span><br><span class="line">        proxy_set_header        X-Real-IP       $remote_addr;</span><br><span class="line">        proxy_set_header        X-Forwarded-For</span><br><span class="line">        $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样RPC可以配置为<code>http://yoursite/jsonrpc</code>。网站后台默认的RPC就是<code>http://yoursite/jsonrpc</code></p><p><img src="https://i.loli.net/2020/06/25/9cY2PiBr6usqXen.png" class="lazyload" data-srcset="https://i.loli.net/2020/06/25/9cY2PiBr6usqXen.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><strong>关闭aria2远程RPC</strong></p><p>仅本地也就是443转发的请求能到达6800。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /root/.aria2c/aria2.conf</span><br></pre></td></tr></table></figure><p>修改aria2配置内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 启用RPC, 默认:false</span><br><span class="line">enable-rpc&#x3D;true</span><br><span class="line"># 接受所有远程请求, 默认:false</span><br><span class="line">rpc-allow-origin-all&#x3D;false</span><br><span class="line"># 允许外部访问, 默认:false</span><br><span class="line">rpc-listen-all&#x3D;false</span><br><span class="line"># RPC监听端口, 端口被占用时可以修改, 默认:6800</span><br><span class="line">rpc-listen-port&#x3D;6800</span><br></pre></td></tr></table></figure><blockquote><p>如果不配置nginx，需要自己修改RPC设置。并且aria2配置需要开放远程RPC</p></blockquote><h1 id="四：参考资料"><a href="#四：参考资料" class="headerlink" title="四：参考资料"></a>四：参考资料</h1><p>《<a href="https://github.com/binux/yaaw">github YAAW项目</a>》</p><p>《<a href="https://github.com/mayswind/AriaNg/issues/62">Issue：一旦使用HTTPS协议就无法连接</a>》</p><p>《<a href="https://kenvix.com/post/nginx-proxy-aria2/">Nginx 反向代理 Aria2 JSONRPC</a>》</p>]]></content>
      
      
      <categories>
          
          <category> 网站编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> YAAW </tag>
            
            <tag> Oneindex </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>部署Aria2+Rclone实现离线下载文件到Onedrive</title>
      <link href="/2020/06/25/%E9%83%A8%E7%BD%B2Aria2-Rclone%E5%AE%9E%E7%8E%B0%E7%A6%BB%E7%BA%BF%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6%E5%88%B0Onedrive/"/>
      <url>/2020/06/25/%E9%83%A8%E7%BD%B2Aria2-Rclone%E5%AE%9E%E7%8E%B0%E7%A6%BB%E7%BA%BF%E4%B8%8B%E8%BD%BD%E6%96%87%E4%BB%B6%E5%88%B0Onedrive/</url>
      
        <content type="html"><![CDATA[<h1 id="一：前言"><a href="#一：前言" class="headerlink" title="一：前言"></a>一：前言</h1><p>Aria2是一款多线程下载的应用，可以充分利用网络带宽，实现满速下载。Rclone是个网盘管理工具，可以绑定Onedrive实现将网盘挂载到本地。利用aria2和Rclone，可以在服务器上通过指令，直接将远程文件下载到本地，并自动保存到Onedrive。</p><h1 id="二：安装Aria2"><a href="#二：安装Aria2" class="headerlink" title="二：安装Aria2"></a>二：安装Aria2</h1><p>推荐使用一键脚本：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">wget</span> <span class="literal">-N</span> git.io/aria2.sh &amp;&amp; chmod +x aria2.sh &amp;&amp; ./aria2.sh</span><br></pre></td></tr></table></figure><p>此脚本会自动下载关联Rclone的脚本，即aria2文件下载结束自动文件上传到Onedrive。</p><h1 id="三：安装rclone"><a href="#三：安装rclone" class="headerlink" title="三：安装rclone"></a>三：安装rclone</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://rclone.org/install.sh | sudo bash</span><br></pre></td></tr></table></figure><p>安装完毕，配置rclone</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rclone config</span><br></pre></td></tr></table></figure><p>配置方式参考《<a href="https://sci.ci/2020/06/22/rclone-zai-win-shang-gua-zai-onedrive/">Rclone在win上挂在Onedrive</a>》，但是不完全相同。</p><p>如果你的系统有UI，那么可以和在win上一样配置rclone。如果是纯指令界面，则按下面操作配置。</p><p>你需要现在windows上部署rclone，以获取onedrive授权的token。token在<code>C:\Users\你的用户名\.config\rclone</code>中</p><p>打开<code>rclone.conf</code>将token从<code>&#123;&quot;access_token&quot;:</code>开始到<code>&#125;</code>结束的内容复制下来。</p><p>在<code>rclone config</code>出现</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Remote config                                                </span><br><span class="line">Use auto config? </span><br><span class="line"> * Say Y if not sure </span><br><span class="line"> * Say N if you are working on a remote or headless machine</span><br><span class="line">y) Yes (default) </span><br><span class="line">n) No                                                        </span><br><span class="line"><span class="meta">y/n&gt;</span></span><br></pre></td></tr></table></figure><p>时输入 <code>n</code>，不自动配置。</p><p>在接下来出现的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result&gt;</span><br></pre></td></tr></table></figure><p>中，输入你拷贝的token。</p><p>剩下的和windows配置相同。</p><p>然后修改aria2配置，以配置将下载文件自动上传到onedrive</p><h1 id="四：配置自动上传脚本"><a href="#四：配置自动上传脚本" class="headerlink" title="四：配置自动上传脚本"></a>四：配置自动上传脚本</h1><p><a href="https://p3terx.com/go/aHR0cHM6Ly9naXRodWIuY29tL1AzVEVSWC9hcmlhMi5zaA==">Aria2 一键安装管理脚本 增强版</a> 整合了 <a href="https://p3terx.com/go/aHR0cHM6Ly9naXRodWIuY29tL1AzVEVSWC9hcmlhMl9wZXJmZWN0X2NvbmZpZw==">Aria2 完美配置</a> ，安装后会附带一些列增强功能脚本，Rclone 自动上传脚本就是其中之一。由于默认不启用，所以需要手动启用。</p><ul><li>输入<code>vim /root/.aria2c/autoupload.sh</code>打开自动上传脚本进行编辑，脚本中有中文注释，按照自己的实际情况进行修改，一般只需要修改下面2个部分。</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Rclone 配置时填写的网盘名(name)</span><br><span class="line">DRIVE_NAME&#x3D;&#39;Onedrive&#39;</span><br><span class="line"># 网盘目录。即上传目标路径，留空为网盘根目录，末尾不要有斜杠。</span><br><span class="line">DRIVE_PATH&#x3D;&#39;&#x2F;DRIVEX&#x2F;Download&#39;</span><br></pre></td></tr></table></figure><ul><li>输入<code>vim /root/.aria2c/aria2.conf</code>打开 Aria2 配置文件进行修改。或使用<a href="https://p3terx.com/go/aHR0cHM6Ly9naXRodWIuY29tL1AzVEVSWC9hcmlhMi5zaA==">Aria2 一键安装管理脚本 增强版</a>中的手动修改选项打开配置文件进行修改。找到“下载完成后执行的命令”，把<code>delete.aria2.sh</code>替换为<code>autoupload.sh</code>。</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 下载完成后执行的命令</span><br><span class="line">on-download-complete&#x3D;&#x2F;root&#x2F;.aria2c&#x2F;autoupload.sh</span><br></pre></td></tr></table></figure><ul><li>重启 Aria2</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service aria2 restart</span><br></pre></td></tr></table></figure><h1 id="五：参考资料"><a href="#五：参考资料" class="headerlink" title="五：参考资料"></a>五：参考资料</h1><p>《<a href="https://p3terx.com/archives/offline-download-of-onedrive-gdrive.html">Aria2 + Rclone 实现 OneDrive、Google Drive 等网盘离线下载</a>》</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rclone </tag>
            
            <tag> Aria2 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rclone在win上挂在Onedrive</title>
      <link href="/2020/06/22/Rclone%E5%9C%A8win%E4%B8%8A%E6%8C%82%E5%9C%A8Onedrive/"/>
      <url>/2020/06/22/Rclone%E5%9C%A8win%E4%B8%8A%E6%8C%82%E5%9C%A8Onedrive/</url>
      
        <content type="html"><![CDATA[<h2 id="一：Rclone下载"><a href="#一：Rclone下载" class="headerlink" title="一：Rclone下载"></a>一：Rclone下载</h2><p>首先下载适用于 Windows 的 rclone 👇</p><p>官网下载：<a href="https://rclone.org/downloads/">https://rclone.org/downloads/</a><br>GitHub下载：<a href="https://github.com/ncw/rclone">https://github.com/ncw/rclone</a></p><p>在<a href="https://rclone.org/downloads/">rclone官网</a>中，Windows 平台下选择下载 AMD64 - 64 Bit</p><p><img src="https://i.loli.net/2020/06/22/flecoyBhTO1kUdQ.png" class="lazyload" data-srcset="https://i.loli.net/2020/06/22/flecoyBhTO1kUdQ.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>或者在<a href="https://github.com/rclone/rclone/releases">github</a>下载。</p><p><img src="https://i.loli.net/2020/06/22/2dAOCENv1Sy8Dwq.png" class="lazyload" data-srcset="https://i.loli.net/2020/06/22/2dAOCENv1Sy8Dwq.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>下载后解压到一个英文路径中。</p><p><img src="https://i.loli.net/2020/06/22/EfHUwhdZGsBmR7c.png" class="lazyload" data-srcset="https://i.loli.net/2020/06/22/EfHUwhdZGsBmR7c.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>另外在Windows平台使用rclone还需要另一个依赖工具<code>winfsp</code>，下载地址：<a href="http://www.secfs.net/winfsp/download/">http://www.secfs.net/winfsp/download/</a> ，下载后一路安装即可。</p><p><img src="https://i.loli.net/2020/06/22/lgdOxXbMBzLwIAV.png" class="lazyload" data-srcset="https://i.loli.net/2020/06/22/lgdOxXbMBzLwIAV.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h2 id="二：-配置环境变量"><a href="#二：-配置环境变量" class="headerlink" title="二： 配置环境变量"></a>二： 配置环境变量</h2><ol><li>在电脑桌面右键点击“此电脑”的“属性”选项</li><li>选择“高级系统设置”选项</li><li>在系统变量中找到path，新建添加刚才解压后的路径</li></ol><p><img src="https://i.loli.net/2020/06/22/nW4auBq5tSxMm6e.png" class="lazyload" data-srcset="https://i.loli.net/2020/06/22/nW4auBq5tSxMm6e.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>检查环境变量是否配置成功。</p><p>按<code>win</code>+<code>X</code>，然后按<code>A</code> 打开 <code>powershell</code> ，当然也可以去打开 <code>cmd</code> ，输入<code>rclone --version</code>，如果出现下面的输出则安装成功，否则检查上面步骤的环境变量是否配置正确。</p><h2 id="三：配置Rclone"><a href="#三：配置Rclone" class="headerlink" title="三：配置Rclone"></a>三：配置Rclone</h2><p>在终端中依次输入以下命令行，请根据我下的步骤进操作。</p><p>下载</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\WINDOWS\system32&gt; rclone config                // 第一步在终端输入 rclone config</span><br><span class="line"><span class="number">2020</span>/<span class="number">06</span>/<span class="number">22</span> <span class="number">19</span>:<span class="number">36</span>:<span class="number">22</span> NOTICE: Config file <span class="string">&quot;C:\\Users\\12412\\.config\\rclone\\rclone.conf&quot;</span> not found - <span class="keyword">using</span> defaults</span><br><span class="line">No remotes found - make a new one</span><br><span class="line">n) New remote</span><br><span class="line">s) <span class="built_in">Set</span> configuration password</span><br><span class="line">q) Quit config</span><br><span class="line">n/s/q&gt; n                                  //第二步输入n创建新的配置， </span><br><span class="line">name&gt; Onedrive_local                      //第三步 输入一个英文名称 ，中间也不要有空格</span><br><span class="line"><span class="built_in">Type</span> of storage to configure.</span><br><span class="line">Enter a string value. Press Enter <span class="keyword">for</span> the default (<span class="string">&quot;&quot;</span>).</span><br><span class="line">Choose a number from below, or <span class="built_in">type</span> <span class="keyword">in</span> your own value</span><br><span class="line"> <span class="number">1</span> / <span class="number">1</span>Fichier</span><br><span class="line">   \ <span class="string">&quot;fichier&quot;</span></span><br><span class="line"> <span class="number">2</span> / Alias <span class="keyword">for</span> an existing remote</span><br><span class="line">   \ <span class="string">&quot;alias&quot;</span></span><br><span class="line"> <span class="number">3</span> / Amazon Drive</span><br><span class="line">   \ <span class="string">&quot;amazon cloud drive&quot;</span></span><br><span class="line"> <span class="number">4</span> / Amazon S3 Compliant Storage Provider (AWS, Alibaba, Ceph, Digital Ocean, Dreamhost, IBM COS, Minio, etc)</span><br><span class="line">   \ <span class="string">&quot;s3&quot;</span></span><br><span class="line"> <span class="number">5</span> / Backblaze B2</span><br><span class="line">   \ <span class="string">&quot;b2&quot;</span></span><br><span class="line"> <span class="number">6</span> / Box</span><br><span class="line">   \ <span class="string">&quot;box&quot;</span></span><br><span class="line"> <span class="number">7</span> / Cache a remote</span><br><span class="line">   \ <span class="string">&quot;cache&quot;</span></span><br><span class="line"> <span class="number">8</span> / Citrix Sharefile</span><br><span class="line">   \ <span class="string">&quot;sharefile&quot;</span></span><br><span class="line"> <span class="number">9</span> / Dropbox</span><br><span class="line">   \ <span class="string">&quot;dropbox&quot;</span></span><br><span class="line"><span class="number">10</span> / Encrypt/Decrypt a remote</span><br><span class="line">   \ <span class="string">&quot;crypt&quot;</span></span><br><span class="line"><span class="number">11</span> / FTP Connection</span><br><span class="line">   \ <span class="string">&quot;ftp&quot;</span></span><br><span class="line"><span class="number">12</span> / Google Cloud Storage (this is not Google Drive)</span><br><span class="line">   \ <span class="string">&quot;google cloud storage&quot;</span></span><br><span class="line"><span class="number">13</span> / Google Drive</span><br><span class="line">   \ <span class="string">&quot;drive&quot;</span></span><br><span class="line"><span class="number">14</span> / Google Photos</span><br><span class="line">   \ <span class="string">&quot;google photos&quot;</span></span><br><span class="line"><span class="number">15</span> / Hubic</span><br><span class="line">   \ <span class="string">&quot;hubic&quot;</span></span><br><span class="line"><span class="number">16</span> / <span class="keyword">In</span> memory object storage system.</span><br><span class="line">   \ <span class="string">&quot;memory&quot;</span></span><br><span class="line"><span class="number">17</span> / Jottacloud</span><br><span class="line">   \ <span class="string">&quot;jottacloud&quot;</span></span><br><span class="line"><span class="number">18</span> / Koofr</span><br><span class="line">   \ <span class="string">&quot;koofr&quot;</span></span><br><span class="line"><span class="number">19</span> / Local Disk</span><br><span class="line">   \ <span class="string">&quot;local&quot;</span></span><br><span class="line"><span class="number">20</span> / Mail.ru Cloud</span><br><span class="line">   \ <span class="string">&quot;mailru&quot;</span></span><br><span class="line"><span class="number">21</span> / Mega</span><br><span class="line">   \ <span class="string">&quot;mega&quot;</span></span><br><span class="line"><span class="number">22</span> / Microsoft Azure Blob Storage</span><br><span class="line">   \ <span class="string">&quot;azureblob&quot;</span></span><br><span class="line"><span class="number">23</span> / Microsoft OneDrive</span><br><span class="line">   \ <span class="string">&quot;onedrive&quot;</span></span><br><span class="line"><span class="number">24</span> / OpenDrive</span><br><span class="line">   \ <span class="string">&quot;opendrive&quot;</span></span><br><span class="line"><span class="number">25</span> / OpenStack Swift (Rackspace Cloud Files, Memset Memstore, OVH)</span><br><span class="line">   \ <span class="string">&quot;swift&quot;</span></span><br><span class="line"><span class="number">26</span> / Pcloud</span><br><span class="line">   \ <span class="string">&quot;pcloud&quot;</span></span><br><span class="line"><span class="number">27</span> / Put.io</span><br><span class="line">   \ <span class="string">&quot;putio&quot;</span></span><br><span class="line"><span class="number">28</span> / QingCloud Object Storage</span><br><span class="line">   \ <span class="string">&quot;qingstor&quot;</span></span><br><span class="line"><span class="number">29</span> / SSH/SFTP Connection</span><br><span class="line">   \ <span class="string">&quot;sftp&quot;</span></span><br><span class="line"><span class="number">30</span> / Sugarsync</span><br><span class="line">   \ <span class="string">&quot;sugarsync&quot;</span></span><br><span class="line"><span class="number">31</span> / Tardigrade Decentralized Cloud Storage</span><br><span class="line">   \ <span class="string">&quot;tardigrade&quot;</span></span><br><span class="line"><span class="number">32</span> / Transparently chunk/split large files</span><br><span class="line">   \ <span class="string">&quot;chunker&quot;</span></span><br><span class="line"><span class="number">33</span> / Union merges the contents of several upstream fs</span><br><span class="line">   \ <span class="string">&quot;union&quot;</span></span><br><span class="line"><span class="number">34</span> / Webdav</span><br><span class="line">   \ <span class="string">&quot;webdav&quot;</span></span><br><span class="line"><span class="number">35</span> / Yandex Disk</span><br><span class="line">   \ <span class="string">&quot;yandex&quot;</span></span><br><span class="line"><span class="number">36</span> / http Connection</span><br><span class="line">   \ <span class="string">&quot;http&quot;</span></span><br><span class="line"><span class="number">37</span> / premiumize.me</span><br><span class="line">   \ <span class="string">&quot;premiumizeme&quot;</span></span><br><span class="line"><span class="number">38</span> / seafile</span><br><span class="line">   \ <span class="string">&quot;seafile&quot;</span></span><br><span class="line">Storage&gt; <span class="number">23</span>                 //第四步 输入要配置的网盘类型 因为我们要配置Microsoft OneDrive 因此输入<span class="number">23</span></span><br><span class="line">** See help <span class="keyword">for</span> onedrive backend at: https://rclone.org/onedrive/ **</span><br><span class="line"></span><br><span class="line">Microsoft App Client Id</span><br><span class="line">Leave blank normally.</span><br><span class="line">Enter a string value. Press Enter <span class="keyword">for</span> the default (<span class="string">&quot;&quot;</span>).</span><br><span class="line">client_id&gt;                //第五步 直接回车</span><br><span class="line">Microsoft App Client Secret</span><br><span class="line">Leave blank normally.</span><br><span class="line">Enter a string value. Press Enter <span class="keyword">for</span> the default (<span class="string">&quot;&quot;</span>).</span><br><span class="line">client_secret&gt;            //第六步 直接回车 </span><br><span class="line">Edit advanced config? (y/n)</span><br><span class="line">y) Yes</span><br><span class="line">n) No (default)</span><br><span class="line">y/n&gt; n                   //第七步 输入n 不进行高级配置 </span><br><span class="line">Remote config</span><br><span class="line">Use auto config?</span><br><span class="line"> * Say Y <span class="keyword">if</span> not sure</span><br><span class="line"> * Say N <span class="keyword">if</span> you are working on a remote or headless machine</span><br><span class="line">y) Yes (default)</span><br><span class="line">n) No</span><br><span class="line">y/n&gt; y                  //第八步 输入y 使用自动配置授权</span><br><span class="line"><span class="keyword">If</span> your browser doesn<span class="string">&#x27;t open automatically go to the following link: http://127.0.0.1:53682/auth?state=DWKiZ1cLZoWl9buxJbPXgw</span></span><br><span class="line"><span class="string">Log in and authorize rclone for access</span></span><br><span class="line"><span class="string">Waiting for code...</span></span><br><span class="line"><span class="string">Got code</span></span><br><span class="line"><span class="string">Choose a number from below, or type in an existing value</span></span><br><span class="line"><span class="string"> 1 / OneDrive Personal or Business</span></span><br><span class="line"><span class="string">   \ &quot;onedrive&quot;</span></span><br><span class="line"><span class="string"> 2 / Root Sharepoint site</span></span><br><span class="line"><span class="string">   \ &quot;sharepoint&quot;</span></span><br><span class="line"><span class="string"> 3 / Type in driveID</span></span><br><span class="line"><span class="string">   \ &quot;driveid&quot;</span></span><br><span class="line"><span class="string"> 4 / Type in SiteID</span></span><br><span class="line"><span class="string">   \ &quot;siteid&quot;</span></span><br><span class="line"><span class="string"> 5 / Search a Sharepoint site</span></span><br><span class="line"><span class="string">   \ &quot;search&quot;</span></span><br><span class="line"><span class="string">Your choice&gt; 1              //第九步 输入1 因为现在我配置的是 OneDrive Personal or Business 类型的网盘</span></span><br><span class="line"><span class="string">Found 1 drives, please select the one you want to use:</span></span><br><span class="line"><span class="string">0:  (personal) id=58719e3298535c9</span></span><br><span class="line"><span class="string">Chose drive to use:&gt; 0     //第十步 输入0</span></span><br><span class="line"><span class="string">Found drive &#x27;</span>root<span class="string">&#x27; of type &#x27;</span>personal<span class="string">&#x27;, URL: https://onedrive.live.com/?cid=058719e3298535c9</span></span><br><span class="line"><span class="string">Is that okay?</span></span><br><span class="line"><span class="string">y) Yes (default)</span></span><br><span class="line"><span class="string">n) No                    //第十一步 直接回车</span></span><br><span class="line"><span class="string">y/n&gt;</span></span><br><span class="line"><span class="string">--------------------</span></span><br><span class="line"><span class="string">[Onedrive_local]</span></span><br><span class="line"><span class="string">type = onedrive</span></span><br><span class="line"><span class="string">token = &#123;&quot;access_token&quot;:&quot;BAAUO9chh8cJscQLmU+LSWpbnr0vmwwAAZ6th5X8qdv3jqko0KCKeFVHdJigXdmpkGf3aO/W9HQahNAmDTxEVF2TnPtPNCw7M/me6FRz4mD9+x/jfJIb8Qewi8NpYMfYXdmPyUUVcPp1G+bwKOIFfJlNa6Can21gaGhTKgdEaz27GwetIvwjy7Qo/eDh/jarwoHEKljM8fN3UF1xz/RS0Ir+DC6CrvNIP3MUpbBF31/qUWJekWn3XqdT1j6m9bBfJ9Xk8heaY1/MT+1SA6fs6IPV5mO5m6dtjfsr1wO3xLGuaEutBPlNT9t219R55MZibwt746mw+VRTMCLsMrFZqVGK6IHzXyG3t+5NOrdP9yelb0AVQDZgAACJVvxd1cmt0LOAKEWlmYeQi3Eo6NKs9l5Abb4AsL2V02tbQt3AheMGLOxpOfyWOUUNaqvFAdSWRGQU8JLgFOA0YWy+UtYHSBG8SIy40jFI5czeqFoCzXguNijP2eiE+JdJREz9fO0q947/QK0K4MxVBqQxmlD1RDujCtnIDsT5r1ICG2AN40wSWqGvanKyctRNPdEm0BjmTrmXh0qTinmJ+BBVe70AU3ZigEzfMULxP+i+vwI2rA7VbiAuXnDUE75t49RGBiCMS+p00x0smGI685pmbPYQoOcMuVLHVdIxSDCO+YLSgpaHaBrruIvFbhto0OczwvYKn8XXEIp0CM6XEy55UYTuLkJFRDWX9VB/mSHarvexYqtEi4EYK2nABm4KrngexH0IdyhdwDKx7gNnLcMP9YYXG0cybppINxx67jFxjQM8/TWQPAz4cADt/FfPPVvuVABOZdhKmpuScj6qOhWsCfh6KH385UiM2Z+Rn2t9hZaXt3ZRmu+W5XAx9+E1SnlewdTiH5/VwB8QhCuRvS89hK/51BeMz4cJ5R9dLEqjGDxZ0HHay52DDhQYta/yG0VN2pkWTg0+T7rVdXbgC607y47sWmqP540tigNZPc0AgrWK3TXFOAJAEAoV9Xg+QUhJKYQNnrtFWI9nKbSFVHEeg8vvl5efZviF2szVI4wProgIHpUydqfnMlR3vRZlei/rmGUC9IICjdNTKPWSGmilJdbdxHMUc/MDyfYhxJA69cwI=&quot;,&quot;token_type&quot;:&quot;Bearer&quot;,&quot;refresh_token&quot;:&quot;MCeVIl4QGaJb!yGdTF6FLD!8N7hR4D8Z1bV4mpta08v64kR!MLcolxhea*NOv24M5V!uqHzBvi5dSW9wVHXGqALSe9kML5HKxV12XougeYafX2dcdyxvZ*cYEa6D0l6hIzovUwFpVjv3lqiP66jpzY4KxYMtZqQHf5PN!VGJf52xDKcsIUseoKD98z7olU3E2kyaZqJW8j6o5dBTV!Lmo5DVc31VpGrfeUnwhOcZkO7xN7IUEy8Vs9YXKQ0C4cin4qpyDSQ3pLpwy09ZpVE2bKOt4XQP7JLWQa6iGQ*r8zgewRo7ULYoEpRXYsqSBdwX6pJEQnRzCDcJimHxXBEV59rE*Ykwc9SijTkBN4haK6br9y2YVQ2UKegfQiErCHY33kzmSMAPJUwiooUNc6GytUz5O6ZxsBMghhb6B6NiSBCs!U5xRon1y*zzOsh9EArHk4y2rihu7BkkC13bJqxeMvhw$&quot;,&quot;expiry&quot;:&quot;2020-06-22T20:38:09.8687266+08:00&quot;&#125;</span></span><br><span class="line"><span class="string">drive_id = 58719e3298825c9</span></span><br><span class="line"><span class="string">drive_type = personal</span></span><br><span class="line"><span class="string">--------------------</span></span><br><span class="line"><span class="string">y) Yes this is OK (default)</span></span><br><span class="line"><span class="string">e) Edit this remote</span></span><br><span class="line"><span class="string">d) Delete this remote</span></span><br><span class="line"><span class="string">y/e/d&gt;                   //第十二步 回车</span></span><br><span class="line"><span class="string">Current remotes:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Name                 Type</span></span><br><span class="line"><span class="string">====                 ====</span></span><br><span class="line"><span class="string">Onedrive_local       onedrive          //显示你的设置则成功！</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">e) Edit existing remote</span></span><br><span class="line"><span class="string">n) New remote</span></span><br><span class="line"><span class="string">d) Delete remote</span></span><br><span class="line"><span class="string">r) Rename remote</span></span><br><span class="line"><span class="string">c) Copy remote</span></span><br><span class="line"><span class="string">s) Set configuration password</span></span><br><span class="line"><span class="string">q) Quit config</span></span><br><span class="line"><span class="string">e/n/d/r/c/s/q&gt; q           //第十三步 输入q结束配置</span></span><br></pre></td></tr></table></figure><h2 id="四：挂载Onedrive到本地"><a href="#四：挂载Onedrive到本地" class="headerlink" title="四：挂载Onedrive到本地"></a>四：挂载Onedrive到本地</h2><ol><li><del>自行下载安装git</del></li></ol><p><del>此时请使用 <code>git bash</code> 的终端执行以下命令，因为我使用<code>cmd</code> 和 <code>powershell</code> 都出现关闭终端后挂载程序退出、本地挂载的OneDrive退出的现象。 如果你的windows没有安装git ， 请[自行安装](<a href="https://www.baidu.com/s?wd=windows">https://www.baidu.com/s?wd=windows</a> 安装git&amp;ie=utf-8)。若你使用 <code>cmd</code> 的话 ，<code>cmd</code> 是不能退出的，要保持 <code>cmd</code> 不退出本地硬盘才一直挂载着。</del></p><ol start="2"><li><del>桌面新建txt文本文件。编辑内容为：</del></li></ol><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">start</span> <span class="string">&quot;&quot;</span> <span class="string">&quot;%ProgramFiles%\Git\git-bash.exe&quot;</span> <span class="literal">-c</span> <span class="string">&quot;rclone mount Onedrive_local:/  Q: --cache-dir C:\Users\97532\Rclone --vfs-cache-mode writes &amp;&quot;</span></span><br></pre></td></tr></table></figure><p><del><code>Onedrive_local</code> 替换为你自己前面设置的名称 。</del></p><p><del><code>Q:</code> 替换为你想要挂载后硬盘的盘符名称即可，记得不要和本地的C盘、D盘等重复。</del></p><p><del><code>C:\Users\97532\Rclone</code> 为本地缓存目录，可自行设置 。</del></p><p><del>上述代码，使用git bash程序执行rclone挂载磁盘的指令。cmd无法识别<code>&amp;</code>，也就是退出程序继续挂载指令。</del></p><ol start="3"><li><del>重命名txt文件为<code>rclone_startup.bat</code></del></li><li><del>双击运行</del></li></ol><p><del><img src="C:\Users\97532\AppData\Roaming\Typora\typora-user-images\image-20200622210455993.png" class="lazyload" data-srcset="C:\Users\97532\AppData\Roaming\Typora\typora-user-images\image-20200622210455993.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="image-20200622210455993"></del></p><p><del>出现：<code>The service rclone has been started</code> 或者磁盘列表出现Onedrive，则说明挂载成功。</del></p><ol start="5"><li><del>设置开机启动</del></li></ol><p><del>由于git程序在重启后会停止，需要将<code>rclone_startup.bat</code>移动到开机启动文件里，每次开机让磁盘自动挂载。</del></p><p><del>将<code>rclone_startup.bat</code>放在<code>C:\Users\用户名\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup</code> 中</del></p><p><del><img src="https://i.loli.net/2020/06/22/Cp7mKkB4tAZ3i9w.png" class="lazyload" data-srcset="https://i.loli.net/2020/06/22/Cp7mKkB4tAZ3i9w.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=">237.png)</del></p><p><del>现在试试重启电脑。。重启后需要等待十几秒，才会运行git bash程序挂载Onedrive。</del></p><p><del>git bash运行后会有一闪而过的黑色窗口。此时磁盘应该挂载成功了</del>。</p><blockquote><p>删掉上面的方法，是由于步骤太过冗杂，需要安装git bash，而且开机启动时存在一闪而过的黑色窗口，运行后的挂载盘也存在问题。</p></blockquote><hr><p>挂载操作在退出cmd后就自动结束了，所以我们需要让它后台运行。<br>rclone虽然提供了<code>--daemon</code>参数来实行后台运行，但是该参数并不适合于windows环境中。会有如下提示：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">λ rclone mount GDrive:&#x2F; x: --cache-dir F:\Temp --vfs-cache-mode writes --daemon</span><br><span class="line">2018&#x2F;05&#x2F;01 09:54:19 background mode not supported on windows platform</span><br></pre></td></tr></table></figure><p>所以，我们需要另外想个办法让rclone能够后端运行以及开机自动挂载。</p><ol><li><strong>新建一个文本文件。</strong></li></ol><p>填入以下内容，<strong>请注意修改倒数第二行的<code>WS.Run</code>中相关命令为你上步成功执行的命令</strong>，然后将该文件名改为<code>rclone.vbs</code> （后缀名为<code>.vbs</code>即可）</p><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Option</span> <span class="keyword">Explicit</span></span><br><span class="line"><span class="keyword">Dim</span> WMIService, Process, Processes, Flag, WS</span><br><span class="line"><span class="keyword">Set</span> WMIService = <span class="built_in">GetObject</span>(<span class="string">&quot;winmgmts:&#123;impersonationlevel=impersonate&#125;!\\.\root\cimv2&quot;</span>)</span><br><span class="line"><span class="keyword">Set</span> Processes = WMIService.ExecQuery(<span class="string">&quot;select * from win32_process&quot;</span>)</span><br><span class="line">Flag = <span class="literal">true</span></span><br><span class="line"><span class="keyword">for</span> <span class="keyword">each</span> Process <span class="keyword">in</span> Processes</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">strcomp</span>(Process.name, <span class="string">&quot;rclone.exe&quot;</span>) = <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">        Flag = <span class="literal">false</span></span><br><span class="line">        <span class="keyword">exit</span> <span class="keyword">for</span></span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">if</span></span><br><span class="line"><span class="keyword">next</span></span><br><span class="line"><span class="keyword">Set</span> WMIService = <span class="literal">nothing</span></span><br><span class="line"><span class="keyword">if</span> Flag <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">Set</span> WS = Wscript.<span class="built_in">CreateObject</span>(<span class="string">&quot;Wscript.Shell&quot;</span>)</span><br><span class="line">    WS.Run <span class="string">&quot;rclone mount Onedrive_local:/  Q: --cache-dir C:\Users\97532\Rclone --vfs-cache-mode writes&quot;</span>, <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span> <span class="keyword">if</span></span><br></pre></td></tr></table></figure><blockquote><p><code>Onedrive_local</code> 替换为你自己前面设置的名称 。</p><p><code>Q:</code> 替换为你想要挂载后硬盘的盘符名称即可，记得不要和本地的C盘、D盘等重复。</p><p><code>C:\Users\97532\Rclone</code> 为本地缓存目录，可自行设置 。</p><p>关于<code>vfs-cache-mode</code>项设置，还是建议看下官方的说明根据自己的需求和网络情况来进行选择 <a href="https://rclone.org/commands/rclone_mount/#file-caching">https://rclone.org/commands/rclone_mount/#file-caching</a> 。这里只做简单说明：</p><ul><li><code>off</code>： 本地不做任何缓存，所有文件直接从云端获取并写入。<strong>建议网速特别好时（复制粘贴大文件时建议至少100M管以上速度）使用。</strong></li><li><code>minimal</code>：（和off类似，但是已经打开的文件会被缓存到本地。<strong>个人推荐，小文件基本够用，但是如果你的网络情况（梯子）不是特别好的话，用writes也行</strong></li><li><code>writes</code>：（如果文件属性为<code>只读</code>则只从云端获取，不然先缓存在本地进行读写操作，随后被同步。<strong>个人推荐使用，但是在直接从本地复制文件到GDrive时还是看网络情况</strong></li><li><code>full</code>：（所有的读写操作都会缓存到磁盘中。然后才会同步。<strong>不是很推荐。会导致所有文件均被缓存到本地。直到达到你缓存总额（–cache-total-chunk-size，默认大小10G）。但是你网速特别差时也可以使用。</strong></li></ul></blockquote><p>如果你需要中断这个挂载操作，请直接在任务管理器中kill掉<code>rclone.exe</code>进程即可。</p><ol start="2"><li><strong>开机自启</strong></li></ol><p>将这个文件<code>rclone.vbs</code>复制（或者剪贴）到开机项中<code>C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp</code>（Windows 10）即可实现开机自动挂载~</p><h2 id="五：参考资料"><a href="#五：参考资料" class="headerlink" title="五：参考资料"></a>五：参考资料</h2><p>《<a href="https://www.lifeee.top/posts/14654.html">Windows平台下使用 Rclone 挂载 OneDrive 为本地硬盘</a>》</p><p>《<a href="https://blog.csdn.net/lilongsy/article/details/89916797">CMD打开Git Bash</a>》</p><p>《<a href="http://www.itkeyword.com/doc/9018080391155886x507/how-to-launch-git-bash-from-dos-command-line">Windows-如何从DOS命令行启动Git Bash？</a>》</p><p>《<a href="https://blog.rhilip.info/archives/874/">使用rclone在Windows下挂载Google个人/团队云盘</a>》</p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rclone </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Oneindex自建不限速网盘</title>
      <link href="/2020/06/22/Oneindex%E8%87%AA%E5%BB%BA%E4%B8%8D%E9%99%90%E9%80%9F%E7%BD%91%E7%9B%98/"/>
      <url>/2020/06/22/Oneindex%E8%87%AA%E5%BB%BA%E4%B8%8D%E9%99%90%E9%80%9F%E7%BD%91%E7%9B%98/</url>
      
        <content type="html"><![CDATA[<p><img src="https://i.loli.net/2020/06/22/49JmMaXqfIx13US.png" class="lazyload" data-srcset="https://i.loli.net/2020/06/22/49JmMaXqfIx13US.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>不占用服务器空间，不走服务器流量，  </p><p>直接列出 OneDrive 目录，文件直链下载。</p><h1 id="一：注册申请000webhost免费主机"><a href="#一：注册申请000webhost免费主机" class="headerlink" title="一：注册申请000webhost免费主机"></a>一：注册申请000webhost免费主机</h1><p>进入 <a href="https://www.000webhost.com/">https://www.000webhost.com/</a></p><p>注册后，在我的网站里创建新网站。</p><p><img src="https://i.loli.net/2020/06/22/CpHtzoaKyFwmNeh.png" class="lazyload" data-srcset="https://i.loli.net/2020/06/22/CpHtzoaKyFwmNeh.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>创建成功后，打开网站后台。</p><p>点击<code>File Manager</code>，或者直接输入网址 <a href="https://files.000webhost.com/">https://files.000webhost.com</a> </p><p><img src="https://i.loli.net/2020/06/22/SfFj2WzEMk3rxq4.png" class="lazyload" data-srcset="https://i.loli.net/2020/06/22/SfFj2WzEMk3rxq4.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>连接你的网站ftp</p><p>输入你的网站名称和密码</p><p><img src="https://i.loli.net/2020/06/22/8dtDAonK3hqpBOS.png" class="lazyload" data-srcset="https://i.loli.net/2020/06/22/8dtDAonK3hqpBOS.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><img src="https://i.loli.net/2020/06/22/rImV6MD2tFXvpcB.png" class="lazyload" data-srcset="https://i.loli.net/2020/06/22/rImV6MD2tFXvpcB.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><code>/public_html</code>就是网站的根目录。将网页的index应放在此目录下</p><h1 id="二：下载和上传网页"><a href="#二：下载和上传网页" class="headerlink" title="二：下载和上传网页"></a>二：下载和上传网页</h1><p>下载程序源码：<a href="https://wwa.lanzous.com/ikFHMdxgkeb">https://wwa.lanzous.com/ikFHMdxgkeb</a></p><p>确保<code>public_html</code>目录里没有任何文件。</p><p>在网站文件管理页面，点击上传文件(upload files)的图标。将压缩包上传到<code>public_html</code>。</p><p>选择文件右键选择解压(extract)。将解压后的所有文件即index.php所在的文件目录下所有的文件移动到<code>public_html</code></p><p>最终结果应如图所示。</p><p><img src="https://i.loli.net/2020/06/22/rImV6MD2tFXvpcB.png" class="lazyload" data-srcset="https://i.loli.net/2020/06/22/rImV6MD2tFXvpcB.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h1 id="三：绑定自己的域名"><a href="#三：绑定自己的域名" class="headerlink" title="三：绑定自己的域名"></a>三：绑定自己的域名</h1><p>webhost给的免费域名是<code>webname.000webhostapp.com</code>，需要自行设置cname解析。解析步骤就不说了。不会的可自行百度。</p><p>cname添加后，还需要在webhost后台设置白名单才能生效。</p><p>在000webhost网站管理后台中，点击<code>Website Settings</code>-&gt;<code>General</code>。</p><p><img src="https://i.loli.net/2020/06/22/7LOBsndZtkCvfxg.png" class="lazyload" data-srcset="https://i.loli.net/2020/06/22/7LOBsndZtkCvfxg.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>在<code>Website Name</code>下面有一段英文，<code>you can change the name of your website here </code>。点击here。进入修改域名界面</p><p><img src="https://i.loli.net/2020/06/22/pFHeLsrxBqJAQOo.png" class="lazyload" data-srcset="https://i.loli.net/2020/06/22/pFHeLsrxBqJAQOo.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>添加你cname解析的域名</p><p><img src="https://i.loli.net/2020/06/22/Aw8iXx2IP9HbZdL.png" class="lazyload" data-srcset="https://i.loli.net/2020/06/22/Aw8iXx2IP9HbZdL.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h1 id="四：安装配置oneindex"><a href="#四：安装配置oneindex" class="headerlink" title="四：安装配置oneindex"></a>四：安装配置oneindex</h1><p>打开你的网盘网页，比如我的 <a href="http://pan.sci.ci/">http://pan.sci.ci</a></p><p>按照提示配置。</p><p>其中应用密钥和id，需要你点击网站给的链接获取。密钥获取结束后，点击密钥界面的回退按钮，在回退的网页里就能找到应用id。</p><img width="658" alt="image" src="https://raw.githubusercontent.com/donwa/oneindex/files/images/install.gif" class="lazyload" data-srcset="https://raw.githubusercontent.com/donwa/oneindex/files/images/install.gif" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=">  <h1 id="五：oneindex其他操作"><a href="#五：oneindex其他操作" class="headerlink" title="五：oneindex其他操作"></a>五：oneindex其他操作</h1><p>onedrive文件管理：<a href="https://onedrive.live.com/">https://onedrive.live.com</a></p><h2 id="5-1-计划任务"><a href="#5-1-计划任务" class="headerlink" title="5.1 计划任务  "></a>5.1 计划任务  </h2><p>[可选]<strong>推荐配置</strong>，非必需。后台定时刷新缓存，可增加前台访问的速度。  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 每小时刷新一次token</span><br><span class="line">0 * * * * &#x2F;具体路径&#x2F;php &#x2F;程序具体路径&#x2F;one.php token:refresh</span><br><span class="line"></span><br><span class="line"># 每十分钟后台刷新一遍缓存</span><br><span class="line">*&#x2F;10 * * * * &#x2F;具体路径&#x2F;php &#x2F;程序具体路径&#x2F;one.php cache:refresh</span><br></pre></td></tr></table></figure><h2 id="5-2-Docker-安装运行"><a href="#5-2-Docker-安装运行" class="headerlink" title="5.2 Docker 安装运行"></a>5.2 Docker 安装运行</h2><ul><li>请参考<a href="https://github.com/TimeBye/oneindex">TimeBye/oneindex</a></li></ul><h2 id="5-3-特殊文件实现功能"><a href="#5-3-特殊文件实现功能" class="headerlink" title="5.3 特殊文件实现功能  "></a>5.3 特殊文件实现功能  </h2><p><code>README.md</code>、<code>HEAD.md</code> 、 <code>.password</code>特殊文件使用  </p><p>可以参考<a href="https://github.com/donwa/oneindex/tree/files">https://github.com/donwa/oneindex/tree/files</a>  </p><p><strong>在文件夹底部添加说明:</strong>  </p><blockquote><p>在 OneDrive 的文件夹中添加<code>README.md</code>文件，使用 Markdown 语法。  </p></blockquote><p><strong>在文件夹头部添加说明:</strong>  </p><blockquote><p>在 OneDrive 的文件夹中添加<code>HEAD.md</code> 文件，使用 Markdown 语法。  </p></blockquote><p><strong>加密文件夹:</strong>  </p><blockquote><p>在 OneDrive 的文件夹中添加<code>.password</code>文件，填入密码，密码不能为空。  </p></blockquote><p><strong>直接输出网页:</strong>  </p><blockquote><p>在 OneDrive 的文件夹中添加<code>index.html</code> 文件，程序会直接输出网页而不列目录。<br>配合 文件展示设置-直接输出 效果更佳。  </p></blockquote><h2 id="5-4-命令行功能"><a href="#5-4-命令行功能" class="headerlink" title="5.4 命令行功能  "></a>5.4 命令行功能  </h2><p>仅能在PHP CLI模式下运行  </p><p><strong>清除缓存:</strong>  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php one.php cache:clear</span><br></pre></td></tr></table></figure><p><strong>刷新缓存:</strong>  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php one.php cache:refresh</span><br></pre></td></tr></table></figure><p><strong>刷新令牌:</strong>  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php one.php token:refresh</span><br></pre></td></tr></table></figure><p><strong>上传文件:</strong>  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php one.php upload:file 本地文件 [OneDrive文件]</span><br></pre></td></tr></table></figure><p><strong>上传文件夹:</strong>  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php one.php upload:folder 本地文件夹 [OneDrive文件夹]</span><br></pre></td></tr></table></figure><p>例如：  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;上传demo.zip 到OneDrive 根目录  </span><br><span class="line">php one.php upload:file demo.zip  </span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;上传demo.zip 到OneDrive &#x2F;test&#x2F;目录  </span><br><span class="line">php one.php upload:file demo.zip &#x2F;test&#x2F;  </span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;上传demo.zip 到OneDrive &#x2F;test&#x2F;目录并将其命名为 d.zip  </span><br><span class="line">php one.php upload:file demo.zip &#x2F;test&#x2F;d.zip  </span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;上传up&#x2F; 到OneDrive &#x2F;test&#x2F; 目录  </span><br><span class="line">php one.php upload:file up&#x2F; &#x2F;test&#x2F;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 网站编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oneindex </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Volantis主题ReadMore自动截取文章内容</title>
      <link href="/2020/06/18/Valantis-ReadMore%E8%87%AA%E5%8A%A8%E6%88%AA%E5%8F%96%E6%96%87%E7%AB%A0%E5%86%85%E5%AE%B9/"/>
      <url>/2020/06/18/Valantis-ReadMore%E8%87%AA%E5%8A%A8%E6%88%AA%E5%8F%96%E6%96%87%E7%AB%A0%E5%86%85%E5%AE%B9/</url>
      
        <content type="html"><![CDATA[<h2 id="1：在主题配置文件里添加键值对"><a href="#1：在主题配置文件里添加键值对" class="headerlink" title="1：在主题配置文件里添加键值对"></a>1：在主题配置文件里添加键值对</h2><p>添加键值对的目的是，控制截取长度和自动截取功能是否开启。在你的博客目录<code>\themes\volantis\_config.yml</code>下添加</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Excerpt </span></span><br><span class="line"><span class="comment">## Auto creat excerpt with not &lt;!--more--&gt;</span></span><br><span class="line"><span class="comment">## Enable will truncate auto_excerpt.lines rows in post head to replace excerpt.</span></span><br><span class="line"><span class="attr">auto_excerpt:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">lines:</span> <span class="number">5</span></span><br></pre></td></tr></table></figure><h2 id="2：修改文章代码"><a href="#2：修改文章代码" class="headerlink" title="2：修改文章代码"></a>2：修改文章代码</h2><p>修改<code>\themes\volantis\layout\_partial</code>文件内容为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;article class&#x3D;&quot;post white-box &lt;%- theme.style.body.effect.join(&#39; &#39;) %&gt; reveal &lt;%&#x3D; (post.title) ? &quot;&quot; : &quot;no-title&quot; %&gt;&quot;&gt;</span><br><span class="line">  &lt;%- partial(&#39;meta&#39;,&#123;post:post, position:&#39;header&#39;&#125;) %&gt;</span><br><span class="line">  &lt;section class&#x3D;&quot;article typo&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;article-entry&quot; itemprop&#x3D;&quot;articleBody&quot;&gt;</span><br><span class="line">      &lt;% var show_all_content &#x3D; true %&gt;</span><br><span class="line">      &lt;% if (post.excerpt) &#123; %&gt;</span><br><span class="line">        &lt;% show_all_content &#x3D; false %&gt;</span><br><span class="line">        &lt;%- post.excerpt %&gt;</span><br><span class="line">      &lt;% &#125;  else if (post.summary) &#123; %&gt;</span><br><span class="line">        &lt;% show_all_content &#x3D; false %&gt;</span><br><span class="line">        &lt;p&gt;&lt;%- post.summary %&gt;&lt;&#x2F;p&gt;</span><br><span class="line">      &lt;% &#125; else if (theme.auto_excerpt.enable) &#123; %&gt;</span><br><span class="line">        &lt;% var br_position &#x3D; 0 %&gt;</span><br><span class="line">        &lt;% for (var br_count &#x3D; 0; br_count &lt; theme.auto_excerpt.lines; br_count++) &#123; %&gt;</span><br><span class="line">            &lt;% br_position &#x3D; post.content.indexOf(&#39;\n&#39;,br_position + 1) %&gt;</span><br><span class="line">            &lt;% if(br_position &lt; 0) &#123; break &#125; %&gt;</span><br><span class="line">        &lt;% &#125; %&gt;</span><br><span class="line">        &lt;% if(br_position &gt; 0) &#123; %&gt;</span><br><span class="line">            &lt;% show_all_content &#x3D; false %&gt;</span><br><span class="line">            &lt;p&gt;&lt;%- post.content.substring(0, br_position + 1) %&gt;&lt;p&gt;</span><br><span class="line">        &lt;% &#125; %&gt;</span><br><span class="line">      &lt;% &#125; %&gt;</span><br><span class="line">      &lt;% if (show_all_content) &#123; %&gt;</span><br><span class="line">        &lt;%- post.content %&gt;</span><br><span class="line">        &lt;% &#125; %&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;% if (theme.layout.on_list.readmore) &#123; %&gt;</span><br><span class="line">      &lt;% if ((post.readmore !&#x3D; false) &amp;&amp; (show_all_content !&#x3D; true)) &#123; %&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;button readmore&quot;&gt;</span><br><span class="line">          &lt;a href&#x3D;&quot;&lt;%- url_for(post.link || post.path) %&gt;&quot;&gt;</span><br><span class="line">            &lt;%- theme.layout.on_list.readmore %&gt;</span><br><span class="line">          &lt;&#x2F;a&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">      &lt;% &#125; %&gt;</span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line">  &lt;&#x2F;section&gt;</span><br><span class="line">&lt;&#x2F;article&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>上面的代码逻辑，是，如果有more标签，则使用more标签前的文字作为摘要，非则使用md文章scaffolds里的summary内容作为摘要，主题原来用的scaffolds是description。如果需要用description，可以自行替换上面的代码。</p><p>在<code>scaffolds\post.md</code>里可以修改新建md文件生成的scaffold。</p></blockquote><blockquote><p>重要！！这种方法是直接提取的文章前5行。如果提取到的内容里，包含代码块的一部分，那么由于渲染问题布局将会出现问题。建议如果你的文章前面里有代码，自行在summary里写摘要，或者more标签前写摘要。</p></blockquote><h2 id="3：参考文献"><a href="#3：参考文献" class="headerlink" title="3：参考文献"></a>3：参考文献</h2><p>《<a href="https://blog.zthxxx.me/post/hexo-automatic-add-readmore/">Hexo 自动给博文添加 ReadMore</a>》</p>]]></content>
      
      
      <categories>
          
          <category> 网站编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Volantis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TensorFlow学习笔记</title>
      <link href="/2020/06/17/TensorFlow%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2020/06/17/TensorFlow%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="P1：tensorflow安装"><a href="#P1：tensorflow安装" class="headerlink" title="P1：tensorflow安装"></a>P1：tensorflow安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install tensorflow</span><br></pre></td></tr></table></figure><h2 id="P2：Hello-World——衣服分类"><a href="#P2：Hello-World——衣服分类" class="headerlink" title="P2：Hello World——衣服分类"></a>P2：Hello World——衣服分类</h2><p>这个例子训练了一个神经网络模型，用于分类衣服图片，比如tshirt和运动鞋。</p><p>需要用到<code>tf.keras</code>，它是个用于建立和训练模型的高层次的API</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TensorFlow and tf.keras</span></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tffrom tensorflow </span><br><span class="line"><span class="keyword">import</span> keras</span><br><span class="line"><span class="comment"># Helper libraries</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">print(tf.__version__)</span><br></pre></td></tr></table></figure><blockquote><p>2.2.0</p></blockquote><p><strong>导入Fashion MNIST数据集</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fashion_mnist = keras.datasets.fashion_mnist</span><br><span class="line">(train_images, train_labels), (test_images, test_labels) = fashion_mnist.load_data()</span><br></pre></td></tr></table></figure><p>导入数据集，返回Numpy数组：</p><ul><li><p><code>train_images</code>和<code>train_labels</code> 数组是训练集。</p></li><li><p><code>test_images</code>和 <code>test_labels</code> 数组是测试集。</p></li></ul><p>这些图像是28x28的Numpy数组。可以理解为28x28的像素点，这些像素点在屏幕上显示出来表现为图像。每个像素点的值在0到255之间，表示颜色的深浅。如果你了解颜色的RGB值，那你就明白，所有的颜色都是由不同深浅程度的三种基本色构成，比如白色的RGB为(255.255.255)。标签<code>labels</code>是一个整数数组，范围从0到9。表示10个不同的衣服种类<code>Class</code>。</p><table><thead><tr><th align="left">Label</th><th align="left">Class</th></tr></thead><tbody><tr><td align="left">0</td><td align="left">T-shirt/top</td></tr><tr><td align="left">1</td><td align="left">Trouser</td></tr><tr><td align="left">2</td><td align="left">Pullover</td></tr><tr><td align="left">3</td><td align="left">Dress</td></tr><tr><td align="left">4</td><td align="left">Coat</td></tr><tr><td align="left">5</td><td align="left">Sandal</td></tr><tr><td align="left">6</td><td align="left">Shirt</td></tr><tr><td align="left">7</td><td align="left">Sneaker</td></tr><tr><td align="left">8</td><td align="left">Bag</td></tr><tr><td align="left">9</td><td align="left">Ankle boot</td></tr></tbody></table><p>这些种类不包括在数据集中，需要单独定义：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class_names = [<span class="string">&#x27;T-shirt/top&#x27;</span>, <span class="string">&#x27;Trouser&#x27;</span>, <span class="string">&#x27;Pullover&#x27;</span>, <span class="string">&#x27;Dress&#x27;</span>, <span class="string">&#x27;Coat&#x27;</span>, <span class="string">&#x27;Sandal&#x27;</span>, <span class="string">&#x27;Shirt&#x27;</span>, <span class="string">&#x27;Sneaker&#x27;</span>, <span class="string">&#x27;Bag&#x27;</span>, <span class="string">&#x27;Ankle boot&#x27;</span>]</span><br></pre></td></tr></table></figure><p><strong>研究数据</strong></p><p>在训练模型之前，先研究这些数据格式。比如在训练集中的六万张图片，每张图片由28x28的像素点表示。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_images.shape</span><br></pre></td></tr></table></figure><blockquote><p>(60000, 28, 28)</p></blockquote><p>同时还有六万个与之对应的标签：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">len(train_labels)</span><br></pre></td></tr></table></figure><blockquote><p>60000</p></blockquote><p>每个标签都是一个0到9之间的整数：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">train_labels</span><br></pre></td></tr></table></figure><blockquote><p>array([9, 0, 0, …, 3, 0, 5], dtype=uint8)</p></blockquote><p>还有一万张用于测试的图片：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test_images.shape</span><br></pre></td></tr></table></figure><blockquote><p>(10000, 28, 28)</p></blockquote><p>一万张训练集的标签：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">len(test_labels)</span><br></pre></td></tr></table></figure><blockquote><p>10000</p></blockquote><p><strong>数据预处理</strong></p><p>在训练模型之前，必须先对数据进行预处理。观察第一张图，我们可以看到图片的像素值在0到255之间。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">plt.figure()</span><br><span class="line">plt.imshow(train_images[<span class="number">0</span>])</span><br><span class="line">plt.colorbar()</span><br><span class="line">plt.grid(<span class="literal">False</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://www.tensorflow.org/tutorials/keras/classification_files/output_m4VEw8Ud9Quh_0.png?hl=zh_cn" class="lazyload" data-srcset="https://www.tensorflow.org/tutorials/keras/classification_files/output_m4VEw8Ud9Quh_0.png?hl=zh_cn" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>将像素值范围缩小为0到1，所以将像素值都除以255：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">train_images = train_images / <span class="number">255.0</span></span><br><span class="line">test_images = test_images / <span class="number">255.0</span></span><br></pre></td></tr></table></figure><p>为了确保数据的正确性，先将训练集的前25个图片显示出来，并且在图片下面展示分类名。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">plt.figure(figsize=(<span class="number">10</span>,<span class="number">10</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">25</span>):</span><br><span class="line">    plt.subplot(<span class="number">5</span>,<span class="number">5</span>,i+<span class="number">1</span>)</span><br><span class="line">    plt.xticks([])</span><br><span class="line">    plt.yticks([])</span><br><span class="line">    plt.grid(<span class="literal">False</span>)</span><br><span class="line">    plt.imshow(train_images[i], cmap=plt.cm.binary)</span><br><span class="line">    plt.xlabel(class_names[train_labels[i]])</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://www.tensorflow.org/tutorials/keras/classification_files/output_oZTImqg_CaW1_0.png?hl=zh_cn" class="lazyload" data-srcset="https://www.tensorflow.org/tutorials/keras/classification_files/output_oZTImqg_CaW1_0.png?hl=zh_cn" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><strong>建立模型</strong></p><p>建立神经网络需要配置模型层，然后编译模型。</p><p><strong>设置层</strong></p><p>基本的神经网络模块是层。层会从它们获取的数据里提取图像。它们希望从这些图像里获取有用的信息。</p><p>大多数深度学习都是简单层组合在一起。大多数层比如<a href="https://www.tensorflow.org/api_docs/python/tf/keras/layers/Dense?hl=zh_cn"><code>tf.keras.layers.Dense</code></a>，拥有在训练时学习到的参数。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model = keras.Sequential([    keras.layers.Flatten(input_shape=(<span class="number">28</span>, <span class="number">28</span>)),    keras.layers.Dense(<span class="number">128</span>, activation=<span class="string">&#x27;relu&#x27;</span>),    keras.layers.Dense(<span class="number">10</span>)])</span><br></pre></td></tr></table></figure><p>这个网络的第一层，tf.keras.layers.Flatten，将图像的格式从二维数组(28 * 28像素)转换为一维数组(28 * 28 = 784像素)。可以将这一层看作是将图像中的像素行展开并排列起来。这一层没有参数需要学习;它只是重新格式化数据。</p><p>像素被扁平化后，网络由两个tf.keras.层组成。它们是紧密相连或完全相连的神经层。第一致密层有128个节点(或神经元)。第二个(也是最后一个)层返回长度为10的logits数组。每个节点都包含一个评价值，表示当前图像属于这10个类中的一个。</p><p><strong>编译模型</strong></p><p>在准备训练模型之前，需要进行一些其他设置。 这些是在模型的编译步骤中添加的：</p><ul><li>Loss function——这可以衡量模型在培训期间的准确性。您希望最小化这个函数，以便将模型“引导”到正确的方向。</li><li>Optimizer——这就是模型如何根据它看到的数据和它的损失函数进行更新。</li><li>Metrics——用于监控培训和测试步骤。下面的例子使用了准确率，即正确分类的图像的比例。</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.compile(optimizer=<span class="string">&#x27;adam&#x27;</span>,              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=<span class="literal">True</span>),              metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br></pre></td></tr></table></figure><p><strong>训练模型</strong></p><p>训练神经网络模型需要以下步骤：</p><ol><li>输入训练数据到模型中。</li><li>模型学习关联图像和分类标签。</li><li>让模型预测测试集。</li><li>验证预测结果是否和标签匹配。</li></ol><p><strong>输入数据到模型中</strong></p><p>利用<code>model.fit</code>方法。他能将模型用于拟合训练数据。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.fit(train_images, train_labels, epochs=<span class="number">10</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Epoch 1/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.4978 - accuracy: 0.8248<br>Epoch 2/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.3767 - accuracy: 0.8637<br>Epoch 3/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.3397 - accuracy: 0.8759<br>Epoch 4/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.3138 - accuracy: 0.8854<br>Epoch 5/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.2948 - accuracy: 0.8914<br>Epoch 6/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.2803 - accuracy: 0.8958<br>Epoch 7/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.2678 - accuracy: 0.9006<br>Epoch 8/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.2590 - accuracy: 0.9043<br>Epoch 9/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.2464 - accuracy: 0.9078<br>Epoch 10/10<br>1875/1875 [==============================] - 3s 2ms/step - loss: 0.2402 - accuracy: 0.9099</p><p>&lt;tensorflow.python.keras.callbacks.History at 0x7fe472eff4a8&gt;</p></blockquote><p><strong>评估准确率</strong></p><p>比较模型在测试数据集上的表现：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">test_loss, test_acc = model.evaluate(test_images,  test_labels, verbose=<span class="number">2</span>)</span><br><span class="line">print(<span class="string">&#x27;\nTest accuracy:&#x27;</span>, test_acc)</span><br></pre></td></tr></table></figure><blockquote><p>313/313 - 1s - loss: 0.3382 - accuracy: 0.8840 </p><p>Test accuracy: 0.8840000033378601</p></blockquote><p>结果是测试数据集上的准确性比训练数据集上的准确性稍低。训练准确度和测试准确度之间的差距代表过拟合。当机器学习模型在新的、以前没有看到的输入上的表现不如在训练数据上的表现时，就会发生过拟合。过度拟合的模型“记忆”了训练数据集中的噪音和细节，从而对模型在新数据上的性能产生负面影响。有关更多信息，请参见以下内容</p><ul><li><a href="https://www.tensorflow.org/tutorials/keras/overfit_and_underfit?hl=zh_cn#demonstrate_overfitting">证明过度拟合</a></li><li><a href="https://www.tensorflow.org/tutorials/keras/overfit_and_underfit?hl=zh_cn#strategies_to_prevent_overfitting">防止过度拟合策略</a></li></ul><p><strong>预测结果</strong></p><p>通过训练模型，你可以使用它来预测某些图像。 模型的线性输出，logits。 附加一个softmax层以将logit转换为更容易解释的概率。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">probability_model = tf.keras.Sequential([model,                                          tf.keras.layers.Softmax()])</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">predictions = probability_model.predict(test_images)</span><br></pre></td></tr></table></figure><p>在这里，模型已经预测了测试集中每个图像的标签。 让我们看一下第一个预测：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">predictions[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><blockquote><p>array([1.2275562e-07, 8.9534730e-08, 7.6224147e-09, 1.9726743e-08,<br>       6.1515345e-07, 4.6329503e-03, 4.1164008e-06, 1.5043605e-02,<br>       2.8817641e-07, 9.8031825e-01], dtype=float32)</p></blockquote><p>预测是一个包含10个数字的数组。它们代表了模型的“自信”，即图像对应着10种不同的服装。你可以看到哪个标签的自信度最高：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np.argmax(predictions[<span class="number">0</span>])</span><br></pre></td></tr></table></figure><blockquote><p>9</p></blockquote><p>因此，模型最自信的认为这是一个踝靴，或<code>class_names[9]</code>。检查测试标签表明这个分类是正确的：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test_labels[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><blockquote><p>9</p></blockquote><p>绘制图表，看看10个类预测的全部集合。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_image</span>(<span class="params">i, predictions_array, true_label, img</span>):</span></span><br><span class="line">  predictions_array, true_label, img = predictions_array, true_label[i], img[i]</span><br><span class="line">  plt.grid(<span class="literal">False</span>)</span><br><span class="line">  plt.xticks([])</span><br><span class="line">  plt.yticks([])</span><br><span class="line"></span><br><span class="line">  plt.imshow(img, cmap=plt.cm.binary)</span><br><span class="line"></span><br><span class="line">  predicted_label = np.argmax(predictions_array)</span><br><span class="line">  <span class="keyword">if</span> predicted_label == true_label:</span><br><span class="line">    color = <span class="string">&#x27;blue&#x27;</span></span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    color = <span class="string">&#x27;red&#x27;</span></span><br><span class="line"></span><br><span class="line">  plt.xlabel(<span class="string">&quot;&#123;&#125; &#123;:2.0f&#125;% (&#123;&#125;)&quot;</span>.format(class_names[predicted_label],</span><br><span class="line">                                <span class="number">100</span>*np.max(predictions_array),</span><br><span class="line">                                class_names[true_label]),</span><br><span class="line">                                color=color)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_value_array</span>(<span class="params">i, predictions_array, true_label</span>):</span></span><br><span class="line">  predictions_array, true_label = predictions_array, true_label[i]</span><br><span class="line">  plt.grid(<span class="literal">False</span>)</span><br><span class="line">  plt.xticks(range(<span class="number">10</span>))</span><br><span class="line">  plt.yticks([])</span><br><span class="line">  thisplot = plt.bar(range(<span class="number">10</span>), predictions_array, color=<span class="string">&quot;#777777&quot;</span>)</span><br><span class="line">  plt.ylim([<span class="number">0</span>, <span class="number">1</span>])</span><br><span class="line">  predicted_label = np.argmax(predictions_array)</span><br><span class="line"></span><br><span class="line">  thisplot[predicted_label].set_color(<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">  thisplot[true_label].set_color(<span class="string">&#x27;blue&#x27;</span>)</span><br></pre></td></tr></table></figure><p><strong>验证预测</strong></p><p>通过训练模型，您可以使用它来预测某些图像。</p><p>让我们看一下第0张图片，预测和预测数组。 正确的预测标签为蓝色，错误的预测标签为红色。 该数字给出了预测标签的百分比（满分为100）。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">0</span></span><br><span class="line">plt.figure(figsize=(<span class="number">6</span>,<span class="number">3</span>))</span><br><span class="line">plt.subplot(<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line">plot_image(i, predictions[i], test_labels, test_images)</span><br><span class="line">plt.subplot(<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>)</span><br><span class="line">plot_value_array(i, predictions[i],  test_labels)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://www.tensorflow.org/tutorials/keras/classification_files/output_HV5jw-5HwSmO_0.png?hl=zh_cn" class="lazyload" data-srcset="https://www.tensorflow.org/tutorials/keras/classification_files/output_HV5jw-5HwSmO_0.png?hl=zh_cn" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">12</span></span><br><span class="line">plt.figure(figsize=(<span class="number">6</span>,<span class="number">3</span>))</span><br><span class="line">plt.subplot(<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line">plot_image(i, predictions[i], test_labels, test_images)</span><br><span class="line">plt.subplot(<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>)</span><br><span class="line">plot_value_array(i, predictions[i],  test_labels)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://www.tensorflow.org/tutorials/keras/classification_files/output_Ko-uzOufSCSe_0.png?hl=zh_cn" class="lazyload" data-srcset="https://www.tensorflow.org/tutorials/keras/classification_files/output_Ko-uzOufSCSe_0.png?hl=zh_cn" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>让我们绘制一些带有预测的图像。 请注意，即使非常自信，该模型也可能是错误的。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Plot the first X test images, their predicted labels, and the true labels.</span></span><br><span class="line"><span class="comment"># Color correct predictions in blue and incorrect predictions in red.</span></span><br><span class="line">num_rows = <span class="number">5</span></span><br><span class="line">num_cols = <span class="number">3</span></span><br><span class="line">num_images = num_rows*num_cols</span><br><span class="line">plt.figure(figsize=(<span class="number">2</span>*<span class="number">2</span>*num_cols, <span class="number">2</span>*num_rows))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(num_images):</span><br><span class="line">  plt.subplot(num_rows, <span class="number">2</span>*num_cols, <span class="number">2</span>*i+<span class="number">1</span>)</span><br><span class="line">  plot_image(i, predictions[i], test_labels, test_images)</span><br><span class="line">  plt.subplot(num_rows, <span class="number">2</span>*num_cols, <span class="number">2</span>*i+<span class="number">2</span>)</span><br><span class="line">  plot_value_array(i, predictions[i], test_labels)</span><br><span class="line">plt.tight_layout()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="https://www.tensorflow.org/tutorials/keras/classification_files/output_hQlnbqaw2Qu__0.png?hl=zh_cn" class="lazyload" data-srcset="https://www.tensorflow.org/tutorials/keras/classification_files/output_hQlnbqaw2Qu__0.png?hl=zh_cn" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><strong>使用训练的模型</strong></p><p>最后，利用训练好的模型对单幅图像进行预测。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Grab an image from the test dataset.</span></span><br><span class="line">img = test_images[<span class="number">1</span>]</span><br><span class="line">print(img.shape)</span><br></pre></td></tr></table></figure><blockquote><p>(28, 28)</p></blockquote><p><code>tf.keras</code>模型经过优化，可以立即对一批或一组示例进行预测。因此，即使使用的是单个图像，也需要将其添加到列表中</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Add the image to a batch where it&#x27;s the only member.</span></span><br><span class="line">img = (np.expand_dims(img,<span class="number">0</span>))</span><br><span class="line">print(img.shape)</span><br></pre></td></tr></table></figure><blockquote><p>(1, 28, 28)</p></blockquote><p>现在为这个图像预测正确的标签</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">predictions_single = probability_model.predict(img)</span><br><span class="line"></span><br><span class="line">print(predictions_single)</span><br></pre></td></tr></table></figure><blockquote><p>[[2.3256284e-06 5.5768194e-13 9.9955302e-01 3.3701731e-13 4.3444714e-04<br>  3.7890427e-17 1.0105057e-05 4.5671220e-20 8.4883814e-14 9.5599025e-18]]</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plot_value_array(<span class="number">1</span>, predictions_single[<span class="number">0</span>], test_labels)_ = plt.xticks(range(<span class="number">10</span>), class_names, rotation=<span class="number">45</span>)</span><br></pre></td></tr></table></figure><p><img src="https://www.tensorflow.org/tutorials/keras/classification_files/output_6Ai-cpLjO-3A_0.png?hl=zh_cn" class="lazyload" data-srcset="https://www.tensorflow.org/tutorials/keras/classification_files/output_6Ai-cpLjO-3A_0.png?hl=zh_cn" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>keras.Model.predict返回列表的列表-数据批次中每个图像的列表。 批量获取我们（唯一）图像的预测：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np.argmax(predictions_single[<span class="number">0</span>])</span><br></pre></td></tr></table></figure><blockquote><p>2</p></blockquote><p>这个模型预测了一个标签。</p><p>本指南使用Fashion MNIST数据集，该数据集包含10个类别中的70,000张灰度图像。这些图像以低分辨率(28×28像素)显示了衣服的单个物品，如图所示</p><p><img src="https://tensorflow.org/images/fashion-mnist-sprite.png?hl=zh_cn" class="lazyload" data-srcset="https://tensorflow.org/images/fashion-mnist-sprite.png?hl=zh_cn" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>Fashion MNIST旨在替代经典MNIST数据集，通常被用作计算机视觉机器学习程序的“ Hello，World”。 MNIST数据集包含手写数字（0、1、2等）的图像，格式与您将在此处使用的衣服的格式相同。</p><p>本指南将Fashion MNIST用于多种用途，并且因为它比常规MNIST更具挑战性。 两个数据集都相对较小，用于验证算法是否按预期工作。 它们是测试和调试代码的良好起点。</p><p>在这里，使用60,000张图像来训练网络，使用10,000张图像来评估网络学习对图像进行分类的准确程度。 您可以直接从TensorFlow访问Fashion MNIST。 直接从TensorFlow导入和加载Fashion MNIST数据：</p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TensorFlow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PyTorch学习笔记</title>
      <link href="/2020/06/16/PyTorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2020/06/16/PyTorch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>PyTorch的用处：GPU加速、求导、常用API</p><h2 id="P1：开发环境"><a href="#P1：开发环境" class="headerlink" title="P1：开发环境"></a>P1：开发环境</h2><blockquote><ul><li><p>Python 3.7+Anaconda 5.3.1</p></li><li><p>CUDA 10.0</p></li><li><p>Pycharm Community</p></li></ul></blockquote><ol><li>下载安装Anaconda，勾选“添加ana到路径环境”</li></ol><p>cmd输入，查看ana安装的包。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda list</span><br></pre></td></tr></table></figure><ol start="2"><li>安装nvidia CUDA</li></ol><p>确保有nvidia的GPU</p><p>配置系统环境变量，确保CUDA的bin目录在<code>PATH</code>行里，在cmd里</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvcc -v</span><br></pre></td></tr></table></figure><ol start="3"><li><p>pytorch.org里下载pytorch</p></li><li><p>下载pycharm，这是一个python的IDE</p></li></ol><p>配置编译器为Python</p><h2 id="P2：梯度下降算法"><a href="#P2：梯度下降算法" class="headerlink" title="P2：梯度下降算法"></a>P2：梯度下降算法</h2><p><img src="https://ae01.alicdn.com/kf/H33b92bc02a41476cb6c9d73410ecf1c4O.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H33b92bc02a41476cb6c9d73410ecf1c4O.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>求解线性方程，如果存在噪声？</p><p>求取近似值w,b。</p><p><img src="https://ae01.alicdn.com/kf/H3b83f138e0734623a1f16fe56ecb2629s.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H3b83f138e0734623a1f16fe56ecb2629s.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>假设采样数据输入x和理论真实输出y满足 y=wx+b的线性回归函数。Linear Regression</p><p>那么<br>$$<br>loss\ function=\sum(wx+b-y)^2<br>$$</p><blockquote><p>梯度下降算法：有若干个wb不同的函数y=wx+b，这些函数能够将采样输入x得出一个若干个输出值w1x+b1、w2x+b2等等，这个输出值wx+b与理论输出值y存在误差，于是我们定义了一个loss function来表示w和b不同时，wx+b与真实值y之间的误差。通过对loss function做运算能找到一组w和b，这组w和b可以使wx+b最接近y。</p><p>对loss function的运算方式叫梯度下降算法，将若干个采样输入和理论输出带入loss function，形成一个诸如L(w,b)的方程。要找使得L(w,b)最小的w和b。</p></blockquote><h2 id="P3：梯度Ⅱ"><a href="#P3：梯度Ⅱ" class="headerlink" title="P3：梯度Ⅱ"></a>P3：梯度Ⅱ</h2><p>对线性回归y=wx+b</p><p>计算loss function：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compute_error_for_line_given_points</span>(<span class="params">b,w,points</span>)：</span></span><br><span class="line">totalError=0</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(points)):</span><br><span class="line">        x = points[i,<span class="number">0</span>]</span><br><span class="line">        y = points[i,<span class="number">1</span>]</span><br><span class="line">        totalError += (y-(w*x+b))**<span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> totalError / float(len(points))</span><br></pre></td></tr></table></figure><p>输入上一个w和b值，计算梯度，返回下一个w和b：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">step_gradient</span>(<span class="params">b_current,w_current,points,learningRate</span>):</span></span><br><span class="line">    b_gradient = <span class="number">0</span></span><br><span class="line">    w_gradient = <span class="number">0</span></span><br><span class="line">    N = float(len(points))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(points)):</span><br><span class="line">        x = points[i,<span class="number">0</span>]</span><br><span class="line">        y = points[i,<span class="number">1</span>]</span><br><span class="line">        b_gradient += -(<span class="number">2</span>/N) * (y - ((w_current*x) + b_current))</span><br><span class="line">        w_gradient += -(<span class="number">2</span>/N) * x * (y-((w_current*x)+b_current))</span><br><span class="line">    new_b = b_current - (learningRate * b_gradient)</span><br><span class="line">    new_w = w_current - (learningRate * w_gradient)</span><br><span class="line">    <span class="keyword">return</span> [new_b,new_w]</span><br></pre></td></tr></table></figure><p>计算最优解：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gradient_descent_runner</span>(<span class="params">points,starting_b,starting_w,learning_rate,num_iterations</span>):</span></span><br><span class="line">    b = starting_b</span><br><span class="line">    w = starting_w</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(num_iterations):</span><br><span class="line">        b,w = step_gradient(b,w,np.array(points),learning_rate)</span><br><span class="line">    <span class="keyword">return</span> [b,w]</span><br></pre></td></tr></table></figure><h2 id="P4：手写数字问题"><a href="#P4：手写数字问题" class="headerlink" title="P4：手写数字问题"></a>P4：手写数字问题</h2><p>手写0~9，输出手写数字</p><h2 id="P5：Pytorch基本数据类型"><a href="#P5：Pytorch基本数据类型" class="headerlink" title="P5：Pytorch基本数据类型"></a>P5：Pytorch基本数据类型</h2><p>Int: IntTensor of size()</p><p>float: FloatTensor of size()</p><p>Int array: IntTensor of size [d1,d2……]</p><blockquote><p>没有String类型，只能用向量来表示[0,0,1,0……]</p></blockquote><hr><h2 id="P6：张量-Tensor"><a href="#P6：张量-Tensor" class="headerlink" title="P6：张量 Tensor"></a>P6：张量 Tensor</h2><p>Tensor或者Numpy的ndarrays</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">import</span> torch</span><br></pre></td></tr></table></figure><p>构造空矩阵,五行三列</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x = torch.empty(<span class="number">5</span>,<span class="number">3</span>)</span><br><span class="line">print(x)</span><br></pre></td></tr></table></figure><blockquote><p>tensor(1.00000e-04 *<br>       [[-0.0000,  0.0000,  1.5135],<br>        [ 0.0000,  0.0000,  0.0000],<br>        [ 0.0000,  0.0000,  0.0000],<br>        [ 0.0000,  0.0000,  0.0000],<br>        [ 0.0000,  0.0000,  0.0000]])</p></blockquote><p>构造一个随机数矩阵，随机数都在0到1之间</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x = torch.rand(<span class="number">5</span>, <span class="number">3</span>) </span><br><span class="line">print(x)</span><br></pre></td></tr></table></figure><blockquote><p>tensor([[ 0.6291,  0.2581,  0.6414],<br>        [ 0.9739,  0.8243,  0.2276],<br>        [ 0.4184,  0.1815,  0.5131],<br>        [ 0.5533,  0.5440,  0.0718],<br>        [ 0.2908,  0.1850,  0.5297]])</p></blockquote><p>构造一个全0矩阵，字符类型为long。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x = torch.zeros(<span class="number">5</span>, <span class="number">3</span>, dtype=torch.long)</span><br><span class="line">print(x)</span><br></pre></td></tr></table></figure><blockquote><p>tensor([[ 0,  0,  0],<br>        [ 0,  0,  0],<br>        [ 0,  0,  0],<br>        [ 0,  0,  0],<br>        [ 0,  0,  0]])</p></blockquote><p>直接输入数据创建一个张量。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x = torch.tensor([<span class="number">5.5</span>, <span class="number">3</span>])</span><br><span class="line">print(x)</span><br></pre></td></tr></table></figure><blockquote><p>tensor([ 5.5000,  3.0000])</p></blockquote><p>创建一个张量，基于已存在的张量</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">x = x.new_ones(<span class="number">5</span>, <span class="number">3</span>, dtype=torch.double)    </span><br><span class="line"></span><br><span class="line"><span class="comment"># new_* methods take in sizes</span></span><br><span class="line">print(x)</span><br><span class="line"></span><br><span class="line">x = torch.randn_like(x, dtype=torch.float)  </span><br><span class="line"></span><br><span class="line"><span class="comment"># override dtype!</span></span><br><span class="line">print(x)                                    </span><br><span class="line"></span><br><span class="line"><span class="comment"># result has the same size</span></span><br></pre></td></tr></table></figure><blockquote><p>tensor([[ 1.,  1.,  1.],<br>        [ 1.,  1.,  1.],<br>        [ 1.,  1.,  1.],<br>        [ 1.,  1.,  1.],<br>        [ 1.,  1.,  1.]], dtype=torch.float64)<br>tensor([[-0.2183,  0.4477, -0.4053],<br>        [ 1.7353, -0.0048,  1.2177],<br>        [-1.1111,  1.0878,  0.9722],<br>        [-0.7771, -0.2174,  0.0412],<br>        [-2.1750,  1.3609, -0.3322]])</p></blockquote><p>获取维度</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(x.size())</span><br></pre></td></tr></table></figure><blockquote><p>torch.Size([5, 3])</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 深度学习 </tag>
            
            <tag> PyTorch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSR负载均衡实现自动切换端口</title>
      <link href="/2020/06/16/SSR%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E5%88%87%E6%8D%A2%E7%AB%AF%E5%8F%A3/"/>
      <url>/2020/06/16/SSR%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E5%88%87%E6%8D%A2%E7%AB%AF%E5%8F%A3/</url>
      
        <content type="html"><![CDATA[<h1 id="1：准备工作"><a href="#1：准备工作" class="headerlink" title="1：准备工作"></a>1：准备工作</h1><ul><li>一台国内服务器。</li></ul><p>国内服务器可以监控到国外的服务器ip或者端口是否被封锁。如果你用国外的服务器，也能做到负载均衡，但是如果这台服务器被封锁，那SSR还是会断开连接。国内服务器不会被封锁。</p><ul><li>SSR添加多个端口或者多台SSR服务器</li></ul><p>修改SSR配置文件，监听多个端口《<a href="https://ssr.tools/194">SSR添加多用户多端口教程</a>》，我监听的是34567、34568、34569。</p><blockquote><p>注意：不同端口或者IP的密码和协议等等都必须相同。</p></blockquote><h1 id="2：haproxy下载和配置"><a href="#2：haproxy下载和配置" class="headerlink" title="2：haproxy下载和配置"></a>2：haproxy下载和配置</h1><p>在Ubuntu上下载：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get -y install haproxy</span><br></pre></td></tr></table></figure><p>在centos上：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install haproxy</span><br></pre></td></tr></table></figure><p>安装完毕后，打开haproxy配置文件<code>/etc/haproxy/haproxy.cfg</code>，修改配置为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">global</span><br><span class="line">    log &#x2F;dev&#x2F;log local0</span><br><span class="line">    log &#x2F;dev&#x2F;log local1 notice</span><br><span class="line">    user root</span><br><span class="line">    group root</span><br><span class="line">    daemon</span><br><span class="line"></span><br><span class="line">defaults</span><br><span class="line">    log global</span><br><span class="line">    mode tcp</span><br><span class="line">    timeout connect 5s</span><br><span class="line">    timeout client 5s</span><br><span class="line">    timeout server 5s</span><br><span class="line">    option      dontlognull</span><br><span class="line">    option      redispatch</span><br><span class="line">    retries     3</span><br><span class="line"></span><br><span class="line">listen status</span><br><span class="line">  bind *:1111</span><br><span class="line">  mode  http</span><br><span class="line">  stats refresh 30s</span><br><span class="line">  stats uri &#x2F;status</span><br><span class="line">  stats realm Haproxy  </span><br><span class="line">  stats auth admin:admin</span><br><span class="line">  stats hide-version</span><br><span class="line">  stats admin if TRUE</span><br><span class="line"></span><br><span class="line">frontend shadowsocks-in</span><br><span class="line">    mode tcp</span><br><span class="line">    bind *:8388</span><br><span class="line">    default_backend shadowsocks-out</span><br><span class="line"></span><br><span class="line">backend shadowsocks-out</span><br><span class="line">    mode tcp</span><br><span class="line">    option      tcp-check</span><br><span class="line">    balance roundrobin</span><br><span class="line">    server  servername1    xxxxx1.com:8088  check</span><br><span class="line">    server  servername2    xxxxx2.net:8080  check</span><br><span class="line">    server  servername3    12.34.56.78:9999  check</span><br><span class="line">    server  servername4    123.234.234.123:443  check</span><br></pre></td></tr></table></figure><p>配置分为五大部分：</p><ul><li><strong>global</strong>：全局配置，这里主要是配置了日志</li><li><strong>默认值</strong>：默认配置，也是一些分布式配置</li><li><strong>听</strong>：监听配置，我在<code>1111</code>端口配置了http监控页面，访问<code>ip:1111/status</code>，认证用户名和密码都是<code>admin</code>，具体含义参考博客<a href="https://www.centos.bz/2018/01/haproxy%E7%9B%91%E6%8E%A7%E9%A1%B5%E9%9D%A2-%E5%92%8C%E9%A1%B5%E9%9D%A2%E8%AF%A6%E7%BB%86%E5%8F%82%E6%95%B0/">“ haproxy监控页面和页面详细参数”</a></li><li><strong>frontend</strong>：前端配置，Shadowsocks数据流从这里进入，流向指定标题，注意这里的端口号，即为ss客户端的输入端口</li><li><strong>backend</strong>：调整配置，<code>balance</code>指定负载平衡方式，每个服务器写一个服务器行，服务器支持域名或IP。如果使用域名，重启服务出现问题，可以参考博客<a href="https://www.solarck.com/systemd-wait-network-online.html">“解决Haproxy用Systemd启动失败的问题”</a>。</li></ul><h1 id="3：其他负载均衡方式"><a href="#3：其他负载均衡方式" class="headerlink" title="3：其他负载均衡方式"></a>3：其他负载均衡方式</h1><p>《<a href="https://project-gutenberg.github.io/Pincong/post/16c147e99745aee701fe6e9fee34e466/">shadowsocks借助nginx实现负载均衡，自动切换“零”宕机</a>》介绍了使用nginx的方法。也可以尝试。</p><p>我之前使用过apache来做负载均衡，但是无法连接，查看apache日志后提示如下：</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Tue Jun <span class="number">16</span> <span class="number">00</span>:<span class="number">07</span>:<span class="number">30</span><span class="variable">.557609</span> <span class="number">2020</span>] [core:debug] [pid <span class="number">25543</span>:tid <span class="number">140127116449536</span>] protocol<span class="variable">.c</span>(<span class="number">1335</span>): [client <span class="number">127</span><span class="variable">.0</span><span class="variable">.0</span><span class="variable">.1</span>:<span class="number">57310</span>] AH00566: request failed: malformed request line</span><br></pre></td></tr></table></figure><p>意思是请求行格式错误。刚开始以为配置错了。阅读apache的相关资料后才知道。</p><blockquote><p>apache在做负载均衡时，只是对子目录进行了替换，比如说，你监听1234端口，将发送给主机1234端口的数据均衡发送给192.1.1.1:5678、192.1.1.2:6789。那么你在访问baidu.com/test 时，将你的请求发送给1234端口，而apache做的仅仅只是将请求HOST替换掉。真实请求地址是192.1.1.1:5678/test 或者192.1.1.2:6789/test 。。而ssr加密后的数据，是没有http请求头的，这便导致了，日志所显示的请求行格式错误。所以apache并不适合做单纯的数据转发。</p></blockquote><h1 id="4：参考文献"><a href="#4：参考文献" class="headerlink" title="4：参考文献"></a>4：参考文献</h1><p>《<a href="https://tianws.github.io/skill/2019/07/11/gfw/">用Haproxy实现多VPS线路负载均衡</a>》</p><p>《<a href="https://project-gutenberg.github.io/Pincong/post/16c147e99745aee701fe6e9fee34e466/">shadowsocks借助nginx实现负载均衡，自动切换“零”宕机</a>》</p><p>《<a href="https://www.jianshu.com/p/a7e3199a0a09">Haproxy（二）之负载均衡配置详解</a>》</p><p>《<a href="https://blog.csdn.net/sforiz/article/details/79651643">Apache 正向代理与反向代理配置</a>》</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSR </tag>
            
            <tag> haproxy </tag>
            
            <tag> 负载均衡 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>移动运营商过滤外网流量和解决办法</title>
      <link href="/2020/06/14/%E7%A7%BB%E5%8A%A8%E8%BF%90%E8%90%A5%E5%95%86%E8%BF%87%E6%BB%A4%E5%A4%96%E7%BD%91%E6%B5%81%E9%87%8F%E9%97%AE%E9%A2%98/"/>
      <url>/2020/06/14/%E7%A7%BB%E5%8A%A8%E8%BF%90%E8%90%A5%E5%95%86%E8%BF%87%E6%BB%A4%E5%A4%96%E7%BD%91%E6%B5%81%E9%87%8F%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p><strong>移动在哪些方面对用户访问外网进行了限制</strong>？</p><ul><li>国内过滤掉海外站点的http请求。</li></ul><p>我们最常使用的https协议是由http和tls协议构成。通常访问一个https网站，第一步是，向目标网站比如youtube.com发起一个http明文请求，要求建立连接，之后传递数据才由tls协议进行加密。。如果只是单纯的使用浏览器代理，发送到youtube的http请求将被移动网络过滤掉，从而无法建立连接。</p><p>不过，ssr、v2ray在使用时，已经将http请求进行了加密转发到ssr、v2ray服务端。因此http请求是由ssr服务端在外网发起的，不用担心移动过滤http请求。</p><ul><li>国内外网络边界上对无特征的tcp流量限流降速</li></ul><p>ssr和v2ray使用了加密和混淆协议，这些协议保证了它们服务端和客户端之间传递的数据无法被解密。移动在这方面，直接对这类没有特征的tcp流量进行丢包，也就导致了，移动用户访问外网速度极慢。</p><ul><li>国内外网络边界上对tls协议的tcp流量按优先级放行</li></ul><p>tls协议流量在出国流量中是海量的，我们访问普通海外网站的时，也包含了大量的tls流量。因此，移动不能对这类流量进行限流降速，而是对那些优先级比较低的用户访问外网进行限制，在高峰时段，可能访问外网速度奇慢。这个问题可以直接花钱解决。</p><p><strong>如何解决移动网络访问外网限制？</strong></p><ul><li>更换电信或联通网络。</li></ul><blockquote><p>广电也很坑，跟移动差不多</p></blockquote><ul><li>使用v2ray+ws+tls方案，即将翻墙流量伪装为普通的https流量。如果你的移动网络出国优先级比较低，高峰时段也会很拥挤。这时候，就取决于你的外网服务器了。外网服务器使用cn2gia自然就不会拥挤了。</li><li>如果你买不起一个cn2gia线路，试试在国内部署一个中转服务器，阿里云头年90块（学生价也有优惠）。在这个路由器上部署一个stunnel，把ssr、v2ray的代理请求转发到国内服务器，然后国内服务器发送至国外服务器。</li></ul><p>这个方案，可以解决ssr不带tls协议的缺点，同时，即便外网服务器不是cn2gia，你用的也不是电信联通，都没关系。阿里云服务器出国会走电信，而且优先级高，所以即便是高峰时期，网速也不会有影响。</p><p>然而，受到国内带宽价格影响。阿里云90一年的服务器，带宽仅为5Mpbs，所以下载速度也就在900kB/s左右。不过看1080P的youtube没有问题。</p>]]></content>
      
      
      <categories>
          
          <category> 其他 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 移动网络 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BLOG双线部署+https</title>
      <link href="/2020/06/14/BLOG%E5%8F%8C%E7%BA%BF%E9%83%A8%E7%BD%B2-https/"/>
      <url>/2020/06/14/BLOG%E5%8F%8C%E7%BA%BF%E9%83%A8%E7%BD%B2-https/</url>
      
        <content type="html"><![CDATA[<p>dns.la支持多线解析，而且免费，非常好用。推荐！</p><p>关于证书申请的方式，就不多说了。之前在coding申请证书失败，是因为域名cname解析没有配置正确。将域名服务商修改为 <a href="https://dns.la/">https://dns.la</a> 后，需要先将域名海外线路解析到coding。</p><blockquote><p>将海外线路解析到coding是，coding证书能够申请成功的关键！<br>在github申请证书时，也需要将海外线路解析到github。</p></blockquote><p>证书申请完毕后，可以在dns.la上修改dns线路，国内解析到coding，海外解析到github。</p>]]></content>
      
      
      <categories>
          
          <category> 网站编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网站优化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSR加速和降低服务器端口被封风险</title>
      <link href="/2020/06/08/SSR%E5%8A%A0%E9%80%9F%E5%92%8C%E9%99%8D%E4%BD%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E5%8F%A3%E8%A2%AB%E5%B0%81%E9%A3%8E%E9%99%A9/"/>
      <url>/2020/06/08/SSR%E5%8A%A0%E9%80%9F%E5%92%8C%E9%99%8D%E4%BD%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E5%8F%A3%E8%A2%AB%E5%B0%81%E9%A3%8E%E9%99%A9/</url>
      
        <content type="html"><![CDATA[<p>另外需要说明的是，购买的国内服务器，不需要进行备案，你可以帮定一个域名到此服务器上，填写ssr客户端也只需要使用这个域名，ssr会自动帮你查询dns，此后即便国外ssr出现端口或ip被封，也不需要更改ssr客户端的配置信息。而只需要另起一台国外服务器，修改国内中转服务器的配置信息。</p><p>如果你懂得更多编程知识，你可以在国内国外的两台服务器上进行编程，实现，当国外服务器端口被封，国内和国外服务器自动检测，若检测到端口被封，则国外服务器修改ssr配置端口，而国内服务器修改stunnel配置信息。这样，无需人为干预，也能实现长久而稳定的连接。如果有空的话，我会去探索这个方案。</p><h1 id="1：原理说明"><a href="#1：原理说明" class="headerlink" title="1：原理说明"></a>1：原理说明</h1><p>简单了解，可以提高你对网络的认识。</p><h2 id="1-1-ssr网络加速原理"><a href="#1-1-ssr网络加速原理" class="headerlink" title="1.1 ssr网络加速原理"></a>1.1 ssr网络加速原理</h2><p>由于中国移动对普通用户的海外流量随机高概率丢包，导致国外流量进入国内时，走移动线路，就会有很高的丢包率。所以我们希望借助一台，属于移动vip级别的国内服务器（这样移动出海线路优先级高，不容易丢包），或者出入海走联通电信线路的服务器。通常，阿里云、腾讯云服务器都能满足要求。</p><p>国内服务器上安装stunnel，并配置为客户端。国外服务器安装stunnel服务端和ssr服务端。</p><p><img src="https://ae01.alicdn.com/kf/Hb7bba28a9bda457899c0f56c82042376m.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/Hb7bba28a9bda457899c0f56c82042376m.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h2 id="1-2-降低端口被封的风险原理"><a href="#1-2-降低端口被封的风险原理" class="headerlink" title="1.2 降低端口被封的风险原理"></a>1.2 降低端口被封的风险原理</h2><p>stunnel是一个将流量利用ssl证书加密的软件，加密后的流量，出国时将会被识别为tls协议，因此不再具有ssr流量特点，我们常使用的https请求便基于ssl证书，此时国外服务器端口被封锁的几率将大大减小。出国后，stunnel将流量解密，再传递给ssr服务端。</p><p>通过抓取ssr流量，可以看到，ssr流量在传输过程中，由于协议加密，它不具备任何常见的网络请求特征，而你在使用ssr与海外服务器进行数据往来时，长时间的使用不具有网络请求特征的流量进行连接，很容易被防火墙识别为翻墙软件。因此被封。使用tls协议，就能够伪装为https请求，https(http协议+tls协议)。当然为了更有迷惑性，在ssr服务器端口加一个能被访问的网站是最好的。因为虽然tls协议作为https的一部分，但在实际使用中，由于没有http协议的流量，那么是能被推断出使用stunnel这类加密隧道的。如果长时间大流量访问，也有被封锁的风险。</p><p>而使用中转服务器，所付出的代价，仅仅是国内月租几块钱的服务器(阿里云、腾讯云等有学生服务器，一年一百块左右)，和相当低的stunnel加解密过程所导致的延迟，此延迟几乎不可见。</p><h1 id="2：stunnel和ssr安装"><a href="#2：stunnel和ssr安装" class="headerlink" title="2：stunnel和ssr安装"></a>2：stunnel和ssr安装</h1><h2 id="2-1-stunnel安装和配置"><a href="#2-1-stunnel安装和配置" class="headerlink" title="2.1 stunnel安装和配置"></a>2.1 stunnel安装和配置</h2><p>stunnel安装，请参见我之间的文章《<a href="https://sci.ci/2020/05/28/stunnel-squid-dai-li-jia-su-ya-chen-jiao-xue-shi-pin-jia-su/">利用Stunnel+squid代理实现国内无客户端访问外网</a>》。</p><blockquote><p>3.2节是在国外服务器上安装stunnel服务端。第四章，在国内服务器上安装stunnel客户端。</p></blockquote><p>将ssr的流量通过stunnel加密，你需要修改配置文件。在《<a href="https://sci.ci/2020/05/28/stunnel-squid-dai-li-jia-su-ya-chen-jiao-xue-shi-pin-jia-su/">利用Stunnel+squid代理实现国内无客户端访问外网</a>》安装后的stunnel基础上修改。</p><p>修改国外服务器上的stunnel服务端配置文件，在<code>/etc/stunnel/stunnel.conf</code>文件里，</p><p>删除</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[squid-proxy]</span><br><span class="line">; 服务监听的端口，client要连接这个端口与server通信</span><br><span class="line">accept &#x3D; 3129</span><br><span class="line">; 服务要连接的端口，连接到squid的3128端口，将数据发给squid</span><br><span class="line">connect &#x3D; localhost:3128</span><br></pre></td></tr></table></figure><p>添加</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[tls2socks]</span><br><span class="line">;服务端监听一个端口，这个端口用于接收stunnel客户端传过来的数据，建议设置在10000~60000之间，务必在linux防火墙和阿里云这类的服务商安全组开放，例如设置为：accept = 12345</span><br><span class="line">accpet = your accept port 1</span><br><span class="line">;连接到，ssr的服务器端口上，与ssr服务端配置的端口保持一致</span><br><span class="line">connect = localhost:your ssr server port</span><br></pre></td></tr></table></figure><p>修改国内中转服务器上的stunnel客户端配置文件，在<code>/etc/stunnel/stunnel.conf</code>文件里，</p><p>删除</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[squid-proxy]</span><br><span class="line">; 监听3128端口，那么用户浏览器的代理设置就是 stunnel-client-ip:3128</span><br><span class="line">accept = 3128</span><br><span class="line">; 要连接到的stunnel server的ip与端口，修改xx.xx.xx.xx为国外的服务器</span><br><span class="line">connect = xx.xx.xx.xx:3129</span><br></pre></td></tr></table></figure><p>添加</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[socks2tls]</span><br><span class="line">;服务端监听一个端口，这个端口用于接收ssr客户端传过来的数据，建议设置在10000~60000之间，务必在linux防火墙和阿里云这类的服务商安全组开放。例如 accept = 34567</span><br><span class="line">accpet = your accept port 2</span><br><span class="line">;连接到，stunnel服务端接收端口上。按照该服务端的例如配置，这里应该为：connect = xx.xx.xx.xx:12345。xx表示国外服务器ip地址。</span><br><span class="line">connect = stunnel server ip:your accept port 1</span><br></pre></td></tr></table></figure><h2 id="2-2-ssr安装和配置"><a href="#2-2-ssr安装和配置" class="headerlink" title="2.2 ssr安装和配置"></a>2.2 ssr安装和配置</h2><p>ssr安装，可以参考《<a href="https://ssr.tools/31">SSR 一键安装脚本</a>》，在国外的服务器上安装。</p><p>ssr服务端端口需要和stunnel服务端的<code>connect</code>端口保持一致。</p><p>ssr客户端配置，客户端地址，应该填写为国内服务器ip，服务端口，应填写为stunnel客户端的<code>accept</code>端口(国内服务器上配置的accept = your accept port 2)，例子中给的34567端口。</p><p>配置完成后，就可以连接上网了。</p><p>即便使用移动网络，也能产生非常好的连接效果，而且应该在非常久得时间里，端口都不会被封。</p><h1 id="3：可能出现的问题"><a href="#3：可能出现的问题" class="headerlink" title="3：可能出现的问题"></a>3：可能出现的问题</h1><p>如果配置后无法上网，请检查你设置得端口，通过 <a href="https://port.ping.pe/">https://port.ping.pe</a> 网址检测你的端口是否开启，如果测试未开启，请修改防火墙配置，在《<a href="https://sci.ci/2020/05/28/stunnel-squid-dai-li-jia-su-ya-chen-jiao-xue-shi-pin-jia-su/">利用Stunnel+squid代理实现国内无客户端访问外网</a>》中第4章有介绍。若任然没有导通，请检查云服务商的安全组是否开启了端口。</p><p>如果端口开放，而无法连接，请尝试，终止stunnel进程并重新启用。</p><p>方法1：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">servicer stunnel restart</span><br></pre></td></tr></table></figure><p>方法2:</p><p>检查stunnel的进程</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep -i stunnel</span><br></pre></td></tr></table></figure><p>找到进程号pid，在第二列</p><p>杀掉进程</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -9 替换为pid</span><br></pre></td></tr></table></figure><p>然后重新启用stunnel</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stunnel</span><br></pre></td></tr></table></figure><p>如果没有任何显示，则stunnel重启成功，且配置文件没有任何问题。否则将显示错误信息。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSR </tag>
            
            <tag> Stunnel </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Squid+MySQL储存用户验证通过的IP</title>
      <link href="/2020/06/02/Squid-MySQL%E5%82%A8%E5%AD%98%E7%94%A8%E6%88%B7%E9%AA%8C%E8%AF%81%E9%80%9A%E8%BF%87%E7%9A%84IP/"/>
      <url>/2020/06/02/Squid-MySQL%E5%82%A8%E5%AD%98%E7%94%A8%E6%88%B7%E9%AA%8C%E8%AF%81%E9%80%9A%E8%BF%87%E7%9A%84IP/</url>
      
        <content type="html"><![CDATA[<h1 id="0：前文"><a href="#0：前文" class="headerlink" title="0：前文"></a>0：前文</h1><p>在文章《<a href="https://sci.ci/2020/05/28/stunnel-squid-dai-li-jia-su-ya-chen-jiao-xue-shi-pin-jia-su/">利用Stunnel+squid代理实现国内无客户端访问外网</a>》中，提到了，当使用代理验证实现代理访问时，手机的软件无法连接网络，而且切换浏览器需要重新验证用户名和密码。为了解决这个问题，我提出了四种方案。前两种漏洞太大，第三种，开发比较麻烦。于是，我采用了第四种方法。下面将对代码和具体细节进行说明。</p><p>阅读本文，请确保你已经安装了squid 3.5以上版本。<code>squid -v</code>可以查看你的安装版本。</p><h1 id="1：配置基本环境MySQL和Python"><a href="#1：配置基本环境MySQL和Python" class="headerlink" title="1：配置基本环境MySQL和Python"></a>1：配置基本环境MySQL和Python</h1><h2 id="1-1-数据库"><a href="#1-1-数据库" class="headerlink" title="1.1 数据库"></a>1.1 数据库</h2><p>Mysql被广泛用于网站数据库，网上的支持文档很多，重要的是，MySQL在python编程上具有非常好的支持。也就是mysqldb库。</p><p>使用数据库，主要是用来存放通过验证器验证的客户端ip，ACL辅助器可以通过读取这个ip，从而acl辅助器通过的ip不再需要验证器验证密码。所以，你使用任何其他数据库都是可以的。建议你选用你自己熟悉的数据库。因为本文对于如何在mysql下，创建数据表，只做大概说明。</p><p>我建议使用宝塔面板<a href="bt.cn">bt.cn</a>安装mysql。这样可以可视化的安装mysql和创建数据库和数据表。也可以规避许多由于数据库权限问题导致的不可控因素。宝塔面板安装和在宝塔面板中安装mysql数据库，可以自行百度。非常简单。</p><p>在完成数据库安装后，请你在mysql里添加一个，库名为：squid。用户名为：squid。的数据库。用于存放squid数据。</p><p><img src="https://ae01.alicdn.com/kf/H9601fdba1d3f4c70add1ada5fbad87ddl.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H9601fdba1d3f4c70add1ada5fbad87ddl.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>数据库新建成功后，点击右边的管理。进入phpmyadmin，新建一个数据表。表名为：sq_client_ip。</p><p><img src="https://ae01.alicdn.com/kf/Hd7fb2278aa8e402cb347108ead39c32fZ.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/Hd7fb2278aa8e402cb347108ead39c32fZ.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>表的结构：</p><p><img src="https://ae01.alicdn.com/kf/Ha096c13cec1c4defa80d6a23e12ec289b.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/Ha096c13cec1c4defa80d6a23e12ec289b.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>注意，id项，新建表时，勾选<code>AI</code>，AI表示设置id为自增主键。这样每添加一个数据进去，id都会自行增加。</p><h2 id="1-2-Python"><a href="#1-2-Python" class="headerlink" title="1.2 Python"></a>1.2 Python</h2><p>安装Python，简单的安装python，你只需要输入下面指令</p><p>centos:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install python</span><br></pre></td></tr></table></figure><p>Ubuntu:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get -y install python</span><br></pre></td></tr></table></figure><p>安装完python，需要安装python的mysqldb库。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install mysqldb</span><br></pre></td></tr></table></figure><h1 id="2：自定义基本验证器"><a href="#2：自定义基本验证器" class="headerlink" title="2：自定义基本验证器"></a>2：自定义基本验证器</h1><p>新建一个python文件<code>AuthPro.py</code>。在里面添加如下内容：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># coding=UTF-8</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> MySQLdb</span><br><span class="line"><span class="string">&quot;&quot;&quot;&quot;&quot;&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">matchpasswd</span>(<span class="params">login,passwd</span>):</span></span><br><span class="line">    <span class="comment">#用户名和密码，用于验证输入的用户名和密码。</span></span><br><span class="line">    <span class="comment">#你可以自定义验证通过的要求，验证通过，返回True，验证不通过返回False</span></span><br><span class="line">    <span class="keyword">if</span> (login == <span class="string">&#x27;修改为你的用户名&#x27;</span> <span class="keyword">and</span> passwd == <span class="string">&#x27;修改为你的验证密码&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_client_ip_to_db</span>(<span class="params">username,client_ip</span>):</span></span><br><span class="line">    <span class="comment">#数据库地址，数据库名，数据库密码，数据库用户名，数据库编码格式</span></span><br><span class="line">    db=MySQLdb.connect(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;squid&quot;</span>,<span class="string">&quot;修改为你的密码&quot;</span>,<span class="string">&quot;squid&quot;</span>,charset=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    <span class="comment"># 使用cursor()方法获取操作游标 </span></span><br><span class="line">    cursor = db.cursor()</span><br><span class="line">    <span class="comment"># 向sq_client_ip表中插入用户名和用户ip</span></span><br><span class="line">    sql = <span class="string">&quot;INSERT INTO sq_client_ip(username, client_ip) VALUES (&#x27;%s&#x27;, &#x27;%s&#x27;)&quot;</span> % (username,client_ip)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">       <span class="comment"># 执行sql语句</span></span><br><span class="line">       cursor.execute(sql)</span><br><span class="line">       <span class="comment">#Ok 后面的print语句可以向cache日志中输出提示。/var/log/squid/cache.log查看</span></span><br><span class="line">       print(<span class="string">&quot;执行sql语句&quot;</span>)</span><br><span class="line">       <span class="comment"># 提交到数据库执行</span></span><br><span class="line">       db.commit()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">       <span class="comment">#打印错误内容</span></span><br><span class="line">       info = sys.exc_info()  </span><br><span class="line">       print( info[<span class="number">0</span>], <span class="string">&quot;:&quot;</span>, info[<span class="number">1</span>]) </span><br><span class="line">   <span class="comment">#发生错误时回滚</span></span><br><span class="line">       db.rollback()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 关闭数据库连接</span></span><br><span class="line">    db.close()</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="comment"># read a line from stdin</span></span><br><span class="line">    line = sys.stdin.readline()</span><br><span class="line">    line = line.strip()</span><br><span class="line">    <span class="comment">#提取输入参数。</span></span><br><span class="line">    username,password,client_ip = line.split()</span><br><span class="line">    <span class="comment">#判断密码是否匹配</span></span><br><span class="line">    <span class="keyword">if</span> matchpasswd(username, password):</span><br><span class="line">        <span class="comment">#输出ok表示验证通过</span></span><br><span class="line">        sys.stdout.write(<span class="string">&#x27;OK\n 密码验证通过&#x27;</span>)</span><br><span class="line">      <span class="comment">#将客户端ip添加至数据库ip白名单</span></span><br><span class="line">      write_client_ip_to_db(username,client_ip)</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        sys.stdout.write(<span class="string">&#x27;ERR\n 密码验证失败&#x27;</span>)</span><br><span class="line">    <span class="comment"># Flush the output to stdout.</span></span><br><span class="line">    sys.stdout.flush()</span><br></pre></td></tr></table></figure><p>将<code>AuthPro.py</code>文件拷贝到squid的配置文件夹<code>/etc/squid</code>里</p><h1 id="3：外部ACL辅助器"><a href="#3：外部ACL辅助器" class="headerlink" title="3：外部ACL辅助器"></a>3：外部ACL辅助器</h1><p>新建一个python文件<code>AclHelper.py</code>。在里面添加如下内容:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># coding=UTF-8</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> MySQLdb</span><br><span class="line"><span class="string">&quot;&quot;&quot;当用户连接squid，传递用户客户端ip地址到外部辅助器，辅助器通过标准输入读取。辅助器查询数据库符合客户端ip的所有项，如果查询结果，显示客户ip在数据库中，则输出ok，否则输出ERR&quot;&quot;&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">matchclientip</span>(<span class="params">client_ip</span>):</span></span><br><span class="line">    <span class="comment">#数据库地址，数据库名，数据库密码，数据库用户名，数据库编码格式</span></span><br><span class="line">    db=MySQLdb.connect(<span class="string">&quot;localhost&quot;</span>,<span class="string">&quot;squid&quot;</span>,<span class="string">&quot;你的数据库密码&quot;</span>,<span class="string">&quot;squid&quot;</span>,charset=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    <span class="comment"># 使用cursor()方法获取操作游标 </span></span><br><span class="line">    cursor = db.cursor()</span><br><span class="line">    <span class="comment"># SQL 插入语句</span></span><br><span class="line">    sql = <span class="string">&quot;SELECT * FROM sq_client_ip  WHERE client_ip = &#x27;%s&#x27;&quot;</span> % (client_ip)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">       <span class="comment"># 执行sql语句</span></span><br><span class="line">       cursor.execute(sql)</span><br><span class="line">       result = cursor.fetchone()</span><br><span class="line">       <span class="keyword">if</span> result:</span><br><span class="line">          exist_ip = <span class="literal">True</span></span><br><span class="line">       <span class="keyword">else</span>:</span><br><span class="line">          exist_ip = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">       <span class="comment"># 发生错误时回滚</span></span><br><span class="line">       db.rollback()</span><br><span class="line">       exist_ip = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 关闭数据库连接</span></span><br><span class="line">    db.close()</span><br><span class="line">    <span class="keyword">return</span> exist_ip</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="comment"># 从标准输入读取一行，“client_ip”</span></span><br><span class="line">    line = sys.stdin.readline()</span><br><span class="line">    <span class="comment">#提取输入参数。squid，输入给辅助器的字符串是&quot;0 xx.xx.xx.xx&quot;格式</span></span><br><span class="line">    <span class="comment">#利用split分割字符串，得到0和client_ip的list</span></span><br><span class="line">    client_ip = line.strip().split()[<span class="number">1</span>]</span><br><span class="line">    <span class="comment">#判断密码是否匹配</span></span><br><span class="line">    <span class="keyword">if</span> matchclientip(client_ip):</span><br><span class="line">        <span class="comment">#输出ok表示验证通过</span></span><br><span class="line">        sys.stdout.write(<span class="string">&#x27;OK\n&#x27;</span>)</span><br><span class="line">        <span class="comment">#print会将信息输出到/var/log/squid/cache.log中。</span></span><br><span class="line">        print(<span class="string">&quot;Acl辅助器验证成功&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        sys.stdout.write(<span class="string">&#x27;ERR\n&#x27;</span>)</span><br><span class="line">        print(<span class="string">&quot;ACL辅助器验证失败&quot;</span>)</span><br><span class="line">    <span class="comment"># Flush the output to stdout.</span></span><br><span class="line">    sys.stdout.flush()</span><br></pre></td></tr></table></figure><p>将<code>AclHelper.py</code>文件拷贝到squid的配置文件夹<code>/etc/squid</code>里</p><h1 id="4：修改squid配置文件"><a href="#4：修改squid配置文件" class="headerlink" title="4：修改squid配置文件"></a>4：修改squid配置文件</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> http_port 设置监听端口，默认为3128</span></span><br><span class="line">http_port 6666</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">父squid配置，配合国外服务器server2使用</span></span><br><span class="line">nonhierarchical_direct off</span><br><span class="line"><span class="meta">#</span><span class="bash">转发请求通过stunnel至父squid</span></span><br><span class="line">cache_peer localhost parent 3128 0 default</span><br><span class="line">never_direct allow all</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> access_log 设置access日志，daemon表示在后台将日志写入/var/<span class="built_in">log</span>/squid/access.log文件, </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> combined是一个预定义的logformat，也可以使用自定义的logformat</span></span><br><span class="line">access_log daemon:/var/log/squid/access.log combined</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ACLs all, manager, localhost, and to_localhost are predefined.</span></span><br><span class="line">acl SSL_ports port 443</span><br><span class="line">acl Safe_ports port 80# http</span><br><span class="line">acl Safe_ports port 21# ftp</span><br><span class="line">acl Safe_ports port 443# https</span><br><span class="line">acl Safe_ports port 70# gopher</span><br><span class="line">acl Safe_ports port 210# wais</span><br><span class="line">acl Safe_ports port 1025-65535  # unregistered ports</span><br><span class="line">acl Safe_ports port 280# http-mgmt</span><br><span class="line">acl Safe_ports port 488# gss-http</span><br><span class="line">acl Safe_ports port 591# filemaker</span><br><span class="line">acl Safe_ports port 777# multiling http</span><br><span class="line">acl CONNECT method CONNECT</span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span><span class="bash"> 拒绝所有非Safe_ports的请求</span></span><br><span class="line">http_access deny !Safe_ports</span><br><span class="line"><span class="meta">#</span><span class="bash"> 拒绝所有非SSL_prots的CONNECT请求</span></span><br><span class="line">http_access deny CONNECT !SSL_ports</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Only allow cachemgr access from localhost</span></span><br><span class="line">http_access allow localhost manager</span><br><span class="line"><span class="meta">#</span><span class="bash">http_access deny manager</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 允许来自本地的请求</span></span><br><span class="line">http_access allow localhost</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">#####################################</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">定义一个外部ACL辅助器</span></span><br><span class="line"><span class="meta">#</span><span class="bash">使用python解释器，negativettl表示验证错误时的缓存时间单位秒，concurrency表示最多接收的认证通过用户，ipv4必须，如果没有ipv4会报错。</span></span><br><span class="line">external_acl_type MyAclHelper negative_ttl=1 concurrency=30 ipv4 %SRC /usr/bin/python /etc/squid/AclHelper.py</span><br><span class="line">acl MyAcl external MyAclHelper</span><br><span class="line">http_access allow MyAcl</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">定义一个验证器</span></span><br><span class="line"><span class="meta">#</span><span class="bash">指定python运行目录，和python程序的目录</span></span><br><span class="line">auth_param basic program /usr/bin/python /etc/squid/AuthPro.py</span><br><span class="line"><span class="meta">#</span><span class="bash">向python程序中输入key_extras变量客户端ip<span class="string">&quot;%&gt;a&quot;</span></span></span><br><span class="line">auth_param basic key_extras &quot;%&gt;a&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash">允许多少个子程序</span></span><br><span class="line">auth_param basic children 30</span><br><span class="line"><span class="meta">#</span><span class="bash">输入框提示信息</span></span><br><span class="line">auth_param basic realm 输入用户名和密码</span><br><span class="line"><span class="meta">#</span><span class="bash">验证信息的缓存时长</span></span><br><span class="line">auth_param basic credentialsttl 1 second</span><br><span class="line"><span class="meta">#</span><span class="bash">用户名和密码是否区分大小写</span></span><br><span class="line">auth_param basic casesensitive on</span><br><span class="line"><span class="meta">#</span><span class="bash">强制用户验证</span></span><br><span class="line">acl authenticated proxy_auth REQUIRED</span><br><span class="line">http_access allow authenticated</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###############################################</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 拒绝所有请求，最后兜底的规则</span></span><br><span class="line">http_access deny all</span><br></pre></td></tr></table></figure><blockquote><p>特别需要注意的是：</p><ol><li><p>必须辅助器配置在前，而验证器配置在后。由于squid特殊的处理机制，当squid从配置文件指定的http_access中找到了符合的条件的allow或deny信息，则后续的判断将不会再生效，也就是说，只有在用户无法通过辅助器验证时，才会进行验证器验证。</p></li><li><p>辅助器必须设置negative_ttl项，而且设置的不通过验证时间不易过长，最好在几秒内。原因是，当用户连接squid后，首先通过辅助器查找数据库是否有此ip，如果没有辅助器会缓存此ip信息，并将其标记为未通过验证，再进入验证器。而通常，我们首先于squid连接上网的并不是浏览器，可能收微博软件等，这些软件由于无法弹出验证窗口，而导致验证器验证失败。此后即便你打开浏览器，而由于上一次的验证失败而缓存了失败信息，致使，squid不会再进行辅助器和验证器验证，而直接拒绝访问。因此设置验证失败缓存时间短点，可以保证我们打开浏览器时，还能进入辅助器验证和验证器验证。</p></li><li><p>验证器必须设置credentialsttl项，且设置时间不易过长，最好在几秒内。之所以验证器验证成功的缓存不能太长，是因为当我们首次通过验证器验证后，squid缓存成功验证的用户信息，下次用户则无需再次经过验证器密码验证，直接读取用户名和ip。但是由于squid缓存的是用户的ip和用户名，如果你使用了微博等没有验证框的软件，由于没有向squid发送用户名，会导致无法联网。</p><p>所以，我们利用验证器，只是为了保存成功验证的用户ip，然后通过辅助器来验证用户。所以，通过后则清除验证器的缓存。</p><p>用户再次上网，便会首先经过辅助器，此时辅助器已经能从数据库读取到刚才验证器保存的客户ip。辅助器，可以设置比较久的成功ttl时长，如果没有设置，默认是一个小时。</p></li></ol></blockquote><h1 id="5：参考资料"><a href="#5：参考资料" class="headerlink" title="5：参考资料"></a>5：参考资料</h1><p>《<a href="http://blog.zyan.cc/book/squid/">squid中文权威指南</a>》</p><p>《<a href="http://www.site-digger.com/html/articles/20161012/132.html">用Python脚本打造Squid权限认证后端程序以及Squid3.5 auth_param key_extras新特性介绍</a>》</p><p>《<a href="https://www.hawu.me/operation/852">使用squid搭建代理服务器</a>》</p><p>《<a href="https://wiki.squid-cache.org/Features/AddonHelpers">Feature: Add-On Helpers for Request Manipulation</a>》</p><p>《<a href="https://stackoverflow.com/questions/26601943/how-to-configure-squid-to-pass-client-ip-to-authenticate-program?rq=1">stackoverflow上关于自定义验证器输入客户端IP的回答</a>》</p><blockquote><p>最后，感谢<a href="https://www.hawu.me/">https://www.hawu.me</a>  站长，提供的一些帮助。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 其他 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Squid </tag>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>利用Stunnel+Squid代理实现国内无客户端访问外网</title>
      <link href="/2020/05/28/%E5%88%A9%E7%94%A8Stunnel+squid%E4%BB%A3%E7%90%86%E5%AE%9E%E7%8E%B0%E5%9B%BD%E5%86%85%E6%97%A0%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BF%E9%97%AE%E5%A4%96%E7%BD%91/"/>
      <url>/2020/05/28/%E5%88%A9%E7%94%A8Stunnel+squid%E4%BB%A3%E7%90%86%E5%AE%9E%E7%8E%B0%E5%9B%BD%E5%86%85%E6%97%A0%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%AE%BF%E9%97%AE%E5%A4%96%E7%BD%91/</url>
      
        <content type="html"><![CDATA[<h1 id="1：加速原理"><a href="#1：加速原理" class="headerlink" title="1：加速原理"></a>1：加速原理</h1><h2 id="1-1-squid介绍"><a href="#1-1-squid介绍" class="headerlink" title="1.1 squid介绍"></a>1.1 squid介绍</h2><p>squid是一个用于代理的开源软件，用户主机将http请求发送到部署了squid的服务器，squid可以帮助用户转发http请求。利用squid，我们可以让服务器替我们请求数据，再由服务器转发给我们。</p><p>按找squid原理，我们就已经可以进行翻墙了，在国内能够访问的国外服务器上部署squid，将访问谷歌的请求发送给squid，squid替我们请求谷歌数据，再将谷歌数据转发给我们。这就是一个完整的工作过程。</p><p>但是由于squid请求报头未加密，在squid服务器向浏览器返回数据时，能够被GFW检测到访问数据来自于谷歌。从而将返回数据过滤掉。之后通过squid返回的数据，都会被GFW过滤掉，即使我们访问的是百度，也会无法收到返回数据。</p><h2 id="1-2-Https介绍"><a href="#1-2-Https介绍" class="headerlink" title="1.2 Https介绍"></a>1.2 Https介绍</h2><p>这篇文章详细介绍了加密的原理：<a href="https://blog.csdn.net/clh604/article/details/22179907">https://blog.csdn.net/clh604/article/details/22179907</a></p><p><img src="https://ae01.alicdn.com/kf/Hdb6994b2de5f42e7adca8620e915331aQ.png" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/Hdb6994b2de5f42e7adca8620e915331aQ.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="SSL"></p><h2 id="1-3-stunnel介绍"><a href="#1-3-stunnel介绍" class="headerlink" title="1.3 stunnel介绍"></a>1.3 stunnel介绍</h2><p>stunnel是一个开源软件，使用stunnel可以为我们使用tcp协议传输的数据使用SSL协议加密，这样我们的请求，除了客户端和服务器，其他人将无法从数据中提取到有用信息。</p><p>为了让GFW无法识别出主机访问谷歌和返回的数据来自谷歌。这里使用stunnel将主机和squid之间的通信数据加密，将http请求的报头也加密。</p><h2 id="1-4-代理过程"><a href="#1-4-代理过程" class="headerlink" title="1.4 代理过程"></a>1.4 代理过程</h2><p>在windows主机上设置全局代理，将windows的tcp请求，转发到国内服务器server 1上，国内服务器server 1与国外服务器server 2搭建stunnel加密隧道连接，国外服务器server 2利用squid，发送主机的访问请求，并将访问结果返回给server 1，server 1在发送给主机浏览器。加速原理如下图。</p><p>通常可以只利用一个国外服务器，在国外服务器上部署stunnel和squid，在本地主机上搭建stunnel客户端就可以了。如下图</p><p><img src="https://ae01.alicdn.com/kf/H4ae21783bed543d7b6102e79eb735c89n.png" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H4ae21783bed543d7b6102e79eb735c89n.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>但是，为了访问方便，即任何用户只需要设置windows上现有的代理服务器就能访问外网，而不需要下载stunnel客户端和配置客户端参数。</p><p>相比于主机使用Stunnel客户端，将stunnel客户端部署到国内服务器的缺点是：这需要国内外均有服务器。成本会更高。</p><p>更重要的是，我们与国内服务器之间的信息被抓取后，能够获取到我们访问的信息，比如是谷歌、使用的浏览器版本等，但是无法知道具体访问内容。由于是与国内服务器发送信息，因此被探测的几率很小。</p><h1 id="2：主机设置代理访问"><a href="#2：主机设置代理访问" class="headerlink" title="2：主机设置代理访问"></a>2：主机设置代理访问</h1><p>为了让阅读本文的读者，提前的看到成果，将server1和server2都配置好后，先介绍如何利用你搭建好的服务器访问外网。</p><ol><li>打开<code>代理服务器色设置</code></li></ol><p><img src="https://ae01.alicdn.com/kf/H70a59c178af24750b89d0d045ee16845R.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H70a59c178af24750b89d0d045ee16845R.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ol start="2"><li>在代理服务器上输入国内服务器server1的IP和stunnel客户端监听的端口号。</li></ol><p><img src="https://ae01.alicdn.com/kf/Hcc9e9c1620b24b3da68519ffef92fd10N.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/Hcc9e9c1620b24b3da68519ffef92fd10N.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ol start="3"><li>使用浏览器登陆google</li></ol><p><img src="https://ae01.alicdn.com/kf/H2000b41723ff444bb46c057eee0bc5635.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H2000b41723ff444bb46c057eee0bc5635.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>实际上使用就是这么简单。当然为了你搭建的隧道不会被其他人使用，你也可以对能够访问这条隧道的IP进行限制，或者设置一个密码。会在后续中介绍到。</p><h1 id="3：国外服务器配置"><a href="#3：国外服务器配置" class="headerlink" title="3：国外服务器配置"></a>3：国外服务器配置</h1><p>确保在服务商安全组里开放了3128和3129端口，这两个端口，将用于接收和转发数据。</p><h2 id="3-1-安装配置Squid"><a href="#3-1-安装配置Squid" class="headerlink" title="3.1 安装配置Squid"></a>3.1 安装配置Squid</h2><ol><li>安装squid</li></ol><p>ubuntu使用：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install squid</span><br></pre></td></tr></table></figure><p>centos使用：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install squid</span><br></pre></td></tr></table></figure><p>使用<code>squid -v</code>检查squid是否安装好。</p><ol start="2"><li>配置squid</li></ol><p>打开squid配置文件<code>/etc/squid/squid.conf</code>。没有就新建此文件</p><p>将文件内容修改为：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> http_port 设置监听端口，默认为3128</span></span><br><span class="line">http_port 3128</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> access_log 设置access日志，daemon表示在后台将日志写入/var/<span class="built_in">log</span>/squid/access.log文件, </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> combined是一个预定义的logformat，也可以使用自定义的logformat</span></span><br><span class="line">access_log daemon:/var/log/squid/access.log combined</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> visible_hotname 设置代理服务器的主机名</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 默认取本机的hostname</span></span><br><span class="line">visible_hostname funway.aliyun.proxy</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ACLs all, manager, localhost, and to_localhost are predefined.</span></span><br><span class="line">acl SSL_ports port 443</span><br><span class="line">acl Safe_ports port 80    # http</span><br><span class="line">acl Safe_ports port 21    # ftp</span><br><span class="line">acl Safe_ports port 443    # https</span><br><span class="line">acl Safe_ports port 70    # gopher</span><br><span class="line">acl Safe_ports port 210    # wais</span><br><span class="line">acl Safe_ports port 1025-65535  # unregistered ports</span><br><span class="line">acl Safe_ports port 280    # http-mgmt</span><br><span class="line">acl Safe_ports port 488    # gss-http</span><br><span class="line">acl Safe_ports port 591    # filemaker</span><br><span class="line">acl Safe_ports port 777    # multiling http</span><br><span class="line">acl CONNECT method CONNECT</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 拒绝所有非Safe_ports的请求</span></span><br><span class="line">http_access deny !Safe_ports</span><br><span class="line"><span class="meta">#</span><span class="bash"> 拒绝所有非SSL_prots的CONNECT请求</span></span><br><span class="line">http_access deny CONNECT !SSL_ports</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Only allow cachemgr access from localhost</span></span><br><span class="line">http_access allow localhost manager</span><br><span class="line">http_access deny manager</span><br><span class="line"><span class="meta">#</span><span class="bash"> 允许来自本地的请求</span></span><br><span class="line">http_access allow localhost</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 拒绝所有请求，最后兜底的规则</span></span><br><span class="line">http_access deny all</span><br></pre></td></tr></table></figure><p>更多详细的配置参数解释，请参考博文《<a href="https://www.hawu.me/operation/852">使用squid搭建代理服务器</a>》</p><p>配置squid只能本地地址访问。</p><ol start="3"><li>运行squid</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service squid start //运行</span><br><span class="line">service squid status //查看squid运行状态</span><br></pre></td></tr></table></figure><h2 id="3-2-安装配置stunnel服务端"><a href="#3-2-安装配置stunnel服务端" class="headerlink" title="3.2 安装配置stunnel服务端"></a>3.2 安装配置stunnel服务端</h2><ol><li>生成自签名证书，如果没有openssl需要先安装。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -x509 -days 3650 -nodes -out stunnel.pem -keyout stunnel.pem</span><br></pre></td></tr></table></figure><p>将生成的证书，复制到/etc/stunnel文件夹下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp stunnel.pem /etc/stunnel</span><br></pre></td></tr></table></figure><p>这个证书还需要下载到主机，之后上传到国内服务器，用于为stunnle客户端设置的公钥。</p><ol><li>下载安装stunnel</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install stunnel</span><br></pre></td></tr></table></figure><ol start="2"><li>设置stunnel配置文件</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">; 设置工作目录，没有目录需要先创建</span><br><span class="line">chroot = /var/run/stunnel/</span><br><span class="line">; 设置stunnel的pid文件路径（在chroot下）</span><br><span class="line">pid = /stunnel.pid</span><br><span class="line">; 设置stunnel工作的用户（组）</span><br><span class="line">setuid = root</span><br><span class="line">setgid = root</span><br><span class="line"></span><br><span class="line">; 开启日志等级：emerg (0), alert (1), crit (2), err (3), warning (4), notice (5), info (6), or debug (7)</span><br><span class="line">; 默认为5</span><br><span class="line">debug = 7</span><br><span class="line">; 日志文件路径（我的server的版本有个bug，这个文件也被放在chroot路径下了，client的版本则是独立的=。=#）</span><br><span class="line">output = /stunnel.log</span><br><span class="line"></span><br><span class="line">; 证书文件，就是在本文2.2中用openssl生成的自签名证书（server端必须设置这两项）</span><br><span class="line">cert = /etc/stunnel/stunnel.pem</span><br><span class="line">; 私钥文件</span><br><span class="line">key = /etc/stunnel/stunnel.pem</span><br><span class="line"></span><br><span class="line">; 设置stunnel服务，可以设置多个服务，监听同的端口，并发给不同的server。</span><br><span class="line">; 自定义服务名squid-proxy</span><br><span class="line">[squid-proxy]</span><br><span class="line">; 服务监听的端口，client要连接这个端口与server通信</span><br><span class="line">accept = 3129</span><br><span class="line">; 服务要连接的端口，连接到squid的3128端口，将数据发给squid</span><br><span class="line">connect = localhost:3128</span><br><span class="line"></span><br><span class="line">; **************************************************************************</span><br><span class="line">; * 下面这些配置我都注释掉了，但也需要了解下 *</span><br><span class="line">; **************************************************************************</span><br><span class="line"></span><br><span class="line">; 设置是否对传输数据进行压缩，默认不开启。</span><br><span class="line">; 这是跟openssl相关的，如果你的openssl没有zlib，开启这个设置会导致启动失败（failed to initialize compression method）</span><br><span class="line">;compression = zlib</span><br><span class="line"></span><br><span class="line">; 设置ssl版本,这个也是跟安装的openssl有关的</span><br><span class="line">;sslVersion = TLSv1</span><br><span class="line"></span><br><span class="line">; Authentication stuff needs to be configured to prevent MITM attacks</span><br><span class="line">; It is important to understand that this option was solely designed for access control and not for authorization</span><br><span class="line">; It is not enabled by default!</span><br><span class="line">; 下面这些配置用来定义是否信任对方发过来的证书。就好比浏览器访问https的时候，浏览器默认会信任那些由权威CA机构签发的证书，</span><br><span class="line">; 对于那些自签名证书，浏览器就会弹出对话框提醒用户这个证书可能不安全，是否要信任该证书。</span><br><span class="line">; 这是有效防止中间人攻击的手段</span><br><span class="line">; verify 等级2表示需要验证对方发过来的证书（默认0，不需要验证，都信任）</span><br><span class="line">; 因为这个配置是server端的，我们不需要理会client的证书（client也不会没事发证书过来啦）</span><br><span class="line">;verify = 2</span><br><span class="line">; CAfile 表示受信的证书文件，即如果对方发过来的证书在这个CAfile里，那么就是受信任的证书；否则不信任该证书，断开连接。</span><br><span class="line">;CAfile = /etc/stunnel/stunnel-client.pem</span><br></pre></td></tr></table></figure><ol start="3"><li>启动停止stunnel</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">service stunnel start //开启stunnel</span><br><span class="line">service stunnel restart //重启</span><br><span class="line">service stunnel stop //停止</span><br><span class="line">service stunnel status  //查看状态</span><br></pre></td></tr></table></figure><h1 id="4：国内服务器配置Stunnel客户端"><a href="#4：国内服务器配置Stunnel客户端" class="headerlink" title="4：国内服务器配置Stunnel客户端"></a>4：国内服务器配置Stunnel客户端</h1><p>国内服务器，就是在浏览器代理设置中，填入的服务器IP，而端口，则是stunnel接收代理数据的端口。</p><ol><li>在服务器提供商网页中的安全组设置里开启stunnel接收数据的端口。</li></ol><p>本人使用的阿里云轻量级应用服务器，进入阿里云控制台相应页面后，找到安全组-&gt;防火墙-&gt;添加新规则。在新规则里，开放，TCP协议的3128接口。也可以是其他接口。</p><ol start="2"><li>配置好安全组后，阿里云服务器本身还有一个防火墙，还需要在服务器里开放3128端口。</li></ol><p>查看开放端口，如果没有firewall，请先安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --list-all</span><br></pre></td></tr></table></figure><p>设置需要开放的端口</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=3128/tcp --permanent//设置</span><br><span class="line">firewall-cmd --reload//生效</span><br></pre></td></tr></table></figure><p>此时再查看开放的端口，就能看到3128端口已开放。</p><ol start="3"><li>安装stunnel客户端。</li></ol><p>ubuntu使用:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install stunnel</span><br></pre></td></tr></table></figure><p>centos使用：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install stunnel</span><br></pre></td></tr></table></figure><ol start="4"><li>设置stunnel客户端配置文件</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">; stunnel工作目录,如果没有/var/run/stunnel文件夹，需先创建</span><br><span class="line">chroot = /var/run/stunnel/</span><br><span class="line">; stunnel工作的用户组</span><br><span class="line">setuid = root</span><br><span class="line">setgid = root</span><br><span class="line">; stunnel工作时候的pid</span><br><span class="line">pid = /stunnel.pid</span><br><span class="line">; 日志等级</span><br><span class="line">debug = 7</span><br><span class="line">; 日志文件</span><br><span class="line">output = /var/log/stunnel/stunnel.log</span><br><span class="line">; 表示以client模式启动stunnel，默认client = no，即server模式</span><br><span class="line">client = yes</span><br><span class="line">; 定义一个服务</span><br><span class="line">[squid-proxy]</span><br><span class="line">; 监听3128端口，那么用户浏览器的代理设置就是 stunnel-client-ip:3128</span><br><span class="line">accept = 3128</span><br><span class="line">; 要连接到的stunnel server的ip与端口，修改xx.xx.xx.xx为国外的服务器</span><br><span class="line">connect = xx.xx.xx.xx:3129</span><br><span class="line">; 需要验证对方发过来的证书</span><br><span class="line">verify = 2</span><br><span class="line">; 用来进行证书验证的文件（里面有stunnel server的证书）</span><br><span class="line">CAfile = /etc/stunnel/stunnel-server.pem</span><br><span class="line">; 客户端不需要传递自己的证书，所以注释掉</span><br><span class="line">;cert = /etc/stunnel/stunnel.pem</span><br><span class="line">;key = /etc/stunnel/stunnel.key</span><br></pre></td></tr></table></figure><ol start="5"><li>将stunnle公钥证书拷贝一份到stunnel客户端配置文件的指定地址上。</li></ol><p>配置文件里<code>CAfile = /etc/stunnel/stunnel-server.pem</code>写明了我们需要将公钥保存的位置和公钥的文件名。</p><p>我们只需要将，3.2节生成的证书打开，复制已<code>BEGIN CERTIFICATION</code>开头到<code>END CERTIFICATION</code>结束的公钥。然后，新建<code>/etc/stunnel/stunnel-server.pem</code>文件，将公钥粘贴进去。</p><p>这样stunnel客户端就能将数据加密后发送给stunnel服务器了。</p><ol start="6"><li>启动和停止stunnel</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">service stunnel start &#x2F;&#x2F;开启stunnel</span><br><span class="line">service stunnel restart &#x2F;&#x2F;重启</span><br><span class="line">service stunnel stop &#x2F;&#x2F;停止</span><br><span class="line">service stunnel status  &#x2F;&#x2F;查看状态</span><br></pre></td></tr></table></figure><h1 id="5：不足和优化"><a href="#5：不足和优化" class="headerlink" title="5：不足和优化"></a>5：不足和优化</h1><h2 id="5-1-代理方法的不足"><a href="#5-1-代理方法的不足" class="headerlink" title="5.1 代理方法的不足"></a>5.1 代理方法的不足</h2><ol><li><p>由于客户端的stunnel直接监听3128端口，而没有任何的验证和访问限制，因此，任何知道ip和端口的人都能通过设置代理，使用你的代理接口。</p></li><li><p>stunnel服务端没有设置对客户端的证书验证，任何通过自建stunnel客户端的人，都有可能使用你的stunnel服务，进行通信。</p></li></ol><h2 id="5-2-优化"><a href="#5-2-优化" class="headerlink" title="5.2 优化"></a>5.2 优化</h2><ol><li>配置squid用户授权，即在用户使用代理上网时，弹出输入用户名和密码，输入正确，才能使用squid</li></ol><ul><li>修改配置文件<code>/etc/squid/squid.conf</code>，在<code>http_access deny all</code>之前追加以下内容，并注释掉<code>http_access allow localhost</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> auth_param 设置代理的认证方式</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 用法：auth_param scheme parameter [setting]</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> scheme表示认证机制，squid支持Basic，Digest，NTLM，Negotiate四种认证机制</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> program 设置认证程序为ncsa_auth（squid自带不少认证程序以及其他拓展程序），程序所需密码文件passwd。。如果linux是32位系统，认证程序/usr/lib/squid/目录下。认证程序名称有可能是basic_ncsa_auth。需要具体打开文件夹后查看。</span></span><br><span class="line">auth_param basic program /usr/lib64/squid/ncsa_auth /etc/squid/passwd</span><br><span class="line"><span class="meta">#</span><span class="bash"> children 设置后台启动几个认证程序进程</span></span><br><span class="line">auth_param basic children 3</span><br><span class="line"><span class="meta">#</span><span class="bash"> credentialsttl 设置认证失效时间，过期后需重新认证</span></span><br><span class="line">auth_param basic credentialsttl 10 hours</span><br><span class="line"><span class="meta">#</span><span class="bash"> realm 设置认证时返回头里夹带的信息“wlecome to using my proxy”</span></span><br><span class="line">auth_param basic realm welecome to using my proxy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ！！！上面只是设置了需要认证，并未将认证生效，还需设置acl与http_access</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加名为AuthUsers访问列表，表示通过认证的用户</span></span><br><span class="line">acl AuthUsers proxy_auth REQUIRED</span><br><span class="line"><span class="meta">#</span><span class="bash"> 允许AuthUsers的代理请求</span></span><br><span class="line">http_access allow AuthUsers</span><br></pre></td></tr></table></figure><ul><li>新建密码文件</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">htpasswd -c /etc/squid/passwd qifei</span><br></pre></td></tr></table></figure><p>如果没有htpasswd，则按提示安装。输入密码即可。</p><ul><li>重启squid</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service squid restart</span><br></pre></td></tr></table></figure><ol start="2"><li>添加stunnel对客户端的证书验证，需要再新建一个证书文件，同时修改服务端和客户端的配置文件。</li></ol><h1 id="6：问题和调试"><a href="#6：问题和调试" class="headerlink" title="6：问题和调试"></a>6：问题和调试</h1><h2 id="6-1-国内squid能接通，但无法访问网络"><a href="#6-1-国内squid能接通，但无法访问网络" class="headerlink" title="6.1 国内squid能接通，但无法访问网络"></a>6.1 国内squid能接通，但无法访问网络</h2><p>这可能是服务器端口没开</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;port.ping.pe&#x2F;xx.xx.xx.xx:port</span><br></pre></td></tr></table></figure><p>将上述网址，修改ip地址和端口后，通过浏览器打开，看看服务器端口是否能够接通，如果显示failed，那么参照第四章内容，安装firewald，并打开对应端口。</p><h2 id="6-2-中国移动只能访问谷歌而无法访问YouTube"><a href="#6-2-中国移动只能访问谷歌而无法访问YouTube" class="headerlink" title="6.2 中国移动只能访问谷歌而无法访问YouTube"></a>6.2 中国移动只能访问谷歌而无法访问YouTube</h2><h3 id="5-30日更新："><a href="#5-30日更新：" class="headerlink" title="5.30日更新："></a>5.30日更新：</h3><p>在经过一段时间的使用后，上种方法存在一些弊端。</p><p>在开启代理后，可以访问谷歌，和一些其他外网网站。但是，无法访问youtube、facebook等网站。反复刷新，还是可以访问到youtube。手机上的许多依赖外网的软件比如谷歌商店，无法使用。</p><p>利用wireshark对无线网卡进行抓包。发现，在浏览器访问youtube时，浏览器向国内的中转代理服务器，发送了http协议数据。此数据带有明显的请求头url<code>youtube.com</code>。猜测可能是国内路由，将含youtube等url的请求头过滤掉了。这样，请求youtube的数据根本无法到达中转服务器。</p><p>而多次刷新youtube网站，还是能够连同，说明国内路由并没有完全丢弃youtube请求，而是部分丢弃了我们的请求。</p><p>之所以谷歌能完全无阻地接通，我猜测，是因为国内许多网站，有依赖谷歌的各种api，因此屏蔽的损失远大于封锁的损失。因此只在国际出口上，对谷歌进行了封锁，而国内服务器之间的通信没有问题。</p><p>查阅https协议的工作原理不难知道。浏览器需要首先使用http协议，向youtube服务器发送请求，youtube服务器返回给浏览器SSL证书公钥，之后浏览器和youtube服务器才会使用SSL加密后的数据进行通讯。</p><p>在youtube服务器和浏览器之间添加代理，也只是转发数据，并没有改变浏览器访问youtube服务器时，发送包含包头的http数据的事实。</p><p>因此，即便我们在国内stunnel客户端和国外的stunnel客户端之间的数据进行了加密，也无法规避掉浏览器到国内stunnel服务器之间有http请求，造成请求被丢弃的问题。</p><p>最好的办法还是，在浏览器所在主机按转stunnel客户端。直接使用stunnel客户端向国外stunnel服务器发送数据，将浏览器的所有出口流量加密，直到发送到国外再解密，并转发。</p><p>这样做，其实和使用ss或者ssr原理相同。但是，缺少一些伪装。</p><h3 id="5-31日更新："><a href="#5-31日更新：" class="headerlink" title="5.31日更新："></a>5.31日更新：</h3><p>我使用ping.pe网站提供的端口测试，发现，当我访问国内服务器3128端口时，除了中国移动的网络，其他包括中国电信和联通，外网在内的所有运营商均能ping同3128端口。</p><p>我猜测可能中国移动会对3128端口进行随机丢包。来阻止squid代理的使用。</p><p>我修改了接收代理的端口号。再次在Ping.pe上测试，移动已经能够ping通端口。然而，仍然存在谷歌能够访问，而youtube和fb不能访问的问题。</p><p>猜测，可能中国移动会随机丢弃请求地址是youtube的http请求数据。于是我更换了我的联通手机卡，来代理上网。发现谷歌、youtube和其他外网网站，均能很好的访问。我又测试了电信网络，发现结果也是好的。</p><p><strong>结论</strong>，中国移动，在我们使用代理上网时，会对请求url为youtube.com之类的http请求进行人为随机丢包，而且丢包率极高。预测超过百分之八十。。了解移动国际带宽保有率，不难发现，移动的国际带宽占有率是三大运营商里最低的，却有第二的国际用户。可见为了解决带宽不足问题，他在国内便对youtube流量进行了丢弃，而不是到国际出口再丢弃。。</p><p>这么做的好处是，减少了youtube这类在国际出口会被拦截的流量占用传递时的带宽，降低国际出口过滤设备的投入。缺点是，会加大在国内路由过滤设备的投入。</p><p>通过对https原理和移动过滤youtube流量的分析，我们应该知道，在使用国内中转方式进行外网访问时，运营商能够知道你正在访问外网。虽然流量流向了国内服务器，如果网警对拦截的流量进行分析，是能够知道你访问了哪些外国网站的。。反向溯源，如果你使用了手机4G网络访问，那么，营运商配合，能够定位到你本人。如果使用wifi访问，能够定位到你的家庭。如果网警查看路由器日志，不难找到，是哪个手机访问了这些外网。</p><p>而http请求头中包含的设备信息，比如是什么电脑，浏览器品牌和版本等，无疑降低了找到你的难度。</p><p>总的来说，为了网络安全，降低被审查的风险。在本地主机部署stunnel客户端，比在国内服务器中转更加安全。但是长时间的加密连接国外服务器，不难让人猜出，你正在使用vpn之类的软件访问外网。使用wifi的代理比使用手机网络的代理更加安全。</p><h2 id="6-3-使用用户名和密码手机软件不能弹出登陆框"><a href="#6-3-使用用户名和密码手机软件不能弹出登陆框" class="headerlink" title="6.3 使用用户名和密码手机软件不能弹出登陆框"></a>6.3 使用用户名和密码手机软件不能弹出登陆框</h2><p>在实际代理过程中，如果使用wifi或手机网络的软件，无法弹出squid的代理认证框，从而无法输入账号和密码。因此，软件会没办法访问外网，只有浏览器可以访问。</p><h3 id="方法1：完全开放代理"><a href="#方法1：完全开放代理" class="headerlink" title="方法1：完全开放代理"></a>方法1：完全开放代理</h3><p>修改<code>squid.conf</code>关闭用户名和密码验证。允许本地ip登陆。此时所有知道IP和端口的用户都能使用代理访问。。这种方法是极不安全的，因为，有许多爬虫软件，能够通过扫描ip和端口，收集能够使用代理的ip和对应端口。短时间的使用方法一是可以的，但长期下来，容易被攻破。</p><h3 id="方法2：IP限制"><a href="#方法2：IP限制" class="headerlink" title="方法2：IP限制"></a>方法2：IP限制</h3><p>在国内中转服务器上也安装squid。用户连接squid端口，squid将内容发送到中转服务器的stunnel接口，stunnel加密传输到国外，国外服务器，stunnel解密再分发请求。</p><p>完整拓扑结构：用户主机-&gt;squid（国内）-&gt;stunnel（国内）-&gt;stunnel（国外）-&gt;squid（国外）-&gt;网站服务器</p><p>添加squid的目的是，squid可以验证用户主机ip。通过squid设置能够连接squid的ip池。stunnel是无法验证的。我们之前的用户名和密码验证，是通过国外squid验证的，国外squid无法验证ip，是因为，国外squid接收的信息，全部来自localhost的端口。也就是国外stunnel发出的。</p><h3 id="方法3：网页验证加自定义ACL辅助器验证"><a href="#方法3：网页验证加自定义ACL辅助器验证" class="headerlink" title="方法3：网页验证加自定义ACL辅助器验证"></a>方法3：网页验证加自定义ACL辅助器验证</h3><p>第一次登陆跳转网页验证用户名和密码，之后永久或缓存保存ip，免于此ip验证。</p><p><strong>设计思路</strong></p><ol><li>用户设置ip和端口，无密码连接代理服务器。</li><li>用户打开浏览器，访问任意网页</li><li>利用squidSGuard重定向无访问权限ip的访问url，转到认证网页。输入用户名和密码。</li><li>网页后台验证用户输入的用户名和密码。并保存用户ip。</li><li>编写squid ACL辅助器，读取并验证查找是否有这个ip。存在则通过，不存在，则进行重定向到验证页面。</li></ol><h3 id="方法4：自定义验证器加ACL辅助器验证"><a href="#方法4：自定义验证器加ACL辅助器验证" class="headerlink" title="方法4：自定义验证器加ACL辅助器验证"></a>方法4：自定义验证器加ACL辅助器验证</h3><p>第一次登陆，弹出代理登陆框，通过后保存ip</p><ol><li>用户设置ip和端口，连接代理服务器。</li><li>代理服务器通过ACL辅助器验证此IP是否在白名单中。</li><li>不在白名单则，进入自定义验证器，在，则通过代理。</li><li>进入验证器，验证器验证用户名和密码，如果通过，则保存IP到白名单，否则不通过。</li></ol><p>我采用方法四进行用户验证，其中蛮多细节，于是另起一文讲解。</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Stunnel </tag>
            
            <tag> Squid </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>利用Stunnel+squid代理实现国内无客户端访问外网</title>
      <link href="/2020/05/28/Stunnel-squid%E4%BB%A3%E7%90%86%E5%8A%A0%E9%80%9F%E4%BA%9A%E7%90%9B%E6%95%99%E5%AD%A6%E8%A7%86%E9%A2%91%E5%8A%A0%E9%80%9F/"/>
      <url>/2020/05/28/Stunnel-squid%E4%BB%A3%E7%90%86%E5%8A%A0%E9%80%9F%E4%BA%9A%E7%90%9B%E6%95%99%E5%AD%A6%E8%A7%86%E9%A2%91%E5%8A%A0%E9%80%9F/</url>
      
        <content type="html"><![CDATA[<h1 id="1：加速原理"><a href="#1：加速原理" class="headerlink" title="1：加速原理"></a>1：加速原理</h1><h2 id="1-1-squid介绍"><a href="#1-1-squid介绍" class="headerlink" title="1.1 squid介绍"></a>1.1 squid介绍</h2><p>squid是一个用于代理的开源软件，用户主机将http请求发送到部署了squid的服务器，squid可以帮助用户转发http请求。利用squid，我们可以让服务器替我们请求数据，再由服务器转发给我们。</p><p>按找squid原理，我们就已经可以进行翻墙了，在国内能够访问的国外服务器上部署squid，将访问谷歌的请求发送给squid，squid替我们请求谷歌数据，再将谷歌数据转发给我们。这就是一个完整的工作过程。</p><p>但是由于squid请求报头未加密，在squid服务器向浏览器返回数据时，能够被GFW检测到访问数据来自于谷歌。从而将返回数据过滤掉。之后通过squid返回的数据，都会被GFW过滤掉，即使我们访问的是百度，也会无法收到返回数据。</p><h2 id="1-2-Https介绍"><a href="#1-2-Https介绍" class="headerlink" title="1.2 Https介绍"></a>1.2 Https介绍</h2><p>这篇文章详细介绍了加密的原理：<a href="https://blog.csdn.net/clh604/article/details/22179907">https://blog.csdn.net/clh604/article/details/22179907</a></p><p><img src="https://ae01.alicdn.com/kf/Hdb6994b2de5f42e7adca8620e915331aQ.png" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/Hdb6994b2de5f42e7adca8620e915331aQ.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="SSL"></p><h2 id="1-3-stunnel介绍"><a href="#1-3-stunnel介绍" class="headerlink" title="1.3 stunnel介绍"></a>1.3 stunnel介绍</h2><p>stunnel是一个开源软件，使用stunnel可以为我们使用tcp协议传输的数据使用SSL协议加密，这样我们的请求，除了客户端和服务器，其他人将无法从数据中提取到有用信息。</p><p>为了让GFW无法识别出主机访问谷歌和返回的数据来自谷歌。这里使用stunnel将主机和squid之间的通信数据加密，将http请求的报头也加密。</p><h2 id="1-4-代理过程"><a href="#1-4-代理过程" class="headerlink" title="1.4 代理过程"></a>1.4 代理过程</h2><p>在windows主机上设置全局代理，将windows的tcp请求，转发到国内服务器server 1上，国内服务器server 1与国外服务器server 2搭建stunnel加密隧道连接，国外服务器server 2利用squid，发送主机的访问请求，并将访问结果返回给server 1，server 1在发送给主机浏览器。加速原理如下图。</p><p>通常可以只利用一个国外服务器，在国外服务器上部署stunnel和squid，在本地主机上搭建stunnel客户端就可以了。如下图</p><p><img src="https://ae01.alicdn.com/kf/H4ae21783bed543d7b6102e79eb735c89n.png" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H4ae21783bed543d7b6102e79eb735c89n.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>但是，为了访问方便，即任何用户只需要设置windows上现有的代理服务器就能访问外网，而不需要下载stunnel客户端和配置客户端参数。</p><p>相比于主机使用Stunnel客户端，将stunnel客户端部署到国内服务器的缺点是：这需要国内外均有服务器。成本会更高。</p><p>更重要的是，我们与国内服务器之间的信息被抓取后，能够获取到我们访问的信息，比如是谷歌、使用的浏览器版本等，但是无法知道具体访问内容。由于是与国内服务器发送信息，因此被探测的几率很小。</p><h1 id="2：主机设置代理访问"><a href="#2：主机设置代理访问" class="headerlink" title="2：主机设置代理访问"></a>2：主机设置代理访问</h1><p>为了让阅读本文的读者，提前的看到成果，将server1和server2都配置好后，先介绍如何利用你搭建好的服务器访问外网。</p><ol><li>打开<code>代理服务器色设置</code></li></ol><p><img src="https://ae01.alicdn.com/kf/H70a59c178af24750b89d0d045ee16845R.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H70a59c178af24750b89d0d045ee16845R.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ol start="2"><li>在代理服务器上输入国内服务器server1的IP和stunnel客户端监听的端口号。</li></ol><p><img src="https://ae01.alicdn.com/kf/Hcc9e9c1620b24b3da68519ffef92fd10N.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/Hcc9e9c1620b24b3da68519ffef92fd10N.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ol start="3"><li>使用浏览器登陆google</li></ol><p><img src="https://ae01.alicdn.com/kf/H2000b41723ff444bb46c057eee0bc5635.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H2000b41723ff444bb46c057eee0bc5635.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>实际上使用就是这么简单。当然为了你搭建的隧道不会被其他人使用，你也可以对能够访问这条隧道的IP进行限制，或者设置一个密码。会在后续中介绍到。</p><h1 id="3：国外服务器配置"><a href="#3：国外服务器配置" class="headerlink" title="3：国外服务器配置"></a>3：国外服务器配置</h1><p>确保在服务商安全组里开放了3128和3129端口，这两个端口，将用于接收和转发数据。</p><h2 id="3-1-安装配置Squid"><a href="#3-1-安装配置Squid" class="headerlink" title="3.1 安装配置Squid"></a>3.1 安装配置Squid</h2><ol><li>安装squid</li></ol><p>ubuntu使用：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install squid</span><br></pre></td></tr></table></figure><p>centos使用：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install squid</span><br></pre></td></tr></table></figure><p>使用<code>squid -v</code>检查squid是否安装好。</p><ol start="2"><li>配置squid</li></ol><p>打开squid配置文件<code>/etc/squid/squid.conf</code>。没有就新建此文件</p><p>将文件内容修改为：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> http_port 设置监听端口，默认为3128</span></span><br><span class="line">http_port 3128</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> access_log 设置access日志，daemon表示在后台将日志写入/var/<span class="built_in">log</span>/squid/access.log文件, </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> combined是一个预定义的logformat，也可以使用自定义的logformat</span></span><br><span class="line">access_log daemon:/var/log/squid/access.log combined</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> visible_hotname 设置代理服务器的主机名</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 默认取本机的hostname</span></span><br><span class="line">visible_hostname funway.aliyun.proxy</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ACLs all, manager, localhost, and to_localhost are predefined.</span></span><br><span class="line">acl SSL_ports port 443</span><br><span class="line">acl Safe_ports port 80    # http</span><br><span class="line">acl Safe_ports port 21    # ftp</span><br><span class="line">acl Safe_ports port 443    # https</span><br><span class="line">acl Safe_ports port 70    # gopher</span><br><span class="line">acl Safe_ports port 210    # wais</span><br><span class="line">acl Safe_ports port 1025-65535  # unregistered ports</span><br><span class="line">acl Safe_ports port 280    # http-mgmt</span><br><span class="line">acl Safe_ports port 488    # gss-http</span><br><span class="line">acl Safe_ports port 591    # filemaker</span><br><span class="line">acl Safe_ports port 777    # multiling http</span><br><span class="line">acl CONNECT method CONNECT</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 拒绝所有非Safe_ports的请求</span></span><br><span class="line">http_access deny !Safe_ports</span><br><span class="line"><span class="meta">#</span><span class="bash"> 拒绝所有非SSL_prots的CONNECT请求</span></span><br><span class="line">http_access deny CONNECT !SSL_ports</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Only allow cachemgr access from localhost</span></span><br><span class="line">http_access allow localhost manager</span><br><span class="line">http_access deny manager</span><br><span class="line"><span class="meta">#</span><span class="bash"> 允许来自本地的请求</span></span><br><span class="line">http_access allow localhost</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 拒绝所有请求，最后兜底的规则</span></span><br><span class="line">http_access deny all</span><br></pre></td></tr></table></figure><p>更多详细的配置参数解释，请参考博文《<a href="https://www.hawu.me/operation/852">使用squid搭建代理服务器</a>》</p><p>配置squid只能本地地址访问。</p><ol start="3"><li>运行squid</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service squid start //运行</span><br><span class="line">service squid status //查看squid运行状态</span><br></pre></td></tr></table></figure><h2 id="3-2-安装配置stunnel服务端"><a href="#3-2-安装配置stunnel服务端" class="headerlink" title="3.2 安装配置stunnel服务端"></a>3.2 安装配置stunnel服务端</h2><ol><li>生成自签名证书，如果没有openssl需要先安装。</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -x509 -days 3650 -nodes -out stunnel.pem -keyout stunnel.pem</span><br></pre></td></tr></table></figure><p>将生成的证书，复制到/etc/stunnel文件夹下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp stunnel.pem /etc/stunnel</span><br></pre></td></tr></table></figure><p>这个证书还需要下载到主机，之后上传到国内服务器，用于为stunnle客户端设置的公钥。</p><ol><li>下载安装stunnel</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install stunnel</span><br></pre></td></tr></table></figure><ol start="2"><li>设置stunnel配置文件</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">; 设置工作目录，没有目录需要先创建</span><br><span class="line">chroot = /var/run/stunnel/</span><br><span class="line">; 设置stunnel的pid文件路径（在chroot下）</span><br><span class="line">pid = /stunnel.pid</span><br><span class="line">; 设置stunnel工作的用户（组）</span><br><span class="line">setuid = root</span><br><span class="line">setgid = root</span><br><span class="line"></span><br><span class="line">; 开启日志等级：emerg (0), alert (1), crit (2), err (3), warning (4), notice (5), info (6), or debug (7)</span><br><span class="line">; 默认为5</span><br><span class="line">debug = 7</span><br><span class="line">; 日志文件路径（我的server的版本有个bug，这个文件也被放在chroot路径下了，client的版本则是独立的=。=#）</span><br><span class="line">output = /stunnel.log</span><br><span class="line"></span><br><span class="line">; 证书文件，就是在本文2.2中用openssl生成的自签名证书（server端必须设置这两项）</span><br><span class="line">cert = /etc/stunnel/stunnel.pem</span><br><span class="line">; 私钥文件</span><br><span class="line">key = /etc/stunnel/stunnel.pem</span><br><span class="line"></span><br><span class="line">; 设置stunnel服务，可以设置多个服务，监听同的端口，并发给不同的server。</span><br><span class="line">; 自定义服务名squid-proxy</span><br><span class="line">[squid-proxy]</span><br><span class="line">; 服务监听的端口，client要连接这个端口与server通信</span><br><span class="line">accept = 3129</span><br><span class="line">; 服务要连接的端口，连接到squid的3128端口，将数据发给squid</span><br><span class="line">connect = localhost:3128</span><br><span class="line"></span><br><span class="line">; **************************************************************************</span><br><span class="line">; * 下面这些配置我都注释掉了，但也需要了解下 *</span><br><span class="line">; **************************************************************************</span><br><span class="line"></span><br><span class="line">; 设置是否对传输数据进行压缩，默认不开启。</span><br><span class="line">; 这是跟openssl相关的，如果你的openssl没有zlib，开启这个设置会导致启动失败（failed to initialize compression method）</span><br><span class="line">;compression = zlib</span><br><span class="line"></span><br><span class="line">; 设置ssl版本,这个也是跟安装的openssl有关的</span><br><span class="line">;sslVersion = TLSv1</span><br><span class="line"></span><br><span class="line">; Authentication stuff needs to be configured to prevent MITM attacks</span><br><span class="line">; It is important to understand that this option was solely designed for access control and not for authorization</span><br><span class="line">; It is not enabled by default!</span><br><span class="line">; 下面这些配置用来定义是否信任对方发过来的证书。就好比浏览器访问https的时候，浏览器默认会信任那些由权威CA机构签发的证书，</span><br><span class="line">; 对于那些自签名证书，浏览器就会弹出对话框提醒用户这个证书可能不安全，是否要信任该证书。</span><br><span class="line">; 这是有效防止中间人攻击的手段</span><br><span class="line">; verify 等级2表示需要验证对方发过来的证书（默认0，不需要验证，都信任）</span><br><span class="line">; 因为这个配置是server端的，我们不需要理会client的证书（client也不会没事发证书过来啦）</span><br><span class="line">;verify = 2</span><br><span class="line">; CAfile 表示受信的证书文件，即如果对方发过来的证书在这个CAfile里，那么就是受信任的证书；否则不信任该证书，断开连接。</span><br><span class="line">;CAfile = /etc/stunnel/stunnel-client.pem</span><br></pre></td></tr></table></figure><ol start="3"><li>启动停止stunnel</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">service stunnel start //开启stunnel</span><br><span class="line">service stunnel restart //重启</span><br><span class="line">service stunnel stop //停止</span><br><span class="line">service stunnel status  //查看状态</span><br></pre></td></tr></table></figure><h1 id="4：国内服务器配置Stunnel客户端"><a href="#4：国内服务器配置Stunnel客户端" class="headerlink" title="4：国内服务器配置Stunnel客户端"></a>4：国内服务器配置Stunnel客户端</h1><p>国内服务器，就是在浏览器代理设置中，填入的服务器IP，而端口，则是stunnel接收代理数据的端口。</p><ol><li>在服务器提供商网页中的安全组设置里开启stunnel接收数据的端口。</li></ol><p>本人使用的阿里云轻量级应用服务器，进入阿里云控制台相应页面后，找到安全组-&gt;防火墙-&gt;添加新规则。在新规则里，开放，TCP协议的3128接口。也可以是其他接口。</p><ol start="2"><li>配置好安全组后，阿里云服务器本身还有一个防火墙，还需要在服务器里开放3128端口。</li></ol><p>查看开放端口，如果没有firewall，请先安装</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --list-all</span><br></pre></td></tr></table></figure><p>设置需要开放的端口</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=3128/tcp --permanent//设置</span><br><span class="line">firewall-cmd --reload//生效</span><br></pre></td></tr></table></figure><p>此时再查看开放的端口，就能看到3128端口已开放。</p><ol start="3"><li>安装stunnel客户端。</li></ol><p>ubuntu使用:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install stunnel</span><br></pre></td></tr></table></figure><p>centos使用：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install stunnel</span><br></pre></td></tr></table></figure><ol start="4"><li>设置stunnel客户端配置文件</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">; stunnel工作目录,如果没有/var/run/stunnel文件夹，需先创建</span><br><span class="line">chroot = /var/run/stunnel/</span><br><span class="line">; stunnel工作的用户组</span><br><span class="line">setuid = root</span><br><span class="line">setgid = root</span><br><span class="line">; stunnel工作时候的pid</span><br><span class="line">pid = /stunnel.pid</span><br><span class="line">; 日志等级</span><br><span class="line">debug = 7</span><br><span class="line">; 日志文件</span><br><span class="line">output = /var/log/stunnel/stunnel.log</span><br><span class="line">; 表示以client模式启动stunnel，默认client = no，即server模式</span><br><span class="line">client = yes</span><br><span class="line">; 定义一个服务</span><br><span class="line">[squid-proxy]</span><br><span class="line">; 监听3128端口，那么用户浏览器的代理设置就是 stunnel-client-ip:3128</span><br><span class="line">accept = 3128</span><br><span class="line">; 要连接到的stunnel server的ip与端口，修改xx.xx.xx.xx为国外的服务器</span><br><span class="line">connect = xx.xx.xx.xx:3129</span><br><span class="line">; 需要验证对方发过来的证书</span><br><span class="line">verify = 2</span><br><span class="line">; 用来进行证书验证的文件（里面有stunnel server的证书）</span><br><span class="line">CAfile = /etc/stunnel/stunnel-server.pem</span><br><span class="line">; 客户端不需要传递自己的证书，所以注释掉</span><br><span class="line">;cert = /etc/stunnel/stunnel.pem</span><br><span class="line">;key = /etc/stunnel/stunnel.key</span><br></pre></td></tr></table></figure><ol start="5"><li>将stunnle公钥证书拷贝一份到stunnel客户端配置文件的指定地址上。</li></ol><p>配置文件里<code>CAfile = /etc/stunnel/stunnel-server.pem</code>写明了我们需要将公钥保存的位置和公钥的文件名。</p><p>我们只需要将，3.2节生成的证书打开，复制已<code>BEGIN CERTIFICATION</code>开头到<code>END CERTIFICATION</code>结束的公钥。然后，新建<code>/etc/stunnel/stunnel-server.pem</code>文件，将公钥粘贴进去。</p><p>这样stunnel客户端就能将数据加密后发送给stunnel服务器了。</p><ol start="6"><li>启动和停止stunnel</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">service stunnel start &#x2F;&#x2F;开启stunnel</span><br><span class="line">service stunnel restart &#x2F;&#x2F;重启</span><br><span class="line">service stunnel stop &#x2F;&#x2F;停止</span><br><span class="line">service stunnel status  &#x2F;&#x2F;查看状态</span><br></pre></td></tr></table></figure><h1 id="5：不足和优化"><a href="#5：不足和优化" class="headerlink" title="5：不足和优化"></a>5：不足和优化</h1><h2 id="5-1-代理方法的不足"><a href="#5-1-代理方法的不足" class="headerlink" title="5.1 代理方法的不足"></a>5.1 代理方法的不足</h2><ol><li><p>由于客户端的stunnel直接监听3128端口，而没有任何的验证和访问限制，因此，任何知道ip和端口的人都能通过设置代理，使用你的代理接口。</p></li><li><p>stunnel服务端没有设置对客户端的证书验证，任何通过自建stunnel客户端的人，都有可能使用你的stunnel服务，进行通信。</p></li></ol><h2 id="5-2-优化"><a href="#5-2-优化" class="headerlink" title="5.2 优化"></a>5.2 优化</h2><ol><li>配置squid用户授权，即在用户使用代理上网时，弹出输入用户名和密码，输入正确，才能使用squid</li></ol><ul><li>修改配置文件<code>/etc/squid/squid.conf</code>，在<code>http_access deny all</code>之前追加以下内容，并注释掉<code>http_access allow localhost</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> auth_param 设置代理的认证方式</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 用法：auth_param scheme parameter [setting]</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> scheme表示认证机制，squid支持Basic，Digest，NTLM，Negotiate四种认证机制</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> program 设置认证程序为ncsa_auth（squid自带不少认证程序以及其他拓展程序），程序所需密码文件passwd。。如果linux是32位系统，认证程序/usr/lib/squid/目录下。认证程序名称有可能是basic_ncsa_auth。需要具体打开文件夹后查看。</span></span><br><span class="line">auth_param basic program /usr/lib64/squid/ncsa_auth /etc/squid/passwd</span><br><span class="line"><span class="meta">#</span><span class="bash"> children 设置后台启动几个认证程序进程</span></span><br><span class="line">auth_param basic children 3</span><br><span class="line"><span class="meta">#</span><span class="bash"> credentialsttl 设置认证失效时间，过期后需重新认证</span></span><br><span class="line">auth_param basic credentialsttl 10 hours</span><br><span class="line"><span class="meta">#</span><span class="bash"> realm 设置认证时返回头里夹带的信息“wlecome to using my proxy”</span></span><br><span class="line">auth_param basic realm welecome to using my proxy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ！！！上面只是设置了需要认证，并未将认证生效，还需设置acl与http_access</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加名为AuthUsers访问列表，表示通过认证的用户</span></span><br><span class="line">acl AuthUsers proxy_auth REQUIRED</span><br><span class="line"><span class="meta">#</span><span class="bash"> 允许AuthUsers的代理请求</span></span><br><span class="line">http_access allow AuthUsers</span><br></pre></td></tr></table></figure><ul><li>新建密码文件</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">htpasswd -c /etc/squid/passwd qifei</span><br></pre></td></tr></table></figure><p>如果没有htpasswd，则按提示安装。输入密码即可。</p><ul><li>重启squid</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service squid restart</span><br></pre></td></tr></table></figure><ol start="2"><li>添加stunnel对客户端的证书验证，需要再新建一个证书文件，同时修改服务端和客户端的配置文件。</li></ol><h1 id="6：补充"><a href="#6：补充" class="headerlink" title="6：补充"></a>6：补充</h1><h2 id="6-1-只能访问谷歌而无法访问YouTube"><a href="#6-1-只能访问谷歌而无法访问YouTube" class="headerlink" title="6.1 只能访问谷歌而无法访问YouTube"></a>6.1 只能访问谷歌而无法访问YouTube</h2><h3 id="5-30日更新："><a href="#5-30日更新：" class="headerlink" title="5.30日更新："></a>5.30日更新：</h3><p>在经过一段时间的使用后，上种方法存在一些弊端。</p><p>在开启代理后，可以访问谷歌，和一些其他外网网站。但是，无法访问youtube、facebook等网站。反复刷新，还是可以访问到youtube。手机上的许多依赖外网的软件比如谷歌商店，无法使用。</p><p>利用wireshark对无线网卡进行抓包。发现，在浏览器访问youtube时，浏览器向国内的中转代理服务器，发送了http协议数据。此数据带有明显的请求头url<code>youtube.com</code>。猜测可能是国内路由，将含youtube等url的请求头过滤掉了。这样，请求youtube的数据根本无法到达中转服务器。</p><p>而多次刷新youtube网站，还是能够连同，说明国内路由并没有完全丢弃youtube请求，而是部分丢弃了我们的请求。</p><p>之所以谷歌能完全无阻地接通，我猜测，是因为国内许多网站，有依赖谷歌的各种api，因此屏蔽的损失远大于封锁的损失。因此只在国际出口上，对谷歌进行了封锁，而国内服务器之间的通信没有问题。</p><p>查阅https协议的工作原理不难知道。浏览器需要首先使用http协议，向youtube服务器发送请求，youtube服务器返回给浏览器SSL证书公钥，之后浏览器和youtube服务器才会使用SSL加密后的数据进行通讯。</p><p>在youtube服务器和浏览器之间添加代理，也只是转发数据，并没有改变浏览器访问youtube服务器时，发送包含包头的http数据的事实。</p><p>因此，即便我们在国内stunnel客户端和国外的stunnel客户端之间的数据进行了加密，也无法规避掉浏览器到国内stunnel服务器之间有http请求，造成请求被丢弃的问题。</p><p>最好的办法还是，在浏览器所在主机按转stunnel客户端。直接使用stunnel客户端向国外stunnel服务器发送数据，将浏览器的所有出口流量加密，直到发送到国外再解密，并转发。</p><p>这样做，其实和使用ss或者ssr原理相同。但是，缺少一些伪装。</p><h3 id="5-31日更新："><a href="#5-31日更新：" class="headerlink" title="5.31日更新："></a>5.31日更新：</h3><p>我使用ping.pe网站提供的端口测试，发现，当我访问国内服务器3128端口时，除了中国移动的网络，其他包括中国电信和联通，外网在内的所有运营商均能ping同3128端口。</p><p>我猜测可能中国移动会对3128端口进行随机丢包。来阻止squid代理的使用。</p><p>我修改了接收代理的端口号。再次在Ping.pe上测试，移动已经能够ping通端口。然而，仍然存在谷歌能够访问，而youtube和fb不能访问的问题。</p><p>猜测，可能中国移动会随机丢弃请求地址是youtube的http请求数据。于是我更换了我的联通手机卡，来代理上网。发现谷歌、youtube和其他外网网站，均能很好的访问。我又测试了电信网络，发现结果也是好的。</p><p><strong>结论</strong>，中国移动，在我们使用代理上网时，会对请求url为youtube.com之类的http请求进行人为随机丢包，而且丢包率极高。预测超过百分之八十。。了解移动国际带宽保有率，不难发现，移动的国际带宽占有率是三大运营商里最低的，却有第二的国际用户。可见为了解决带宽不足问题，他在国内便对youtube流量进行了丢弃，而不是到国际出口再丢弃。。</p><p>这么做的好处是，减少了youtube这类在国际出口会被拦截的流量占用传递时的带宽，降低国际出口过滤设备的投入。缺点是，会加大在国内路由过滤设备的投入。</p><p>通过对https原理和移动过滤youtube流量的分析，我们应该知道，在使用国内中转方式进行外网访问时，运营商能够知道你正在访问外网。虽然流量流向了国内服务器，如果网警对拦截的流量进行分析，是能够知道你访问了哪些外国网站的。。反向溯源，如果你使用了手机4G网络访问，那么，营运商配合，能够定位到你本人。如果使用wifi访问，能够定位到你的家庭。如果网警查看路由器日志，不难找到，是哪个手机访问了这些外网。</p><p>而http请求头中包含的设备信息，比如是什么电脑，浏览器品牌和版本等，无疑降低了找到你的难度。</p><p>总的来说，为了网络安全，降低被审查的风险。在本地主机部署stunnel客户端，比在国内服务器中转更加安全。但是长时间的加密连接国外服务器，不难让人猜出，你正在使用vpn之类的软件访问外网。使用wifi的代理比使用手机网络的代理更加安全。</p><h2 id="6-2-使用用户名和密码手机软件不能弹出登陆框"><a href="#6-2-使用用户名和密码手机软件不能弹出登陆框" class="headerlink" title="6.2 使用用户名和密码手机软件不能弹出登陆框"></a>6.2 使用用户名和密码手机软件不能弹出登陆框</h2><p>在实际代理过程中，如果使用wifi或手机网络的软件，无法弹出squid的代理认证框，从而无法输入账号和密码。因此，软件会没办法访问外网，只有浏览器可以访问。</p><h3 id="方法1：完全开放代理"><a href="#方法1：完全开放代理" class="headerlink" title="方法1：完全开放代理"></a>方法1：完全开放代理</h3><p>修改<code>squid.conf</code>关闭用户名和密码验证。允许本地ip登陆。此时所有知道IP和端口的用户都能使用代理访问。。这种方法是极不安全的，因为，有许多爬虫软件，能够通过扫描ip和端口，收集能够使用代理的ip和对应端口。短时间的使用方法一是可以的，但长期下来，容易被攻破。</p><h3 id="方法2：IP限制"><a href="#方法2：IP限制" class="headerlink" title="方法2：IP限制"></a>方法2：IP限制</h3><p>在国内中转服务器上也安装squid。用户连接squid端口，squid将内容发送到中转服务器的stunnel接口，stunnel加密传输到国外，国外服务器，stunnel解密再分发请求。</p><p>完整拓扑结构：用户主机-&gt;squid（国内）-&gt;stunnel（国内）-&gt;stunnel（国外）-&gt;squid（国外）-&gt;网站服务器</p><p>添加squid的目的是，squid可以验证用户主机ip。通过squid设置能够连接squid的ip池。stunnel是无法验证的。我们之前的用户名和密码验证，是通过国外squid验证的，国外squid无法验证ip，是因为，国外squid接收的信息，全部来自localhost的端口。也就是国外stunnel发出的。</p><h3 id="方法3：网页验证加自定义ACL辅助器验证"><a href="#方法3：网页验证加自定义ACL辅助器验证" class="headerlink" title="方法3：网页验证加自定义ACL辅助器验证"></a>方法3：网页验证加自定义ACL辅助器验证</h3><p>第一次登陆跳转网页验证用户名和密码，之后永久或缓存保存ip，免于此ip验证。</p><p><strong>设计思路</strong></p><ol><li>用户设置ip和端口，无密码连接代理服务器。</li><li>用户打开浏览器，访问任意网页</li><li>利用squidSGuard重定向无访问权限ip的访问url，转到认证网页。输入用户名和密码。</li><li>网页后台验证用户输入的用户名和密码。并保存用户ip。</li><li>编写squid ACL辅助器，读取并验证查找是否有这个ip。存在则通过，不存在，则进行重定向到验证页面。</li></ol><h3 id="方法4：自定义验证器加ACL辅助器验证"><a href="#方法4：自定义验证器加ACL辅助器验证" class="headerlink" title="方法4：自定义验证器加ACL辅助器验证"></a>方法4：自定义验证器加ACL辅助器验证</h3><p>第一次登陆，弹出代理登陆框，通过后保存ip</p><ol><li>用户设置ip和端口，连接代理服务器。</li><li>代理服务器通过ACL辅助器验证此IP是否在白名单中。</li><li>不在白名单则，进入自定义验证器，在，则通过代理。</li><li>进入验证器，验证器验证用户名和密码，如果通过，则保存IP到白名单，否则不通过。</li></ol><p>我采用方法四进行用户验证，其中蛮多细节，于是另起一文讲解。</p>]]></content>
      
      
      <categories>
          
          <category> 其他 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Stunnel代理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>亚琛工大教学视频添加中德字幕</title>
      <link href="/2020/05/27/%E4%BA%9A%E7%90%9B%E5%B7%A5%E5%A4%A7%E6%95%99%E5%AD%A6%E8%A7%86%E9%A2%91%E6%B7%BB%E5%8A%A0%E4%B8%AD%E5%BE%B7%E5%AD%97%E5%B9%95/"/>
      <url>/2020/05/27/%E4%BA%9A%E7%90%9B%E5%B7%A5%E5%A4%A7%E6%95%99%E5%AD%A6%E8%A7%86%E9%A2%91%E6%B7%BB%E5%8A%A0%E4%B8%AD%E5%BE%B7%E5%AD%97%E5%B9%95/</url>
      
        <content type="html"><![CDATA[<h1 id="第一章-插件用户手册"><a href="#第一章-插件用户手册" class="headerlink" title="第一章 插件用户手册"></a>第一章 插件用户手册</h1><h2 id="1-1-适用场景和功能说明"><a href="#1-1-适用场景和功能说明" class="headerlink" title="1.1 适用场景和功能说明"></a>1.1 适用场景和功能说明</h2><ol><li>本插件适用于基于chromium内核开发的浏览器，包括<strong>Chrome浏览器、360安全浏览器、QQ浏览器</strong>等。</li><li>插件只在满足<strong>https://*/rwth-aachen.de/*</strong>域名<strong>匹配</strong>时工作，且除了添加字幕外无其他功能。</li><li>支持<strong>德语、中文、双语</strong>字幕</li><li>插件只能为<strong>数据库里存在的视频</strong>资源<strong>添加字幕</strong>。更多视频字幕，会逐渐上传。</li></ol><h2 id="1-2-效果图预览"><a href="#1-2-效果图预览" class="headerlink" title="1.2 效果图预览"></a>1.2 效果图预览</h2><p>以下仅展示了双语字幕。</p><p><img src="https://ae01.alicdn.com/kf/U82f285cdeda645b1b2b1c6aaafdec57f2.png" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/U82f285cdeda645b1b2b1c6aaafdec57f2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h2 id="1-3-插件安装"><a href="#1-3-插件安装" class="headerlink" title="1.3 插件安装"></a>1.3 插件安装</h2><ol><li><p>下载插件<a href="https://lanzous.com/ick15oh">https://lanzous.com/ick15oh</a></p></li><li><p>解压插件到桌面。获得以captions-for-moodle为名的文件夹。</p><p><img src="https://ae01.alicdn.com/kf/Hf2869255fa0c49bf973aa50825ba47ff8.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/Hf2869255fa0c49bf973aa50825ba47ff8.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></li><li><p>打开chrome浏览器，依次点击右上角的三个点图标—&gt;更多工具—&gt;扩展程序。或者在地址栏输入<code>chrome://extensions/</code>以打开扩展程序。</p><p><img src="https://ae01.alicdn.com/kf/Hd3b1aedb657a41519bbb456c43198d18D.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/Hd3b1aedb657a41519bbb456c43198d18D.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></li><li><p>单击打开扩展程序右上角的开发者选项。</p></li></ol><p><img src="https://ae01.alicdn.com/kf/Hbb3e047e6d16498da7592aafb7749abbY.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/Hbb3e047e6d16498da7592aafb7749abbY.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>然后开发者模式下方将出现<code>加载已解压的扩展程序</code>。</p><p><img src="https://ae01.alicdn.com/kf/Hbb72c1ae5ca74a6f819042e5131ce7efp.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/Hbb72c1ae5ca74a6f819042e5131ce7efp.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ol start="5"><li>点击<strong>加载已解压的扩展程序</strong>，在弹出页面，选择名称为<code>captions-for-moodle</code>文件夹。点击<strong>选择文件夹</strong>。此时页面出现Captions for Moodle RWTH 1.0插件。</li></ol><p><img src="https://ae01.alicdn.com/kf/H0b0a0d26f66541c5809fd11e17d0b36bE.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H0b0a0d26f66541c5809fd11e17d0b36bE.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ol start="6"><li>至此插件安装完成，确认插件卡片里的选择按钮为蓝色，表示插件已激活。插件激活后，在浏览器右上角，将出现RWTH的图标。</li></ol><p><img src="https://ae01.alicdn.com/kf/H82bd3a2c0c1a4760b7d576a735ad812eQ.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H82bd3a2c0c1a4760b7d576a735ad812eQ.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>且当你打开，<code>moodle.rwth-aachen.de</code>时，页面出现绿色浮动按钮。</p><p><img src="https://ae01.alicdn.com/kf/H84b78f1894a545848e82bb899f2b1577V.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H84b78f1894a545848e82bb899f2b1577V.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h2 id="1-4-插件使用"><a href="#1-4-插件使用" class="headerlink" title="1.4 插件使用"></a>1.4 插件使用</h2><ol><li>打开moodle课程视频页面，页面出现绿色悬浮按钮。</li></ol><p><img src="https://ae01.alicdn.com/kf/H3f9b8280cb794400ae6106988a71e3e6U.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H3f9b8280cb794400ae6106988a71e3e6U.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ol start="2"><li>点击播放视频，直到<strong>视频</strong>加载成功且<strong>开始播放</strong>，<strong>单击</strong>绿色悬浮<strong>按钮</strong>，！重要，<strong>等待几秒钟</strong>。待字幕下载完毕，会自动加载到视频上。</li></ol><p><img src="https://ae01.alicdn.com/kf/H3e5382f96fd44da487b4d5da77053754O.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H3e5382f96fd44da487b4d5da77053754O.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ol start="3"><li><p>下载完毕的字幕，<strong>默认为德语字幕</strong>，<strong>再次单击</strong>绿色按钮，切换<strong>中文</strong>字幕；再次单击，切换双语字幕；再次单击清除字幕。依次循环。</p></li><li><p>若当前视频还没有上传字幕，视频字幕会显示</p></li></ol><p><img src="https://ae01.alicdn.com/kf/H5cdfa43615ea49708d22223eb72d7b06J.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H5cdfa43615ea49708d22223eb72d7b06J.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>在出现此字幕时，单击三次按钮，即此清除字幕或当视频播放到两分钟时自动清除。</p><ol start="5"><li>下载字幕到本地</li></ol><p>如果当前视频存在字幕，待页面加载完毕后，点击浏览器右上角插件图标，即可看到字幕下载链接和视频下载链接。</p><p><img src="https://ae01.alicdn.com/kf/Hec0a5e0fdb4947a7ba464fd51bc0738fv.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/Hec0a5e0fdb4947a7ba464fd51bc0738fv.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h2 id="1-5-其他说明"><a href="#1-5-其他说明" class="headerlink" title="1.5 其他说明"></a>1.5 其他说明</h2><p>目前已支持的课程有</p><ul><li>Bioenergie</li><li>Grundoperationen der Energietechnik (VO)</li><li>Petrochemie und Raffinerietechnik (VU)</li><li>待添加</li></ul><h1 id="第二章-教学视频下载和字幕转换"><a href="#第二章-教学视频下载和字幕转换" class="headerlink" title="第二章 教学视频下载和字幕转换"></a>第二章 教学视频下载和字幕转换</h1><h2 id="2-1-系统要求和网络要求"><a href="#2-1-系统要求和网络要求" class="headerlink" title="2.1 系统要求和网络要求"></a>2.1 系统要求和网络要求</h2><p>插件用户安装我提供的视频下载和字幕转换工具。插件没提供的字幕，用户可自行本地转换，字幕转换成功后，可通过上传接口，将转换的字幕共享给每一位使用插件的用户。</p><ol><li>系统要求</li></ol><p>此教程仅<strong>适用于windows系统</strong>，若有需求，后续可出Ubuntu系统教程。Mac系统暂不支持。</p><ol start="2"><li>网络要求⭐</li></ol><ul><li><p><strong>软件的安装需要连接外网！</strong></p></li><li><p><strong>视频下载不需要连接外网！</strong></p></li><li><p><strong>生成字幕需连接外网！</strong>字幕转换将请求谷歌的文字翻译API接口。请确保你在进行本章<strong>第5节</strong>内容，即获取字幕时，满足以下两种条件：</p><ul><li>用户电脑网络处于除中国大陆以外的地区。</li><li>用户连接网速较好的VPN网络。<strong>注意：VPN网络不佳，将使字幕转换出现中断。</strong></li></ul></li></ul><h2 id="2-2-软件环境搭建"><a href="#2-2-软件环境搭建" class="headerlink" title="2.2 软件环境搭建"></a>2.2 软件环境搭建</h2><ol><li>打开命令管理器。</li></ol><p>打开windows桌面右上角搜索功能</p><p><img src="https://ae01.alicdn.com/kf/H4eaaea2ca879428e9bcd8210dd41a884t.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H4eaaea2ca879428e9bcd8210dd41a884t.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>在搜索框输入cmd，并点击“以管理员身份运行”。</p><p><img src="https://ae01.alicdn.com/kf/H138e311a7cb24cc7a19af0ae7a2031c6z.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H138e311a7cb24cc7a19af0ae7a2031c6z.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>打开后如图。注意：命令行开头是：C:\WINDOWS\system32</p><p><img src="https://ae01.alicdn.com/kf/H918346e5c4b84b7c82f955e37ec0c9c76.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H918346e5c4b84b7c82f955e37ec0c9c76.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ol start="2"><li>安装包管理器chocolatey</li></ol><p><strong>复制以下</strong>指令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@&quot;%SystemRoot%\System32\WindowsPowerShell\v1.0\powershell.exe&quot; -NoProfile -InputFormat None -ExecutionPolicy Bypass -Command &quot;iex ((New-Object System.Net.WebClient).DownloadString(&#39;https:&#x2F;&#x2F;chocolatey.org&#x2F;install.ps1&#39;))&quot; &amp;&amp; SET &quot;PATH&#x3D;%PATH%;%ALLUSERSPROFILE%\chocolatey\bin&quot;</span><br></pre></td></tr></table></figure><p>⭐⭐⭐<strong>温馨提示：命令提示符里，使用右键单击即可复制和粘贴！</strong></p><p>在命令框里，<strong>右键单击</strong>。如图，然后回车运行。等待安装完成。</p><p><img src="https://ae01.alicdn.com/kf/H196b206989f648559c11ba0c8c0034cc0.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H196b206989f648559c11ba0c8c0034cc0.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>通常，未出现红色提示，则表示安装成功。</p><p>当然为了确保成功安装，你可以通过在命令提示符里输入指令，注意V是大写</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">choco -V</span><br></pre></td></tr></table></figure><p>输出<strong>绿色版本号</strong>。则安装成功，例如:0.10.15。</p><p><img src="https://ae01.alicdn.com/kf/H8e190142f7fc4acb8a29dbb4e97d61bfo.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H8e190142f7fc4acb8a29dbb4e97d61bfo.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ol start="3"><li>安装 git python curl ffmpeg。</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">choco install git python curl ffmpeg -y</span><br></pre></td></tr></table></figure><p>此安装过程较长，且取决于你当前所处网络环境。请耐心等待，保持电脑激活状态。</p><p>安装过程中，未提示红色字体，则表示安装成功。</p><p>⭐⭐安装完成后，<strong>退出cmd</strong>，<strong>重新</strong>用管理员权限<strong>打开</strong>，以刷新git、python等的环境变量。</p><p>可选：你可通过分别输入<code>git --version</code>，<code>python -V</code>,<code>curl -V</code>，<code>ffmpeg -V</code>。依次查看这几个软件是否安装成功，若出现版本号则表示安装成功。</p><p>如果某个程序没有安装上，比如python，你可单独使用指令 <code>choco install python -y</code>来安装。安装完成后需重启cmd，才能使用<code>python -V</code>指令查看版本信息。</p><ol start="4"><li>下载python程序并安装，⭐此步骤需要<strong>连接外网</strong>，否则会报错</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python get-pip.py</span><br><span class="line">pip install git+https:&#x2F;&#x2F;github.com&#x2F;BingLingGroup&#x2F;autosub.git@alpha ffmpeg-normalize langcodes</span><br></pre></td></tr></table></figure><ol start="5"><li><p>安装成功。输入指令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">autosub -V</span><br></pre></td></tr></table></figure><p>显示版本号，则安装成功。</p></li></ol><p><img src="https://ae01.alicdn.com/kf/Hefd55d64696a4fbd82cce452048b27f0E.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/Hefd55d64696a4fbd82cce452048b27f0E.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ol start="6"><li>若出现错误提示如下图</li></ol><p><img src="https://ae01.alicdn.com/kf/H95f9347ba00c4ebe87e17c66beb2867ae.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H95f9347ba00c4ebe87e17c66beb2867ae.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>可能是你系统的未安装<strong>Microsoft Visual C++ 14.0</strong>。</p><p>打开连接</p><p><a href="https://964279924.ctfile.com/fs/1445568-239446865">https://964279924.ctfile.com/fs/1445568-239446865</a></p><p>下载<strong>安装VC++**。安装后，</strong>重复第4步**。</p><h2 id="2-3-获得视频地址"><a href="#2-3-获得视频地址" class="headerlink" title="2.3 获得视频地址"></a><strong>2.3 获得</strong>视频地址</h2><p>视频下载地址，将在第一章，1.4节插件使用中有详细介绍。</p><p>在打开视频地址后，点击右上角插件图标，即可看到视频下载地址的url。</p><h2 id="2-4-下载视频"><a href="#2-4-下载视频" class="headerlink" title="2.4 下载视频"></a>2.4 下载视频</h2><p>如果你<strong>需要转换字幕，</strong>请<strong>跳过此节</strong>，下节内容，将包括视频的下载和字幕转换。</p><p>如果你只想下载视频，而不需要转换字幕，请看此章。</p><ol><li>你已经安装了第二节提供的软件，并在第三节<strong>获取到了视频的下载地址</strong>，那么在这节，你将知道，如何利用ffmpeg工具，将m3u8文件转为mp4格式视频。关于m3u8文件，可看本节补充说明。</li><li>打开<strong>命令提示符</strong>，无需用管理员权限打开！在搜索栏输入<code>cmd</code>。双击打开。</li></ol><p><img src="https://ae01.alicdn.com/kf/Hc9c7a15d63f8409a8d66d9d93c2668acm.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/Hc9c7a15d63f8409a8d66d9d93c2668acm.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ol start="3"><li>复制以下代码，在cmd窗口右键单击，然后回车运行。</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd %USERPROFILE%\Desktop &amp;&amp; curl -O https:&#x2F;&#x2F;gitee.com&#x2F;xieqifei&#x2F;captions_for_moodle&#x2F;raw&#x2F;master&#x2F;getcaptions.bat &amp;&amp; call getcaptions.bat</span><br></pre></td></tr></table></figure><ol start="4"><li>在选择操作时，输入<strong>2：网络下载视频，但不生成字幕</strong>，</li></ol><p><img src="https://ae01.alicdn.com/kf/Hd5b0070930894da7bafd1ea489d1cab8r.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/Hd5b0070930894da7bafd1ea489d1cab8r.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ol start="5"><li>在输入视频的网络地址里，输入2.3节获取的，以.m3u8结尾的链接。然后回车</li></ol><p><img src="https://ae01.alicdn.com/kf/H896116a606d2454d99828b2001cb7f48w.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H896116a606d2454d99828b2001cb7f48w.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ol start="6"><li>输入保存视频和字幕的地址，这里直接回车，将字幕保存到桌面。此时，软件开始工作。</li></ol><p><img src="https://ae01.alicdn.com/kf/H7873a672675b4fcf8a1208867e8556f6q.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H7873a672675b4fcf8a1208867e8556f6q.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><img src="https://ae01.alicdn.com/kf/Hdc06bb5d333f451eb3960cf358193742p.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/Hdc06bb5d333f451eb3960cf358193742p.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>补充说明：m3u8是一个视频片段的地址列表，利用视频处理工具，读取这个地址表，将切割成片段的ts格式视频拼接成一个ts格式视频，在将ts格式视频转化为mp4格式。</p><h2 id="2-5-转换字幕和上传字幕"><a href="#2-5-转换字幕和上传字幕" class="headerlink" title="2.5 转换字幕和上传字幕"></a>2.5 转换字幕和上传字幕</h2><p>⭐请注意，执行本节内容之前，请确保，你的网络已连接外网，并且能打开<code>https://www.google.com</code>，否则将无法进行字幕转换操作。</p><p>字幕上传功能，仅在你使用此脚本的选项“网络下载视频，并生成中德字幕”时启用。</p><ol><li><p>搜索并打开cmd命令提示符</p></li><li><p>输入以下命令，下载并执行批处理脚本</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> %USERPROFILE%\Desktop &amp;&amp; curl -O https://gitee.com/xieqifei/captions_for_moodle/raw/master/getcaptions.bat &amp;&amp; call getcaptions.bat</span><br></pre></td></tr></table></figure><p><img src="https://ae01.alicdn.com/kf/Hf10f415aaabd4db2b7e763f8e6a0fd74e.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/Hf10f415aaabd4db2b7e763f8e6a0fd74e.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ol start="3"><li>按照提示开始选择指令。直接回车。选择1：网络下载视频，并生成中德字幕。</li></ol><p><img src="https://ae01.alicdn.com/kf/Hc7bea45505354e95ab0d4e43192d1bd2R.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/Hc7bea45505354e95ab0d4e43192d1bd2R.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ol start="4"><li>填写视频的下载链接，参照<strong>第三节</strong>内容，复制第三节获取到的视频链接。直接在cmd窗口上右键单击，即可粘贴。</li></ol><p><img src="https://ae01.alicdn.com/kf/Hec0a5e0fdb4947a7ba464fd51bc0738fv.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/Hec0a5e0fdb4947a7ba464fd51bc0738fv.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>链接例子：<code>https://streaming.rwth-aachen.de/rwth/smil:engage-player_0fe26b35-3e44-47f0-acf6-a9c4fd05b0bc_presentation.smil/playlist.m3u8</code></p><p><img src="https://ae01.alicdn.com/kf/Hb092253dbd0b40d488c96ed68d7f17e9a.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/Hb092253dbd0b40d488c96ed68d7f17e9a.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ol start="5"><li>填写视频和字幕的保存地址。直接回车，默认保存到桌面。</li></ol><p><img src="https://ae01.alicdn.com/kf/Hee6ac3e4ee22457089bc60c7cff675f12.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/Hee6ac3e4ee22457089bc60c7cff675f12.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ol start="6"><li>程序将自动开始运行，现在，你可以去泡杯茶，等待视频和字幕转换完成。</li></ol><p><img src="https://ae01.alicdn.com/kf/H3e241700e878434b9343e00a5901cfceW.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H3e241700e878434b9343e00a5901cfceW.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ol start="7"><li>字幕转换完成，检查字幕文件是否正确无误，然后继续回车上传字幕。</li></ol><p>出现字幕上传成功字样，则字幕已更新至服务器，可通过插件在线给视频添加字幕，其他用户也可以点击右上角插件按钮下载字幕。</p><ol start="8"><li>下次运行脚本，可以直接在桌面双击打开<code>getcaptions.bat</code>文件,而无需再次下载此脚本。若脚本有更新，可执行步骤2的代码。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 其他 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 浏览器插件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ShopXO商城优化-商城后台、小程序、飞鹅订单打印、公众号新订单推送</title>
      <link href="/2020/05/26/ShopXO%E5%95%86%E5%9F%8E%E4%BC%98%E5%8C%96%E5%95%86%E5%93%81%E4%BB%B7%E6%A0%BC%E4%BF%AE%E6%94%B9/"/>
      <url>/2020/05/26/ShopXO%E5%95%86%E5%9F%8E%E4%BC%98%E5%8C%96%E5%95%86%E5%93%81%E4%BB%B7%E6%A0%BC%E4%BF%AE%E6%94%B9/</url>
      
        <content type="html"><![CDATA[<h1 id="1：内容梗概"><a href="#1：内容梗概" class="headerlink" title="1：内容梗概"></a>1：内容梗概</h1><p>ShopXO是款非常优秀的开源商城软件。为了让商城更加适合没有网站管理经验的人使用，我优化了手机和电脑端的商城后台。修复了小程序的一些BUG，并做了一些其他优化。使用飞鹅打印机，接收新订单推送通知和订单打印。利用微信认证的公众号，在有新订单时，通过公众号给微信推送新订单消息。</p><p>特别说明：此篇文章建议有一定前后端基础的朋友阅读，否则，你在按照本文修改你的网站时，可能由于我在写作时，将某个环节遗漏，而导致你的网站无法做到像我修改后一样的结果。此时，会得不偿失。同时，若你对本文内容有任何疑问，欢迎你通过邮箱与我联系。邮箱几乎每天一看。</p><p>在进行下面修改时，建议你先将你的网站压缩打包，保存一下。避免操作失误无法修复。如果你的修改在达到理想效果后，建议你都进行一下保存操作</p><h1 id="2：商城后台优化"><a href="#2：商城后台优化" class="headerlink" title="2：商城后台优化"></a>2：商城后台优化</h1><h2 id="2-1-优化说明"><a href="#2-1-优化说明" class="headerlink" title="2.1 优化说明"></a>2.1 优化说明</h2><blockquote><p>优化说明：</p><ol><li>手机端显示商品缩率图</li><li>直接点击价格，弹出价格修改框，快速改价。</li><li>隐藏“查看更多”按钮。（给缩略图让空间）</li></ol></blockquote><p>对比：</p><p><img src="https://ae01.alicdn.com/kf/H00d9341b2269430e9a8655a814b116a8g.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H00d9341b2269430e9a8655a814b116a8g.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>优化后点击商品价格改价：</p><p><img src="https://ae01.alicdn.com/kf/Hd8eb006aab414041aea83683efe4cdaaO.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/Hd8eb006aab414041aea83683efe4cdaaO.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h2 id="2-2-优化工作"><a href="#2-2-优化工作" class="headerlink" title="2.2 优化工作"></a>2.2 优化工作</h2><ul><li>首先在手机端显示缩率图和价格。隐藏查看更多。</li></ul><p>核心代码：替换原有的价格显示样式，并添加一个js控制的弹窗。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;td &gt;</span><br><span class="line">    &lt;button class&#x3D;&quot;am-btn am-btn-success price-changed am-btn-xs am-radius&quot; data-id&#x3D;&quot;&#123;&#123;$v.id&#125;&#125;&quot; data-url&#x3D;&quot;&#123;&#123;:MyUrl(&#39;admin&#x2F;goods&#x2F;pricechanged&#39;)&#125;&#125;&quot; id&#x3D;&quot;doc-prompt-toggle&#123;&#123;$v.id&#125;&#125;&quot; &gt;&#123;&#123;$v.price&#125;&#125;&lt;&#x2F;button&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;am-modal am-modal-prompt&quot; tabindex&#x3D;&quot;-1&quot; id&#x3D;&quot;my-prompt&#123;&#123;$v.id&#125;&#125;&quot;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;am-modal-dialog&quot;&gt;</span><br><span class="line">            &lt;div class&#x3D;&quot;am-modal-hd&quot;&gt;&#123;&#123;$v.title&#125;&#125;&lt;&#x2F;div&gt;</span><br><span class="line">            &lt;div class&#x3D;&quot;am-modal-bd&quot;&gt;</span><br><span class="line">                &lt;img src&#x3D;&quot;&#123;&#123;$v[&#39;images&#39;]&#125;&#125;&quot; class&#x3D;&quot;am-radius&quot; style&#x3D;&quot;width:100%&quot;&#x2F;&gt;</span><br><span class="line">                &lt;input type&#x3D;&quot;number&quot; class&#x3D;&quot;am-modal-prompt-input&quot;  pattern&#x3D;&quot;^([0-9]&#123;1&#125;\d&#123;0,6&#125;)(\.\d&#123;1,2&#125;)?$&quot; data-validation-message&#x3D;&quot;请填写有效的销售金额&quot; placeholder&#x3D;&quot;&#123;&#123;$v.price&#125;&#125;&quot;&gt;元</span><br><span class="line">            &lt;&#x2F;div&gt;</span><br><span class="line">            &lt;div class&#x3D;&quot;am-modal-footer&quot;&gt;</span><br><span class="line">                &lt;span class&#x3D;&quot;am-modal-btn&quot; data-am-modal-cancel&gt;取消&lt;&#x2F;span&gt;</span><br><span class="line">                &lt;span class&#x3D;&quot;am-modal-btn&quot; data-am-modal-confirm&gt;提交&lt;&#x2F;span&gt;</span><br><span class="line">            &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">    &#123;&#123;if !empty($v[&#39;original_price&#39;]) and $v[&#39;original_price&#39;] gt 0&#125;&#125;</span><br><span class="line">    &lt;br &#x2F;&gt;&lt;span class&#x3D;&quot;am-badge am-radius&quot;&gt;原价 &#123;&#123;$v.original_price&#125;&#125;&lt;&#x2F;span&gt;</span><br><span class="line">    &#123;&#123;&#x2F;if&#125;&#125;</span><br><span class="line">&lt;&#x2F;td&gt;</span><br></pre></td></tr></table></figure><p>完整<code>index.html</code>代码链接：<a href="https://github.com/xieqifei/shopxo/blob/master/application/admin/view/default/goods/index.html">https://github.com/xieqifei/shopxo/blob/master/application/admin/view/default/goods/index.html</a></p><p>将此链接中的代码下载下来，替换原后台商品管理的html代码。替换<code>你的网站根目录/application/admin/view/default/goods/index.html</code>。</p><ul><li>修改js文件，实现点击价格，弹出对话框，提交发送post请求修改数据库</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [doc-prompt-toggle 价格修改弹窗]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author   <span class="variable">Qifei</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@blog     </span>https://sci.ci/</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version  </span>0.0.1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@datetime </span>2020-05-25T14:22:39+0800</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param    <span class="type">&#123;[int] [data-id] [数据id]&#125;</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param    <span class="type">&#123;[int] [data-field][数据库内容]&#125;</span></span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param    <span class="type">&#123;[string] [data-url] [请求地址]&#125;</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> $(<span class="built_in">document</span>).on(<span class="string">&#x27;click&#x27;</span>,<span class="string">&#x27;.price-changed&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">var</span> tag = $(<span class="built_in">this</span>);</span><br><span class="line"> <span class="keyword">var</span> id = tag.attr(<span class="string">&#x27;data-id&#x27;</span>);</span><br><span class="line"> <span class="keyword">var</span> $my_prompt=<span class="string">&#x27;#my-prompt&#x27;</span>+id;</span><br><span class="line"> <span class="keyword">var</span> url = tag.attr(<span class="string">&#x27;data-url&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> field = tag.attr(<span class="string">&#x27;data-field&#x27;</span>) || <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    $($my_prompt).modal(&#123;</span><br><span class="line">      relatedElement: <span class="built_in">this</span>,</span><br><span class="line">      onConfirm: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">           <span class="comment">//获取input标签中的value值</span></span><br><span class="line">      price=data[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line">      <span class="keyword">if</span>(id == <span class="literal">undefined</span> || url == <span class="literal">undefined</span>)</span><br><span class="line">&#123;</span><br><span class="line">Prompt(<span class="string">&#x27;参数配置有误&#x27;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 请求更新数据</span></span><br><span class="line">$.ajax(&#123;</span><br><span class="line">url:url,</span><br><span class="line">type:<span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">dataType:<span class="string">&quot;json&quot;</span>,</span><br><span class="line">timeout:tag.attr(<span class="string">&#x27;data-timeout&#x27;</span>) || <span class="number">30000</span>,</span><br><span class="line">data:&#123;<span class="string">&quot;id&quot;</span>:id, <span class="string">&quot;price&quot;</span>:price, <span class="string">&quot;field&quot;</span>:field&#125;,</span><br><span class="line">success:<span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(result.code == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">Prompt(result.msg, <span class="string">&#x27;success&#x27;</span>);</span><br><span class="line"><span class="comment">// 成功则更新价格</span></span><br><span class="line">tag.html(price);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">Prompt(result.msg);</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line">error:<span class="function"><span class="keyword">function</span>(<span class="params">xhr, type</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Prompt(<span class="string">&#x27;网络异常出错&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">      onCancel: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"> </span><br></pre></td></tr></table></figure><blockquote><p>以上代码加入到common.js文件中，或者下载我的commonjs完全替换这个文件</p></blockquote><p>替换<code>你的网站/public/static/common/js/common.js</code></p><p>完整代码：<a href="https://github.com/xieqifei/shopxo/blob/master/public/static/common/js/common.js">https://github.com/xieqifei/shopxo/blob/master/public/static/common/js/common.js</a></p><ul><li>在Goods控制器里新建一个控制器函数PriceChanged()。实现接收POST数据。</li></ul><p>在<code>application/admin/controller/Goods.php</code>里添加下面的代码。或者完全替换为我的<code>Goods.php</code>。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * [PriceChanged 修改商品价格]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>   Qifei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@blog</span>     https://sci.ci/</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>  0.0.1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@datetime</span> 2020-05-25T22:23:06+0800</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">PriceChanged</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// 是否ajax</span></span><br><span class="line"><span class="keyword">if</span>(!IS_AJAX)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;error(<span class="string">&#x27;非法访问&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">$filename=<span class="string">&quot;a.txt&quot;</span>;</span><br><span class="line">$handle=fopen($filename,<span class="string">&quot;a+&quot;</span>);</span><br><span class="line">$str=fwrite($handle,<span class="string">&quot;test\n&quot;</span>);</span><br><span class="line"> fclose($handle);</span><br><span class="line"><span class="comment">// 开始操作</span></span><br><span class="line">$params = input(<span class="string">&#x27;post.&#x27;</span>);</span><br><span class="line">$params[<span class="string">&#x27;admin&#x27;</span>] = <span class="keyword">$this</span>-&gt;admin;</span><br><span class="line">$params[<span class="string">&#x27;field&#x27;</span>] = <span class="string">&#x27;price&#x27;</span>;</span><br><span class="line">        <span class="comment">//调用商品管理服务，更新数据库。</span></span><br><span class="line"><span class="keyword">return</span> GoodsService::GoodsPriceUpdate($params);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>替换<code>你的网站/application/admin/controller/Goods.php</code></p><p>完整的Goods.php代码：<a href="https://github.com/xieqifei/shopxo/blob/master/application/admin/controller/Goods.php">https://github.com/xieqifei/shopxo/blob/master/application/admin/controller/Goods.php</a></p><ul><li>在商品后台服务中添加更新价格的服务函数</li></ul><p>将以下代码添加到<code>你的网站/application/service/GoodsService.php</code>,或者下载我的<code>GoodsService.php</code>文件，完全替换它。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改商品价格</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span>   Qifei</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@blog</span>    https://sci.ci/</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@version</span> 1.0.0</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@date</span>    2020-05-25</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@desc</span>    description</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>   [int]          $goods_id [商品id]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">GoodsPriceUpdate</span>(<span class="params">$params = []</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 请求参数</span></span><br><span class="line">        $p = [</span><br><span class="line">            [</span><br><span class="line">                <span class="string">&#x27;checked_type&#x27;</span>      =&gt; <span class="string">&#x27;empty&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;key_name&#x27;</span>          =&gt; <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;error_msg&#x27;</span>         =&gt; <span class="string">&#x27;操作id有误&#x27;</span>,</span><br><span class="line">            ],</span><br><span class="line">            [</span><br><span class="line">                <span class="string">&#x27;checked_type&#x27;</span>      =&gt; <span class="string">&#x27;empty&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;key_name&#x27;</span>          =&gt; <span class="string">&#x27;field&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;error_msg&#x27;</span>         =&gt; <span class="string">&#x27;未指定操作字段&#x27;</span>,</span><br><span class="line">            ],</span><br><span class="line">            [<span class="comment">//价格在0到5000这个区间</span></span><br><span class="line">                <span class="string">&#x27;checked_type&#x27;</span>      =&gt; <span class="string">&#x27;between&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;key_name&#x27;</span>          =&gt; <span class="string">&#x27;price&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;checked_data&#x27;</span>      =&gt; [<span class="number">0</span>,<span class="number">5000</span>],</span><br><span class="line">                <span class="string">&#x27;error_msg&#x27;</span>         =&gt; <span class="string">&#x27;价格不能小于0，大于5000&#x27;</span>,</span><br><span class="line">            ],</span><br><span class="line">        ];</span><br><span class="line">        $ret = ParamsChecked($params, $p);</span><br><span class="line">        <span class="keyword">if</span>($ret !== <span class="literal">true</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> DataReturn($ret, <span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 数据更新</span></span><br><span class="line">        <span class="keyword">if</span>(Db::name(<span class="string">&#x27;Goods&#x27;</span>)-&gt;where([<span class="string">&#x27;id&#x27;</span>=&gt;intval($params[<span class="string">&#x27;id&#x27;</span>])])-&gt;update([$params[<span class="string">&#x27;field&#x27;</span>]=&gt;number_format($params[<span class="string">&#x27;price&#x27;</span>],<span class="number">2</span>),<span class="string">&#x27;min_price&#x27;</span>=&gt;number_format($params[<span class="string">&#x27;price&#x27;</span>],<span class="number">2</span>),<span class="string">&#x27;max_price&#x27;</span>=&gt;number_format($params[<span class="string">&#x27;price&#x27;</span>],<span class="number">2</span>), <span class="string">&#x27;upd_time&#x27;</span>=&gt;time()])&amp;&amp;Db::name(<span class="string">&#x27;GoodsSpecBase&#x27;</span>)-&gt;where([<span class="string">&#x27;goods_id&#x27;</span>=&gt;intval($params[<span class="string">&#x27;id&#x27;</span>])])-&gt;update([$params[<span class="string">&#x27;field&#x27;</span>]=&gt;number_format($params[<span class="string">&#x27;price&#x27;</span>],<span class="number">2</span>)]))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> DataReturn(<span class="string">&#x27;操作成功&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> DataReturn(<span class="string">&#x27;操作失败&#x27;</span>, <span class="number">-100</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>完整<code>GoodsService.php</code>地址：<a href="https://github.com/xieqifei/shopxo/blob/master/application/service/GoodsService.php">https://github.com/xieqifei/shopxo/blob/master/application/service/GoodsService.php</a></p><p>替换<code>你的网站/application/service/GoodsService.php</code></p><ul><li>最后，你需要给新的控制器方法添加访问数据库权限。</li></ul><p>打开ShopXO网站后台<code>你的网站网址/admin.php</code></p><p><img src="https://ae01.alicdn.com/kf/H293d34dbf9a147c592d74b4954d64654G.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H293d34dbf9a147c592d74b4954d64654G.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>添加权限：<img src="https://ae01.alicdn.com/kf/He9b4b848c75644fcbdc2c2d960cb52d5Y.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/He9b4b848c75644fcbdc2c2d960cb52d5Y.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>点击保存。至此商品后台优化已经完成。</p><h1 id="3：WX小程序优化"><a href="#3：WX小程序优化" class="headerlink" title="3：WX小程序优化"></a>3：WX小程序优化</h1><h2 id="3-1-优化说明"><a href="#3-1-优化说明" class="headerlink" title="3.1 优化说明"></a>3.1 优化说明</h2><blockquote><p>优化内容：</p><ol><li>修改首页导航栏上传图片，显示太小</li><li>修改分类无法查看一级分类。</li></ol></blockquote><p>修改前后对比</p><p><img src="https://ae01.alicdn.com/kf/H7290adc40303410fbb2bb29573e26349o.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H7290adc40303410fbb2bb29573e26349o.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><img src="https://ae01.alicdn.com/kf/H1f69c3e41d8b45c6ae974c37aa3c0e08R.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H1f69c3e41d8b45c6ae974c37aa3c0e08R.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h2 id="3-2-优化工作"><a href="#3-2-优化工作" class="headerlink" title="3.2 优化工作"></a>3.2 优化工作</h2><ul><li>导航栏修改</li></ul><ol><li>打开小程序源代码，找到<code>components</code>-&gt;<code>icon-nav</code></li></ol><p>替换<code>icon-nav.wxml</code>内容为：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;propData.length &gt; 0&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;data-list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;items&quot;</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;propData&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;key&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;item.bg_color===&#x27;#FFFFFF&#x27;&#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;items-content&quot;</span> <span class="attr">data-value</span>=<span class="string">&quot;&#123;&#123;item.event_value&#125;&#125;&quot;</span> <span class="attr">data-type</span>=<span class="string">&quot;&#123;&#123;item.event_type&#125;&#125;&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;navigation_event&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background-color:#fff;padding:0;height:110rpx;width:110rpx;border-radius:0%&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item.images_url&#125;&#125;&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;aspectFit&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:110rpx;height:110rpx&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:else</span> <span class="attr">class</span>=<span class="string">&quot;items-content&quot;</span> <span class="attr">data-value</span>=<span class="string">&quot;&#123;&#123;item.event_value&#125;&#125;&quot;</span> <span class="attr">data-type</span>=<span class="string">&quot;&#123;&#123;item.event_type&#125;&#125;&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;navigation_event&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background-color:&#123;&#123;item.bg_color&#125;&#125;;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item.images_url&#125;&#125;&quot;</span> <span class="attr">mode</span>=<span class="string">&quot;aspectFit&quot;</span> <span class="attr">style</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>代码逻辑：当检测到导航栏背景颜色为白色时，设置图片上一层View标签的内边距padding 为0（原为20rpx）高宽设置为110rpx。并且将图片高宽均增加40rpx（原为70rpx），弥补内边距。</p></blockquote><ol start="2"><li>修改<code>icon-nav.wxss</code>文件</li></ol><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.data-list</span> <span class="selector-class">.items</span> <span class="selector-tag">image</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">60</span>rpx ;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">60</span>rpx ;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">5</span>rpx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将原来的高宽后面的<code>!important</code>去掉，为了使步骤1中内联的高宽样式生效。</p><p>最后，特别注意：你在网站后台修改导航栏图片时，必须设置导航栏背景色为白色。不设置或者设置为其他颜色，则采用默认的样式。此时图片会比较小。</p><p>修改导航栏：<code>你的网站/admin.php</code>-&gt;<code>手机端管理</code>-&gt;<code>首页导航</code>,修改导航栏</p><p><img src="https://ae01.alicdn.com/kf/H74bc60750cb04428817d42273a0f89fa6.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H74bc60750cb04428817d42273a0f89fa6.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>确保颜色代码为<code>#FFFFFF</code></p><p><img src="https://ae01.alicdn.com/kf/H2adb7476accc4be3b43acb4517f560d0h.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H2adb7476accc4be3b43acb4517f560d0h.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><ul><li>添加分类<code>全部</code>选项</li></ul><p>完全替换小程序源代码中<code>pages</code>-&gt;<code>goods-category</code>-&gt;<code>goods-category.wxml</code>文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;view class&#x3D;&#39;left-nav&#39;&gt;</span><br><span class="line">  &lt;block wx:for&#x3D;&quot;&#123;&#123;data_list&#125;&#125;&quot; wx:key&#x3D;&quot;key&quot;&gt;</span><br><span class="line">    &lt;view class&#x3D;&#39;items &#123;&#123;item.active || &quot;&quot;&#125;&#125;&#39; data-index&#x3D;&quot;&#123;&#123;index&#125;&#125;&quot; bindtap&#x3D;&#39;nav_event&#39;&gt;</span><br><span class="line">      &lt;text&gt;&#123;&#123;item.name&#125;&#125;&lt;&#x2F;text&gt;</span><br><span class="line">    &lt;&#x2F;view&gt;</span><br><span class="line">  &lt;&#x2F;block&gt;</span><br><span class="line">&lt;&#x2F;view&gt;</span><br><span class="line">&lt;view class&#x3D;&#39;right-content bg-white&#39;&gt;</span><br><span class="line">  &lt;view class&#x3D;&quot;content-items&quot; data-value&#x3D;&quot;&#123;&#123;data_first_class[&#39;id&#39;]&#125;&#125;&quot; bindtap&#x3D;&quot;category_event&quot;&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;text single-text&quot;&gt;全部&lt;&#x2F;view&gt;</span><br><span class="line">  &lt;&#x2F;view&gt;</span><br><span class="line">  &lt;block wx:if&#x3D;&quot;&#123;&#123;data_content.length &gt; 0&#125;&#125;&quot;&gt;</span><br><span class="line">    &lt;block wx:for&#x3D;&quot;&#123;&#123;data_content&#125;&#125;&quot; wx:key&#x3D;&quot;keys&quot; wx:for-item&#x3D;&quot;v&quot;&gt;</span><br><span class="line">      &lt;view class&#x3D;&quot;content-items&quot; data-value&#x3D;&quot;&#123;&#123;v.id&#125;&#125;&quot; bindtap&#x3D;&quot;category_event&quot;&gt;</span><br><span class="line">        &lt;image wx:if&#x3D;&quot;&#123;&#123;(v.icon || null) !&#x3D; null&#125;&#125;&quot; src&#x3D;&quot;&#123;&#123;v.icon&#125;&#125;&quot; mode&#x3D;&quot;aspectFit&quot; class&#x3D;&quot;icon&quot; &#x2F;&gt;</span><br><span class="line">        &lt;view class&#x3D;&quot;text single-text&quot;&gt;&#123;&#123;v.name&#125;&#125;&lt;&#x2F;view&gt;</span><br><span class="line">      &lt;&#x2F;view&gt;</span><br><span class="line">    &lt;&#x2F;block&gt;</span><br><span class="line">  &lt;&#x2F;block&gt;</span><br><span class="line">&lt;&#x2F;view&gt;</span><br><span class="line"></span><br><span class="line">&lt;view wx:if&#x3D;&quot;&#123;&#123;data_list.length &#x3D;&#x3D; 0 &amp;&amp; data_list_loding_status !&#x3D; 0&#125;&#125;&quot;&gt;</span><br><span class="line">  &lt;import src&#x3D;&quot;&#x2F;pages&#x2F;common&#x2F;nodata.wxml&quot; &#x2F;&gt;</span><br><span class="line">  &lt;template is&#x3D;&quot;nodata&quot; data&#x3D;&quot;&#123;&#123;status: data_list_loding_status&#125;&#125;&quot;&gt;</span><br><span class="line">  &lt;&#x2F;template&gt;</span><br><span class="line">&lt;&#x2F;view&gt;</span><br></pre></td></tr></table></figure><p>修改<code>pages</code>-&gt;<code>goods-category</code>-&gt;<code>goods-category.js</code>中部分代码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导航事件</span></span><br><span class="line">  nav_event(e) &#123;</span><br><span class="line">    <span class="keyword">var</span> index = e.currentTarget.dataset.index;</span><br><span class="line">    <span class="keyword">var</span> temp_data = <span class="built_in">this</span>.data.data_list;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i <span class="keyword">in</span> temp_data)</span><br><span class="line">    &#123;</span><br><span class="line">      temp_data[i][<span class="string">&#x27;active&#x27;</span>] = (index == i) ? <span class="string">&#x27;nav-active&#x27;</span> : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.setData(&#123;</span><br><span class="line">      data_list: temp_data,</span><br><span class="line">      data_first_class: temp_data[index],</span><br><span class="line">      data_content: temp_data[index][<span class="string">&#x27;items&#x27;</span>],</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><p>编译运行，即修改完毕。</p><blockquote><p>有个小bug，打开分类页面，第一个一级分类的“全部”，在第一次打开时，会指向全部商品，而不是一级分类的商品。切换到第二个一级分类，再回来，此时点击“全部”，就变正常了。。后续再修复吧。</p></blockquote><h1 id="4：新订单通知推送"><a href="#4：新订单通知推送" class="headerlink" title="4：新订单通知推送"></a>4：新订单通知推送</h1><p>新订单推送，是为了方便商家，接收各个端下单消息。通常，通常都是使用短信和邮箱方式来接收消息，但是邮箱接收效率太低。短信又需要收费。</p><p>这里我们使用两种及时的推送方式，第一种，飞鹅打印机。入住美团、饿了么的商家，通常都会购买这个打印机，因为他是全平台的，而且可以调用它的API接口，自定义打印内容。</p><p>第二种，微信公众号推送。当网站后台接收到新订单，即通过微信公众号的模板消息功能，向指定微信推送新订单消息。</p><p>当然如果你具备一些编程知识，还可以自己写个程序，向下单的用户推送订单的进展。（开发一个插件，调用订单的相关钩子。）</p><p><img src="https://ae01.alicdn.com/kf/Hbf03630cbb7b499e946293ebe107df1fU.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/Hbf03630cbb7b499e946293ebe107df1fU.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>为了减少工作量，消息通知，是在原有插件<code>新订单提醒</code>基础上进行的修改。新的插件具有了除邮箱和短信以外的公众号和飞鹅打印功能。</p><p><img src="https://ae01.alicdn.com/kf/H47729d1cdad342dbbf295c7e53404a9cQ.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/H47729d1cdad342dbbf295c7e53404a9cQ.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>]]></content>
      
      
      <categories>
          
          <category> 网站编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ShopXO </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>机器学习深度学习李宏毅版-学习笔记</title>
      <link href="/2020/05/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2020/05/21/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="第一章-Regression-回归"><a href="#第一章-Regression-回归" class="headerlink" title="第一章 Regression 回归"></a>第一章 Regression 回归</h1><p>$$<br>f(input)=output<br>$$</p><p>输入一个对象后，有指定的输出结果。</p><p><strong>示例应用：</strong>数码宝贝原始cp值，求进化一次后的cp值</p><p>Step 1: Model</p><p>定义一个函数：确定输入原始cp值和输出进化后的cp值。<br>$$<br>y=b+w*x_{cp}<br>$$</p><blockquote><p>w and b are parameters</p></blockquote><p>Step 2: Goodness of Function方程好坏</p><p>对象1：function input: cp612-&gt;x1      function output:cp979-&gt;y1<br>$$<br>(x^1,y^1)<br>$$</p><p>$$<br>(x^2,y^2)<br>$$</p><p>$$<br>……<br>$$</p><p>$$<br>(x^{10},y^{10})<br>$$</p><p>定义另一个函数：确定第一个函数效果如何。输入一个函数，输出函数好坏程度。</p><p>Loss Function<br>$$<br>\begin{split}<br>L(f) &amp;= L(w,b)<br>\ &amp;=\sum_{n=1}^{10}\left(y^n-\left(b+w*x^n_{cp}\right)\right)^2<br>\end{split}<br>$$<br>Step 3: Best Function最好的函数</p><p>Gradient Descent<br>$$<br>w^*=arg\ min\ L(w)<br>$$<br>枚举w值，找到Loss Function最小的w值。</p><ul><li><p>随机选择一个初始w0,</p></li><li><p>$$<br>\frac{dL}{dw}|w=w^0<br>$$</p></li></ul><p>在w0位置，如果斜率为正，则w向小的位置移动，反之向w增大的位置移动，目的是找到L(w)更小的位置。下一个位置w1。<br>$$<br>w^1=w^0-\eta\frac{\partial L}{\partial w}|w=w^0,b=b^0<br>\b^1=b^0-\eta\frac{\partial L}{\partial b}|w=w^0,b=b^0<br>\\eta表示学习率。<br>$$<br>最终找到一个最佳的w和b，确定一个L(f)最小。</p><p>然而，由于数码宝贝的物种不同，b和w的取值将不同。</p><p><strong>修改模型</strong></p><p>Step 1:选择模型<br>$$<br>y=b_1<em>\delta(x^s=宝贝1)+w_1</em>\delta(x_s=宝贝1)<em>x_{cp}+b_2</em>\delta(x^s=宝贝2)+w_2*\delta(x_s=宝贝2)*x_{cp}+……<br>$$</p><p>$$<br>\delta(x_s=宝贝1)\begin{cases}<br>=1\ if,x_s=宝贝1 \\<br>=0\ else\end{cases}<br>$$</p><p>此时已经很精准了，但是可能还存在其他除了种类以外的影响因素，比如身高，体重，hp。</p><p>回到Step 2:Regularization<br>$$<br>y=b+\sum w_ix_i<br>\L=\sum_n(y^n-(b+\sum w_ix_i))^2+\lambda\sum (w_i)^2<br>$$<br>为了获取一个更光滑的曲线，来减少噪音对输出结果的影响。</p><blockquote><p><strong>采用较小的拟合次数简单的model，通常具有更小的方差，但偏差更大，即结果集中但集中位置偏离真实值；较大的拟合次数复杂的model，方差比较大，但偏差更小。</strong></p></blockquote><p>偏差大：</p><ol><li>更多训练数据</li><li>更复杂的模型</li></ol><p>方差大：</p><ol><li>更多训练数据</li></ol><p>获取模型：Validation</p><p>训练数据-&gt;分三份，两份获取模型，一份验证模型。</p><h1 id="第二章-Gradient-Descent梯度下降法"><a href="#第二章-Gradient-Descent梯度下降法" class="headerlink" title="第二章 Gradient Descent梯度下降法"></a>第二章 Gradient Descent梯度下降法</h1><p>在第一章Step 3中，我们要找到一个最低的loss function<br>$$<br>\theta^*=arg\ max\ L(\theta) \ \ \ \ L:loss\ function\ \ \theta:parameters<br>$$<br>假设$\theta$有两个参数${\theta_1,\theta_2}$</p><p>随机设置一个$\theta^0=\begin{bmatrix}\theta_1^0\\theta_2^0\end{bmatrix}$<br>$$<br>\begin{bmatrix}\theta_1^1\\theta_2^1\end{bmatrix}=\begin{bmatrix}\theta_1^0\\theta^0_2\end{bmatrix}-\eta\begin{bmatrix}\frac{\partial(\theta_1^0)}{\partial\theta_1}\\frac{\partial(\theta_2^0)}{\partial\theta_2}\end{bmatrix}<br>$$</p><p>$$<br>\begin{bmatrix}\theta_1^2\\theta_2^2\end{bmatrix}=\begin{bmatrix}\theta_1^1\\theta^1_2\end{bmatrix}-\eta\begin{bmatrix}\frac{\partial(\theta_1^1)}{\partial\theta_1}\\frac{\partial(\theta_2^1)}{\partial\theta_2}\end{bmatrix}<br>$$</p><p>简化公式：<br>$$<br>\bigtriangledown L(\theta)=\begin{bmatrix}\frac{\partial L(\theta_1)}{\partial\theta_1}\\frac{\partial L(\theta_2)}{\partial\theta_2}\end{bmatrix}<br>\\theta^1=\theta^0-\eta\bigtriangledown L(\theta^0)<br>$$<br>需要调节学习率（步长）$\eta$到合适的值。</p><blockquote><p>不同的$\theta$给不同的$\eta$。</p></blockquote><p>Adagrad:随着参数增加，步长逐渐减小。<br>$$<br>w^1\gets w^1-\frac{\eta^0}{\sigma^0}g^0 \ \ \ \sigma^0=\sqrt{(g^0)^2}<br>\\vdots<br>\\vdots<br>\w^{t+1}\gets w^t-\frac{\eta^t}{\sigma^t}g^t\ \ \ \sigma^t=\sqrt{\frac{1}{t+1}\sum^t_{i=0}(g^i)^2}<br>$$</p><p>$$<br>\eta^t=\frac{\eta}{\sqrt{t+1}}<br>$$</p><p>Feature Scaling:</p><p>将多个x输入的范围统一到一个范围，以保证在计算L(f)时，每个w对L(f)的影响相同。</p><blockquote><p>Gradient Descent会卡在局部最小值的位置</p></blockquote><h1 id="第三章-New-Optimizers-for-Deep-Learning-优化"><a href="#第三章-New-Optimizers-for-Deep-Learning-优化" class="headerlink" title="第三章 New Optimizers for Deep Learning 优化"></a>第三章 New Optimizers for Deep Learning 优化</h1><p>一些记号：</p><p>$\theta_t$:模型参数</p><p>$m_{t+1}$:从step 0到step t 的动量。</p><p><strong>SGD：</strong></p><p>SGDM、Learning rate scheduling、NAG</p><p>走到最低点时，还不会停下来，由于之前的动量影响，存在一个类似的惯性作用，会继续向上爬坡。</p><p><strong>Adam：</strong></p><p>Adagrad、RMSProp、AMSGrad、AdaBound、RAdam、Nadam、AdamW</p><p>SGD+Adam-&gt;SWATS</p><p><strong>Lookahead</strong></p><h1 id="第四章-Classification-分类"><a href="#第四章-Classification-分类" class="headerlink" title="第四章 Classification 分类"></a>第四章 Classification 分类</h1><p>例：投简历</p><ul><li>输入：收入、存款、专业、年纪</li><li>输出：录取或拒绝</li></ul><p>模型：<br>$$<br>x\rightarrow f(x)\begin{cases}g(x)&gt;0\ &amp;Output=class1\else \ \ &amp;Output=class2\end{cases}<br>$$<br>Loss function：<br>$$<br>L(f)=\sum_n\delta(f(x^n)\ne y^n)<br>$$<br>79个水系（C1）宝可梦，61只普通系（C2）的宝可梦</p><p>$P(x|C_1)$的可能性。</p><p>$P(x|C_1)$满足高斯分布（正态分布），找到最合适的高速分布系数$\mu$和$E$</p><p>使用贝叶斯公式，求测试数据$P(C_1|x)$的概率。</p><p>所以：</p><p>模型<br>$$<br>x\rightarrow P(C_1|x)=\frac{P(x|C_1)P(C_1)}{P(x|C_1)P(C_1)+P(x|C_2)P(C_2)}<br>$$<br>函数的好坏：</p><p>平均值$\mu$和$E$。</p><p>一堆数学运算……</p><p>模型：<br>$$<br>P_{w,b}(C_2|x)=\sigma(z)<br>\<br>\sigma(z)=\frac{1}{1+exp(-z)}<br>\<br>z=w*x+b<br>$$</p><h1 id="第五章-Logistic-Regression"><a href="#第五章-Logistic-Regression" class="headerlink" title="第五章 Logistic Regression"></a>第五章 Logistic Regression</h1><p>$$<br>f_{w,b}(x)=\sigma(\sum w_ix+b)<br>$$<br>$x_1$属于$C_1$,$x_2$属于$C_1$,$x_3$属于$C_2$……<br>$$<br>L(w,b)=f_{w,b}(x^1)f_{w,b}(x^2)(1-f_{w,b}(x^3))…<br>$$<br>找到一个$w^*,b^*$满足$arg\ max,L(w,b)$最大。</p><h1 id="第六章-Deep-learning"><a href="#第六章-Deep-learning" class="headerlink" title="第六章 Deep learning"></a>第六章 Deep learning</h1><p>历史：</p><p>1958: Perceptron(linear model)</p><p>1980: Multi-layer perceptron</p><p>1986: Backpropagation</p><p>1989: 1 hidden layer is “good enough”</p><p>2006: RBM initialization</p><p>2009: GPU</p><p>2011: Speech recognizition</p><p>步骤：</p><ol><li>找到一个函数-&gt;Neural Network</li></ol><p><img src="https://ae01.alicdn.com/kf/Hfab376d7115d4542a9bca22bbae41b31b.jpg" class="lazyload" data-srcset="https://ae01.alicdn.com/kf/Hfab376d7115d4542a9bca22bbae41b31b.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>Deep = Many hidden layers</p><h1 id="第七章-Backpropagation-反向传播"><a href="#第七章-Backpropagation-反向传播" class="headerlink" title="第七章 Backpropagation 反向传播"></a>第七章 Backpropagation 反向传播</h1><p>让计算梯度下降法的参数更有效。</p><p>Chain Rule 链式法则：</p><p>Case1：<br>$$<br>y=g(x) \ \ \ \ z=h(y)<br>\\triangle x \rightarrow \triangle y\rightarrow \triangle z<br>\ \frac{dz}{dx}=\frac{dz}{dy}\frac{dy}{dx}<br>$$<br>Case2:<br>$$<br>x=g(s) \ \ y=h(s) \ \ z=k(x,y)<br>\ \frac{dz}{ds}=\frac{\partial z}{\partial x}\frac{dx}{ds}+\frac{\partial z}{\partial y}\frac{dy}{ds}<br>$$</p><p>Loss function是所有输入经神经网络处理后的输出，与理想输出误差之和。<br>$$<br>L(\theta)=\sum_nC(\theta)<br>$$<br>对Loss function求导：<br>$$<br>\frac{\partial L}{\partial w}=\sum_n\frac{\partial C}{\partial w}<br>$$<br>只讨论神经网络的一个节点。</p><p><img src="https://i.loli.net/2020/06/20/o5kCyJMm9NULnFI.png" class="lazyload" data-srcset="https://i.loli.net/2020/06/20/o5kCyJMm9NULnFI.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>$$<br>\frac{\partial C}{\partial w}=\frac{\part C}{\part z}\frac{\part z}{\part w}<br>$$<br>求z对w求导，很简单，对w1求导是x1，对w2求导是x2。</p><p><img src="https://i.loli.net/2020/06/20/gICwHOfq65uS9dj.png" class="lazyload" data-srcset="https://i.loli.net/2020/06/20/gICwHOfq65uS9dj.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>假设第二层神经节点的输入a，是将z通过一个信号函数(signal) $\sigma(z)$得到的现在求$\frac{\part C}{\part z}$<br>$$<br>\frac{\part C}{\part z}=\frac{\part a}{\part z}\frac{\part C}{\part a}<br>$$<br>利用链式法则，求$\frac{\part C}{\part a}$</p><p>公式见上图。此时，通过反向传递法则。假设红色的信号节点就是神经网络的最后一个节点，对应输出就是神经网络输出。那么可以倒推回去。$\frac{\part C}{\part z^,}$就等于最后的sign函数导数。因此能求得$\frac{\part C}{\part a}$，这样依次反推回去。最终求得每个节点的$\frac{\part C}{\part z}$。从而求得Loss function的导数。</p><h1 id="第八章-Tips-for-Deep-Learning"><a href="#第八章-Tips-for-Deep-Learning" class="headerlink" title="第八章 Tips for Deep Learning"></a>第八章 Tips for Deep Learning</h1><ol><li><p>定义一个方程</p></li><li><p>方程好坏</p></li><li><p>选择最好的方程</p></li><li><p>获得一个Neural Network</p></li><li><p>是否获得一个好的结果在Training Data，如果不好重新选择最好的方程</p></li><li><p>在Testing Data获得不好的结果，overfitting，则重新定义一个方程。</p></li></ol><p><strong>ReLU</strong></p><p>Rectified Linear Unit.矫正线性单元</p><p><img src="https://i.loli.net/2020/06/20/YxX9CrsUGl2ot1J.png" class="lazyload" data-srcset="https://i.loli.net/2020/06/20/YxX9CrsUGl2ot1J.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>如果某个节点，输出是零，那么他对最后的结果没有任何影响。所以，输出为零关联的之后节点都可以被拿掉。</p><p><strong>ReLU -variant</strong></p><p>当z小于0时，a=mz。</p><p>Leaky ReLU ：m=0.01</p><p>Parametric: m可变</p><p><strong>Maxout</strong></p><p>最大输出，将不同输入的输出z分组，组内选出最大的值，作为下一个节点输入。</p><p><strong>RMSProp</strong><br>$$<br>w^1 \leftarrow w^0-\frac{\eta}{\sigma^0}g^0 \ \ \ \ \ \sigma^0=g^0<br>\<br>w^2 \leftarrow w^1-\frac{\eta}{\sigma^1}g^1 \ \ \ \ \ \sigma^1=\sqrt{\alpha (\sigma^0)^2+(1-\alpha)(g^1)^2}<br>\……<br>$$<br>$\alpha$可以设置。</p><p><strong>Momentum</strong></p><p>在初始点$\theta^0$处，加速度方向为gradient方向。</p><p>初始移动距离:$v_0=0$</p><p>加速度(第一点处的gradient):$\triangledown L(\theta^0)$</p><p>移动距离:$v^1=\lambda v^0-\eta \triangledown L(\theta^0)$</p><p>移到第二点:$\theta^1=\theta^0+v^1$</p><p>计算第二点的加速度:$\triangledown L(\theta^1)$</p><p>下一次移动距离:$v^2=\lambda v^1-\eta \triangledown L(\theta^1)$</p><p>移动到第三点:$\theta^2=\theta^1+v^2$</p><p><strong>Adam</strong>:RMSProp+Momentum</p><p><strong>过拟合问题</strong></p><ol><li>early stop</li></ol><p>通过情况可能出席，当训练集增加时，测试集的正确率反而下降，因此通过减少训练集的数据来达到防止过拟合。</p><ol start="2"><li>Regularization</li></ol><p>$$<br>L^,(\theta)=L(\theta)+\lambda \frac{1}{2}||\theta||_2<br>$$</p><p>$$<br>||\theta||_2=(w_1)^2+(w_2)^2+……<br>$$</p><p>$||\theta||_2$不考虑biases，因为正则化是为了让loss function更加平滑，biases并不会起到作用。</p><p>Loss function求导:<br>$$<br>\frac{\partial L^,}{\partial w}=\frac{\partial L}{\part w}+\lambda w<br>$$<br>在找下一个<br>$$<br>w^{t+1}\rightarrow w^t-\eta\frac{\part L^,}{\part w} =w^t-\eta(\frac{\part L}{\part w}+\lambda w^t)=(1-\eta\lambda)w^t-\eta\frac{\part L}{\part w}<br>$$</p><ol start="3"><li>Dropout</li></ol><p>在更新参数之前：</p><ul><li>每个节点有p%几率被丢掉</li><li>使用新的网络去训练</li></ul><p>测试时：</p><p>没有丢弃节点</p><ul><li>如果丢弃率为p%，所有的weights times(1-p)%</li></ul><p>可以理解为，在训练时，腿上绑重物，测试时把重物拿掉。</p><p>为什么要乘(1-p)%</p><p><img src="https://i.loli.net/2020/06/21/dAis9PpjHgMKWy7.png" class="lazyload" data-srcset="https://i.loli.net/2020/06/21/dAis9PpjHgMKWy7.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>假设丢弃率为50%,在训练时一半节点被拿掉，而测试时使用了所有节点，导致节点z相差两倍，在测试时将所有weight乘50%，保证测试时的$z’\approx z$</p><h1 id="第八章-Why-deep"><a href="#第八章-Why-deep" class="headerlink" title="第八章 Why deep"></a>第八章 Why deep</h1><p>矮胖？高瘦？</p><p>实验数据表明，相同参数情况下，deep的错误率更小。</p><p><strong>Modularization</strong></p><ul><li>Deep-&gt;Modularization</li></ul><p>比如辨别男生长发、男生短发、女生长发、女生长发。</p><p>男生长发的训练集是很少的。</p><p>使用模组化，可以先辨别性别，在辨别头发长短。这样性别和长短发的训练集都是差不多的。这样男生长发也有好的正确率。</p><ul><li>Deep-&gt;Modularization-&gt;Less training data</li></ul><p><strong>Modularization-Speech</strong></p><p>人类语言的架构</p><p>Phoneme:人类发音的音节，</p><p>Tri-phone:不同的组合</p><p>State: 不同的节</p><ul><li>语音识别：</li></ul><p>分类：input-&gt;acoustic feature,output-&gt;state</p><blockquote><p>deep的好处是，可以把复杂的问题，使用很多个简单的function连接在一起。</p></blockquote><h1 id="第九章-Pytorch"><a href="#第九章-Pytorch" class="headerlink" title="第九章 Pytorch"></a>第九章 Pytorch</h1><p>指定设备，迁移到某个设备</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cpu = torch.device(<span class="string">&quot;cpu&quot;</span>)</span><br><span class="line">gpu=torch.device(<span class="string">&quot;gpu&quot;</span>)</span><br><span class="line">x= torch.rand(<span class="number">10</span>)</span><br><span class="line">print(x)</span><br><span class="line">x=x.to(gpu)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 机器学习 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算机网络技术学习笔记</title>
      <link href="/2020/04/26/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2020/04/26/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%8A%80%E6%9C%AF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="1：基础概念"><a href="#1：基础概念" class="headerlink" title="1：基础概念"></a>1：基础概念</h1><ol><li><p>局域网、城域网、广域网的区别</p></li><li><p>实训任务：宽带城域网的逻辑结构，“三个平台一个出口”</p></li></ol><p>管理平台、业务平台、网络平台（核心层、汇聚层、接入层）、城市宽带出口- </p><p>核心层：</p><ul><li>为汇聚层的网络提供高速分组转发，为城市提供一个高速安全与具有QoS保障能力的数据传输环境</li><li>提供城市的宽带IP出口</li><li>用户访问Internet所需的路由访问</li></ul><p>汇聚层：</p><ul><li>汇聚接入层的用户流量</li><li>进行本地路由，QoS优先级的管理等</li><li>用户流量转发到核心层</li></ul><p>接入层：</p><ul><li>连接最终用户</li></ul><p>三层结构思想：上层负责下层的数据汇聚，核心提供出口和QoS、汇聚本地路由、接入服务用户。</p><ol start="3"><li>QoS服务质量的保证：</li></ol><ul><li>资源预留、区分服务、多协议标记交换</li></ul><p>RPR：弹性分组环，工作技术，动态分组传输（DPT），在光以太网上高效传输IP分组的传输技术。顺时针传输的光纤叫做外环，内外环都可以传输数据分组和控制分组</p><h1 id="2：中小型网格系统总体规划"><a href="#2：中小型网格系统总体规划" class="headerlink" title="2：中小型网格系统总体规划"></a>2：中小型网格系统总体规划</h1><p><strong>考点：路由器技术指标、网格系统分层设计、交换机技术指标、网络服务器性能</strong></p><h2 id="2-1-基础知识"><a href="#2-1-基础知识" class="headerlink" title="2.1 基础知识"></a>2.1 基础知识</h2><h3 id="2-1-1-基于网络的信息系统基本结构"><a href="#2-1-1-基于网络的信息系统基本结构" class="headerlink" title="2.1.1 基于网络的信息系统基本结构"></a>2.1.1 基于网络的信息系统基本结构</h3><ul><li>网络运行环境：机房和电源</li><li>网络系统</li><li>网络操作系统</li><li>网络应用软件开发和运行环境</li></ul><h3 id="2-1-2-网络需求调研与系统设计的基本原则"><a href="#2-1-2-网络需求调研与系统设计的基本原则" class="headerlink" title="2.1.2 网络需求调研与系统设计的基本原则"></a>2.1.2 网络需求调研与系统设计的基本原则</h3><h2 id="2-2-实训任务"><a href="#2-2-实训任务" class="headerlink" title="2.2 实训任务"></a>2.2 实训任务</h2><h3 id="2-2-1-网络用户调查与网络工程需求分析"><a href="#2-2-1-网络用户调查与网络工程需求分析" class="headerlink" title="2.2.1 网络用户调查与网络工程需求分析"></a>2.2.1 网络用户调查与网络工程需求分析</h3><p>网络需求分析包括：网络总体需求分析、综合布线需求分析、网络可用性与可靠性分析、网络安全性分析</p><h3 id="2-2-2-路由器选型的依据"><a href="#2-2-2-路由器选型的依据" class="headerlink" title="2.2.2 路由器选型的依据"></a>2.2.2 路由器选型的依据</h3><ol><li>路由器的分类——根据路由器背板交换能力划分</li></ol><p>交换能力大于<strong>40Gbps</strong>的为高端路由器</p><ol start="2"><li>路由器的技术指标</li></ol><ul><li><p>吞吐量：包转发能力。能力与<strong>端口数量、端口效率、包长、包类型</strong>有关</p></li><li><p>背板能力：路由器的输入端与输出端之间的物理通道。传统，共享背板，高性能，交换式结构。背板能力决定了吞吐量</p></li><li><p>丢包率：持续负荷下，包丢失的概率。衡量路由器超负荷工作时的指标</p></li><li><p>延时与延时抖动：第一个比特进入路由器，到该帧的最后一个比特离开路由器所经历的时间。高速路由器，1518B的IP包，延时要求小于1ms。延时抖动指延时的变化量，语音、视频对延时抖动要求较高。</p></li><li><p>突发处理能力：最小帧间隔发送数据包而不引起丢失的最大发送速率</p></li><li><p>路由表容量</p></li><li><p>服务质量：主要表现在队列管理机制、端口硬件队列管理和QoS协议上</p></li><li><p>网管能力</p></li><li><p>可靠性和可用性：设备的冗余、热插拔、无故障工作时间、内部钟表精度</p></li></ul><h3 id="2-2-3-交换机分类与主要技术指标"><a href="#2-2-3-交换机分类与主要技术指标" class="headerlink" title="2.2.3 交换机分类与主要技术指标"></a>2.2.3 交换机分类与主要技术指标</h3><ol><li><p>交换机的分类</p></li><li><p>交换机的性能指标</p></li></ol><ul><li>背板带宽</li><li>全双工端口带宽：端口数x端口速率x2</li></ul><h3 id="2-2-4-网络服务器选型"><a href="#2-2-4-网络服务器选型" class="headerlink" title="2.2.4 网络服务器选型"></a>2.2.4 网络服务器选型</h3><ol><li><p>分类</p><p>文件服务器、数据库服务器、Internet通用服务器、应用服务器</p></li></ol><p>应用服务器的主要技术特点：采用浏览器/服务器（B/S）模式。传统的（C/S）客户/服务器</p><ol start="2"><li>功能</li></ol><ul><li><p>热插拔</p></li><li><p>RAID磁盘冗余阵列</p></li><li><p>CISC处理器结构</p></li></ul><ol start="3"><li>网络服务器性能</li></ol><ul><li>运算处理能力</li><li>磁盘存储能力</li><li>系统的高可靠性=MTBF/（MTBF+MRBR），MTBF，平均无故障时间，MRBR，平均修复时间</li></ul><h1 id="3：IP地址规划设计"><a href="#3：IP地址规划设计" class="headerlink" title="3：IP地址规划设计"></a>3：IP地址规划设计</h1><h2 id="3-1-基础知识"><a href="#3-1-基础知识" class="headerlink" title="3.1 基础知识"></a>3.1 基础知识</h2><h3 id="3-1-1-IP地址的概念和划分地址新技术的研究"><a href="#3-1-1-IP地址的概念和划分地址新技术的研究" class="headerlink" title="3.1.1 IP地址的概念和划分地址新技术的研究"></a>3.1.1 IP地址的概念和划分地址新技术的研究</h3><p>标准分类：A类、B类、C类IP地址采用包括网络号-主机号</p><p>划分子网的三级结构：网络号-子网号-主机号</p><p>无类域间路由（CIDR）：也称超网，将连续小的网络组成一个大的网络</p><p>网络地址转换（NAT）：公司内部每一台主机分配不能再Internet上使用的专用IP地址，访问外网时，专用IP地址转换成全局IP地址。</p><h3 id="3-1-2-标准分类IP地址"><a href="#3-1-2-标准分类IP地址" class="headerlink" title="3.1.2 标准分类IP地址"></a>3.1.2 标准分类IP地址</h3><p>A类：0+7位网络号+24位主机号：1.0.0.0~127.255.255.255</p><p>B类：10+14位网络号+16位主机号：128.0.0.0~191.255.255.255</p><p>C类：110+21位网络号+8位主机号：192.0.0.0~223.255.255.255</p><p>D类：1110+21位组播地址：224.0.0.0~</p><p>E类：11110+保留号</p><ol><li>A类地址，一共127块，第一块和最后一块保留用作特殊用途，另外，网络号=10的，用于专用地址，其余125块可指派给一些机构，可用的主机号为2^24-2.</li><li>B类地址，网络号长度为14位，网络号总数为16384，因此每个B类网络可以有2^16=65536个主机号。全0和全1保留用于特殊目的，因此允许分配的主机号位65534个。</li><li>C类地址，网络号长度21位，主机号长度为8位，允许有2097152个网络位，允许分配的主机号为254个。</li></ol><p>特殊地址形式：</p><ul><li>直接广播地址：在A类B类C类IP地址中，主机号是全1，那么这个主机号为直接广播地址</li><li>受限广播地址：32位全为1的广播地址（255.255.255.255）为受限广播地址，用来将一个分组以广播方式发送给本网络的所有主机。</li><li>这个网络上的特定主机地址：网络号全零，主机号不变</li><li>回送地址：A类地址中的127.0.0.0是回送地址，他是一个保留地址，会送地址用于网络软件测试和本地进程间通信</li></ul><h3 id="3-1-3-划分子网的三级网络结构"><a href="#3-1-3-划分子网的三级网络结构" class="headerlink" title="3.1.3 划分子网的三级网络结构"></a>3.1.3 划分子网的三级网络结构</h3><ol><li><p>子网的基本概念</p></li><li><p>三级层次是IP地址：netID——subnetID——hostID</p></li><li><p>子网掩码的概念：如何从一个IP地址中提取出子网号。</p></li></ol><p>A类地址：8位网络号：全1，24位主机号全0-。255.0.0.0</p><p>B类：255.255.0.0</p><p>C类：255.255.255.0</p><p>计算：</p><p>B类地址，要分出64个子网，从主机位借6位，现在网络号22位，主机位10位，子网掩码是，网络号全1，主机号全0，所以子网掩码为，255.255.252.0或者“网络号/22”.</p><p>分128个子网，则网络号23位，主机号9位，子网掩码：255.255.254.0</p><h2 id="3-2-实训任务"><a href="#3-2-实训任务" class="headerlink" title="3.2 实训任务"></a>3.2 实训任务</h2><p>网络地址转换NAT工作原理</p><ul><li>静态NAT（一对一）</li><li>动态地址NAT（一对多）</li><li>网络地址端口装欢NAPT（端口区分）</li></ul><p>IPv6地址的主要特征</p><ul><li>新的协议格式，巨大的地址空间，有效的分机寻址和路由结构，地址自动配置，支持QoS服务</li><li>IP v6地址长度规定为128位，用16位边界划分，每个16位段转换更4位十六进制数字，用冒号分隔</li><li>压缩零，有一段连续的十六进制段都为0，用双冒号压缩，FE8C::2AA:FF:FE9A:4CA2。段内压缩，只能压缩前面的零，双冒号在一个地址中只能出现一次。</li><li>IPv6不支持子网掩码，FE8C::2AA:FF:FE9A:4CA2/48。用前缀位表示48位前缀。</li></ul><h1 id="4：路由设计技术"><a href="#4：路由设计技术" class="headerlink" title="4：路由设计技术"></a>4：路由设计技术</h1><p>考点：RIP路由协议、OSPF、BGP、IP路由选择和路由汇聚</p><p>内部路由协议：RIP、OSPF</p><p>外部路由协议：BGP</p><h2 id="4-1-路由信息协议（RIP）的工作过程："><a href="#4-1-路由信息协议（RIP）的工作过程：" class="headerlink" title="4.1 路由信息协议（RIP）的工作过程："></a>4.1 路由信息协议（RIP）的工作过程：</h2><ol><li>路由表的建立，初始化的路由只包含所有与该路由器直接相连的网络的路由。距离为0.</li><li>路由表信息的更新</li></ol><ul><li>如果自己的路由表没有该项，增加该项，距离+1</li><li>如果自己的路由表已有该项<ul><li>原距离比对方的距离（跳数）+1还要大，距离设置为对方距离+1。路由为对方</li><li>原距离比对方的距离+1还要小，保持不变。</li><li>相同不变</li></ul></li></ul><p>路由刷新保温主要内容是由若干（V、D）组成的表</p><h2 id="4-2-最短路径优先协议（OSPF）"><a href="#4-2-最短路径优先协议（OSPF）" class="headerlink" title="4.2 最短路径优先协议（OSPF）"></a>4.2 最短路径优先协议（OSPF）</h2><h3 id="4-2-1-和RIP比较，其特点"><a href="#4-2-1-和RIP比较，其特点" class="headerlink" title="4.2.1 和RIP比较，其特点"></a>4.2.1 和RIP比较，其特点</h3><ol><li>OSPF是使用<strong>分布式链路状态协议</strong>；</li><li>链路状态度量主要是指<strong>费用、距离、延时、带宽</strong>。RIP主要看跳数；</li><li>链路状态发生变化时，用<strong>洪泛法</strong>向所有路由器发送此信息；</li><li>所有的OSFPF路由器交换链路状态信息，<strong>最终建立一个链路状态数据库</strong>，这个数据库实际上就是<strong>全网的拓扑结构图</strong>；</li><li>OSPF可以将一个自治系统再划分为若干个更小的范围，即<strong>区域</strong>，每个区域有一个<strong>32位的区域标识符</strong>，一个区域路由器<strong>不超过200个</strong>。</li></ol><p>自治系统内部的区域划分，好处在于利用洪泛法将链路状态信息范围局限再每个区域而不是整个自治系统。<strong>层次结构划分</strong>，将一个自治系统划分成<strong>若干区域与一个主干区域</strong>。主干区域内部的路由器叫主干路由器，连接各个区域的路由器叫做区域边界路由器，区域边界路由器接收从其他区域来的信息。</p><h3 id="4-2-2-OSPF协议的执行过程"><a href="#4-2-2-OSPF协议的执行过程" class="headerlink" title="4.2.2 OSPF协议的执行过程"></a>4.2.2 OSPF协议的执行过程</h3><ol><li>初始化过程：OSPF让每个路由器用数据库描述分组和相邻路由器交换本数据库已有的链路状态摘要信息，摘要信息主要址出哪些路由器的链路状态信息已经写入数据库。</li><li>网络云心过程：只要一个路由器的链路发生变化，该路由器就要使用链路状态发送分组信息。</li></ol><h2 id="4-3-外部网关协议BGP"><a href="#4-3-外部网关协议BGP" class="headerlink" title="4.3 外部网关协议BGP"></a>4.3 外部网关协议BGP</h2><p>基本思想：</p><ul><li>外部网关协议是不同自治系统的路由器之间交换路由信息的协议。</li><li>BGP-4采用了路由向量路由协议，每个自治系统至少选择一个路由器作为自治系统的“发言人”，一个BGP发言人与其他自治系统的发言人交换路由信息要先建立TCP连接。</li></ul><p>BGP路由选择协议的工作过程</p><ol><li>BGP初始化过程：BGP<strong>刚刚运行时，交换整个路由表，以后只需要在发生变化时更新有变化的部分</strong>；</li><li>BGP协议的四种分组：</li></ol><ul><li>打开分组：与另一个BGP发言人建立关系；</li><li>更新分组：发送某一路由信息，以及列出要撤销的多条路由；</li><li>保活分组：确认打开分组，以及周期证实相邻边界路由器存在；</li><li>通知分组：发送检测到的差错。</li></ul><p>BGP发言人周期（30秒）交换“保活分组”。</p><p>“更新分组”是BGP协议的核心。</p><h1 id="5：局域网技术"><a href="#5：局域网技术" class="headerlink" title="5：局域网技术"></a>5：局域网技术</h1><p>考点：以太网组网方法（快速以太网）、局域网组网设备（集线器、交换机）、综合布线子系统设计（水平子系统、建筑群子系统）</p><h2 id="5-1-基础知识"><a href="#5-1-基础知识" class="headerlink" title="5.1 基础知识"></a>5.1 基础知识</h2><h3 id="5-1-1-局域网组网的基础知识"><a href="#5-1-1-局域网组网的基础知识" class="headerlink" title="5.1.1 局域网组网的基础知识"></a>5.1.1 局域网组网的基础知识</h3><p>局域网（LAN）是指分布在相对较小距离范围内的计算机网络。</p><p>局域网标准：IEEE802——&gt;数据链路层分为了两个子层，LLC子层和MAC子层</p><p>交换式局域网的基本概念，交换局域网是相对共享式局域网而言。局域网交换机可以在多个端口之间建立多个并发连接。主要采用<strong>快捷交换方式和存储转发方式</strong></p><p>虚拟局域网的基本概念（VLAN），以<strong>软件</strong>的方法将网络中的节点按工作性质与需要划分成若干“逻辑局域网”。</p><p>方法通常四种：</p><ul><li>基于端口的虚拟局域网</li><li>基于MAC地址的虚拟局域网</li><li>基于网络层地址定义的虚拟局域网</li><li>基于IP广播组的虚拟局域网</li></ul><h3 id="5-1-2-综合布线的概念"><a href="#5-1-2-综合布线的概念" class="headerlink" title="5.1.2 综合布线的概念"></a>5.1.2 综合布线的概念</h3><p>综合布线是一种模块化的、灵活性极高的建筑物内或建筑群之间的信息传输通道。由不同系列和规格的不见组成，包括：传输介质、相关连接硬件以及电气保护设备。</p><p>特点：兼容性、开放性等</p><p>组成：<strong>工作区、配线（水平子系统）、干线（垂直子系统）、设备间、建筑群、管理</strong>六大子系统</p><h2 id="5-2-实训任务"><a href="#5-2-实训任务" class="headerlink" title="5.2 实训任务"></a>5.2 实训任务</h2><ol><li>以太网组网的基本方法</li></ol><p>以太网的物理层标准的命名方法：</p><p>IEEE802.3x(Mb/s) |Type-y|Name(局域网名称)</p><p>10BASE-5，10M网，Base基带传输方式，y为网络的最大长度，单位100m。</p><p>10BASE-T标准以太网组网的设计方法，-T表示非屏蔽双绞线和RJ-45接口</p><p>快速以太网组网的基本设计方法：</p><p>特点：IEEE802.3u、 可工作在10M和100M</p><p>快速以太网介质专用接口MII</p><p>快速以太网的物理标准：</p><ul><li><p>100BASE-TX：使用<strong>5类非屏蔽双绞线或屏蔽双绞线</strong>（抗干扰性更强），两队双绞线，<strong>一对用于发送，一对用于接收</strong>。在传输中使用<strong>4B/5B编码</strong>方式。最大网段长度为100m。支持<strong>全双工</strong></p></li><li><p>100BASE-FX：两条<strong>光纤</strong>。<strong>全双工</strong></p></li><li><p>100BASE-T4：<strong>4对3类</strong>非屏蔽双绞线，3对用于传送数据，1对用于检测冲突信号。传输<strong>8B/6T编码</strong>。<strong>半双工</strong>。</p></li></ul><p>全双工：任意时刻，信号双向传输信号。是一种点到点连接方式，支持全双工的以太网拓扑结构一定是星形。</p><p>10Mbps与100Mpbs速率自动协商功能，只能用于使用双绞线的以太网，需要在500ms内完成。</p><ol start="2"><li>中继器</li></ol><p>中继器是网络物理层上面的连接设备。通过对数据信号的重新发送或转发，来扩大网络传输的设备。</p><p>543规则：是以太网标准中规定了以太网只允许出现5个网段，最多使用4个中继器，其中3段可以连接计算机</p><ol start="3"><li>集线器</li></ol><p>多端口的中继器，区别仅在于中继器只是连接两个网段，而集线器能够提供更多端口服务，采用<strong>CSMA/CD</strong>介质访问控制方法。连接一个集线器的<strong>所有节点共享一个冲突域</strong>。</p><p><strong>串联一个集线器可以监听</strong>该链路中的数据包。</p><p>连接到一个集线器的节点，<strong>不能同时发送数据帧，但能同时接收</strong></p><ol start="4"><li>网桥</li></ol><p>工作在数据链路层的设备。局域网互联，交换数据和共享资源</p><p>特征：能互联两个采用<strong>不同数据链路层协议、不同传输介质、不同传输速率</strong>的网络。网桥以接收、储存、地址过滤和转发实现连接。</p><p>网桥最重要的维护工作是构建和维护MAC地址表。MAC地址表记录了不同的节点的物理地址与网桥转发端口的关系。</p><p>为避免网桥互联时的环状结构，透明网桥使用生成树算法。</p><p>生成树协议：其能够逻辑地阻断网络中存在地冗余链路，以消除路径中地环路，活动链路出现故障时，重新激活冗余链路来恢复网络的连接。</p><ol start="5"><li>交换机</li></ol><p>交换机可以在他的多个端口之间建立并发连接，交换式以太网是典型地交换式局域网，它的核心部件是以太网交换机。</p><p>交换机与网桥地主要区别：网桥一般只有一个CPU，通过软件方法完成网桥地接收、存储、地址过滤与转发等。</p><p>交换机使用为帧转发设计地专用集成电路芯片ASIC。或采取多个CPU并发工作地计算机结构</p><ol start="6"><li>综合布线系统子系统设计</li></ol><ul><li>工作区子系统设计：指从设备出线到信息插座地整个区域</li></ul><p>确定信息插座地数量和类型：信息插座分为，嵌入式安装插座（暗盒）、表面安装插座（明盒）、多介质信息插座（光纤和铜缆）</p><p>适配器的选用：设备连接处用的不同信息插座，可用专用电缆和适配器。挡在单一信息插座上，进行两项服务，应用“Y”型适配器。选用电缆类型不同与设备所需的电缆类型时，以及在连接使用不同信号的数模转换货数据速率转换，应采用适配器。</p><ul><li>水平子系统设计</li></ul><p>采用5类或超5类4对非屏蔽双绞线，90m以内</p><ul><li><p>管理子系统设计</p></li><li><p>干线子系统设计</p></li></ul><p>建筑物主馈电缆</p><ul><li>建筑群子系统</li></ul><p>两个或以上建筑物之间，由电缆、光缆和入楼处线缆上过流过压的电器保护设备</p><p>最好的是——管道布线法</p><hr><h1 id="6：-局域网交换机"><a href="#6：-局域网交换机" class="headerlink" title="6： 局域网交换机"></a>6： 局域网交换机</h1><h2 id="6-1-基础知识"><a href="#6-1-基础知识" class="headerlink" title="6.1 基础知识"></a>6.1 基础知识</h2><h3 id="6-1-1-局域网交换机的基本功能"><a href="#6-1-1-局域网交换机的基本功能" class="headerlink" title="6.1.1 局域网交换机的基本功能"></a>6.1.1 局域网交换机的基本功能</h3><p>交换机的基本概念：工作在数据链路层的网络设备。交换机根据进入端口数据帧中的MAC地址，过滤、转发数据帧。独占数据通道、独享信道带宽，同时允许多对站点进行通信、系统带宽等于所有端口带宽之和。</p><p>交换机的功能：</p><ol><li><p>建立和维护一个表示<strong>MAC地址与交换机端口</strong>对应关系的交换表。</p></li><li><p>在发送节点和接收节点之间建立一个<strong>虚连接</strong>。</p></li><li><p>完成数据帧的转发和过滤。</p></li></ol><p>交换机分析每一个进来的数据帧，根据帧中的目的MAC地址，通过查询交换表，确定是丢弃还是转发。</p><h3 id="6-1-2-局域网交换机的工作原理"><a href="#6-1-2-局域网交换机的工作原理" class="headerlink" title="6.1.2 局域网交换机的工作原理"></a>6.1.2 局域网交换机的工作原理</h3><p>交换机的工作原理与网桥相似，通过自学习的方式。</p><h3 id="6-1-3-交换表内容的建立和维护"><a href="#6-1-3-交换表内容的建立和维护" class="headerlink" title="6.1.3 交换表内容的建立和维护"></a>6.1.3 交换表内容的建立和维护</h3><p>交换表的内容：<strong>目的MAC地址</strong>、该地址所对应的<strong>交换机端口号</strong>以及所在的<strong>虚拟子网</strong>。</p><p>交换表的建立，初始时是空的，通过学习建立。</p><p>交换表的维护，一定时间后，表项未被更新，则被删除</p><p>交换结构：</p><ul><li>软件交换结构，串/并转换-&gt;RAM-&gt;并/串转换；</li><li>矩阵交换结构，根据源端口与目的端口打开交换矩阵中相应的开关；</li><li>总线交换结构，数据帧都按时隙在总线上传输，</li></ul><p>交换模式：快速转发、碎片丢弃、存储转发</p><ul><li>快速转发模式，一旦检测到<strong>6个字节</strong>，目的地址就立即进行转发操作。无法经过校验、纠错即被直接转发。</li><li>存储转发模式，先存储起来，然后进行循环冗余码校验检查，再对错误帧进行处理，才去除数据帧的目的地址，进行转发操作。延时大，支持不同速度的端口间转发。</li><li>碎片丢弃交换模式，检测数据帧是否冲突碎片，判断数据帧是否为64字节</li></ul><h3 id="6-1-3-虚拟局域网VLAN技术"><a href="#6-1-3-虚拟局域网VLAN技术" class="headerlink" title="6.1.3 虚拟局域网VLAN技术"></a>6.1.3 虚拟局域网VLAN技术</h3><p>以交换式网络为基础，把网络上的用户终端被划分为多个逻辑工作组。逻辑组设立一个独立的逻辑网段和广播域。不受用户所在的物理位置和物理网段的限制。通过软件完成。</p><ul><li>VLAN工作在OSi参考模型的第2层，数据链路层。</li><li>其广播的信息只能发送给该VLAN的节点</li><li>唯一不同的子网号，VLAN只能通过第三层路由才能通信</li></ul><p>VLAN的标识：VLAN ID或VLAN name</p><p>VLAN ID由IEEE 802.1Q标准规定<strong>12位二进制</strong>，1~1000用于以太网。</p><p>VLAN name由32位字符表示，可以是字母或数字</p><p>VLAN Trunk（虚拟中继）：主干线路上传输多个VLAN的信息，连接主干线路的两台交换机端口，应具有Trunk功能</p><h3 id="6-1-4-生成树协议STP"><a href="#6-1-4-生成树协议STP" class="headerlink" title="6.1.4 生成树协议STP"></a>6.1.4 生成树协议STP</h3><p>BPDU报文，每两秒或是再网络发生故障、网络拓扑变化时，发送新的BPDU。</p><p>BPDU两种类型，配置BPDU（不超过35个字节），拓扑变化通知BPDU（不超过4字节）</p><h2 id="6-2-实训任务"><a href="#6-2-实训任务" class="headerlink" title="6.2 实训任务"></a>6.2 实训任务</h2><ol><li>使用console配置交换机，超级端口设置参数9600bps，8位数字</li><li>telnet命令配置，再windows“运行”输入指令<code>telnet x.x.x.x:端口号</code></li><li>使用浏览器配置交换机，计算机已安装TCP/IP协议，计算机和交换机都有IP地址；计算机安装有JAVA的WEB浏览器；交换机有管理权限的用户密码；交换机支持http服务，并启用。</li></ol><hr><h1 id="7：路由器及其配置"><a href="#7：路由器及其配置" class="headerlink" title="7：路由器及其配置"></a>7：路由器及其配置</h1><p>考点：路由器基础与基本命令、接口配置、Pos接口配置、访问控制列表、静态路由、RIP协议、OSPF协议配置</p><h2 id="7-1-基础知识"><a href="#7-1-基础知识" class="headerlink" title="7.1 基础知识"></a>7.1 基础知识</h2><h3 id="7-1-1-路由器概述"><a href="#7-1-1-路由器概述" class="headerlink" title="7.1.1 路由器概述"></a>7.1.1 路由器概述</h3><p>工作在<strong>网络层</strong>的设备，选择<strong>最佳路径</strong>，将数据从源主机传送到目的端主机。路由器具有异构网络、广域网互联、<strong>隔离广播</strong>的能力。</p><h3 id="7-1-2-路由器工作原理"><a href="#7-1-2-路由器工作原理" class="headerlink" title="7.1.2 路由器工作原理"></a>7.1.2 路由器工作原理</h3><ol><li>路由选择，路由器依据目的IP地址的网络地址，通过路由算法，确定一条最佳路径。</li><li>分组转发，根据最佳路径信息，将其转发给下一跳路由器、目的端口或是缺省路由器。</li></ol><p>缺省路由也称缺省网关。<strong>分组转发的思想，目的IP地址不变，目的MAC地址，逐跳修改。</strong></p><ol start="3"><li>路由表，目的网络地址及其对应端口，下一跳路由器的名字，缺省路由信息</li></ol><h3 id="7-1-3-路由器的结构"><a href="#7-1-3-路由器的结构" class="headerlink" title="7.1.3 路由器的结构"></a>7.1.3 路由器的结构</h3><ol><li><p>中央处理器</p></li><li><p>非易失性随机存储器NVRAM：存储路由器的启动配置文件</p></li><li><p>闪存FLASH：保存操作系统的映像文件和一些微代码</p></li><li><p>接口：局域网接口、广域网接口</p></li></ol><p>配置接口：console控制接口和AUX辅助接口。AUX通过拨号方式实现远程访问</p><p>路由器接口名字和编号 f 0/5，f：FastEthernet；mod/port，模块号/端口</p><h3 id="7-1-4-路由器的工作模式"><a href="#7-1-4-路由器的工作模式" class="headerlink" title="7.1.4 路由器的工作模式"></a>7.1.4 路由器的工作模式</h3><ol><li>用户模式</li></ol><p>通过控制台或Telnet登陆路由器后，用户可以浏览路由器的某些信息。默认提示符：router&gt;</p><ol start="2"><li>特权模式</li></ol><p>用户模式后输入enable。可以管理系统时钟、错误检测、查看和保存配置文件、清除内存、重启。提示符：router#</p><ol start="3"><li>全局配置模式</li></ol><p>在特权模式下，输入configure terminal。配置路由器全局性参数（主机名、口令、TFTP服务器、静态路由）。提示符：router（config）#</p><ol start="4"><li>其他配置模式</li></ol><p>包括接口配置模式、虚拟终端配置模式、路由配置模式等。</p><ol start="5"><li>设置模式</li></ol><p>用户创建第一次的配置文件</p><ol start="6"><li>RXBOOT模式</li></ol><p>路由器的维护模式，<strong>恢复密码</strong></p><h2 id="7-2-实训任务"><a href="#7-2-实训任务" class="headerlink" title="7.2 实训任务"></a>7.2 实训任务</h2><ol><li>路由器的操作</li></ol><p>AUX通过远程拨号配置路由器</p><ol start="2"><li>路由器的配置</li></ol><p>router(config)#line vty 0 15</p><p>router(config-line)#password zzz ***</p><ol start="3"><li>使用TFTP配置路由器</li></ol><p><strong>广域网接口配置：</strong></p><ul><li>配置异步串行口（为用户提供拨号上网服务）</li></ul><p>interface a1。封装格式只能为ppp</p><ul><li>配置同步串行口</li></ul><p>用于DDN专线、帧中继、卫星</p><p>interface s1/1；Bandwidth 2048（带宽2M，单位为kb）；封装hdlc或ppp协议，hdlc为缺省</p><ul><li>配置POS接口</li></ul><p>interface POS3/0；Crc 32（校验位16和32）；Posframing sdh（可选帧格式是SDH和SONET）</p><ul><li>loopback接口配置</li></ul><p>一个虚拟接口，接口号有效值为0~2147483647，主要用为管理地址，永远处于激活状态。子网掩码为255.255.255.255。int loopback 0</p><p><strong>路由器的静态路由配置：</strong></p><ul><li>静态路由的配置方法：</li></ul><p>Router(config)#p route &lt;目的网络地址&gt;&lt;子网掩码&gt;&lt;下一跳路由器的IP地址&gt;</p><ul><li>静态默认路由配置方法</li></ul><p>如果路由表中无匹配表项，且路由表中有默认路由，路由器按默认路由的吓一跳地址妆发数据</p><p>Router(config)#ip route 0.0.0.0 0.0.0.0 212.112.8.6</p><p><strong>动态路由协议的配置</strong></p><ul><li>RIP动态路由协议的配置</li></ul><p>RIP路由协议依据路由器的跳数(hop数)。最大跳数为15。不可带子网掩码</p><ol><li>配置被动接口，只收不发</li><li>配置路由过滤</li><li>配置管理距离</li><li>定义邻居路由器</li></ol><ul><li>OSPF动态路由协议的配置</li></ul><p>OSPF的基本配置</p><ol><li><p>使用network定义参与OSPF的子网地址</p><p>Router(config)# router ospf 63</p><p>Router(config-router)# network 131.107.25.1 0.0.0.0 area 0（0.0.0.0为反掩码或通配符）</p><p>Router(config-router)# area 0 range 131.107.25.1 255.255.255.255</p></li><li><p>参数配置</p></li></ol><p>配置被动接口、配置路由过滤、配置管理地址、配置引入外部路由到OSPF的参数</p><p><strong>路由器的DHCP功能及其配置</strong></p><p>IP地址分配有动态和静态两种方式。</p><p>工作原理：DHCP采用C/S工作模式，一，建立和管理IP地址池，二，接收并处理DHCP客户端提出的请求。</p><ul><li>DHCP服务器配置</li></ul><ol><li><p>配置IP地址池的名称，并进入DHCP Pool配置模式</p><p>Router(config)# ip dhcp pool ttt</p></li><li><p>配置IP地址池</p></li><li><p>配置不用于动态分配的IP地址</p></li><li><p>配置IP地址池的缺省网关</p></li><li><p>配置IP地址池的域名系统</p></li><li><p>配置IP地址池的地址租约时间</p></li><li><p>取消地址冲突记录日志</p></li></ol><ul><li>路由器IP访问控制列表的功能</li></ul><p>主要功能：ACL可以当作一种网络控制工具，用来过滤流入和流出接口的数据包</p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 网络技术 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>微信小程序学习笔记</title>
      <link href="/2020/04/07/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2020/04/07/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="1：简介"><a href="#1：简介" class="headerlink" title="1：简介"></a>1：简介</h1><ol><li>用户扫一扫或搜索一下即可打开应用。</li><li>微信有海量用户，粘性高</li><li>开发适配成本低</li></ol><h1 id="2：目录结构"><a href="#2：目录结构" class="headerlink" title="2：目录结构"></a>2：目录结构</h1><p>小程序<strong>结构目录</strong></p><ul><li><p>pages</p><ul><li>index</li><li>logs</li></ul></li><li><p>utils</p></li><li><p>app.js</p></li><li><p>app.json</p></li><li><p>project.config.json</p></li><li><p>sitemap.json  //某些页面是否能被微信检索</p></li></ul><p>开发者文档：<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/structure.html">https://developers.weixin.qq.com/miniprogram/dev/framework/structure.html</a></p><ul><li>全局配置app.json</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;pages&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;pages/index/index&quot;</span>,<span class="comment">//第一个页面</span></span><br><span class="line">    <span class="string">&quot;pages/logs/logs&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;window&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;backgroundTextStyle&quot;</span>: <span class="string">&quot;light&quot;</span>,<span class="comment">//下拉刷新文字，需开通下拉刷新</span></span><br><span class="line">    <span class="attr">&quot;navigationBarBackgroundColor&quot;</span>: <span class="string">&quot;#fff&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;navigationBarTitleText&quot;</span>: <span class="string">&quot;WeChat&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;navigationBarTextStyle&quot;</span>: <span class="string">&quot;black&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;tabBar&quot;</span>: &#123;  <span class="comment">//页面下面的菜单</span></span><br><span class="line">    <span class="attr">&quot;list&quot;</span>: [&#123; <span class="comment">//list至少需要两项</span></span><br><span class="line">      <span class="attr">&quot;pagePath&quot;</span>: <span class="string">&quot;pagePath&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;text&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;iconPath&quot;</span>: <span class="string">&quot;iconPath&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;selectedIconPath&quot;</span>: <span class="string">&quot;selectedIconPath&quot;</span></span><br><span class="line">    &#125;]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;style&quot;</span>: <span class="string">&quot;v2&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;sitemapLocation&quot;</span>: <span class="string">&quot;sitemap.json&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="3-数据绑定"><a href="#3-数据绑定" class="headerlink" title="3:数据绑定"></a>3:数据绑定</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span> &#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    data:&#123;</span><br><span class="line">        msg:<span class="string">&quot;hello world&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>4：数组和对象循环</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    data:&#123;</span><br><span class="line">        list:&#123;</span><br><span class="line">            id:<span class="number">0</span>,</span><br><span class="line">            name:<span class="string">&quot;猪八戒&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;list&#125;&#125;&quot;</span> <span class="attr">wx:for-item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">wx:for-index</span>=<span class="string">&quot;index&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">    索引：&#123;&#123;index&#125;&#125;--&#123;&#123;item.name&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p>wx:key可以提高循环检索效率。</p><ol><li>key必须是唯一的值</li><li>wx:key =”*this” 表示数组是一个普通数组</li></ol><p><code>wx:for-item=&quot;item&quot; wx:for-index=&quot;index&quot;</code>可以省略</p><p><strong>对象循环</strong><code>wx:for=&quot;&#123;&#123;对象&#125;&#125;&quot; wx:for-item=&quot;对象的值（键值）&quot; wx:for-index=&quot;对象的属性（键名）&quot;</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Person&#123;</span><br><span class="line">    name:<span class="string">&quot;起飞&quot;</span>,</span><br><span class="line">    age:<span class="number">22</span>,</span><br><span class="line">    height:<span class="number">174</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5：block标签</p><p>占位符的标签</p><p>写代码的时候可以看到这个存在</p><p>渲染时会移除掉</p><p>将view换成block，可将标签去掉，最终<strong>循环变量可在一行展示</strong></p><p>6：条件渲染</p><p><code>wx:if=&quot;&#123;&#123;ture/false&#125;&#125;&quot;</code></p><p><code>hidden</code></p><p>应用场景：</p><ul><li><p>当标签不是频繁切换显示，优先使用wx:if</p><p>直接把标签从页面结构中删除</p></li><li><p>频繁切换用hidden</p><p>使用display:none属性。</p></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>条件<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;true&#125;&#125;&quot;</span>&gt;</span>display<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:if</span>=<span class="string">&quot;&#123;&#123;true&#125;&#125;&quot;</span>&gt;</span>if<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:elis</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span>&gt;</span>elif<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:else</span>&gt;</span>else<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">hidden</span>&gt;</span>hidden<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">hidden</span>=<span class="string">&quot;&quot;</span>&#123;&#123;<span class="attr">true</span>&#125;&#125;&quot;&quot;&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><p>7：事件绑定</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">bindinput</span>=<span class="string">&quot;handelInput&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">&quot;handletap&quot;</span> <span class="attr">data-opt</span>=<span class="string">&quot;&#123;&#123;1&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    +</span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">&quot;handletap&quot;</span> <span class="attr">data-opt</span>=<span class="string">&quot;&#123;&#123;-1&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">    -</span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>&#123;&#123;num&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Pages(&#123;</span><br><span class="line">    data:&#123;</span><br><span class="line">        num:<span class="number">0</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    handelInput(e)&#123;</span><br><span class="line">        <span class="built_in">this</span>.setDate(&#123;<span class="attr">num</span>:e.detail.value&#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">handletap(e)&#123;</span><br><span class="line">        e.currentTaget.opt</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>8：样式</p><p>在750x屏幕中</p><p>750px=750rpx</p><p>把屏幕改为375</p><p>375px=750rpx</p><p>1rpx=0.5px.</p><ul><li>样式导入</li></ul><p>utils下新建文件夹<code>styles</code>，文件夹里新建common.wxss</p><p>引用：<code>@import &quot;../../styles/common.wxss&quot;</code></p><ul><li>选择器</li></ul><p>小程序不支持通配符</p><p>9：常见组件</p><ul><li>view</li><li>text<ul><li>文本标签</li><li>只有此标签可长按复制</li><li>解码decode</li></ul></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">text</span> <span class="attr">selectable</span>&gt;</span>长按复制 &amp;nbsp(这是空格)<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>图片</p><ul><li>本地图片不能超过2M，所以都使用外链图片</li><li>src：来源</li><li>mode：图片裁剪缩放格式//scaleToFill</li><li>lazy-load：懒加载，当图片在上下三屏范围类，图片会预加载</li></ul></li><li><p>swiper</p><ul><li>轮播图</li><li>autoplay:自动播放</li><li>circular：轮播</li><li>interva：间隔时间。单位ms</li><li>indicator-dots：显示分页指示器</li></ul></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">swiper</span> <span class="attr">autoplay</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">swiper-item</span>&gt;</span><span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span><span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">swiper-item</span>&gt;</span><span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span><span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">swiper-item</span>&gt;</span><span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span><span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">swiper</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>navigator<ul><li>导航栏</li><li>块级元素</li><li>url：跳转某个页面</li><li>target：跳转到其他小程序</li><li>open-type：navigate，保留当前页面，不能跳转tabbar里的页面，默认值；redirect，不保留当前页面；switchTab：跳转tabbar，关闭其他页面；reLauch：关闭所有页面，打开应用某个页面</li></ul></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">navigator</span> <span class="attr">url</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">navigator</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>rich-text<ul><li>富文本标签</li></ul></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">rich-text</span> <span class="attr">nodes</span>=<span class="string">&quot;&#123;&#123;html&#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">rich-text</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">    data:&#123;</span><br><span class="line">        html:[</span><br><span class="line">            name:<span class="string">&quot;div&quot;</span>,</span><br><span class="line">            attr:&#123;</span><br><span class="line">            class:&quot;my_div&quot;,</span><br><span class="line">            style:<span class="string">&quot;color:red&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">    children:[&#123;</span><br><span class="line">        name:<span class="string">&quot;p&quot;</span>,</span><br><span class="line">        attr:&#123;&#125;,</span><br><span class="line">        children:[&#123;</span><br><span class="line">            type:<span class="string">&quot;text&quot;</span>,</span><br><span class="line">            text:<span class="string">&quot;hellp&quot;</span></span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;]</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li><p>button</p><ul><li>按钮</li><li>open-type:contact：打开客服，在小程序官网，功能-客服。添加；share：分享小程序，不能分享朋友圈；getPhonNumber：获取用户手机号码，需要结合事件使用，只有企业小程序有权限使用，绑定事件bindgetphonenumber，获取回调函数；getUserInof：获取用户信息，需绑定事件，处理函数；openSetting：用户查看更改小程序能获得的权限</li></ul></li><li><p>icon</p><ul><li>图标</li><li>type：图标类型，sucess、warning等参数</li><li>size：大小</li><li>color：颜色</li></ul></li><li><p>radio</p><ul><li>单选框</li><li>必须和父元素radio-group一起使用</li><li>value选中的单选框值</li></ul></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">radio-group</span> <span class="attr">bindchange</span>=<span class="string">&quot;handelchange&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">radio</span> <span class="attr">value</span>=<span class="string">&quot;male&quot;</span>&gt;</span>男<span class="tag">&lt;/<span class="name">radio</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">radio</span> <span class="attr">value</span>=<span class="string">&quot;female&quot;</span>&gt;</span>女<span class="tag">&lt;/<span class="name">radio</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">radio-group</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span>&gt;</span>你选中的值是：&#123;&#123;gender&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Page(&#123;</span><br><span class="line">data:&#123;</span><br><span class="line">gender:&quot;&quot;</span><br><span class="line">&#125;,</span><br><span class="line">handleChange(e)&#123;</span><br><span class="line">let gender=e.detail.value;</span><br><span class="line">this.setData(&#123;gender&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>checkbox<ul><li>复选框</li><li>需和checkbox-group一起使用</li></ul></li></ul><p>10：自定义组件</p><p>slot标签，占位标签，内容传递过来时，替代</p><p>自定义组件中：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tabs</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">slot</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tabs</span>&gt;</span></span><br></pre></td></tr></table></figure><p>父组件中：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tabs</span>&gt;</span></span><br><span class="line">  你好啊</span><br><span class="line"><span class="tag">&lt;/<span class="name">tabs</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 微信小程序 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>微信公众号开发</title>
      <link href="/2020/04/01/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91/"/>
      <url>/2020/04/01/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91/</url>
      
        <content type="html"><![CDATA[<h1 id="1：微信公众号简介"><a href="#1：微信公众号简介" class="headerlink" title="1：微信公众号简介"></a>1：微信公众号简介</h1><p>给个人、企业和组织提供服务和用户管理的全新服务平台。</p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 微信公众号 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bootstrap学习笔记</title>
      <link href="/2020/03/01/Bootstrap%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2020/03/01/Bootstrap%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="0：入门例子"><a href="#0：入门例子" class="headerlink" title="0：入门例子"></a>0：入门例子</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width,initial-scale=1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Bootstrap<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/bootstrap.min.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>网站天下<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>hello-world<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>lang=&quot;zh-CN&quot;</code>修改网站文字为中文文字。</p><p><code>&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1&quot;&gt;</code>设置网站为自适应屏幕尺寸网站，缩放比例为不缩放。</p><p><code>&lt;link rel=&quot;stylesheet&quot; href=&quot;css/bootstrap.min.css&quot;&gt;</code>导入本地bootstrap.css样式。</p><h1 id="1：容器"><a href="#1：容器" class="headerlink" title="1：容器"></a>1：容器</h1><p><code>.container</code>+<code>tab</code>=<code>&lt;div class=&quot;container&quot;&gt;&lt;/div&gt;</code>固定宽度居中显示</p><p><code>.container-fluid</code>全宽容器</p><p>变化容器中一行一共包含12个格子。建立一个列表，每三个小格（col-xl-3）为一大格，需要一共4个大格可将其填满。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-xl-3&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #0c5460&quot;</span>&gt;</span>111<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-xl-3&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #005cbf&quot;</span>&gt;</span>222<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-xl-3&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #1e7e34&quot;</span>&gt;</span>333<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-xl-3&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background-color: #6c757d&quot;</span>&gt;</span>444<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>栅格等级：</strong><code>col</code>特小、<code>col-sm-*</code>小、<code>col=md-*</code>中、<code>col-lg-*</code>大、<code>col-xl-*</code>超宽。</p><p>各尺寸表示在不同尺寸屏幕上的显示方式，比如使用，<code>col-xl</code>则在屏幕宽度变为1000像素左右时，原来的栅格就换行显示，每个栅格占据一行。</p><p>若直接使用<code>col</code>来修饰，那么，即便在很小的屏幕上，栅格也不会换行。相当于网页直接缩放。不推荐使用。</p><p>栅格后的数字非必须。不添加数字则采用<code>flexbox</code>布局</p><ul><li>设置一列宽度</li></ul><p><code>col-6</code>占6/12</p><p><code>col-auto</code>可变宽度，随内容变化，变化的单位为1小格</p><ul><li>混合布局</li></ul><p><code>col-sm-6 col-lg-3</code>大屏时每行四个，中屏每行2个，小屏每行一个。</p><ul><li>对齐</li></ul><p>垂直对齐<code>align-items-center</code>、<code>align-items-xl-end</code></p><p>水平对齐<code>justify-content-start/center/end/around/between</code></p><ul><li>消除内边距</li></ul><p><code>&lt;div class=&quot;row no-gutters&quot;&gt;</code></p><ul><li>排序</li></ul><p><code>order-*</code>*值越小排序越前。默认为0</p><ul><li>偏移</li></ul><p><code>offset-*</code>偏移*个格子，也可加断点</p><ul><li>margin移动</li></ul><p><code>mr-auto``ml-auto</code></p><h1 id="2：排版"><a href="#2：排版" class="headerlink" title="2：排版"></a>2：排版</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">    主标题<span class="tag">&lt;<span class="name">small</span>&gt;</span> 小号字体<span class="tag">&lt;/<span class="name">small</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;display-1&quot;</span>&gt;</span>比标题字体大<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;leader&quot;</span>&gt;</span>变大强调<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">mark</span>&gt;</span>高亮<span class="tag">&lt;/<span class="name">mark</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>普通<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;mark&quot;</span>&gt;</span>高亮<span class="tag">&lt;/<span class="name">span</span>&gt;</span>文本<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">del</span>&gt;</span>删除线<span class="tag">&lt;/<span class="name">del</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">s</span>&gt;</span>删除线<span class="tag">&lt;/<span class="name">s</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">ins</span>&gt;</span>下划线<span class="tag">&lt;/<span class="name">ins</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">u</span>&gt;</span>下划线<span class="tag">&lt;/<span class="name">u</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>粗体<span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>粗体<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">em</span>&gt;</span>斜体<span class="tag">&lt;/<span class="name">em</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">i</span>&gt;</span>斜体<span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">abbr</span> <span class="attr">title</span>=<span class="string">&quot;请输入你的邮箱&quot;</span> <span class="attr">class</span>=<span class="string">&quot;initialism&quot;</span>&gt;</span>email<span class="tag">&lt;/<span class="name">abbr</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">blockquote</span> <span class="attr">class</span>=<span class="string">&quot;blockquote&quot;</span>&gt;</span></span><br><span class="line">    引用在此</span><br><span class="line"><span class="tag">&lt;/<span class="name">blockquote</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">code</span>&gt;</span>代码块<span class="tag">&lt;/<span class="name">code</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">var</span>&gt;</span>变量斜体<span class="tag">&lt;/<span class="name">var</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">kbd</span>&gt;</span>用户输入，黑色背景白色字体<span class="tag">&lt;/<span class="name">kbd</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="3：图片和图片框"><a href="#3：图片和图片框" class="headerlink" title="3：图片和图片框"></a>3：图片和图片框</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;../img/lg.img&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;img-fluid img-thumbnail w-100&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;rounded float-left&quot;</span>&gt;</span>//圆角</span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;rounded float-right&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;rounded d-block mx-auto&quot;</span>&gt;</span>//转为块级元素，然后居中对齐</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">picture</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">source</span> <span class="attr">srcset</span>=<span class="string">&quot;../images/lg.jpg&quot;</span> <span class="attr">media</span>=<span class="string">&quot;(min-width:992px)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">source</span> <span class="attr">srcset</span>=<span class="string">&quot;../images/md.jpg&quot;</span> <span class="attr">media</span>=<span class="string">&quot;(min-width:576px)&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;../images/sm.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">picture</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--设置不同屏幕显示不同尺寸图片--&gt;</span></span><br></pre></td></tr></table></figure><h1 id="4：表格"><a href="#4：表格" class="headerlink" title="4：表格"></a>4：表格</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;table-responsive&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;table&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>HeadingHeadingHeading<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>HeadingHeadingHeading<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">th</span>&gt;</span>HeadingHeadingHeading<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>CellCellCell<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>CellCellCell<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">td</span>&gt;</span>CellCellCell<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>条纹状表格：</strong>使用<code>.table-striped</code>样式定义<code>&lt;tbody&gt;</code>可以产生逐行交替变化的背景色。同<code>.table-dark</code>结合使用改变变化背景色为黑夜主题。</p><p><strong>表格边框：</strong>使用<code>。table-bordered</code>产生表格边框与间隙。<code>table-borderless</code>无边界表格。</p><p><strong>悬停效果：</strong><code>table-hover</code>悬停时，背景高亮。</p><p><strong>缩紧表格</strong>：<code>table—sm</code>可以将表格padding值缩减为原来的一般。</p><p><strong>Caption表格辅助标题：</strong><code>&lt;caption&gt;</code>默认是隐藏的，协助屏幕阅读用户找到表格，了解表格内容，并决定是否阅读它。</p><p><strong>字体和背景色：</strong><code>table-dark、table-primary、table-secondary、table-warnung、table-success、table-danger、table-info</code>为浅色字体色，将<code>table</code>替换为<code>bg</code>则改为背景色。能加在tr或td上。</p><p><strong>响应式滚动条：</strong>在<code>table</code>上层添加<code>&lt;div class=&quot;table-responsive&quot;&gt;</code></p><h1 id="5：边框"><a href="#5：边框" class="headerlink" title="5：边框"></a>5：边框</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;border-top border-secondary rounded-top&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;rounded-circle&quot;</span>&gt;</span>圆形或椭圆边框<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;rounded-pill&quot;</span>&gt;</span>圆形或胶囊型<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>border-top-0</code>清除边框。</p><h1 id="6：颜色—Display显示属性"><a href="#6：颜色—Display显示属性" class="headerlink" title="6：颜色—Display显示属性"></a>6：颜色—Display显示属性</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;d-inline&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;d-xl-none&quot;</span>&gt;</span>断点，当屏幕过大时不显示<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Bootstrap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux操作系统</title>
      <link href="/2020/02/20/Linux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2020/02/20/Linux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h1 id="1：Linux简介"><a href="#1：Linux简介" class="headerlink" title="1：Linux简介"></a>1：Linux简介</h1><p>开源软件：</p><ul><li>使用自由</li><li>研究自由</li><li>散布及改良的自由</li></ul><p>LAMP：Linux+Apache+Mysql+PHP</p><p>网络配置：</p><ul><li>桥接：像一台真实电脑一样直接连接互联网</li><li>NAT：类似于使用真实电脑的热点</li><li>host only：只允许和真实机通行</li></ul><p><code>ifconfig eth0 192.168.118.2</code>//配置网卡和ip，如果配置为桥接，需要设置为局域网相同网段。此设置重启后失效。</p><p>注意事项：</p><ul><li>Linux严格区分大小写</li><li>Linux所有内容以文件形式保存，包括硬件。</li></ul><p><strong>Linux目录的作用</strong></p><table><thead><tr><th>目录名</th><th>目录的作用</th></tr></thead><tbody><tr><td>/bin/</td><td>存放系统命令的目录，普通和超级用户都可以执行</td></tr><tr><td>/sbin/</td><td>保存和系统环境设置相关的指令，只有超级用户root能使用，但普通用户可以查看</td></tr><tr><td>/usr/bin/</td><td>单用户模式下不能使用，类似于win的安全模式</td></tr><tr><td>/usr/sbin/</td><td>超级用户才能使用</td></tr><tr><td>/boot/</td><td>系统启动目录，保存系统启动相关文件，如内核文件和启动引导程序</td></tr><tr><td>/dev/</td><td>设备文件保存位置，</td></tr><tr><td>/etc/</td><td>配置文件，默认保存在这</td></tr><tr><td>/home/</td><td>普通用户的家目录</td></tr><tr><td>/lib/</td><td>系统调用的函数库</td></tr><tr><td>/lost+found/</td><td>当系统意外崩溃或关机，产生一些文件碎片放在这里。系统启动时，fsck工具会检测这里。每个分区下都有自己的此文件</td></tr><tr><td>/media/</td><td>挂载目录，媒体设备</td></tr><tr><td>/mnt/</td><td>挂在如优盘、移动硬盘</td></tr><tr><td>/misc/</td><td>挂在NFS服务的共享目录</td></tr><tr><td>/opt/</td><td>第三方安装的软件保存位置。现在的习惯是，放在/usr/local/，类似于win中的Program Files文件夹。</td></tr><tr><td>/proc/</td><td>虚拟文件系统。存放在内存中，保存系统的内核、今后曾、外部设备状态、网络状态。不要再这里面写东西</td></tr><tr><td>/sys/</td><td>虚拟文件系统。内存中，保存内核相关</td></tr><tr><td>/root/</td><td>超级用户的家目录。普通用户在/home/</td></tr><tr><td>/srv/</td><td>服务数据目录。</td></tr><tr><td>/tmp/</td><td>临时目录。可以清空</td></tr><tr><td>/usr/</td><td>系统软件资源目录。unix software resource</td></tr><tr><td>/var/</td><td>动态数据保存目录。保存缓存、日志以及软件运行产生的文件。</td></tr></tbody></table><h1 id="2：Linux常用命令"><a href="#2：Linux常用命令" class="headerlink" title="2：Linux常用命令"></a>2：Linux常用命令</h1><p><strong>命令格式</strong></p><p>命令 [-选项] [参数]</p><p>例： ls -la /etc</p><p>说明：</p><ol><li><p>个别命令不遵守此格式</p></li><li><p>当有多个选项时，可以写在一起</p></li><li><p>简写选项与完整选项</p><p>-a 等于 –all</p></li></ol><h2 id="2-1-目录处理命令"><a href="#2-1-目录处理命令" class="headerlink" title="2.1 目录处理命令"></a>2.1 目录处理命令</h2><h3 id="2-1-1-展示子目录：ls"><a href="#2-1-1-展示子目录：ls" class="headerlink" title="2.1.1 展示子目录：ls"></a>2.1.1 展示子目录：ls</h3><p>命令名称：ls</p><p>命令原意：list</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ls#显示当前目录的非隐藏文件</span><br><span class="line">ls -a#all，显示隐藏文件和非隐藏文件，隐藏文件文件名格式：.abc</span><br><span class="line">ls /#查看根目录，/+文件路径可以查看任意位置</span><br><span class="line">ls -l#long，长格式显示，显示文件的详细信息</span><br><span class="line">ls -h#human,比如将文件大小单位列出来，人性化显示</span><br><span class="line">ls -d#direct，只显示目录本身</span><br><span class="line">ls -i#inode，展示i节点，文件的唯一身份标识</span><br></pre></td></tr></table></figure><p>ls -l的结果：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">total 31056</span><br><span class="line">-rwxr-xr-x  1 root root     3612 Jun 23 19:17 Aria2Drive.sh</span><br><span class="line">权限 引用次数 文件所有者 文件所属组 文件大小(单位字节) 文件最近修改时间 文件名</span><br></pre></td></tr></table></figure><p><strong>权限：-rw-r–r–</strong></p><p>权限第一个参数：</p><table><thead><tr><th>-</th><th>d</th><th>l</th></tr></thead><tbody><tr><td>文件</td><td>文件夹</td><td>软连接</td></tr></tbody></table><p>剩余九个参数：</p><table><thead><tr><th>rw-</th><th>r–</th><th>r–</th></tr></thead><tbody><tr><td>u所有者权限</td><td>g所属组权限</td><td>o其他人</td></tr><tr><td>r读</td><td>w写</td><td>x执行</td></tr></tbody></table><h3 id="2-1-2-新建目录：mkdir"><a href="#2-1-2-新建目录：mkdir" class="headerlink" title="2.1.2 新建目录：mkdir"></a>2.1.2 新建目录：mkdir</h3><p>命令名称：mkdir</p><p>命令原意：创建文件目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir /tmp/123</span><br><span class="line">mkdir -p /tmp/japan/123#递归创建目录，japan目录原来也没有</span><br><span class="line">mkdir -p /tmp/japan/123 /temp/japan/456#创建多个目录</span><br></pre></td></tr></table></figure><h3 id="2-1-3-切换目录：cd"><a href="#2-1-3-切换目录：cd" class="headerlink" title="2.1.3 切换目录：cd"></a>2.1.3 切换目录：cd</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /tmp/japan/123#切换到指定目录</span><br><span class="line">cd .#表示当前目录</span><br><span class="line">cd ..#回到上级目录</span><br></pre></td></tr></table></figure><h3 id="2-1-4-展示当前完整路径：pwd"><a href="#2-1-4-展示当前完整路径：pwd" class="headerlink" title="2.1.4 展示当前完整路径：pwd"></a>2.1.4 展示当前完整路径：pwd</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pwd#显示当前位置的完整路径</span><br></pre></td></tr></table></figure><h3 id="2-1-5-删除空目录：rmdir"><a href="#2-1-5-删除空目录：rmdir" class="headerlink" title="2.1.5 删除空目录：rmdir"></a>2.1.5 删除空目录：rmdir</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rmdir /tmp/japan/123</span><br></pre></td></tr></table></figure><h3 id="2-1-6-复制：cp"><a href="#2-1-6-复制：cp" class="headerlink" title="2.1.6 复制：cp"></a>2.1.6 复制：cp</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/grab.conf /root#复制文件</span><br><span class="line">cp -r /tmp/japan/123 /root#复制目录</span><br><span class="line">cp /tmp/japan/123.log /tmp/japan/456.log /tmp#复制多个文件</span><br><span class="line">cp -p /tmp/abc.log /tmp#保存文件的属性不变，比如最近修改的时间。</span><br><span class="line">cp /tmp/japan/abc.log /tmp/gaiming.log#拷贝并改名</span><br></pre></td></tr></table></figure><h3 id="2-1-7-移动、剪切：mv"><a href="#2-1-7-移动、剪切：mv" class="headerlink" title="2.1.7 移动、剪切：mv"></a>2.1.7 移动、剪切：mv</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mv /tmp/japan/123 /tmp#把123移动到/tmp目录下</span><br><span class="line">mv /tmp/japan/123 /tmp/us#移动并改名</span><br><span class="line">mv 123 456#当前目录下移动并改名，则是重命名</span><br></pre></td></tr></table></figure><h3 id="2-1-8-删除：rm"><a href="#2-1-8-删除：rm" class="headerlink" title="2.1.8 删除：rm"></a>2.1.8 删除：rm</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rm grab.conf#删除文件</span><br><span class="line">rm -f grab.conf#强制删除文件，不会询问是否确认。</span><br><span class="line">rm -r /tmp/japan#删除目录</span><br></pre></td></tr></table></figure><h2 id="2-2-文件处理命令"><a href="#2-2-文件处理命令" class="headerlink" title="2.2 文件处理命令"></a>2.2 文件处理命令</h2><h3 id="2-2-1-新建文件：touch"><a href="#2-2-1-新建文件：touch" class="headerlink" title="2.2.1 新建文件：touch"></a>2.2.1 新建文件：touch</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">touch japanlovestory.list#新建文件</span><br><span class="line">touch &quot;program files&quot; #创建带空格文件，不推荐带空格文件名</span><br></pre></td></tr></table></figure><h3 id="2-2-2-浏览短文件：cat"><a href="#2-2-2-浏览短文件：cat" class="headerlink" title="2.2.2 浏览短文件：cat"></a>2.2.2 浏览短文件：cat</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/issue#显示内容</span><br><span class="line">cat -n /etc/issue#显示行号</span><br></pre></td></tr></table></figure><h3 id="2-2-3-按行反向显示浏览：tac"><a href="#2-2-3-按行反向显示浏览：tac" class="headerlink" title="2.2.3 按行反向显示浏览：tac"></a>2.2.3 按行反向显示浏览：tac</h3><h3 id="2-2-4-分页浏览长文件：more"><a href="#2-2-4-分页浏览长文件：more" class="headerlink" title="2.2.4 分页浏览长文件：more"></a>2.2.4 分页浏览长文件：more</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">more /etc/services#空格或f向下翻页，按行向下翻，按q退出，帮助信息都是调用more命令。</span><br></pre></td></tr></table></figure><p>不能往上翻。</p><h3 id="2-2-5-可向上分页浏览：less"><a href="#2-2-5-可向上分页浏览：less" class="headerlink" title="2.2.5 可向上分页浏览：less"></a>2.2.5 可向上分页浏览：less</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">less /etc/services#向下翻页和more相同，按pgup向上翻页，上箭头向上一行。</span><br><span class="line"><span class="meta">#</span><span class="bash">搜索功能，浏览状态，输入“/service”，按“n”向下找搜索结果。</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-2-6-浏览文件前几行：head"><a href="#2-2-6-浏览文件前几行：head" class="headerlink" title="2.2.6 浏览文件前几行：head"></a>2.2.6 浏览文件前几行：head</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">head /etc/services#默认显示前十行</span><br><span class="line">head -n 7 /etc/services#显示前七行</span><br></pre></td></tr></table></figure><h3 id="2-2-7-浏览文件末尾几行：tail"><a href="#2-2-7-浏览文件末尾几行：tail" class="headerlink" title="2.2.7 浏览文件末尾几行：tail"></a>2.2.7 浏览文件末尾几行：tail</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tail /etc/services#显示末尾几行</span><br><span class="line">tail -n 7 /etc/services#显示指定行</span><br><span class="line">tail -f /var/log/messages#动态显示文件末尾几行</span><br></pre></td></tr></table></figure><h2 id="2-3-链接命令"><a href="#2-3-链接命令" class="headerlink" title="2.3 链接命令"></a>2.3 链接命令</h2><p><strong>生成链接文件：ln</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s /etc/issue /tmp/issue.soft#创建文件的软连接</span><br><span class="line">ln /etc/issue /tmp/issue.hard#创建文件的硬链接</span><br></pre></td></tr></table></figure><p>软连接：类似windows的快捷方式</p><p>硬链接：硬链接和源文件属性相同，且同步更新，可以向硬链接中写入内容，删除源文件后，硬链接任然存在。硬链接的i节点与源文件相同。</p><p>硬链接不能跨分区，生成对象不能是目录</p><h2 id="2-4-权限管理命令"><a href="#2-4-权限管理命令" class="headerlink" title="2.4 权限管理命令"></a>2.4 权限管理命令</h2><h2 id="2-4-1-文件权限变更：chmod"><a href="#2-4-1-文件权限变更：chmod" class="headerlink" title="2.4.1 文件权限变更：chmod"></a>2.4.1 文件权限变更：chmod</h2><p>命令名称：chmod（change the permissions mode of a file）</p><p>语法： chmod [{ugoa}]{+-=}[文件或目录]</p><p>​                            [mode=421][文件或目录]</p><p>​                            -R 递归修改</p><p>权限只有管理员root和所有者可以修改。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod g+w,o-r japan.list#所属组加读权限，其他人减少读权限</span><br><span class="line">chmod g=rwx japn.list</span><br></pre></td></tr></table></figure><p>数字表述法：</p><table><thead><tr><th align="center">r</th><th align="center">w</th><th align="center">x</th></tr></thead><tbody><tr><td align="center">4</td><td align="center">2</td><td align="center">1</td></tr></tbody></table><p>rwxrw-r–对应权限：(4+2+1)(4+2)(4)=764</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod -R 777 /tmp/abc#修改/tmp/abc及其下面的的所有文件的权限为777</span><br></pre></td></tr></table></figure><blockquote><p>root用户创建的644权限文件，其他用户能否删除？</p><p>答案取决于用户是否具有文件所属的目录的写权限。</p></blockquote><p>比如：<br>一个目录/temp权限为777</p><p>文件/temp/testfile的权限为644。</p><p>那么普通用户任然可以删除/temp/testfile，因为所有人都有/tmp目录的写权限，所以可以再/temp目录下新建文件、目录、删除目录和删除文件。</p><table><thead><tr><th></th><th>r读权限</th><th>w写权限</th><th>x执行权限</th></tr></thead><tbody><tr><td>file</td><td>cat/more/less/head/tail</td><td>vim</td><td>script command</td></tr><tr><td>directory</td><td>ls</td><td>touch/mkdir/rmdir/rm</td><td>cd</td></tr></tbody></table><h2 id="2-4-2-文件所有者变更：chown"><a href="#2-4-2-文件所有者变更：chown" class="headerlink" title="2.4.2 文件所有者变更：chown"></a>2.4.2 文件所有者变更：chown</h2><p>语法： chown [用户] [文件或目录]</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">useradd shenchao#添加一个用户</span><br><span class="line">chown shenchao /tmp/japan#改变所有者</span><br></pre></td></tr></table></figure><h2 id="2-4-3-文件所属组变更：chgrp"><a href="#2-4-3-文件所属组变更：chgrp" class="headerlink" title="2.4.3 文件所属组变更：chgrp"></a>2.4.3 文件所属组变更：chgrp</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">groupadd lampbrother#新建组</span><br><span class="line">chgrp lampbrother /tmp/japan#更改所属组</span><br></pre></td></tr></table></figure><h3 id="2-4-4-显示新建文件的缺省权限：umask"><a href="#2-4-4-显示新建文件的缺省权限：umask" class="headerlink" title="2.4.4 显示新建文件的缺省权限：umask"></a>2.4.4 显示新建文件的缺省权限：umask</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">umask -S#显示新建目录缺省权限</span><br><span class="line">umask#显示新建目录缺省权限的与值</span><br><span class="line">umask 077#修改新建文件的缺省权限为700.原理为，777与077得700</span><br></pre></td></tr></table></figure><p>0022</p><p>0：特殊权限</p><p>022：— -w- -w-</p><p>则目录的权限为：777和022逻辑与的结果，等于755</p><h2 id="2-5-文件搜索命令"><a href="#2-5-文件搜索命令" class="headerlink" title="2.5 文件搜索命令"></a>2.5 文件搜索命令</h2><h3 id="2-5-1-文件搜索命令：find"><a href="#2-5-1-文件搜索命令：find" class="headerlink" title="2.5.1 文件搜索命令：find"></a>2.5.1 文件搜索命令：find</h3><p>语法：find [搜索范围] [匹配条件]</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">find /etc -name init#在/etc目录下搜索名为init的文件，initab不能被搜索到。</span><br><span class="line">find /etc -name *init*#名字包含init就会被搜索，*作为通配符</span><br><span class="line">find /etc -name int???#?</span><br><span class="line">find /etc -iname init???#搜索名字不区分大小写。</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -size +204800#查找大于100MB文件，按数据块算，一个数据块=0.5K。204800个数据块=100MB</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -user shenchao#根据所有者查找</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find /etc -cmin -5#根据文件属性5分钟内被改的文件查找 change</span><br><span class="line">find /etc -amin -5#根据访问时间 access</span><br><span class="line">find /etc -mmin -5#根据文件内容被改变 modify</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find /etc -size +163840 -a -size -204800#查找大于80MB并且小于100MB的文件</span><br><span class="line">find /etc -size +163840 -o -size -204800#查找大于80MB或者小于100MB的文件</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /etc -name init* -a -type f#查找类型为文件的init*对象</span><br></pre></td></tr></table></figure><p>-exec/-ok 对搜索结果进行处理。-ok比-exec多了询问是否操作过程</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /etc -name inittab -exec ls -l &#123;&#125; \;#-exec 命令 &#123;&#125; \;为固定格式</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find /etc -inum 3442#根据i节点查找文件</span><br><span class="line">find /etc -inum 3442 -exec rm &#123;&#125; \;#删除i节点为3442的文件。可用于名字奇怪的文件</span><br></pre></td></tr></table></figure><h3 id="2-5-2-其他文件搜索命令：locate"><a href="#2-5-2-其他文件搜索命令：locate" class="headerlink" title="2.5.2 其他文件搜索命令：locate"></a>2.5.2 其他文件搜索命令：locate</h3><p>在文件资料库中查找文件，速度非常快。但是不能及时更新。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">locate inittab#查找inittab的位置</span><br><span class="line">locate -i inittab#查找时不区分大小写</span><br></pre></td></tr></table></figure><p>更新资料库</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">updatedb</span><br></pre></td></tr></table></figure><blockquote><p>locate无法收录/tmp目录下的文件</p></blockquote><h3 id="2-5-3-命令文件搜索命令：which"><a href="#2-5-3-命令文件搜索命令：which" class="headerlink" title="2.5.3 命令文件搜索命令：which"></a>2.5.3 命令文件搜索命令：which</h3><p>对命令使用</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">which cp#查找命令绝对路径的位置，并且得到命令是否有别命</span><br></pre></td></tr></table></figure><h3 id="2-5-4-命令文件搜索命令：whereis"><a href="#2-5-4-命令文件搜索命令：whereis" class="headerlink" title="2.5.4 命令文件搜索命令：whereis"></a>2.5.4 命令文件搜索命令：whereis</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whereis rm#找到命令绝对路径，和命令的帮助文档所在位置</span><br></pre></td></tr></table></figure><h3 id="2-5-5-文件内容搜索命令：grep"><a href="#2-5-5-文件内容搜索命令：grep" class="headerlink" title="2.5.5 文件内容搜索命令：grep"></a>2.5.5 文件内容搜索命令：grep</h3><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>-i</td><td>不区分大小写</td></tr><tr><td>-v</td><td>排除指定字串</td></tr></tbody></table><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grep multiuser /etc/inittab#查找文件中multiuser所在的行。</span><br><span class="line">grep -v ^# /etc/inittab#排除指定字串所在的行，即以#开头的行，不希显示。</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kali Linux的学习和使用</title>
      <link href="/2020/02/19/Kali-Linux%E7%9A%84%E5%AD%A6%E4%B9%A0%E5%92%8C%E4%BD%BF%E7%94%A8/"/>
      <url>/2020/02/19/Kali-Linux%E7%9A%84%E5%AD%A6%E4%B9%A0%E5%92%8C%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="0：Kali简介"><a href="#0：Kali简介" class="headerlink" title="0：Kali简介"></a>0：Kali简介</h1><p>Kali作为最常用的网络渗透系统，内置了网络安全人员和黑客最常用的各类工具。</p><h1 id="1：Kali安装"><a href="#1：Kali安装" class="headerlink" title="1：Kali安装"></a>1：Kali安装</h1><p><strong>安装途径：</strong></p><ol><li><p>在VMWare虚拟机上安装Kali，<a href="https://blog.csdn.net/xfyangle/article/details/81045116">Kali Linux 系统安装详细教程</a></p></li><li><p>在Vultr上上传自定义的IOS。将Kali部署到服务器上。</p></li></ol><p><strong>常见问题：</strong></p><ul><li>切换图形界面和命令界面，当主机内存小于2g时，使用图形界面体验更好。</li></ul><ol><li><p>切换命令界面：Ctrl+Alt+F3</p></li><li><p>切换图形界面：Ctrl+Alt+F1</p></li></ol><ul><li>在新版本Kali Linux2020中默认系统登陆为非超级管理员权限，也就是说不是root权限。在安装过程中，只有普通用户的用户名和密码设置。不会涉及root密码的设置。现在为root设置密码。</li></ul><ol><li><p>命令界面输入<code>sudo passwd root</code></p></li><li><p>输入新密码，重复输入新密码。密码设置完成。</p></li></ol><ul><li>开启SSH，如果你在服务器中安装了Kali，这个操作是必须的，他能让你使用其他终端，登陆Kali。</li></ul><ol><li><p>命令界面输入<code>sudo vim /etc/ssh/sshd_config</code>。</p></li><li><p>修改部分内容为如下：</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#Authentication</span><br><span class="line">LoginGraceTime 2m</span><br><span class="line">PermitRoootLogin yes</span><br><span class="line">StrictModes yes</span><br><span class="line">MaxAuthTries 0</span><br><span class="line">MaxSessions 10</span><br></pre></td></tr></table></figure><ol start="3"><li><p>保存退出</p></li><li><p>重启ssh <code>service ssh restart</code></p></li><li><p>查看ssh是否启动，<code>service ssh status</code></p></li><li><p>如果显示active则已生效，现在可以使用ssh登陆了。</p></li></ol><h1 id="3：被动信息收集"><a href="#3：被动信息收集" class="headerlink" title="3：被动信息收集"></a>3：被动信息收集</h1><h2 id="3-1-常用查询指令和工具"><a href="#3-1-常用查询指令和工具" class="headerlink" title="3.1 常用查询指令和工具"></a>3.1 常用查询指令和工具</h2><p><code>Ctrl+L</code>:清屏</p><p><code>ping sci.ci</code>:查看域名的访问速度</p><p><code>nslookup baidu.com</code>:域名服务器查询。</p><p><code>dig @8.8.8.8 baidu.com any</code>:查询，@8.8.8.8域名服务器记录的baidu.com域名解析记录。any:查询所有记录。不加只查A记录。+noall +answer只输出域名记录结果。</p><p><code>dig -x 35.201.203.235</code>：查询反向解析，ptr记录，需要有解析记录才行</p><p><code>dig txt chaos VERSION.BIND @ns3.dnsv4.com</code>:查询Dns服务器版本。通过版本信息查找漏洞</p><p><code>whois baidu.com</code>:查询注册信息</p><p>查询接口：</p><ul><li><p>备案信息：<code>http://www.beianbeian.com</code></p></li><li><p>天眼查：<code>https://www.tianyancha.com</code></p></li></ul><h2 id="3-2-子域名挖掘"><a href="#3-2-子域名挖掘" class="headerlink" title="3.2 子域名挖掘"></a>3.2 子域名挖掘</h2><ol><li>子域名挖掘工具：Maltego子域名挖掘机</li><li>搜索引擎：<code>site:qq.com</code></li><li>第三方网站：<code>http://tool.chinaz.com/subdomain、https://dnsdumpster.com</code></li></ol><h2 id="3-3-Maltego使用"><a href="#3-3-Maltego使用" class="headerlink" title="3.3 Maltego使用"></a>3.3 Maltego使用</h2><h2 id="3-4-Shodan搜索技巧"><a href="#3-4-Shodan搜索技巧" class="headerlink" title="3.4 Shodan搜索技巧"></a>3.4 Shodan搜索技巧</h2><p><code>https://www.shodan.io</code></p><p>搜索技巧：</p><p><code>webcam</code>//网络摄像头</p><p><code>city:beijing webcam</code>//位于北京的摄像头</p><p><code>net:35.201.203.235</code>//查询到ip绑定的域名等信息</p><p><code>port:9200</code>//搜索开启9200端口的服务器</p><h2 id="3-5-Google搜索引擎的使用技巧"><a href="#3-5-Google搜索引擎的使用技巧" class="headerlink" title="3.5 Google搜索引擎的使用技巧"></a>3.5 Google搜索引擎的使用技巧</h2><ul><li><p><code>inurl:qq.txt</code>文件</p></li><li><p><code>inurl:admin_login.asp</code>登陆界面</p></li><li><p><code>intitle:index.of .bash_history</code>表示网站目录对我们开放，我i们可以看到该目录下所有文件的信息。<code>.文件名</code>表示隐藏目录。</p><ul><li>查找mysql的配置文件，my.cnf</li><li>查找discuz论坛中储存mysql密码的配置文件confg_global.php</li></ul></li><li><p><code>cache:baidu.com</code>搜索缓存的页面，虽然某些页面被删了</p></li><li><p><code>Kali filetype:torrent</code>Kali时关键词，搜索Kali相关的指定文件类型</p></li><li><p><code>apache site:baidu.com </code>某网站下的关键词</p></li><li><p><code>intext:user.sql intitle:index.of</code>查询包含user.sql用户信息数据的网站，并且网站目录可见</p></li><li><p><code>s3 site:amazonaws.com filetype:xls password</code>s3关键字，亚马逊的一种服务器类型。</p></li></ul><p><strong>总结：谷歌黑客数据库：<a href="https://www.exploit-db.com/google-hacking-database">https://www.exploit-db.com/google-hacking-database</a></strong></p><h1 id="4-信息收集"><a href="#4-信息收集" class="headerlink" title="4: 信息收集"></a>4: 信息收集</h1><h2 id="4-1-主动采集"><a href="#4-1-主动采集" class="headerlink" title="4.1 主动采集"></a>4.1 主动采集</h2><ul><li><p><code>ping 192.168.1. -c 1</code>-c 1发一个ping包就停止，默认一直发</p></li><li><p><code>traceroute baidu.com</code>检测路由</p></li></ul><p><strong>ARP：将ip解析为MAC物理地址</strong></p><ul><li>使用<code>apring</code>命令查看局域网中的IP是否有冲突</li></ul><p>如何在Kali中排查黑客是否冒充网关进行中间攻击？</p><p>伪装机配置：<code>ifconfig ens33 192.168.1.1</code></p><p>Kali探测：<code>arping 192.168.1.1 -c 1</code>//查看局域网中是否存在arp攻击，出现两个MAC地址对应IP地址，就有ARP攻击了。</p><ul><li><code>netdiscover -i eth0 -r 192.168.1.0/27</code>查看局域网中存活的设备。</li></ul><p>-i 是网络设备，网卡。-r 表示扫描范围</p><h2 id="4-2-被动采集"><a href="#4-2-被动采集" class="headerlink" title="4.2 被动采集"></a>4.2 被动采集</h2><p><code>netdiscover -p</code>扫描局域网中的设备，不容易被管理员发现</p><h2 id="4-3-用Hping3对服务器进行DOS攻击"><a href="#4-3-用Hping3对服务器进行DOS攻击" class="headerlink" title="4.3 用Hping3对服务器进行DOS攻击"></a>4.3 用Hping3对服务器进行DOS攻击</h2><p><code>hping3 -c 1000 -d 120 -s -w 64 -p 80 --flood --rand-source baidu.com</code></p><p>-c 发送包的数量</p><p>-d 发送到目标机器的每个数据包的大小。单位是字节</p><p>-s 只发送SYN数据包</p><p>-w TCP窗口大小</p><p>-p 目的地端口（80是web端口）</p><p>–flood 洪水攻击模式，尽可能快地发送数据包</p><p>–rand-source 使用随机性的源头ip地址。只是在局域中伪造</p><h2 id="4-4-使用Nmap进行半连接扫描"><a href="#4-4-使用Nmap进行半连接扫描" class="headerlink" title="4.4 使用Nmap进行半连接扫描"></a>4.4 使用Nmap进行半连接扫描</h2><p><code>nmap -sS 101.200.128.35 -p 80,81,21,25,110,443</code>看某个端口是否开启</p><p><code>nmap -sS 101.200.128.35</code>查看其打开的端口，但不会完全扫描65535个端口</p><p><code>nmap -sS 101.200.128.35 -p 1-1024</code>指定端口范围</p><h2 id="4-5使用nc扫描端口"><a href="#4-5使用nc扫描端口" class="headerlink" title="4.5使用nc扫描端口"></a>4.5使用nc扫描端口</h2><p><code>nc -nv -w 1 -z 192.168.1.1 1-100</code></p><ol><li>实现任意TCP/UDP端口的监听，nc可以作为server以TCP或UDP方式监听指定端口。</li><li>端口的扫描，nc可以作为client发起TCOP或UDP连接。</li><li>机器之间传输文件。</li><li>机器之间网络测速</li></ol><p>nc参数：</p><p>-nv 表示扫描的目标是个IP地址不做域名解析</p><p>-w 表示超时时间，超过时间则不再扫描</p><p>-z 表示进行端口扫描</p><h2 id="4-6-Scapy定制ARP和ICMP协议数据包"><a href="#4-6-Scapy定制ARP和ICMP协议数据包" class="headerlink" title="4.6 Scapy定制ARP和ICMP协议数据包"></a>4.6 Scapy定制ARP和ICMP协议数据包</h2><p>伪装网络报文</p><p><code>scapy</code>如果报错弹出：<code>Wont be able to plot</code></p><p><code>apt install python-matplotlib</code></p><p><code>exti()</code>//退出Scapy</p><p><code>ARP().display()</code>//列出arp相关参数</p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kali Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flutter学习记录</title>
      <link href="/2020/02/15/Flutter%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
      <url>/2020/02/15/Flutter%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h1 id="1：Flutter介绍"><a href="#1：Flutter介绍" class="headerlink" title="1：Flutter介绍"></a>1：Flutter介绍</h1><ul><li><p>市面上有很多混合开发框架，比如ReactNative、lonic，但都是针对前端开发。</p></li><li><p>Flutter针对全部开发者的混合框架。</p></li><li><p>需要Dart语言基础。</p></li></ul><h1 id="2：Flutter目录结构、入口、自定义Widget、Center等组件"><a href="#2：Flutter目录结构、入口、自定义Widget、Center等组件" class="headerlink" title="2：Flutter目录结构、入口、自定义Widget、Center等组件"></a>2：Flutter目录结构、入口、自定义Widget、Center等组件</h1><ul><li><p>目录：ios，android，build，lib，text，pubspec.yaml（配置依赖），main.dart</p></li><li><p>入口文件、方法：再main.dart中</p></li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main()&#123;</span><br><span class="line">    runApp(<span class="keyword">new</span> MyApp())<span class="comment">//new 再Dart中可以省略</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//void main()=&gt;runApp(MyApp());</span></span><br><span class="line"><span class="comment">//自定义组件</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span></span>&#123;</span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    Widget build(BuildContext context)&#123;</span><br><span class="line">        <span class="keyword">return</span> MaterialApp(</span><br><span class="line">        home:Scaffold(</span><br><span class="line">        appBar:AppBar(</span><br><span class="line">                title:Text(<span class="string">&#x27;Flutter Demo&#x27;</span>)</span><br><span class="line">                ),</span><br><span class="line">                body:HomeContent(),</span><br><span class="line">        ),</span><br><span class="line">            theme:ThemeData(</span><br><span class="line">            primarySwatch:Colors.blue</span><br><span class="line">            ),</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeContent</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span></span>&#123;</span><br><span class="line">    <span class="meta">@override</span></span><br><span class="line">    Widget build(BuildContext context)&#123;</span><br><span class="line">        <span class="keyword">return</span> Center(<span class="comment">//内容居中的LinearLayout</span></span><br><span class="line">    child:Text(</span><br><span class="line">            <span class="string">&#x27;Hello Flutter&#x27;</span>，</span><br><span class="line">            textDirection:TextDirection.ltr,<span class="comment">//文字方向从左到右</span></span><br><span class="line">                style:TextStyle(</span><br><span class="line">                fontSize:<span class="number">40.0</span>,</span><br><span class="line">                    color:Colors.yellow,</span><br><span class="line">                    <span class="comment">//color:Color.formRGBO(244,233,121,0.5),</span></span><br><span class="line">                ),</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="3：Container组件、Text组件"><a href="#3：Container组件、Text组件" class="headerlink" title="3：Container组件、Text组件"></a>3：Container组件、Text组件</h1><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() =&gt; runApp(MyApp());</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="comment">// This widget is the root of your application.</span></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="keyword">return</span> MaterialApp(</span><br><span class="line">      home:Scaffold(</span><br><span class="line">        appBar: AppBar(</span><br><span class="line">          title: Text(<span class="string">&quot;flutter demo&quot;</span>),</span><br><span class="line">        ),</span><br><span class="line">        body: HomeContent(),</span><br><span class="line">      )</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeContent</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span></span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement build</span></span><br><span class="line">    <span class="keyword">return</span> Center(</span><br><span class="line">      child: Container(</span><br><span class="line">        child: Text(<span class="string">&#x27;各位同学大家好，我是珠江老师阿发是否你好吗&#x27;</span>,</span><br><span class="line">        textAlign: TextAlign.left,</span><br><span class="line">        style: TextStyle(</span><br><span class="line">          fontSize: <span class="number">16</span>,</span><br><span class="line">          color: Colors.red,</span><br><span class="line">          fontWeight: FontWeight.w800,<span class="comment">//加粗</span></span><br><span class="line">          fontStyle: FontStyle.italic,<span class="comment">//斜线</span></span><br><span class="line">          decoration: TextDecoration.lineThrough,</span><br><span class="line">          decorationColor: Colors.white,</span><br><span class="line">          decorationStyle: TextDecorationStyle.dashed,</span><br><span class="line">          letterSpacing: <span class="number">5</span></span><br><span class="line">        ),</span><br><span class="line">        overflow: TextOverflow.ellipsis,</span><br><span class="line">        maxLines: <span class="number">2</span>,</span><br><span class="line">        textScaleFactor: <span class="number">1.2</span>,<span class="comment">//size scale 2 times</span></span><br><span class="line">        ),</span><br><span class="line">        height: <span class="number">300</span>,</span><br><span class="line">        width: <span class="number">300</span>,</span><br><span class="line">        decoration: BoxDecoration(</span><br><span class="line">          color: Colors.yellow,</span><br><span class="line">          border: Border.all(</span><br><span class="line">            color: Colors.blue,</span><br><span class="line">            width: <span class="number">2</span></span><br><span class="line">          ),</span><br><span class="line">          borderRadius: BorderRadius.all(</span><br><span class="line">            Radius.circular(<span class="number">20</span>)</span><br><span class="line">          )</span><br><span class="line">        ),</span><br><span class="line">        padding: EdgeInsets.all(<span class="number">10</span>),</span><br><span class="line">        margin: EdgeInsets.all(<span class="number">10</span>),</span><br><span class="line">        <span class="comment">//transform: Matrix4.translationValues(100, 0, 0),</span></span><br><span class="line">        transform: Matrix4.rotationZ(<span class="number">0.3</span>),</span><br><span class="line">        alignment: Alignment.bottomLeft,</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="4：图片组件Image、本地图片、远程图片、图片裁剪"><a href="#4：图片组件Image、本地图片、远程图片、图片裁剪" class="headerlink" title="4：图片组件Image、本地图片、远程图片、图片裁剪"></a>4：图片组件Image、本地图片、远程图片、图片裁剪</h1><h2 id="4-1-网络图片和样式"><a href="#4-1-网络图片和样式" class="headerlink" title="4.1 网络图片和样式"></a>4.1 网络图片和样式</h2><ul><li>网络图片：</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeContent</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span></span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement build</span></span><br><span class="line">    <span class="keyword">return</span> Center(</span><br><span class="line">      child: Container(</span><br><span class="line">        child: Image.network(<span class="string">&quot;https://i0.hdslb.com/bfs/archive/9377fda78c8a873085bd133e4fc54699ab56746d.jpg@336w_190h.webp&quot;</span>,</span><br><span class="line">          alignment: Alignment.center,</span><br><span class="line">          <span class="comment">//color: Colors.yellow,</span></span><br><span class="line">          <span class="comment">//colorBlendMode: BlendMode.screen,</span></span><br><span class="line">          fit: BoxFit.cover,<span class="comment">//cover：拉伸剪切，但不变形。最常用</span></span><br><span class="line">          <span class="comment">//repeat: ImageRepeat.repeatX,//X轴平铺</span></span><br><span class="line">        ),</span><br><span class="line">        width: <span class="number">300</span>,</span><br><span class="line">        height: <span class="number">300</span>,</span><br><span class="line">        decoration: BoxDecoration(</span><br><span class="line">          color: Colors.lightBlue</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><ul><li>容器装饰图片</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeContent</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span></span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement build</span></span><br><span class="line">    <span class="keyword">return</span> Center(</span><br><span class="line">      child: Container(</span><br><span class="line">        width: <span class="number">300</span>,</span><br><span class="line">        height: <span class="number">300</span>,</span><br><span class="line">        decoration: BoxDecoration(</span><br><span class="line">          color: Colors.lightBlue,</span><br><span class="line">          borderRadius: BorderRadius.circular(<span class="number">150</span>),</span><br><span class="line">          image: DecorationImage(</span><br><span class="line">            image: NetworkImage(<span class="string">&quot;https://i0.hdslb.com/bfs/archive/b13bfd82fdea672001554eca19c6bf7135e2f692.jpg@336w_190h.webp&quot;</span>),</span><br><span class="line">            fit: BoxFit.cover</span><br><span class="line">          )</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><ul><li>ClipOval</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeContent</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span></span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement build</span></span><br><span class="line">    <span class="keyword">return</span> Center(</span><br><span class="line">      child: Container(</span><br><span class="line">        child: ClipOval(</span><br><span class="line">          child: Image.network(<span class="string">&quot;https://i0.hdslb.com/bfs/archive/b13bfd82fdea672001554eca19c6bf7135e2f692.jpg@336w_190h.webp&quot;</span>,</span><br><span class="line">            height: <span class="number">100</span>,</span><br><span class="line">            width: <span class="number">100</span>,</span><br><span class="line">            fit: BoxFit.cover,</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-2-引入本地图片"><a href="#4-2-引入本地图片" class="headerlink" title="4.2 引入本地图片"></a>4.2 引入本地图片</h2><ol><li>在项目根目录下新建文件夹images</li></ol><ul><li>build</li><li>images<ul><li>2.0x</li><li>3.0x</li><li>4.0x</li></ul></li></ul><ol start="2"><li>在文件夹里放入图片，会根据屏幕分辨率配置不同图片</li><li>在pubspec.yaml中配置</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">assets:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">images/2.0x/a.jpeg</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">images/3.0x/a.jpeg</span></span><br></pre></td></tr></table></figure><ol start="4"><li>在代码中使用</li></ol><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeContent</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span></span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement build</span></span><br><span class="line">    <span class="keyword">return</span> Center(</span><br><span class="line">      child: Container(</span><br><span class="line">        child: Image.asset(<span class="string">&#x27;images/a.jpeg&#x27;</span>),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h1 id="5：ListView组件"><a href="#5：ListView组件" class="headerlink" title="5：ListView组件"></a>5：ListView组件</h1><h2 id="5-1-基本列表"><a href="#5-1-基本列表" class="headerlink" title="5.1 基本列表"></a>5.1 基本列表</h2><ul><li>垂直列表 ListTile组件</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeContent</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span></span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement build</span></span><br><span class="line">    <span class="keyword">return</span> ListView(</span><br><span class="line">      padding: EdgeInsets.all(<span class="number">10</span>),</span><br><span class="line">      children: &lt;Widget&gt;[</span><br><span class="line">        ListTile(</span><br><span class="line">          leading: Icon(Icons.settings,color: Colors.red,),<span class="comment">//前置图标</span></span><br><span class="line">          title: Text(<span class="string">&quot;1你好列表组件&quot;</span>,style: TextStyle(</span><br><span class="line">            fontSize: <span class="number">24</span></span><br><span class="line">          ),),</span><br><span class="line">          subtitle: Text(<span class="string">&quot;1你好我是二级标题&quot;</span>),</span><br><span class="line">        ),</span><br><span class="line">        ListTile(</span><br><span class="line">          title: Text(<span class="string">&quot;1你好列表组件&quot;</span>),</span><br><span class="line">          subtitle: Text(<span class="string">&quot;1你好我是二级标题&quot;</span>),</span><br><span class="line">          trailing: Icon(Icons.home,size: <span class="number">30</span>,),<span class="comment">//后置图标</span></span><br><span class="line">        ),</span><br><span class="line">        ListTile(</span><br><span class="line">          leading: Image.network(<span class="string">&quot;https://i0.hdslb.com/bfs/sycp/creative_img/202002/849753c8234f501092c0b8ae6af5b679.jpg&quot;</span>),</span><br><span class="line">          title: Text(<span class="string">&quot;你好列表组件&quot;</span>),</span><br><span class="line">          subtitle: Text(<span class="string">&quot;你好我是二级标题&quot;</span>),</span><br><span class="line">        ),</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>垂直图文列表</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeContent</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span></span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement build</span></span><br><span class="line">    <span class="keyword">return</span> ListView(</span><br><span class="line">      padding: EdgeInsets.all(<span class="number">10</span>),</span><br><span class="line">      children: &lt;Widget&gt;[</span><br><span class="line">        Image.network(<span class="string">&quot;https://i0.hdslb.com/bfs/sycp/creative_img/202002/849753c8234f501092c0b8ae6af5b679.jpg&quot;</span>),</span><br><span class="line">        Container(</span><br><span class="line">          child: Text(<span class="string">&quot;i am title&quot;</span>,textAlign: TextAlign.center,style: TextStyle(fontSize: <span class="number">18</span>),),</span><br><span class="line">          height: <span class="number">40</span>,</span><br><span class="line">          padding: EdgeInsets.fromLTRB(<span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">10</span>),</span><br><span class="line">        ),</span><br><span class="line">        Image.network(<span class="string">&quot;https://i0.hdslb.com/bfs/sycp/creative_img/202002/849753c8234f501092c0b8ae6af5b679.jpg&quot;</span>),</span><br><span class="line">        Container(</span><br><span class="line">          child: Text(<span class="string">&quot;i am title&quot;</span>,textAlign: TextAlign.center,style: TextStyle(fontSize: <span class="number">18</span>),),</span><br><span class="line">          height: <span class="number">40</span>,</span><br><span class="line">          padding: EdgeInsets.fromLTRB(<span class="number">0</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">10</span>),</span><br><span class="line">        ),</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>水平列表</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeContent</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span></span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement build</span></span><br><span class="line">    <span class="keyword">return</span> Container(</span><br><span class="line">      height: <span class="number">180</span>,</span><br><span class="line">      child: ListView(</span><br><span class="line">        padding: EdgeInsets.all(<span class="number">10</span>),</span><br><span class="line">        scrollDirection: Axis.horizontal,</span><br><span class="line">        children: &lt;Widget&gt;[</span><br><span class="line">          Container(</span><br><span class="line">            width: <span class="number">180</span>,</span><br><span class="line">            height: <span class="number">180</span>,</span><br><span class="line">            color: Colors.red,</span><br><span class="line">          ),</span><br><span class="line">          Container(</span><br><span class="line">            width: <span class="number">180</span>,</span><br><span class="line">            height: <span class="number">180</span>,</span><br><span class="line">            color: Colors.orange,</span><br><span class="line">            child: ListView(</span><br><span class="line">              children: &lt;Widget&gt;[</span><br><span class="line">                Image.network(<span class="string">&quot;https://i0.hdslb.com/bfs/sycp/creative_img/202002/849753c8234f501092c0b8ae6af5b679.jpg&quot;</span>),</span><br><span class="line">                Text(<span class="string">&quot;i am text&quot;</span>)</span><br><span class="line">              ],</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">          Container(</span><br><span class="line">            width: <span class="number">180</span>,</span><br><span class="line">            height: <span class="number">180</span>,</span><br><span class="line">            color: Colors.blue,</span><br><span class="line">          ),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>scrollDirection</strong></p><h2 id="5-2-ListView列表组件、动态列表"><a href="#5-2-ListView列表组件、动态列表" class="headerlink" title="5.2 ListView列表组件、动态列表"></a>5.2 ListView列表组件、动态列表</h2><ul><li>展示一个列表中的数据</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeContent</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span></span>&#123;</span><br><span class="line">  <span class="comment">//自定义方法</span></span><br><span class="line">  <span class="built_in">List</span>&lt;Widget&gt; _getData()&#123;</span><br><span class="line">    <span class="built_in">List</span>&lt;Widget&gt; list=<span class="keyword">new</span> <span class="built_in">List</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">20</span>;i++)&#123;</span><br><span class="line">      list.add(ListTile(</span><br><span class="line">        title: Text(<span class="string">&quot;iam <span class="subst">$i</span> list&quot;</span>),</span><br><span class="line">      ));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement build</span></span><br><span class="line">    <span class="keyword">return</span> ListView(</span><br><span class="line">      children: _getData()</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ListView.builder</li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeContent</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">List</span> list=<span class="keyword">new</span> <span class="built_in">List</span>();</span><br><span class="line">  HomeContent()&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">20</span>;i++) &#123;</span><br><span class="line">      list.add(ListTile(</span><br><span class="line">        title: Text(<span class="string">&quot;iam <span class="subst">$i</span> list&quot;</span>),</span><br><span class="line">      ));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement build</span></span><br><span class="line">    <span class="keyword">return</span> ListView.builder(</span><br><span class="line">        itemCount: <span class="keyword">this</span>.list.length,</span><br><span class="line">        itemBuilder: (context,index)&#123;</span><br><span class="line">          <span class="keyword">return</span> ListTile(</span><br><span class="line">            title: Text(<span class="keyword">this</span>.list[index]),</span><br><span class="line">          );</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Flutter </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue、Vuejs学习记录</title>
      <link href="/2020/02/15/Vue%E3%80%81Vuejs%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
      <url>/2020/02/15/Vue%E3%80%81Vuejs%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h1 id="0：ES6补充"><a href="#0：ES6补充" class="headerlink" title="0：ES6补充"></a>0：ES6补充</h1><h2 id="0-1-块级作用域"><a href="#0-1-块级作用域" class="headerlink" title="0.1 块级作用域"></a>0.1 块级作用域</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="comment">//变量作用域：变量在什么范围内可用</span></span></span><br><span class="line">    &#123;</span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> name = <span class="string">&#x27;why&#x27;</span>;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(name);</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(name);<span class="comment">//在大括号外也能打开。</span></span></span><br><span class="line">    </span><br><span class="line"><span class="javascript">    <span class="comment">//没有块级作用域会导致什么问题</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> btns = <span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;button&#x27;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i&lt;btns.length;i++)&#123;</span></span><br><span class="line"><span class="javascript">        btns[i].addEventListener(<span class="string">&#x27;click&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&#x27;第&#x27;</span>+i+<span class="string">&#x27;个按钮被点击&#x27;</span>)</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    <span class="comment">//显示的按钮被点击不准确。使用闭包解决此问题    </span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i&lt;btns.length;i++)&#123;</span></span><br><span class="line"><span class="javascript">        (<span class="function"><span class="keyword">function</span>(<span class="params">num</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            btns[num].addEventListener(<span class="string">&#x27;click&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&#x27;第&#x27;</span>+num+<span class="string">&#x27;个按钮被点击&#x27;</span>)</span></span><br><span class="line">        &#125;)</span><br><span class="line">        &#125;)(i)</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="1：Vue初体验"><a href="#1：Vue初体验" class="headerlink" title="1：Vue初体验"></a>1：Vue初体验</h1><h2 id="1-1-认识Vuejs"><a href="#1-1-认识Vuejs" class="headerlink" title="1.1 认识Vuejs"></a>1.1 认识Vuejs</h2><p>作为时下流行的前端框架，Vuejs是很多中小型企业开发项目的首选框架。</p><ul><li><p>Vue是一个渐进式的框架。</p><ul><li>渐进式意味着可以将Vue作为应用的一部分嵌入进去，带来更丰富的交互体验。</li></ul></li><li><p>Vue特点和Web开发中的高级功能</p><ul><li>解耦视图和数据</li><li>可复用的组件</li><li>前端路由</li><li>状态管理</li><li>虚拟DOM</li></ul></li><li><p>学习前提</p><ul><li>不需要Angular、React、jQuery</li><li>需要HTML、CSS、JavaScript基础</li></ul></li></ul><h2 id="1-2-Vue-js安装"><a href="#1-2-Vue-js安装" class="headerlink" title="1.2 Vue.js安装"></a>1.2 Vue.js安装</h2><p>方式一：直接CDN引入</p><p>方式二：下载和引入</p><ul><li><p>安装教程 <a href="https://cn.vuejs.org/">https://cn.vuejs.org</a></p></li><li><p>开发环境 <a href="https://vuejs.org/js/vue.js">https://vuejs.org/js/vue.js</a></p></li><li><p>生产环境 <a href="https://vuejs.org/js/vue.min.js">https://vuejs.org/js/vue.min.js</a></p></li></ul><p>方式三：NPM安装</p><ul><li>通过webpack和CLI</li></ul><h2 id="1-3-Hello-Vuejs"><a href="#1-3-Hello-Vuejs" class="headerlink" title="1.3 Hello Vuejs"></a>1.3 Hello Vuejs</h2><p>Vue的响应式</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">            &#123;&#123;name&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        &#123;&#123;message&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="comment">//let(变量)/const(常量)</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//编程范式：声明式编程</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">            el:<span class="string">&#x27;#app&#x27;</span>,<span class="comment">//用于挂在要管理的元素</span></span></span><br><span class="line"><span class="javascript">            data:&#123;<span class="comment">//定义数据</span></span></span><br><span class="line"><span class="javascript">                message:<span class="string">&#x27;你好啊！&#x27;</span>,<span class="comment">//在div中显示message内容</span></span></span><br><span class="line"><span class="javascript">                name:<span class="string">&#x27;coderwhy&#x27;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)        </span><br><span class="line"></span><br><span class="line"><span class="javascript">        <span class="comment">//原始js的做法（编程范式：命令式编程）</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//1.创建div元素，设置id属性</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//2.定义一个变量叫message</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//3.将message变量放在div元素中显示</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//4.修改messge的数据</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//5.将修改后的数据替换到div元素</span></span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span>   </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-4-Vue列表显示"><a href="#1-4-Vue列表显示" class="headerlink" title="1.4 Vue列表显示"></a>1.4 Vue列表显示</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;item in movies&quot;</span>&gt;</span>&#123;&#123;item&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">            el:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">            data:&#123;</span><br><span class="line"><span class="javascript">                message:<span class="string">&#x27;你好啊&#x27;</span>，</span></span><br><span class="line"><span class="javascript">                movies:[<span class="string">&#x27;海王&#x27;</span>,<span class="string">&#x27;大话西游&#x27;</span>,<span class="string">&#x27;星际穿越&#x27;</span>,<span class="string">&#x27;少年派&#x27;</span>]</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>app.movies.push(&#39;盗梦空间&#39;)//添加数据</code></p><ul><li>使用v-for指令遍历数组元素</li></ul><p><strong>案例展示：计数器</strong></p><script src="/js/vue.min.js"></script><div id="app">    当前计数：0</br>        <button v-on:click="counter++">+</button>        <button v-on:click="counter--">-</button></div><script>        //语法糖：简写        const app = new Vue({            el:'#app',            data:{                counter:0            }        })</script><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">            当前计数：&#123;&#123;counter&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;button v-on:click=&quot;counter++&quot;&gt;+&lt;/button&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;button v-on:click=&quot;counter--&quot;&gt;-&lt;/button&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;add&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;min&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//语法糖：简写</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">            el:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">            data:&#123;</span><br><span class="line">                counter:0</span><br><span class="line">            &#125;,</span><br><span class="line">            methods:&#123;</span><br><span class="line"><span class="javascript">                add:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(<span class="string">&#x27;add被执行&#x27;</span>)；</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">this</span>.counter++;</span></span><br><span class="line">                &#125;,</span><br><span class="line"><span class="javascript">                min:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&#x27;min被执行&#x27;</span>)；</span></span><br><span class="line"><span class="javascript"><span class="built_in">this</span>.counter--;</span></span><br><span class="line">        &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line"><span class="javascript">        <span class="comment">//原始js</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//1.拿buttom元素</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//2.添加监听时间</span></span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>新属性：methods，该属性用于Vue对象中定义方法。</p></li><li><p>新指令：@click，该指令用于监听某个元素的点击事件。</p></li></ul><h2 id="1-5-Vue中的MVVM"><a href="#1-5-Vue中的MVVM" class="headerlink" title="1.5 Vue中的MVVM"></a>1.5 Vue中的MVVM</h2><p>什么是MVVM？</p><ul><li>Model View ViewModel</li></ul><h2 id="1-6-创建Vue实例传入的options"><a href="#1-6-创建Vue实例传入的options" class="headerlink" title="1.6 创建Vue实例传入的options"></a>1.6 创建Vue实例传入的options</h2><p>目前掌握的选项</p><ul><li><p>el：</p><ul><li>字符型String|HTMLElement</li><li>决定Vue管理哪一个DOM</li></ul></li><li><p>data：</p><ul><li>Object|Funtion()<strong>（组件当中必须是一个函数）</strong></li><li>Vue实例对应的数据对象。</li></ul></li><li><p>methods：</p><ul><li>{[key:string] Function}</li><li>定义属于Vue的一些方法，可以在其他地方调用，也可以在指令中使用</li></ul></li></ul><h2 id="1-7-Vue的生命周期"><a href="#1-7-Vue的生命周期" class="headerlink" title="1.7 Vue的生命周期"></a>1.7 Vue的生命周期</h2><p>生命周期：事物从诞生到消亡的整个过程</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data:obj,</span><br><span class="line">        methods:&#123;&#125;,</span><br><span class="line"><span class="javascript">        created:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</span></span><br><span class="line"><span class="javascript">        mounted:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span></span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="1-8-Vue的生命周期函数"><a href="#1-8-Vue的生命周期函数" class="headerlink" title="1.8 Vue的生命周期函数"></a>1.8 Vue的生命周期函数</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data:obj,</span><br><span class="line">        methods:&#123;&#125;,</span><br><span class="line"><span class="javascript">        beforeCreate:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,<span class="comment">//Hook:钩子函数</span></span></span><br><span class="line"><span class="javascript">        created:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,</span></span><br><span class="line"><span class="javascript">        mounted:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;</span></span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>生命周期函数：</strong><code>beforeCreate,create,beforeMounte,mounted,beforeUpdate,updated,beforDestroy,destroyed</code></p><h1 id="2：插值的操作"><a href="#2：插值的操作" class="headerlink" title="2：插值的操作"></a>2：插值的操作</h1><h2 id="2-1-Mustache语法，插值的操作"><a href="#2-1-Mustache语法，插值的操作" class="headerlink" title="2.1 Mustache语法，插值的操作"></a>2.1 Mustache语法，插值的操作</h2><p>Mustache语法：双大括号//mustache胡须</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">        &#123;&#123;message&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">        &#123;&#123;firstName+&#x27; &#x27;+lastName&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">        &#123;&#123;firstName&#125;&#125; &#123;&#123;lastName&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;counter*2&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line"><span class="javascript">            message:<span class="string">&#x27;nihao&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            firstName:<span class="string">&#x27;kobe&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            lastName:<span class="string">&#x27;bryant&#x27;</span>,</span></span><br><span class="line">            counter:100</span><br><span class="line">        &#125;,</span><br><span class="line">        </span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>mustache语法不仅可以直接写变量，还可以写语法。</p><h2 id="2-2-插值操作–其他指令使用"><a href="#2-2-插值操作–其他指令使用" class="headerlink" title="2.2 插值操作–其他指令使用"></a>2.2 插值操作–其他指令使用</h2><ul><li><strong>v-once</strong>: 不想改变DOM值，使DOM变成非响应式。</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-once</span>&gt;</span></span><br><span class="line">    &#123;&#123;message&#125;&#125;<span class="comment">&lt;!--message不会随数据更新而改变--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><strong>v-html</strong>:直接展示html代码，而不是展示其字符串</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-html</span>=<span class="string">&quot;url&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">            el:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">            data:&#123;</span><br><span class="line"><span class="handlebars"><span class="xml">                url=&#x27;<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.baidu.com&quot;</span>&gt;</span>百度一下<span class="tag">&lt;/<span class="name">a</span>&gt;</span>&#x27;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>输出结果：<a href="https://www.baidu.com/">百度一下</a></p><ul><li><strong>v-text</strong>：和作用相同，但会覆盖<code>&lt;h2&gt;</code>代码块中的字符会被覆盖掉，不灵活。</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-text</span>=<span class="string">&quot;message&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">            el:<span class="string">&#x27;#app&#x27;</span>,<span class="comment">//用于挂在要管理的元素</span></span></span><br><span class="line"><span class="javascript">            data:&#123;<span class="comment">//定义数据</span></span></span><br><span class="line"><span class="javascript">                message:<span class="string">&#x27;你好啊！&#x27;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span>   </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><strong>v-pre</strong>：将例如大括号显示出来，不渲染数据</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-pre</span>&gt;</span></span><br><span class="line">    &#123;&#123;message&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br></pre></td></tr></table></figure><p>输出结果：</p><ul><li><strong>v-cloak</strong>：当js延迟加载出来时，不显示dom渲染之前的值。不会在渲染之前出现//cloak斗篷</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--&lt;head&gt;</span></span><br><span class="line"><span class="comment">    &lt;style&gt;</span></span><br><span class="line"><span class="comment">        [v-cloak]&#123;</span></span><br><span class="line"><span class="comment">            display:none;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">    &lt;/style&gt;</span></span><br><span class="line"><span class="comment">&lt;/head&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span> <span class="attr">v-cloak</span>&gt;</span></span><br><span class="line">    &#123;&#123;message&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="3：动态绑定属性"><a href="#3：动态绑定属性" class="headerlink" title="3：动态绑定属性"></a>3：动态绑定属性</h1><h2 id="3-1-v-bind，动态绑定DOM属性"><a href="#3-1-v-bind，动态绑定DOM属性" class="headerlink" title="3.1 v-bind，动态绑定DOM属性"></a>3.1 v-bind，动态绑定DOM属性</h2><ul><li>v-bind的基本使用</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">v-bind:src</span>=<span class="string">&quot;imgURL&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">v-bind:href</span>=<span class="string">&quot;aHref&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!--语法糖的写法--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;imgURL&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">:href</span>=<span class="string">&quot;aHref&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../js/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">            el:<span class="string">&#x27;#app&#x27;</span>,<span class="comment">//用于挂在要管理的元素</span></span></span><br><span class="line">            data:&#123;</span><br><span class="line"><span class="javascript">                aHref=<span class="string">&quot;https://www.baidu.com&quot;</span>,</span></span><br><span class="line"><span class="javascript">imgURL:<span class="string">&#x27;https://i0.hdslb.com/bfs/sycp/creative_img/202002/1e9bfa663a93374c8e10c3933cfc78f8.jpg&#x27;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span>   </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>v-bind简写/语法糖：<code>:</code></li><li>v-bind对象用法：</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;&#123;class1:isClass1,class2:isClass2&#125;&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line">        data:&#123;</span><br><span class="line"><span class="javascript">            message:<span class="string">&quot;showClassExample&quot;</span></span></span><br><span class="line"><span class="javascript">            isClass1:<span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">            isClass2:<span class="literal">false</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>//title类固定，动态更改class1和class2</strong></p><p><code>&#123;类名:布尔值,类名：布尔值&#125;</code></p><ul><li>v-bind数组语法</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;getClasses()&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line">        data:&#123;</span><br><span class="line"><span class="javascript">            message:<span class="string">&quot;showClassExample&quot;</span>,</span></span><br><span class="line"><span class="javascript">            isClass1:<span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">            isClass2:<span class="literal">false</span></span></span><br><span class="line">        &#125;</span><br><span class="line">        methods:&#123;</span><br><span class="line"><span class="javascript">        getClasses:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span>&#123;<span class="attr">class1</span>:<span class="built_in">this</span>.isClass1,<span class="attr">class2</span>:<span class="built_in">this</span>.isClass2&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>注意：v-on中函数省略了()，但v-bind需要添加()</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;[class1,class2]&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line">        data:&#123;</span><br><span class="line"><span class="javascript">            message:<span class="string">&quot;showClassExample&quot;</span>,</span></span><br><span class="line"><span class="javascript">            class1:<span class="string">&#x27;class1&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            class2:<span class="string">&#x27;class2&#x27;</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="3-2-作业，结合v-for和v-bind"><a href="#3-2-作业，结合v-for和v-bind" class="headerlink" title="3.2 作业，结合v-for和v-bind"></a>3.2 作业，结合v-for和v-bind</h2><p>作业：使用v-for显示一个电影名称列表，设置监听点击事件，当某个电影被点击，改变此电影名称字体颜色为红色。</p><p>答案：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">        <span class="selector-class">.red</span>&#123;<span class="attribute">color</span>:red&#125;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(m, index) in movies&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;clickItem=index&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;&#123;red:clickItem==index&#125;&quot;</span>&gt;</span>&#123;&#123;m&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">            el:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">            data: &#123;</span><br><span class="line"><span class="javascript">                movies: [<span class="string">&#x27;复仇者联盟&#x27;</span>, <span class="string">&#x27;生化危机&#x27;</span>, <span class="string">&#x27;星际大战&#x27;</span>, <span class="string">&#x27;钢铁侠&#x27;</span>],</span></span><br><span class="line">                clickItem:99,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="3-3-v-bind动态绑定样式"><a href="#3-3-v-bind动态绑定样式" class="headerlink" title="3.3 v-bind动态绑定样式"></a>3.3 v-bind动态绑定样式</h2><ul><li>样式的对象用法</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span> <span class="attr">:style</span>=<span class="string">&quot;&#123;fontSize:&#x27;50px&#x27;,color:finalColor&#125;&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123;message&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line">        data:&#123;</span><br><span class="line"><span class="javascript">            message:<span class="string">&#x27;abc&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        finalColor:<span class="string">&#x27;red&#x27;</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>注意：{fontSize:50px}为错误表达，50px会被解析为一个变量，50px必须加单引号</p></blockquote><ul><li>样式的数组用法</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span> <span class="attr">:style</span>=<span class="string">&quot;[style1,style2]&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123;message&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line"><span class="javascript">            message:<span class="string">&#x27;abc&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        style1:&#123;<span class="attr">fontSize</span>:<span class="string">&#x27;100px&#x27;</span>&#125;,</span></span><br><span class="line"><span class="javascript">            style2:&#123;<span class="attr">color</span>:<span class="string">&#x27;red&#x27;</span>&#125;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="4：计算属性"><a href="#4：计算属性" class="headerlink" title="4：计算属性"></a>4：计算属性</h1><h2 id="4-1-计算属性的基本用法"><a href="#4-1-计算属性的基本用法" class="headerlink" title="4.1 计算属性的基本用法"></a>4.1 计算属性的基本用法</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">        &#123;&#123;firstName+&quot; &quot;+lastName&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">        &#123;&#123;getFullName()&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">        &#123;&#123;fullName&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line"><span class="javascript">        firstName:<span class="string">&#x27;Lebron&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            lastName:<span class="string">&#x27;James&#x27;</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        computed:&#123;</span><br><span class="line"><span class="javascript">            fullName:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">return</span> <span class="built_in">this</span>.fistName+<span class="string">&#x27; &#x27;</span>+<span class="built_in">this</span>.lastName;</span></span><br><span class="line">            &#125;</span><br><span class="line"><span class="javascript">        &#125;,<span class="comment">//计算属性</span></span></span><br><span class="line">        methods:&#123;</span><br><span class="line">        getFullName()&#123;</span><br><span class="line"><span class="javascript">                <span class="keyword">return</span> <span class="built_in">this</span>.fistName+<span class="string">&#x27; &#x27;</span>+<span class="built_in">this</span>.lastName;</span></span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>computed:计算属性的使用</strong></p><h2 id="4-2-计算属性的复杂使用"><a href="#4-2-计算属性的复杂使用" class="headerlink" title="4.2 计算属性的复杂使用"></a>4.2 计算属性的复杂使用</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">        总价格：&#123;&#123;totalPrice&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line">            books:&#123;</span><br><span class="line"><span class="javascript">                &#123;<span class="attr">id</span>:<span class="number">110</span>,<span class="attr">name</span>:<span class="string">&#x27;Unix编程&#x27;</span>,<span class="attr">price</span>:<span class="number">119</span>&#125;,</span></span><br><span class="line"><span class="javascript">            &#123;<span class="attr">id</span>:<span class="number">111</span>,<span class="attr">name</span>:<span class="string">&#x27;代码大全&#x27;</span>,<span class="attr">price</span>:<span class="number">89</span>&#125;,</span></span><br><span class="line"><span class="javascript">        &#123;<span class="attr">id</span>:<span class="number">112</span>,<span class="attr">name</span>:<span class="string">&#x27;现代操作系统&#x27;</span>,<span class="attr">price</span>:<span class="number">81</span>&#125;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        computed:&#123;</span><br><span class="line"><span class="javascript">            totalPrice:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;<span class="built_in">this</span>.books.length;i++)&#123;</span></span><br><span class="line"><span class="javascript">                    result += <span class="built_in">this</span>.books[i].price;</span></span><br><span class="line">                &#125;</span><br><span class="line">                /*</span><br><span class="line"><span class="javascript">                <span class="keyword">for</span>(<span class="keyword">let</span> i <span class="keyword">in</span> <span class="built_in">this</span>.books)&#123;</span></span><br><span class="line"><span class="javascript">                    result += <span class="built_in">this</span>.books[i].price;</span></span><br><span class="line">                &#125;</span><br><span class="line"><span class="javascript">                <span class="keyword">for</span>(<span class="keyword">let</span> book <span class="keyword">of</span> <span class="built_in">this</span>.books)&#123;</span></span><br><span class="line">                    result += book.price;</span><br><span class="line">                &#125;</span><br><span class="line">                */</span><br><span class="line"><span class="javascript">                <span class="keyword">return</span> result;</span></span><br><span class="line">                </span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line"><span class="javascript">        &#125;,<span class="comment">//计算属性</span></span></span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="4-3-计算属性setter和getter"><a href="#4-3-计算属性setter和getter" class="headerlink" title="4.3 计算属性setter和getter"></a>4.3 计算属性setter和getter</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">        &#123;&#123;fullName&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line"><span class="javascript">            firstName:<span class="string">&#x27;Kobe&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            lastName:<span class="string">&#x27;Bryant&#x27;</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        computed:&#123;</span><br><span class="line">            /*</span><br><span class="line"><span class="javascript">            fullName:&#123;<span class="comment">//fullName为一个对象</span></span></span><br><span class="line"><span class="javascript">                <span class="comment">//一般属性没有set方法，为只读属性</span></span></span><br><span class="line"><span class="javascript">                set:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,<span class="comment">//通过控制板，app.fullName=&#x27;ABC&#x27;会调用此方法</span></span></span><br><span class="line"><span class="javascript">                get:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">return</span> <span class="built_in">this</span>.firstName+<span class="string">&#x27; &#x27;</span>+<span class="built_in">this</span>.lastName;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            */</span><br><span class="line"><span class="javascript">            <span class="comment">//上述方法简写为</span></span></span><br><span class="line"><span class="javascript">            fullName:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="built_in">this</span>.firstName+<span class="string">&#x27; &#x27;</span>+<span class="built_in">this</span>.lastName; </span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">        &#125;,<span class="comment">//计算属性</span></span></span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="4-4-计算属性和methods对比"><a href="#4-4-计算属性和methods对比" class="headerlink" title="4.4 计算属性和methods对比"></a>4.4 计算属性和methods对比</h2><p>方法每次调用，程序都会重复执行；计算属性第一次计算出来，结果就保存在内存中。下次再调用，程序不会重复执行。</p><blockquote><p>需要多次调用的计算结果，采用计算属性性能会更低。</p></blockquote><h2 id="4-5-跑马灯项目"><a href="#4-5-跑马灯项目" class="headerlink" title="4.5 跑马灯项目"></a>4.5 跑马灯项目</h2><p>一句文字实现，点击按钮，文字滚动播放，再点击文字停止滚动。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;lang&quot;</span>&gt;</span>浪起来<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;di&quot;</span>&gt;</span>低调<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h4</span>&gt;</span>&#123;&#123;msg&#125;&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//语法糖：简写</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">            el:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">            data: &#123;</span><br><span class="line"><span class="javascript">                msg:<span class="string">&#x27;猥琐发育。别浪~~！&#x27;</span>,</span></span><br><span class="line"><span class="javascript">                intervalId:<span class="literal">null</span></span></span><br><span class="line">            &#125;,</span><br><span class="line">            methods:&#123;</span><br><span class="line">                lang()&#123;</span><br><span class="line"><span class="javascript">                    <span class="comment">//函数里的this.变量无法指向函数外部的变量</span></span></span><br><span class="line">                    /*</span><br><span class="line"><span class="javascript">                    <span class="built_in">setInterval</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">let</span> start = <span class="built_in">this</span>.msg.substring(<span class="number">0</span>,<span class="number">1</span>);<span class="comment">//获取第一个字符</span></span></span><br><span class="line"><span class="javascript">                        <span class="keyword">let</span> end = <span class="built_in">this</span>.msg.substring(<span class="number">1</span>);<span class="comment">//获取第一个字符后的所有字符</span></span></span><br><span class="line"><span class="javascript">                        <span class="built_in">this</span>.msg=end+start;<span class="comment">//将第一个字符放到最后，实现跑马灯效果</span></span></span><br><span class="line">                    &#125;,400)</span><br><span class="line">                     */</span><br><span class="line"><span class="javascript">                   <span class="comment">//使用箭头函数解决函数内部this问题</span></span></span><br><span class="line"><span class="javascript">                    <span class="keyword">if</span>(<span class="built_in">this</span>.intervalId!=<span class="literal">null</span>) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">this</span>.intervalId = <span class="built_in">setInterval</span>(<span class="function">()=&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">let</span> start = <span class="built_in">this</span>.msg.substring(<span class="number">0</span>,<span class="number">1</span>);<span class="comment">//获取第一个字符</span></span></span><br><span class="line"><span class="javascript">                        <span class="keyword">let</span> end = <span class="built_in">this</span>.msg.substring(<span class="number">1</span>);<span class="comment">//获取第一个字符后的所有字符</span></span></span><br><span class="line"><span class="javascript">                        <span class="built_in">this</span>.msg=end+start;<span class="comment">//将第一个字符放到最后，实现跑马灯效果</span></span></span><br><span class="line">                    &#125;,400)</span><br><span class="line"></span><br><span class="line">                &#125;,</span><br><span class="line">                di()&#123;</span><br><span class="line"><span class="javascript">                    <span class="built_in">clearInterval</span>(<span class="built_in">this</span>.intervalId);</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">this</span>.intervalId=<span class="literal">null</span>;<span class="comment">//清楚定时器后需要重新把internalId设为null</span></span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="5-常用指令"><a href="#5-常用指令" class="headerlink" title="5: 常用指令"></a>5: 常用指令</h1><h2 id="5-1-v-for的四种使用方式"><a href="#5-1-v-for的四种使用方式" class="headerlink" title="5.1 v-for的四种使用方式"></a>5.1 v-for的四种使用方式</h2><ul><li>循环数组</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-for</span>=<span class="string">&quot;item in list&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123;item&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in list&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123;item+&quot;-----&quot;+index&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line">            list:[1,2,3,4,5]</span><br><span class="line">        &#125;,</span><br><span class="line">        </span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>循环对象数组</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-for</span>=<span class="string">&quot;item in list&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123;item.id&#125;&#125;--&#123;&#123;item.name&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">   </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line">            list:[</span><br><span class="line"><span class="javascript">                &#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span> :<span class="string">&#x27;zs1&#x27;</span>&#125;,</span></span><br><span class="line"><span class="javascript">                &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span> :<span class="string">&#x27;zs2&#x27;</span>&#125;,</span></span><br><span class="line"><span class="javascript">                &#123;<span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span> :<span class="string">&#x27;zs3&#x27;</span>&#125;,</span></span><br><span class="line"><span class="javascript">                &#123;<span class="attr">id</span>: <span class="number">4</span>, <span class="attr">name</span> :<span class="string">&#x27;zs4&#x27;</span>&#125;,</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        </span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>循环对象</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-for</span>=<span class="string">&quot;(val,key,index) in user&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123;val&#125;&#125;--&#123;&#123;key&#125;&#125;--&#123;&#123;index&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">   </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line">            user:&#123;</span><br><span class="line">                id:1,</span><br><span class="line"><span class="javascript">                name:<span class="string">&#x27;tuoni&#x27;</span>,</span></span><br><span class="line"><span class="javascript">                gender:<span class="string">&#x27;nan&#x27;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        </span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>迭代数字</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--in后面可以使数组，对象数组，对象，还可以使数字。若为数字，count从1开始--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-for</span>=<span class="string">&quot;count in 10&quot;</span>&gt;</span></span><br><span class="line">        第&#123;&#123;count&#125;&#125;次循环</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">   </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data:&#123;&#125;,   </span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>注意：count从1开始计数</strong></p><ul><li>v-for循环中key属性的使用</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Id:</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span>Name:</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;name&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add&quot;</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-for</span>=<span class="string">&quot;item in list&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item.id&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span> = <span class="string">&quot;checkbox&quot;</span> &gt;</span></span><br><span class="line">       &#123;&#123;item.id&#125;&#125;--&#123;&#123;item.name&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">   </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line"><span class="javascript">            id:<span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line"><span class="javascript">            name:<span class="string">&#x27;&#x27;</span>,</span></span><br><span class="line">            list:[</span><br><span class="line"><span class="javascript">                &#123;<span class="attr">id</span>:<span class="number">1</span>,<span class="attr">name</span>:<span class="string">&#x27;lisi&#x27;</span>&#125;,</span></span><br><span class="line"><span class="javascript">                &#123;<span class="attr">id</span>:<span class="number">2</span>,<span class="attr">name</span>:<span class="string">&#x27;yinzheng&#x27;</span>&#125;,</span></span><br><span class="line"><span class="javascript">                &#123;<span class="attr">id</span>:<span class="number">3</span>,<span class="attr">name</span>:<span class="string">&#x27;zhaogao&#x27;</span>&#125;,</span></span><br><span class="line"><span class="javascript">                &#123;<span class="attr">id</span>:<span class="number">4</span>,<span class="attr">name</span>:<span class="string">&#x27;hanfei&#x27;</span>&#125;,</span></span><br><span class="line"><span class="javascript">                &#123;<span class="attr">id</span>:<span class="number">5</span>,<span class="attr">name</span>:<span class="string">&#x27;kongzi&#x27;</span>&#125;,</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        methods:&#123;</span><br><span class="line">            add()&#123;</span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.list.push(&#123;<span class="attr">id</span>:<span class="built_in">this</span>.id,<span class="attr">name</span>:<span class="built_in">this</span>.name&#125;);</span></span><br><span class="line"><span class="javascript">                <span class="comment">//this.list.unshift(&#123;id:this.id,name:this.name&#125;);</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="5-2-v-on指令"><a href="#5-2-v-on指令" class="headerlink" title="5.2 v-on指令"></a>5.2 v-on指令</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;show&quot;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//语法糖：简写</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">            el:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">            data:&#123;</span><br><span class="line">                counter:0</span><br><span class="line">            &#125;,</span><br><span class="line">            methods:&#123;</span><br><span class="line">                show()&#123;</span><br><span class="line"><span class="javascript">                    alert(<span class="string">&#x27;Hello&#x27;</span>);</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line"><span class="javascript">        <span class="comment">//原始js</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//1.拿buttom元素</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//2.添加监听时间</span></span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>事件修饰符<ul><li>.stop 阻止冒泡//@click.stop设置再内部DOM。不会触发@click.stop外部DOM的点击事件</li><li>.prevent 阻止默认行为//@click.prevent。比如阻止a标签跳转到href地址</li><li>.capture 添加事件倾听器实现捕获模式//给外层DOM 添加@click.capture，会先处理外部点击事件。</li><li>.self 只当自身被点击才触发事件//给外部DOM添加@click.self，只有点击外部DOM时才能触发它。也可阻止冒泡</li><li>.once 只触发一次事件处理函数。</li></ul></li></ul><p>事件修饰符可以叠加使用 @click.prevent.once先后顺序无区别。</p><h2 id="5-3-v-model"><a href="#5-3-v-model" class="headerlink" title="5.3 v-model"></a>5.3 v-model</h2><p>可以实现表单元素的model中的数据双向绑定。<strong>v-model只能用在表单元素中</strong>，input(redio, text, address, email…),select , checkbox, textarea</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;msg&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>简易计算器案例</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;n1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">v-model</span>=<span class="string">&quot;opt&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;+&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;-&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;*&quot;</span>&gt;</span>*<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;/&quot;</span>&gt;</span>/<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;n2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;calculate&quot;</span>&gt;</span>=<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;result&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line">            n1:0,</span><br><span class="line">            n2:0,</span><br><span class="line">            result:0,</span><br><span class="line"><span class="javascript">            opt:<span class="string">&#x27;+&#x27;</span></span></span><br><span class="line">        &#125;</span><br><span class="line">        methods:&#123;</span><br><span class="line">        calculate()&#123;</span><br><span class="line"><span class="javascript">        <span class="keyword">switch</span>(<span class="built_in">this</span>.opt)&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.result = <span class="built_in">parseInt</span>(<span class="built_in">this</span>.n1) + <span class="built_in">parseInt</span>(<span class="built_in">this</span>.n2);</span></span><br><span class="line"><span class="javascript">                <span class="keyword">break</span>;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">case</span> <span class="string">&#x27;-&#x27;</span>:</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.result = <span class="built_in">parseInt</span>(<span class="built_in">this</span>.n1) - <span class="built_in">parseInt</span>(<span class="built_in">this</span>.n2);</span></span><br><span class="line"><span class="javascript">                <span class="keyword">break</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.result = <span class="built_in">parseInt</span>(<span class="built_in">this</span>.n1) * <span class="built_in">parseInt</span>(<span class="built_in">this</span>.n2);</span></span><br><span class="line"><span class="javascript">                <span class="keyword">break</span>;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.result = <span class="built_in">parseInt</span>(<span class="built_in">this</span>.n1) / <span class="built_in">parseInt</span>(<span class="built_in">this</span>.n2);</span></span><br><span class="line"><span class="javascript">                <span class="keyword">break</span>;</span></span><br><span class="line"><span class="javascript">         <span class="comment">//this.result = eval(this.n1+this.opt+this.n2)</span></span></span><br><span class="line"><span class="javascript">         <span class="comment">//eval会解析字符串并执行</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="5-4-v-if和v-show的使用"><a href="#5-4-v-if和v-show的使用" class="headerlink" title="5.4 v-if和v-show的使用"></a>5.4 v-if和v-show的使用</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;flag=!flag&quot;</span>&gt;</span></span><br><span class="line">            切换</span><br><span class="line">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span> <span class="attr">v-if</span>=<span class="string">&quot;flag&quot;</span>&gt;</span></span><br><span class="line">            这是v-if控制的元素</span><br><span class="line">        <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span> <span class="attr">v-show</span>=<span class="string">&quot;flag&quot;</span>&gt;</span></span><br><span class="line">            这是v-show控制的元素</span><br><span class="line">        <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//语法糖：简写</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">            el:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">            data:&#123;</span><br><span class="line"><span class="javascript">                flag:<span class="literal">true</span></span></span><br><span class="line">            &#125;,</span><br><span class="line">            methods:&#123;</span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line"><span class="javascript">        <span class="comment">//原始js</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//1.拿buttom元素</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//2.添加监听时间</span></span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>v-if:会删除或创建元素  //v-if消耗切换性能，如果元素设计频繁的切换不要使用。</p></li><li><p>v-show：不会删除DOM，而是修改其可见属性dispaly:none //如果元素可能永远也不会显示出来，最好使用v-if</p></li></ul><h1 id="6：过滤器"><a href="#6：过滤器" class="headerlink" title="6：过滤器"></a>6：过滤器</h1><p><strong>概念</strong>：Vue.js中允许自定义过滤器，可以用作一些常见的文本格式化。过滤器可以用在两个地方：mustache插值和v-bind</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--过滤器调用格式     &#123;&#123;name | nameope&#125;&#125;--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="comment">//过滤器定义语法</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">//过滤器中的function，第一个参数，永远是过滤器管道符（|）前面传过来的参数</span></span></span><br><span class="line"><span class="javascript">Vue.filter(<span class="string">&#x27;过滤器名称&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;&#125;)</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>注意:当全局和私有过滤器，使用相同名称时，优先调用私有过滤器</strong></p><h2 id="6-1-定义全局过滤器"><a href="#6-1-定义全局过滤器" class="headerlink" title="6.1 定义全局过滤器"></a>6.1 定义全局过滤器</h2><p>全局过滤器，就是所有的vm实例都能用</p><p>过滤器的<strong>基本使用</strong></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        &#123;&#123; msg | msgFormat(&#x27;牛逼&#x27;) | test&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="comment">//定义一个Vue全局过滤器</span></span></span><br><span class="line"><span class="javascript">    Vue.filter(<span class="string">&#x27;msgFormat&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">msg, arg</span>)</span>&#123;<span class="comment">//arg是msgFormat输入的参数。第一个为参数msg为默认的插值</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> msg.replace(<span class="regexp">/傻子/g</span>,arg)<span class="comment">//正则替换，g表示全部替换</span></span></span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line"><span class="javascript">    <span class="comment">//定义多个过滤器</span></span></span><br><span class="line"><span class="javascript">    Vue.filter(<span class="string">&#x27;test&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> msg+<span class="string">&quot;这是第二个过滤器&quot;</span></span></span><br><span class="line">    &#125;)</span><br><span class="line"><span class="javascript">    <span class="comment">//语法糖：简写</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line"><span class="javascript">            msg:<span class="string">&#x27;你是真的傻子哦,人是傻子，脑袋笨&#x27;</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        methods:&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="6-2-定义私有过滤器"><a href="#6-2-定义私有过滤器" class="headerlink" title="6.2 定义私有过滤器"></a>6.2 定义私有过滤器</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        &#123;&#123; msg | msgFormat(&#x27;牛逼&#x27;) | test&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="comment">//语法糖：简写</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line"><span class="javascript">            msg:<span class="string">&#x27;你是真的傻子哦,人是傻子，脑袋笨&#x27;</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        methods:&#123;&#125;,</span><br><span class="line">        filters:&#123;</span><br><span class="line"><span class="javascript">            msgFormat:<span class="function"><span class="keyword">function</span>(<span class="params">msg, arg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">return</span> msg.replace(<span class="regexp">/傻子/g</span>,arg)<span class="comment">//正则替换，g表示全部替换</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="7：自定义"><a href="#7：自定义" class="headerlink" title="7：自定义"></a>7：自定义</h1><h2 id="7-1-自定义按键修饰符"><a href="#7-1-自定义按键修饰符" class="headerlink" title="7.1 自定义按键修饰符"></a>7.1 自定义按键修饰符</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>Name：</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;name&quot;</span> @<span class="attr">keyup.enter</span>=<span class="string">&quot;add&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>@keyup</strong>:绑定键盘</p><ol><li><p>内置修饰符.enter .tab .delete .esc .space .up .down .left .right</p></li><li><p>其他的键可使用js定义的键盘码。比如**@keyup.113**表示F12 。</p></li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span>Name：</span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;name&quot;</span> @<span class="attr">keyup.f12</span>=<span class="string">&quot;add&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="comment">//自定义全局按键修饰符</span></span></span><br><span class="line">    Vue.config.keyCode.f12 = 113</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="7-2-自定义指令"><a href="#7-2-自定义指令" class="headerlink" title="7.2 自定义指令"></a>7.2 自定义指令</h2><ol><li>定义全局指令</li></ol><p>比如自定一个指令v-focus</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="comment">//使用Vue.directive()定义全局的指令</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">//其中：参数1：指令的名称，定义的时候，不要加v-前缀。但在调用的时候必须在指令名称前加v-前缀</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">//参数2是一个对象，对象身上有一些指令相关的函数，这些函数可以在特定的阶段执行相关操作</span></span></span><br><span class="line"><span class="javascript">Vue.directive(<span class="string">&#x27;focus&#x27;</span>,&#123;</span></span><br><span class="line"><span class="javascript">        bind:<span class="function"><span class="keyword">function</span>(<span class="params">el</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">//每当指令被绑定到元素上时，会执行这个函数。只执行一次</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//第一个参数永远时el，表示被绑定了指令的那个元素，el是一个原生的JS对象。</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//在元素刚绑定了指令的时候，还没有插入到DOM中去，这时调用focus方法没有作用。</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//el.focus</span></span></span><br><span class="line">            </span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        inserted:<span class="function"><span class="keyword">function</span>(<span class="params">el</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">           <span class="comment">//inserted表示元素插入到dom中时执行，只执行一次</span></span></span><br><span class="line">            el.focus</span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        updated:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;,<span class="comment">//当vNode更新的时候，会执行。可能多次触发</span></span></span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>.focus</strong>：JS方法，可以将焦点集中到DOM对象上，类似于，鼠标单击一次输入框。</p><p>使用钩子函数参数</p><ul><li>el：指令绑定的元素，用来直接操作DOM</li><li>binding：一个对象，包含以下属性：<ul><li>name:指令名称——color</li><li>value:指令的绑定值。会计算比如v-color=”1+1”，binding.value=2</li><li>expression:指令绑定值，不会计算, binding.expression=’1+1’</li></ul></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-color</span>=<span class="string">&quot;&#x27;red&#x27;&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">Vue.directive(<span class="string">&#x27;color&#x27;</span>,&#123;</span></span><br><span class="line"><span class="javascript">        bind:<span class="function"><span class="keyword">function</span>(<span class="params">el,binding</span>)</span>&#123;</span></span><br><span class="line">            el.style.color = binding.value</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>定义私有指令</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"> <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line"><span class="javascript">            msg:<span class="string">&#x27;你是真的傻子哦,人是傻子，脑袋笨&#x27;</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        methods:&#123;&#125;,</span><br><span class="line">        filters:&#123;&#125;,</span><br><span class="line">        directives:&#123;</span><br><span class="line"><span class="javascript">            <span class="string">&#x27;color&#x27;</span>:&#123;</span></span><br><span class="line"><span class="javascript">                bind:<span class="function"><span class="keyword">function</span>(<span class="params">el,binding</span>)</span>&#123;</span></span><br><span class="line">                     el.style.color = binding.value</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>简写：</strong></p><p>大多数情况下，旨在<code>bind</code>和<code>update</code>钩子上做重复动作，可以简写</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">    directives:&#123;</span><br><span class="line"><span class="javascript">                <span class="string">&#x27;color&#x27;</span>:<span class="function"><span class="keyword">function</span>(<span class="params">el,binding</span>)</span>&#123;<span class="comment">//等同于把方法同时写到bind和update中</span></span></span><br><span class="line">                         el.style.color = binding.value</span><br><span class="line">                    &#125;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="8：vue-resource实现get，post，jsonp请求"><a href="#8：vue-resource实现get，post，jsonp请求" class="headerlink" title="8：vue-resource实现get，post，jsonp请求"></a>8：vue-resource实现get，post，jsonp请求</h1><p>vue-resource依赖于vue，需要在vue.js后导入vue-resource.js包。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/vue-resource.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;getInfo&quot;</span>&gt;</span></span><br><span class="line">            getInfo</span><br><span class="line">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;postInfo&quot;</span>&gt;</span></span><br><span class="line">            getInfo</span><br><span class="line">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;jsonpInfo&quot;</span>&gt;</span></span><br><span class="line">            getInfo</span><br><span class="line">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line"><span class="javascript">            msg:<span class="string">&#x27;你是真的傻子哦,人是傻子，脑袋笨&#x27;</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        methods:&#123;</span><br><span class="line"><span class="javascript">            getInfo()&#123;      <span class="built_in">this</span>.$http.get(<span class="string">&#x27;http://vue.studyit.io/api/getlunbo&#x27;</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="comment">//result是返回的结果，包括头部、数据等</span></span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(result.body)</span></span><br><span class="line">                &#125;),</span><br><span class="line">             postInfo()&#123;</span><br><span class="line"><span class="javascript">                 <span class="comment">//手动发起的post请求没有表单数据</span></span></span><br><span class="line"><span class="javascript">                 <span class="comment">//通过post方法的第三个参数，设置提交内容类型为普通表单格式。</span></span></span><br><span class="line"><span class="javascript">                 <span class="built_in">this</span>.$http.post(<span class="string">&#x27;http://vue.studyit.io/api/post&#x27;</span>,&#123;&#125;,&#123;<span class="attr">emulateJSON</span>:<span class="literal">true</span>&#125;).then(<span class="function"><span class="params">result</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">                     <span class="built_in">console</span>.log(result.body)</span></span><br><span class="line">                 &#125;),</span><br><span class="line">              jsonpInfo()&#123;</span><br><span class="line"><span class="javascript">                     <span class="built_in">this</span>.$http.jsonp(<span class="string">&#x27;http://vue.studyit.io/api/jsonp&#x27;</span>).then(<span class="function"><span class="params">result</span>=&gt;</span>&#123;</span></span><br><span class="line"><span class="javascript">                         <span class="built_in">console</span>.log(result.body)</span></span><br><span class="line">                     &#125;)</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;     </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vuejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>个人推荐的一些优秀的安卓开源库</title>
      <link href="/2020/02/01/%E6%94%B6%E9%9B%86%E4%B8%80%E4%BA%9B%E4%BC%98%E7%A7%80%E7%9A%84%E5%AE%89%E5%8D%93%E5%BC%80%E6%BA%90%E5%BA%93/"/>
      <url>/2020/02/01/%E6%94%B6%E9%9B%86%E4%B8%80%E4%BA%9B%E4%BC%98%E7%A7%80%E7%9A%84%E5%AE%89%E5%8D%93%E5%BC%80%E6%BA%90%E5%BA%93/</url>
      
        <content type="html"><![CDATA[<h1 id="0：引言"><a href="#0：引言" class="headerlink" title="0：引言"></a>0：引言</h1><p>最近自己在写一个安卓软件，把我做的sci.ci这个网站接入到移动端来。在写这个软件的过程中，遇到了非常多优秀的开源库，这些库简化了我很多工作，在此将他们分享出来。</p><h1 id="1：Kongzue-Dialog-V3"><a href="#1：Kongzue-Dialog-V3" class="headerlink" title="1：Kongzue Dialog V3"></a>1：Kongzue Dialog V3</h1><p><strong>自定义Toast对话框，仿IOS设计</strong></p><p>项目地址：<a href="https://github.com/kongzue/DialogV3">https://github.com/kongzue/DialogV3</a></p><h2 id="1-1-引入"><a href="#1-1-引入" class="headerlink" title="1.1 引入"></a>1.1 引入</h2><h3 id="1-1-1Support-版本"><a href="#1-1-1Support-版本" class="headerlink" title="1.1.1Support 版本"></a>1.1.1Support 版本</h3><p>Maven仓库：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;com.kongzue.dialog_v3&lt;&#x2F;groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;dialog&lt;&#x2F;artifactId&gt;</span><br><span class="line">  &lt;version&gt;3.1.8&lt;&#x2F;version&gt;</span><br><span class="line">  &lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure><p>Gradle： 在dependencies{}中添加引用：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation &#39;com.kongzue.dialog_v3:dialog:3.1.8&#39;</span><br></pre></td></tr></table></figure><h2 id="1-2-功能"><a href="#1-2-功能" class="headerlink" title="1.2 功能"></a>1.2 功能</h2><h3 id="1-2-1-基本对话框"><a href="#1-2-1-基本对话框" class="headerlink" title="1.2.1 基本对话框"></a>1.2.1 基本对话框</h3><p><img src="https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_messagedialog.png" class="lazyload" data-srcset="https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_messagedialog.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><h3 id="1-2-2-输入对话框"><a href="#1-2-2-输入对话框" class="headerlink" title="1.2.2 输入对话框"></a>1.2.2 输入对话框</h3><p><img src="https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_input.png" class="lazyload" data-srcset="https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_input.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="输入对话框"></p><h3 id="1-2-3等待提示对话框"><a href="#1-2-3等待提示对话框" class="headerlink" title="1.2.3等待提示对话框"></a>1.2.3等待提示对话框</h3><p><img src="https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_tip.png" class="lazyload" data-srcset="https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_tip.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="等待提示框"></p><h3 id="1-2-4底部菜单"><a href="#1-2-4底部菜单" class="headerlink" title="1.2.4底部菜单"></a>1.2.4底部菜单</h3><p><img src="https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_bottomdialog.png" class="lazyload" data-srcset="https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_bottomdialog.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="底部菜单    "></p><h3 id="1-2-5通知"><a href="#1-2-5通知" class="headerlink" title="1.2.5通知"></a>1.2.5通知</h3><p><img src="https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_notify.png" class="lazyload" data-srcset="https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_notify.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="通知"></p><h3 id="1-2-6分享对话框"><a href="#1-2-6分享对话框" class="headerlink" title="1.2.6分享对话框"></a>1.2.6分享对话框</h3><p><img src="https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_share.png" class="lazyload" data-srcset="https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_share.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="分享"></p><h3 id="1-2-7全屏"><a href="#1-2-7全屏" class="headerlink" title="1.2.7全屏"></a>1.2.7全屏</h3><p><img src="https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_fullscreen.png" class="lazyload" data-srcset="https://github.com/kongzue/Res/raw/master/app/src/main/res/mipmap-xxxhdpi/img_dialog_v3_fullscreen.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="全屏"></p><h1 id="2：YCVideoPlayer"><a href="#2：YCVideoPlayer" class="headerlink" title="2：YCVideoPlayer"></a>2：YCVideoPlayer</h1><p><strong>视频播放器封装库，仿爱奇艺、优酷。</strong></p><p>项目地址：<a href="https://github.com/yangchong211/YCVideoPlayer">https://github.com/yangchong211/YCVideoPlayer</a></p><h2 id="2-1-引用"><a href="#2-1-引用" class="headerlink" title="2.1 引用"></a>2.1 引用</h2><p>应用build.gradle中引入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &#39;cn.yc:YCVideoPlayerLib:2.4.9&#39; </span><br></pre></td></tr></table></figure><h2 id="2-2-功能"><a href="#2-2-功能" class="headerlink" title="2.2 功能"></a>2.2 功能</h2><h5 id="A基础功能"><a href="#A基础功能" class="headerlink" title="A基础功能"></a>A基础功能</h5><ul><li>A.1.1 能够自定义视频加载loading类型，设置视频标题，设置视频底部图片，设置播放时长等基础功能</li><li>A.1.2 可以切换播放器的视频播放状态，播放错误，播放未开始，播放开始，播放准备中，正在播放，暂停播放，正在缓冲等等状态</li><li>A.1.3 可以自由设置播放器的播放模式，比如，正常播放，全屏播放，和小屏幕播放。其中全屏播放支持旋转屏幕。</li><li>A.1.4 可以支持多种视频播放类型，比如，原生封装视频播放器，还有基于ijkPlayer封装的播放器。</li><li>A.1.5 可以设置是否隐藏播放音量，播放进度，播放亮度等，可以通过拖动seekBar改变视频进度。还支持设置n秒后不操作则隐藏头部和顶部布局功能</li><li>A.1.6 可以设置竖屏模式下全屏模式和横屏模式下的全屏模式，方便多种使用场景</li><li>A.1.7 top和bottom面版消失和显示：点击视频画面会显示、隐藏操作面板；显示后不操作会5秒后自动消失【也可以设置】</li></ul><h5 id="B高级功能"><a href="#B高级功能" class="headerlink" title="B高级功能"></a>B高级功能</h5><ul><li>B.1.1 支持一遍播放一遍缓冲的功能，其中缓冲包括两部分，第一种是播放过程中缓冲，第二种是暂停过程中缓冲</li><li>B.1.2 基于ijkPlayer的封装播放器，支持多种格式视频播放</li><li>B.1.3 可以设置是否记录播放位置，设置播放速度，设置屏幕比例</li><li>B.1.4 支持滑动改变音量【屏幕右边】，改变屏幕亮度【屏幕左边】，屏幕底测左右滑动调节进度</li><li>B.1.5 支持list页面中视频播放，滚动后暂停播放，播放可以自由设置是否记录状态。并且还支持删除视频播放位置状态。</li><li>B.1.6 切换横竖屏：切换全屏时，隐藏状态栏，显示自定义top(显示电量)；竖屏时恢复原有状态</li><li>B.1.7 支持切换视频清晰度模式</li><li>B.1.8 添加锁屏功能，竖屏不提供锁屏按钮，横屏全屏时显示，并且锁屏时，屏蔽手势处理</li></ul><h5 id="C拓展功能【这块根据实际情况选择是否需要使用，一般视频付费App会有这个工鞥】"><a href="#C拓展功能【这块根据实际情况选择是否需要使用，一般视频付费App会有这个工鞥】" class="headerlink" title="C拓展功能【这块根据实际情况选择是否需要使用，一般视频付费App会有这个工鞥】"></a>C拓展功能【这块根据实际情况选择是否需要使用，一般视频付费App会有这个工鞥】</h5><ul><li><strong>C1产品需求：类似优酷，爱奇艺视频播放器部分逻辑。比如如果用户没有登录也没有看视频权限，则提示试看视频[自定义布局]；如果用户没有登录但是有看视频权限，则正常观看；如果用户登录，但是没有充值会员，部分需要权限视频则进入试看模式，试看结束后弹出充值会员界面；如果用户余额不足，比如余额只有99元，但是视频观看要199元，则又有其他提示。</strong></li><li>C2自身需求：比如封装好了视频播放库，那么点击视频上登录按钮则跳到登录页面；点击充值会员页面也跳到充值页面。这个通过定义接口，可以让使用者通过方法调用，灵活处理点击事件。</li><li>C.1.1 可以设置试看模式，设置试看时长。试看结束后就提示登录或者充值……</li><li>C.1.2 对于设置视频的宽高，建议设置成4：3或者16：9或者常用比例，如果不是常用比例，则可能会有黑边。其中黑边的背景可以设置</li><li>C.1.3 可以设置播放有权限的视频时的各种文字描述，而没有把它写在封装库中，使用者自己设定</li><li>C.1.4 锁定屏幕功能</li></ul><h5 id="D待添加功能"><a href="#D待添加功能" class="headerlink" title="D待添加功能"></a>D待添加功能</h5><ul><li><p>D.1.1 可以支持屏幕截图功能，视频添加水印效果</p></li><li><p>D.1.2 支持弹幕功能</p></li><li><p>D.1.3 后期待定，视频拖拽</p></li></ul><h1 id="3：Android-SpinKit"><a href="#3：Android-SpinKit" class="headerlink" title="3：Android-SpinKit"></a>3：Android-SpinKit</h1><p><strong>加载中样式。</strong></p><p>项目地址：<a href="https://ybq.github.io/Android-SpinKit">https://ybq.github.io/Android-SpinKit</a></p><p>如果第一章的kongzue等待对话框还不足以满足个性化需求，那这个加载库应该足够了。</p><h2 id="3-1-引用"><a href="#3-1-引用" class="headerlink" title="3.1 引用"></a>3.1 引用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">   implementation &#39;com.github.ybq:Android-SpinKit:1.4.0&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-2-样式"><a href="#3-2-样式" class="headerlink" title="3.2 样式"></a>3.2 样式</h2><p><img src="https://raw.githubusercontent.com/ybq/AndroidSpinKit/master/art/screen.gif" class="lazyload" data-srcset="https://raw.githubusercontent.com/ybq/AndroidSpinKit/master/art/screen.gif" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="样式"></p><p><img src="https://raw.githubusercontent.com/ybq/AndroidSpinKit/master/art/screen2.gif" class="lazyload" data-srcset="https://raw.githubusercontent.com/ybq/AndroidSpinKit/master/art/screen2.gif" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="样式2"></p><h1 id="4：AgentWeb"><a href="#4：AgentWeb" class="headerlink" title="4：AgentWeb"></a>4：AgentWeb</h1><p><strong>基于安卓原生Webview的浏览器，自动实现视频全屏播放，加入了网页加载进度条</strong></p><p>项目地址：<a href="https://github.com/Justson/AgentWeb">https://github.com/Justson/AgentWeb</a></p><h2 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h2><p>Gradle</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">api &#39;com.just.agentweb:agentweb:4.1.2&#39; &#x2F;&#x2F; (必选)</span><br><span class="line">api &#39;com.just.agentweb:filechooser:4.1.2&#39;&#x2F;&#x2F; (可选)</span><br><span class="line">api &#39;com.download.library:Downloader:4.1.2&#39;&#x2F;&#x2F; (可选)</span><br></pre></td></tr></table></figure><h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p><img src="https://github.com/Justson/AgentWeb/raw/master/img/img-function-list.png" class="lazyload" data-srcset="https://github.com/Justson/AgentWeb/raw/master/img/img-function-list.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><img src="https://github.com/Justson/AgentWeb/raw/master/img/custom%20setting.png" class="lazyload" data-srcset="https://github.com/Justson/AgentWeb/raw/master/img/custom%20setting.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><img src="https://github.com/Justson/AgentWeb/raw/master/img/alipay.png" class="lazyload" data-srcset="https://github.com/Justson/AgentWeb/raw/master/img/alipay.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p>]]></content>
      
      
      <categories>
          
          <category> 安卓编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 安卓开源库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>创建一个简单的API项目</title>
      <link href="/2020/01/26/%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84API%E9%A1%B9%E7%9B%AE/"/>
      <url>/2020/01/26/%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84API%E9%A1%B9%E7%9B%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="0：简介"><a href="#0：简介" class="headerlink" title="0：简介"></a>0：简介</h1><p>API（应用程序接口），我现在正在做一个安卓项目，需要将mysql数据库里的数据，通过api接口以json格式导出，然后再安卓上解析和使用。</p><p>API项目基于php服务器和laravel框架，这个框架听说比较适合做api，当然由于项目简单，我做的API省去了很多验证相关的内容，普通的框架类似thinkphp也能做，这里用laravel为了方便后期补足API的相关内容。</p><h1 id="1：域名和LAMP"><a href="#1：域名和LAMP" class="headerlink" title="1：域名和LAMP"></a>1：域名和LAMP</h1><p>专用于api的域名建议采用类似于api.example.com这样的三级域名，LAMP这四个网站服务器是必须的。</p><h1 id="2：laravel安装"><a href="#2：laravel安装" class="headerlink" title="2：laravel安装"></a>2：laravel安装</h1><p>使用宝塔面板安装好的php，已经自带composer，若没有composer需要先安装。</p><p>没有数据库需要先创建数据库。</p><p>然后在网站目录下例如/var/www，运行指令</p><p><code>composer create-project laravel/laravel MyProject  &quot;5.1.*&quot;</code> </p><p>安装laravel。根据提示连接数据库。</p><h1 id="3：新建laravel控制器"><a href="#3：新建laravel控制器" class="headerlink" title="3：新建laravel控制器"></a>3：新建laravel控制器</h1><p>控制器就是当我们访问url时，服务器将运行控制器内的程序，然后返回给浏览器一个内容，这个内容可以是html代码，当然也可以时xml或者json。</p><p>在laravel安装目录运行<code>php artisan make:controller Api/LinkController</code></p><p>新建一个名叫LinkController控制器，此时在将在<code>app/Http/Controllers/Api</code>目录下生成一个LinkController.php`文件。打开文件编辑我们想要的程序。</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>]()</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Api</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">DB</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LinkController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">//方法一，从数据库获取某一数据</span></span><br><span class="line">    <span class="comment">//url中有参数情况，例如https://api.example.com/linkcontroller/searchlinks?type=电影&amp;kw=中国机长</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">searchlinks</span>(<span class="params">Request $request</span>)</span>&#123;</span><br><span class="line">    $type=$request-&gt;input(<span class="string">&#x27;type&#x27;</span>);<span class="comment">//使用request获取url中参数</span></span><br><span class="line">    $kw=$request-&gt;input(<span class="string">&#x27;kw&#x27;</span>);</span><br><span class="line">$linksresult = DB::table(<span class="string">&#x27;my_zhlinks&#x27;</span>)-&gt;where(<span class="string">&#x27;type&#x27;</span>, $type)-&gt;get();<span class="comment">//从已连接的数据库，找到表单“my_zhlinks”，获取type和带入参数type相同的项。将这些数据保存到linkresult变量中。</span></span><br><span class="line">        <span class="comment">//数据库表单my_zhlinks是我自己创建的。</span></span><br><span class="line">    <span class="keyword">return</span> json_encode($linksresult);<span class="comment">//返回一个json数组，不是json对象。</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//方法二，url中不带参数</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">alltype</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    $alltypes=DB::table(<span class="string">&#x27;my_zhpreg&#x27;</span>)-&gt;select(<span class="string">&#x27;type&#x27;</span>)-&gt;get();</span><br><span class="line">    <span class="keyword">return</span> json_encode($alltypes);</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="4：修改路由"><a href="#4：修改路由" class="headerlink" title="4：修改路由"></a>4：修改路由</h1><p>在上面注释中我们看到，要通过searchlinks方法返回一个json数组，url为<code>https://api.example.com/linkcontroller/searchlinks?type=电影&amp;kw=中国机长</code>非常的长，而且不利于我们后期管理api版本。</p><p>在<code>routes</code>目录下的<code>api.php</code>是专门用来写Api接口的路由，打开它</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>]()</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">| API Routes</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">| Here is where you can register API routes for your application. These</span></span><br><span class="line"><span class="comment">| routes are loaded by the RouteServiceProvider within a group which</span></span><br><span class="line"><span class="comment">| is assigned the &quot;api&quot; middleware group. Enjoy building your API!</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Route::namespace(<span class="string">&#x27;Api&#x27;</span>)-&gt;prefix(<span class="string">&#x27;v1&#x27;</span>)-&gt;group(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">Route::get(<span class="string">&#x27;search&#x27;</span>,<span class="string">&#x27;LinkController@searchlinks&#x27;</span>)-&gt;name(<span class="string">&#x27;search.links&#x27;</span>);</span><br><span class="line">Route::get(<span class="string">&#x27;type&#x27;</span>,<span class="string">&#x27;LinkController@alltype&#x27;</span>)-&gt;name(<span class="string">&#x27;type.all&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><code>namespace(&#39;Api&#39;)</code>指定了命名空间，控制器命名空间只要不是在<code>App\Http\Controllers</code>下，都需要进一步指明其命名空间，比如LinkController命名空间为<code>App\Http\Controllers\Api</code>。prefix为前缀，我们用来控制版本，group表示，后面的地址拥有相同的命名空间和前缀。<br>修改后的带参数url变为<code>https://api.example.com/api/v1/search?type=电影&amp;kw=中国机长</code></p><p>不带参数的url变为<code>https://api.example.com/api/v1/type</code></p><h1 id="5：总结"><a href="#5：总结" class="headerlink" title="5：总结"></a>5：总结</h1><p>修改路由后，通过访问链接<code>https://api.example.com/api/v1/search?type=电影&amp;kw=中国机长</code>就可以获得从数据库获取的值了。</p><p>下篇讲解使用okhttp和gson获取并解析api里的json数组。</p>]]></content>
      
      
      <categories>
          
          <category> 网站编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> API </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用Magento创建电商网站记录</title>
      <link href="/2020/01/24/%E4%BD%BF%E7%94%A8Magento%E5%88%9B%E5%BB%BA%E7%94%B5%E5%95%86%E7%BD%91%E7%AB%99%E8%AE%B0%E5%BD%95/"/>
      <url>/2020/01/24/%E4%BD%BF%E7%94%A8Magento%E5%88%9B%E5%BB%BA%E7%94%B5%E5%95%86%E7%BD%91%E7%AB%99%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h1 id="0：绪论"><a href="#0：绪论" class="headerlink" title="0：绪论"></a>0：绪论</h1><p>安装教程使用magento中国官网的提示，教程原地址为<a href="https://www.magentochina.org/blog/magento-guide/install-magento-2-1-with-composer.html">https://www.magentochina.org/blog/magento-guide/install-magento-2-1-with-composer.html</a></p><p>我是用composer安装magento，composer在宝塔面板安装php时已默认安装了，所以能直接用。若未使用宝塔面板需优先安装composer。使用以下命令下载运行composer。若已有则跳过。</p><p><code>curl -sS https://getcomposer.org/installer | php</code></p><p>使用以下命令将composer添加至全局，以便在任意目录下使用composer指令</p><p><code>mv composer.phar /usr/local/bin/composer</code></p><h1 id="1：php环境配置"><a href="#1：php环境配置" class="headerlink" title="1：php环境配置"></a>1：php环境配置</h1><p>一下内容的操作，在宝塔控制面板，软件商店，运行环境，php设置里能找到</p><p><strong>Magento安装时PHP环境需要检查以下扩展：</strong></p><ul><li><p>PHP Extension curl.</p></li><li><p>PHP Extension iconv.</p></li><li><p>PHP Extension mbstring.</p></li><li><p>PHP Extension dom.</p></li><li><p>PHP Extension hash.</p></li><li><p>PHP Extension openssl.</p></li><li><p>PHP Extension xmlwriter.</p></li><li><p>PHP Extension pcre.</p></li><li><p>PHP Extension gd.</p></li><li><p>PHP Extension bcmath.</p></li><li><p>PHP Extension simplexml.</p></li><li><p>PHP Extension spl.</p></li><li><p>PHP Extension xsl.</p></li><li><p>PHP Extension intl.</p></li><li><p>PHP Extension ctype.</p></li><li><p>PHP Extension pdo_mysql.</p></li><li><p>PHP Extension soap.</p></li><li><p>PHP Extension zip.</p></li><li><p>PHP Extension phar.</p></li><li><p>PHP Extension libxml.</p><p><strong>取消函数禁用</strong></p></li><li><p>openlog、syslog、symlink、exec等</p></li><li><p>还有些函数需要取消禁用，可根据安装时的错误提示操作</p></li></ul><h1 id="2：开始安装"><a href="#2：开始安装" class="headerlink" title="2：开始安装"></a>2：开始安装</h1><p>打开xshell或其他ssh面板，在使用cd指令，进入网站根目录，例如/var/www，输入指令</p><p><code>composer create-project --repository-url=https://repo.magento.com/ magento/project-community-edition  magento2</code></p><p>其中magento2指，网站将被放在/var/www/magento2目录下，删除此字段，magento会放在/var/www目录下。</p><p>提示输入username和password。</p><ol><li>首先您先登录<a href="https://marketplace.magento.com/">Magento的官方商店</a>。</li><li>点击“Sign In”登录到您的账号，如果还没有账号,需要先注册。</li><li>当登录之后，点击”My Access Keys”.如果找不到，可以使用CTRL+F键进行搜索.</li><li>点击“Create a New Access Key”后，找到“Generate New”,为自己的Magento2生成一个Key.</li><li>记录下生成的Public key及Private key</li></ol><p>其中public key是用户名，private key是密码。</p><p>完成安装后在网站目录下就没能看到magento2目录了，由于magento需要文件写权限。使用composer安装时，magetno文件的所有者是运行指令时的用户，也就是说通常是root。那么假定网站用户是www，则在运行安装程序时，www将无法对文件进行写操作，因此，需要更改文件权限，或者所有者。。不建议将文件权限修改，我们只需要修改文件所有者即可。。</p><p>使用宝塔面板可直接在文件里修改所有者。xshell使用chmod指令，详细方法请自行查阅。<strong>请注意：文件所有者不更改，打开http://域名/magento2，无法进入安装界面</strong></p><p>修改完毕后就可以直接输入http://域名/magento2/setup进行安装了。如果你遇到这个问题</p><p><strong>长时间安装不上，服务器cpu过载问题</strong></p><p>请尝试使用指令安装</p><p>首先将magento添加到环境变量,请自行修改自己的magento2文件夹位置。</p><p><code>export PATH=$PATH:/var/www/html/magento2/bin</code></p><p>然后cd到magento2安装目录下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">php setup&#x2F;index.php</span><br><span class="line">--db_host&#x3D;localhost \</span><br><span class="line">--db_name&#x3D;magento2 \</span><br><span class="line">--db_user&#x3D;root \</span><br><span class="line">--db_pass&#x3D;canbempty \</span><br><span class="line">--backend_frontname&#x3D;admin \</span><br><span class="line">--admin_username&#x3D;username \</span><br><span class="line">--admin_password&#x3D;password \</span><br><span class="line">--admin_email&#x3D;admin@email.local \</span><br><span class="line">--admin_firstname&#x3D;First \</span><br><span class="line">--admin_lastname&#x3D;Last \</span><br><span class="line">--base_url&#x3D;http:&#x2F;&#x2F;magento2.local&#x2F; \</span><br><span class="line">--base_url_secure&#x3D;http:&#x2F;&#x2F;magento2.local&#x2F; \</span><br><span class="line">--language&#x3D;en_US \</span><br><span class="line">--currency&#x3D;USD \</span><br><span class="line">--use_rewrites&#x3D;true \</span><br><span class="line">--use_secure&#x3D;false \</span><br><span class="line">--use_secure_admin&#x3D;false \</span><br><span class="line">--cleanup_database</span><br></pre></td></tr></table></figure><p>上面的参数请根据自己的需要进行修改,比如base_url就是您的网址,admin_*将是您后台管理员用户名或密码.</p><p>等待安装如果遇到提示</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ERROR 1419 (HY000): You do not have the SUPER privilege and</span><br><span class="line">binary logging is enabled (you *might* want to use the less safe</span><br><span class="line">log_bin_trust_routine_creators variable)</span><br></pre></td></tr></table></figure><p>请在你的系统中查找my.cnf文件，通常在/etc/my.cnf下，文件中 <strong>[mysqld]</strong> 标记后加一行内容为<strong>log-bin-trust-function-creators=1</strong></p><p>然后运行</p><p><code>service mysql restart</code></p><p>重启mysql。然后重新<strong>php setup/index.php</strong>以及其后指令。完成安装。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[SUCCESS]: Magento installation complete.</span><br><span class="line">[SUCCESS]: Magento Admin URI: &#x2F;admin_xgswzt</span><br><span class="line">Nothing to import.</span><br></pre></td></tr></table></figure><p>出现此提示，则完成安装。</p><p>然后修改网站伪静态规则，Nginx：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">location &#x2F; &#123;</span><br><span class="line">        index index.html index.php; ## Allow a static html file to be shown first</span><br><span class="line">        try_files $uri $uri&#x2F; @handler; </span><br><span class="line">        expires 30d;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">location &#x2F;var&#x2F;export&#x2F; &#123; ## Allow admins only to view export folder</span><br><span class="line">    auth_basic           &quot;Restricted&quot;; ## Message shown in login window</span><br><span class="line">    auth_basic_user_file htpasswd; ## See &#x2F;etc&#x2F;nginx&#x2F;htpassword</span><br><span class="line">    autoindex            on;</span><br><span class="line">&#125;</span><br><span class="line">  location  &#x2F;. &#123; ## Disable .htaccess and other hidden files</span><br><span class="line">    return 404;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location @handler &#123; ## Magento uses a common front handler</span><br><span class="line">    rewrite &#x2F; &#x2F;index.php;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location ~ .php&#x2F; &#123; ## Forward paths like &#x2F;js&#x2F;index.php&#x2F;x.js to relevant handler</span><br><span class="line">    rewrite ^(.*.php)&#x2F; $1 last;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="3：-宝塔面板安装失败"><a href="#3：-宝塔面板安装失败" class="headerlink" title="3： 宝塔面板安装失败"></a>3： 宝塔面板安装失败</h1><p>建议不要采用宝塔面板安装，在使用宝塔面板进行安装后，网站无法运行，查看错误日志，提示<strong>http://域名/magento2/magento2文件不存在</strong></p><p>修改网站根目录还是无法进入，提示</p><p><code>An error has happened during application run. See exception log for details.</code></p>]]></content>
      
      
      <categories>
          
          <category> 网站编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Magento </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何自己开发一个VPN App</title>
      <link href="/2019/12/12/%E5%A6%82%E4%BD%95%E8%87%AA%E5%B7%B1%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AAVPN%E7%A8%8B%E5%BA%8F/"/>
      <url>/2019/12/12/%E5%A6%82%E4%BD%95%E8%87%AA%E5%B7%B1%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AAVPN%E7%A8%8B%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="第一章-简介"><a href="#第一章-简介" class="headerlink" title="第一章 简介"></a>第一章 简介</h1><h2 id="1-1-学习条件和要求"><a href="#1-1-学习条件和要求" class="headerlink" title="1.1 学习条件和要求"></a>1.1 学习条件和要求</h2><p>学习条件：</p><ul><li>你不用一定学习过JAVA或其他编程语言。</li><li>你不用一定了解或精通安卓编程。</li><li>你不用一定懂得Linux编程。</li><li>你需要自费支付服务器费用，国外服务器大概一个月30元，也可能有便宜的或更贵但性能更好的，你可自行选择，当然如果愿意用国内服务器练手，腾讯阿里的学生服务器一年只要120，当然这个服务器做出的VPN无法翻墙。</li><li>你需要消耗一定的时间和耐心。</li></ul><p>如果你已经满足以上条件了，那么我希望你在浏览以下文章时，同意我的以下要求：</p><ul><li>你保证不使用本教程制作的VPN进行牟利。</li><li>你保证不在中国大陆地区散播和分享制作的VPN。</li><li>你保证不使用此VPN进行其他违法犯罪活动或在外网发表对国家不利的言论。</li></ul><blockquote><p>若你已同意以上要求，请继续向下浏览，若你无法做到上述要求，请停止继续浏览。</p></blockquote><h2 id="1-2-功能介绍"><a href="#1-2-功能介绍" class="headerlink" title="1.2 功能介绍"></a>1.2 功能介绍</h2><p>软件的实现原理，我不做介绍，有兴趣的同学可自行学习。</p><p>这里只教大家如何在我的软件基础上通过简单修改，制作一个自用VPN客户端。当然你也可以使用SS、SSR或V2ray等现成软件，并配置服务器后翻墙。</p><p>VPN功能：</p><ul><li>可配置多条线路，以适用不同的服务器，或同一服务器上的不同用户。</li><li>客户端主动更改主题颜色。</li><li>推送更新通知，和推送广告。可在服务端更改是否推送广告。</li></ul><p>本软件没有账户登陆等限定条件。只要安装软件，即可翻墙，当然前提条件是，你配置好了服务器。</p><p>下面展示我已经制作好的VPN程序截图，测试已能翻墙。</p><img src="http://qn.xieqifei.com/static/images/ecaoovpn1.jpg" class="lazyload" data-srcset="http://qn.xieqifei.com/static/images/ecaoovpn1.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" style="zoom:25%;" /><img src="http://qn.xieqifei.com/static/images/ecaoovpn2.jpg" class="lazyload" data-srcset="http://qn.xieqifei.com/static/images/ecaoovpn2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" style="zoom: 25%;" /><img src="http://qn.xieqifei.com/static/images/ecaoovpn3.jpg" class="lazyload" data-srcset="http://qn.xieqifei.com/static/images/ecaoovpn3.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" style="zoom:25%;" /><img src="http://qn.xieqifei.com/static/images/ecaoovpn4.jpg" class="lazyload" data-srcset="http://qn.xieqifei.com/static/images/ecaoovpn4.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" style="zoom:25%;" /><p>如此，我们便开始制作自己的VPN吧。</p><h1 id="第二章-服务端配置"><a href="#第二章-服务端配置" class="headerlink" title="第二章 服务端配置"></a>第二章 服务端配置</h1><h2 id="2-1-VPS服务器购买"><a href="#2-1-VPS服务器购买" class="headerlink" title="2.1 VPS服务器购买"></a>2.1 VPS服务器购买</h2><p>这里我推荐给大家的是<a href="https://www.vultr.com/?ref=8345070">vultr.com</a>。为什么这家服务器呢？这家服务器可以按小时收费，如果你不嫌麻烦，可以在需要的使用VPN的时候，再开启一台VPS。不需要的时候关闭，当然重新开启需要重新配置服务器等操作。只是我觉得性价比挺高。最重要的是支持支付宝微信付款！</p><p>下面教大家购买VPS服务器。主要是没看到中文翻译，所以决定一步步教大家，毕竟有的人可能并不会。</p><ol><li><p>点击链接打开vultr网站，<a href="https://www.vultr.com/?ref=8345070">www.vultr.com</a>额外说明一句，通过我的链接打开注册，我和你都可以获得10美元的奖励费用，当然这笔钱，需要你购买服务器之后才会发放。只是给大家说明这点，当然如果大家有其他选择也是可以的。</p></li><li><p>创建账户。</p><p><img src="http://qn.xieqifei.com/static/images/vultr-step1.jpg" class="lazyload" data-srcset="http://qn.xieqifei.com/static/images/vultr-step1.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>填写邮箱，按要求设置密码，密码要求至少一个大写字母，一个小写字母，一个数字，和至少十个字符。点击“create acounnt”即可。</p></li><li><p>Vultr充值。</p><p>注册登录后会进入个人面板，左边栏选择 <strong>“Billing”</strong> ，选择支付方式和金额，付款即可。</p><p>Vultr 支持支付宝付款，很方便。但是个人更推荐有 Paypal 的使用 Paypal。</p><p><img src="http://qn.xieqifei.com/static/images/vultr-step2.jpg" class="lazyload" data-srcset="http://qn.xieqifei.com/static/images/vultr-step2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></li><li><p>创建VPS</p><p>选择 <strong>“Servers”</strong> ，点击右边蓝色的 “**+**” 添加 VPS。</p><p><img src="http://qn.xieqifei.com/static/images/vultr-step3.jpg" class="lazyload" data-srcset="http://qn.xieqifei.com/static/images/vultr-step3.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><strong>a.选择节点</strong></p><p>日本距离最近，延迟最低，但太热门了，白天还好，晚上有时很慢；洛杉矶比日本稳些。</p><p><img src="http://qn.xieqifei.com/static/images/vultr-step4.jpg" class="lazyload" data-srcset="http://qn.xieqifei.com/static/images/vultr-step4.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><strong>b.选择系统</strong></p><p>选择系统。支持 Windows 和自己上传 ISO 系统镜像。这里请大家选择<strong>CentOS系统7x64</strong></p><p><img src="http://qn.xieqifei.com/static/images/vultr-step5.png" class="lazyload" data-srcset="http://qn.xieqifei.com/static/images/vultr-step5.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><strong>c.选择套餐</strong></p><p>价格从 $2.5/mo 到 $640/mo，各种配置都有，最低 $2.5/mo 的套餐现在基本买不到了。要求必须<strong>有IPv4地址</strong>。</p><p><img src="http://qn.xieqifei.com/static/images/vultr-step6.jpg" class="lazyload" data-srcset="http://qn.xieqifei.com/static/images/vultr-step6.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><strong>d.其他选项</strong></p><p>有 IPv6，私密，主机名、标签等，<strong>无特殊需要全部默认即可。</strong></p><p>选好后点击右下角的 <strong>“Deploy Now”</strong> ，开始安装 VPS。</p><p><strong>e.查看VPS</strong></p><p>已购买的 VPS 都会显示在 “Servers” 面板中，当显示 “Running” 时即表示安装完成。点击 <strong>“Manage”</strong> 进入 VPS 管理面板。</p><p><img src="http://qn.xieqifei.com/static/images/vultr-step7.jpg" class="lazyload" data-srcset="http://qn.xieqifei.com/static/images/vultr-step7.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>VPS 管理面板，这里需要记录下 IP 地址（IP Address）、用户名（Username）、密码（Password）供稍后连接 VPS 时使用。</p><p><img src="http://qn.xieqifei.com/static/images/vultr-step8.jpg" class="lazyload" data-srcset="http://qn.xieqifei.com/static/images/vultr-step8.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></li><li><p>连接VPS</p><p>使用 ssh 工具连接我们的 VPS，Windows 推荐 xshell，Mac 可使用自带的终端。</p><p>Xshell 网盘链接：<a href="https://link.zhihu.com/?target=https://pan.baidu.com/s/1pMbKLMb">https://pan.baidu.com/s/1pMbKLMb</a> 密码：lwir</p><p><strong>Windows</strong></p><p>安装 xshell，打开软件。</p><p>点击 “文件” —&gt; “新建” —&gt; “连接”，输入 “名称” 和 “主机” （即VPS ip）。</p><p><img src="http://qn.xieqifei.com/static/images/vps-step1.jpg" class="lazyload" data-srcset="http://qn.xieqifei.com/static/images/vps-step1.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>点击 “用户身份验证”，输入用户名（默认root）和密码。确认。</p><p><img src="http://qn.xieqifei.com/static/images/vps-step2.jpg" class="lazyload" data-srcset="http://qn.xieqifei.com/static/images/vps-step2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>连接 VPS，接受并保存密匙。</p><p><img src="http://qn.xieqifei.com/static/images/vps-step3.jpg" class="lazyload" data-srcset="http://qn.xieqifei.com/static/images/vps-step3.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><img src="http://qn.xieqifei.com/static/images/vps-step4.jpg" class="lazyload" data-srcset="http://qn.xieqifei.com/static/images/vps-step4.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>出现 <code>root@vultr:~#</code> 即连接成功，可以输入代码了进行操作了。</p><p><img src="http://qn.xieqifei.com/static/images/vps-step5.jpg" class="lazyload" data-srcset="http://qn.xieqifei.com/static/images/vps-step5.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><blockquote><p>很重要的一点，因为不是所有的VPS在国内都能ping通，有的IP地址已经被国内网络屏蔽了，所以如果VPS连接不上，请你到 [ping.chinaz.com]输入你的IP地址测试，若国内连接均提示超时且为红色，请你在vultr中删除vps并重新创建一个可用的ip地址。</p></blockquote><p><img src="http://qn.xieqifei.com/static/images/vps-step7.jpg" class="lazyload" data-srcset="http://qn.xieqifei.com/static/images/vps-step7.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><strong>Mac</strong></p><p>打开终端，输入以下代码登录 VPS，其中 root 即用户名，将 ip 更改为 VPS 的 IP 地址，回车。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root<span class="meta">@ip</span></span><br></pre></td></tr></table></figure><p>输入 <code>yes</code> 确认，粘贴密码，回车。需要提醒的是，密码输入时并不会显示出来，直接复制粘贴，回车即可。出现 <code>root@vultr:~#</code> 即连接成功。</p><p><img src="http://qn.xieqifei.com/static/images/vps-step6.jpg" class="lazyload" data-srcset="http://qn.xieqifei.com/static/images/vps-step6.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p></li></ol><p>   <strong>最近很忙，没时间更新了</strong></p><p>项目地址：<a href="https://github.com/xieqifei/openvpn%E3%80%82%E7%84%B6%E5%90%8E%E6%9C%89%E8%8B%B1%E8%AF%AD%E7%89%88%E6%9C%AC%E7%9A%84readme%E3%80%82">https://github.com/xieqifei/openvpn。然后有英语版本的readme。</a></p>]]></content>
      
      
      <categories>
          
          <category> 安卓编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VPN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JAVA安卓编程笔记</title>
      <link href="/2019/11/18/%E9%87%8D%E6%B8%A9%E5%AE%89%E5%8D%93%E7%BC%96%E7%A8%8B/"/>
      <url>/2019/11/18/%E9%87%8D%E6%B8%A9%E5%AE%89%E5%8D%93%E7%BC%96%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="第一章-前言"><a href="#第一章-前言" class="headerlink" title="第一章 前言"></a>第一章 前言</h1><p>大概在两年前，我第一次决定学习安卓编程，在大约两三周的学习之后，由于缺乏JAVA开发基础和经验，单纯的视频教程看得我云里雾里，不过在此期间学会了使用代码进行页面布局，这给我此后学习Web编程，使用html、css进行页面布局打下了基础。</p><p>两年前，我使用的还是联想的i5五系列cpu、机械硬盘、4g内存，这个电脑配置使得我当时用eplise开发安卓程序非常麻烦，打开一个安卓虚拟机需要花很长的时间。半年前，我更换了Surface，用上了8+128G内存+固态硬盘。也更新了最新的i5八系列cpu，电脑配置有了显著提高，运行安卓开发程序也游刃有余了。</p><p>而这次重启安卓学习之旅，我将使用AS进行安卓开发。虽然AS目前已支持C/C++做程序开发，但我仍将选择JAVA作为开发语言，以提高我的JAVA水平。</p><h1 id="第二章-安装Android-Studio"><a href="#第二章-安装Android-Studio" class="headerlink" title="第二章 安装Android Studio"></a>第二章 安装Android Studio</h1><p>从 <a href="https://developer.android.com/studio">https://developer.android.com/studio</a> 下载IDE和SDK后，进行相应安装和配置。安装教程，从网课和CDSN论坛均可找到。不再赘述。</p><p>此处说明安装时遇到的坑。</p><ol><li><p>SDK安装后，在SDK管理工具中添加SDK目录即andriod-sdk提示<code>android sdk location should not contain whitespace</code></p></li><li><p>问题1解决后紧接着出现提示<code>Target folder is neither empty nor does it point to an existing SDK installtion.</code></p></li></ol><p>问题分析和解决办法：</p><ol><li>提示意思为SDK的目录路径中出现空格。在我的问题中是，Program Files文件夹名称中间有空格，于是我在根路径重新创建了一个以Andriod为名的文件夹，并将andriod-sdk移到此路径下。</li><li>提示为，选择的文件夹既不是空的也不是sdk的文件夹，原因是我将sdk目录指向了Andriod为名的文件夹，正确的路径是上步创建Andriod文件下的andriod-sdk。</li></ol><p>安装好SDK后，还要给AS安装虚拟机，运行AS后，在Tools菜单下找到AVD Manager（虚拟机管理器），添加合适分辨率、Andriod版本的虚拟机即可。</p><h1 id="第三章-应用的资源访问"><a href="#第三章-应用的资源访问" class="headerlink" title="第三章 应用的资源访问"></a>第三章 应用的资源访问</h1><h2 id="3-1-认识Android目录"><a href="#3-1-认识Android目录" class="headerlink" title="3.1 认识Android目录"></a>3.1 认识Android目录</h2><ol><li><p>res资源</p><ul><li>drawable-？dpi（l,h,m,x）：不同分辨率下的资源文件，如图片的大小。</li><li>values：安卓应用界面上需要显示的各类文本标签文字。</li><li>layout：界面布局文件。</li><li>menu：存放菜单</li></ul></li><li><p>gen（ADT中）或JAVA（AS中）</p><p>由IDE自动生成的包文件</p></li></ol><h2 id="3-2-通用资源访问"><a href="#3-2-通用资源访问" class="headerlink" title="3.2 通用资源访问"></a>3.2 通用资源访问</h2><ol><li><p>基于Java代码访问资源</p><ul><li>Java代码访问方式:</li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[\&lt;packge-name&gt;.]R.   <span class="comment">//R类所在包路径可省略</span></span><br><span class="line">&lt;resource_type&gt;.&lt;resource_name&gt;  <span class="comment">//resource_type：资源类型如color等。</span></span><br></pre></td></tr></table></figure><ul><li><p>Java访问示例</p></li><li><p>//从drawable目录中加载图片，设置为背景图片</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getWindow().setBackgroundDrawableResource(R.drawable.back)</span><br></pre></td></tr></table></figure><ul><li>//从string设置字符串资源，设置为文本框的显示内容</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TextView title=(TextView)findViewById(R.id.title);  </span><br><span class="line">title.setText(R.string.titleinfo);</span><br></pre></td></tr></table></figure><ol start="2"><li><p>在XML配置文件中访问资源</p><ul><li>XML资源访问方式:</li></ul></li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@[<span class="tag">&lt;<span class="name">package_name</span>&gt;</span>:]</span><br><span class="line"><span class="tag">&lt;<span class="name">resource_type</span>&gt;</span>/<span class="tag">&lt;<span class="name">resource_name</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>XML资源定义示例</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">color</span> <span class="attr">name</span>=<span class="string">&quot; blue &quot;</span> &gt;</span>#ff00ff<span class="tag">&lt;/<span class="name">color</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot; title &quot;</span> &gt;</span></span><br><span class="line">Confirmation<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>在XML中使用资源示例</p><ul><li>XML资源使用实例片段</li></ul></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">EditText</span> <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">android:text</span>=<span class="string">&quot; @string/title&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">android:textColor</span>=<span class="string">&quot; @color/blue&quot;</span> </span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">EditText</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="3-3-安卓中字符串、颜色和尺寸应用"><a href="#3-3-安卓中字符串、颜色和尺寸应用" class="headerlink" title="3.3 安卓中字符串、颜色和尺寸应用"></a>3.3 安卓中字符串、颜色和尺寸应用</h2><ol><li><p>资源列表</p><p>字符串、颜色、尺寸资源，存放在XML文件内，位于/res/values目录下。</p><p>如字符串资源：/res/values/strings.xml。R类中名称：R.string</p></li><li><p>颜色表示方法</p><ul><li><p>使用Color类的常量</p><p>如：<code>int color = Color.BLUE;//创建一个蓝色</code></p></li><li><p>使用Color类的静态方法argb创建颜色</p><p><code>int color = Color.argb\(127.255.0.255\);//半透明紫色</code></p></li><li><p>在XML资源文件定义颜色值</p></li></ul></li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">color</span> <span class="attr">name</span>=<span class="string">&quot; blue &quot;</span> &gt;</span>#ff00ff<span class="tag">&lt;/<span class="name">color</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot; title &quot;</span> &gt;</span></span><br><span class="line">Confirmation<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="3"><li><p>使用示例</p></li><li><p>res和assets区别</p><ul><li><p>res内的文件被映射到R.java，基于资源ID直接访问。</p></li><li><p>assets需通过资源管理器访问。</p></li><li><p>res下不可以创建子目录，assets可以有目录结构。</p></li><li><p>读取文件资源的方式不同</p><ul><li>读取res/raw下的文件资源，通过当前Activity中的<code>getResources()</code>方法：</li></ul></li></ul></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">InputStream is = getResources().</span><br><span class="line">openRawResource(R.id.filename);</span><br></pre></td></tr></table></figure><ul><li>读取assets下的文件资源，通过当前活动的资源管理器assetmanager读取相应的资源文件：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AssetManager am = getAssets();<span class="comment">//通过当前的Activity的getAsset()方法。</span></span><br><span class="line">InputStream is = am.open(<span class="string">&quot;filename&quot;</span>);<span class="comment">//基于文件名读取资源。</span></span><br></pre></td></tr></table></figure><h2 id="3-4-Drawable资源"><a href="#3-4-Drawable资源" class="headerlink" title="3.4 Drawable资源"></a>3.4 Drawable资源</h2><ol><li><p>Drawable资源</p><ul><li><p>主要是需要绘制的资源，比如图片资源。</p></li><li><p>主要格式有*.png、*.jpg等。</p></li><li><p>图片放入/res/drawable-xxx目录下。</p></li><li><p>安卓SDK会在编译应用自动加载图片。</p></li><li><p>资源文件在R.java资源类中生成该资源的索引。</p></li></ul></li><li><p>Drawable资源类型</p><ul><li>StateListDrawable资源（动态切换背景）</li><li>LayerDrawable资源（图层叠加）</li><li>ShapeDrawable资源（绘图）</li><li>ClipDrawable资源</li><li>AnimationDrawable资源（动画）</li></ul></li></ol><h2 id="3-5-安卓项目布局文件"><a href="#3-5-安卓项目布局文件" class="headerlink" title="3.5 安卓项目布局文件"></a>3.5 安卓项目布局文件</h2><ol><li><p>什么是安卓布局文件？</p><ul><li>定义用户界面上各个组建之间的组织结构。</li><li>XML格式文件，安卓系统负责初始化。</li><li>实现界面布局和逻辑代码的分离。</li><li>修改和更新界面非常简便，无需修改代码。</li><li>布局文件是树形结构，使用根节点。</li><li>一般在布局控件中放置界面显示组建LinearLayout中放入textview文本标签</li><li>通过节点属性设置显示界面组建的属性：大小、颜色和边距等。</li></ul></li><li><p>布局示例</p></li><li><p>布局文件节点属性示例</p><p><code>android:id=&quot;@+id/button_id&quot;</code></p><ul><li>@表示XML解析器应该解析ID字符串把它作为ID资源。</li><li>+符号表示一个新的资源名字，会被创建且加入到资源列表中（R.java）</li><li>@string/@color等可用于访问其他资源。</li><li>组建id在android应用中是唯一的。</li></ul></li></ol><table><thead><tr><th>主题</th><th align="left">内容</th></tr></thead><tbody><tr><td>资源位置</td><td align="left">res/layout/my_layout.xml</td></tr><tr><td>布局XML文件格式</td><td align="left">使用&lt;?xml version= “1.0”encoding=”utf-8” ?&gt;<br>&lt;布局类xmlns:android=”<a href="http://schemas.android/">http://schemas.android</a>.<br>Com/apk/res/android” id= “@id+/string_na<code>&lt;br&gt;</code>me”(属性)&gt;<br>&lt;视图组件或者其他嵌套布局类&gt;<br>&lt;requestFocus/&gt;<br>&lt;/布局类&gt;</td></tr><tr><td>获得XML资源的方法</td><td align="left">Activity.setContentView()</td></tr><tr><td>引用XML资源的格式</td><td align="left">Java代码中：R.layout.my_layout。<br>XML文件中：@[package:]layout/my_layout</td></tr><tr><td>资源位置</td><td align="left">res/layout/my_layout.xml</td></tr></tbody></table><h2 id="3-6-AndroidManifest-xml项目配置文件"><a href="#3-6-AndroidManifest-xml项目配置文件" class="headerlink" title="3.6 AndroidManifest.xml项目配置文件"></a>3.6 AndroidManifest.xml项目配置文件</h2><ol><li><p>什么是AndroidManifest.xml</p><p>位于根目录下，文件名不可修改。</p><p>该文件中 &lt;manifest&gt;和 &lt;application&gt;是必需的且只能出现一次。</p></li><li><p>描述Android应用使用的组建和系统配置信息</p><ul><li>应用使用的组建及其实现类（Activity/Service等）</li><li>需要使用的安卓系统权限。</li><li>声明其他应用程序与该应用程序交互需要的权限</li><li>该应用程序所需的安卓API版本。</li><li>列出该应用程序所需类库。</li></ul></li></ol><h1 id="第四章-界面编程任务分析与设计"><a href="#第四章-界面编程任务分析与设计" class="headerlink" title="第四章 界面编程任务分析与设计"></a>第四章 界面编程任务分析与设计</h1><h2 id="4-1-循序渐进"><a href="#4-1-循序渐进" class="headerlink" title="4.1 循序渐进"></a>4.1 循序渐进</h2><ol><li><p>Activity简介</p><ul><li>安卓的视图组件，四大组件之一。</li><li>定义用户可以看到触摸到的界面。</li><li>活动内使用各种界面组件，实现交互动作。</li><li>通过活动，用户界面之间切换跳转、进行数据传递。</li></ul></li><li><p>Activity概念</p></li></ol><ul><li>用来包装用户界面组件的容器，实现用户和界面组件之间的交互。</li></ul><ol start="3"><li><p>案列分析教学特点和注意事项</p><ul><li>界面编程案例分析教学特点<ul><li>案例：基于安卓系统的计算器</li><li>特点：案例驱动，实践先行</li><li>优势：在实践中学习抽象的概念</li></ul></li><li>界面编程案例分析注意事项<ul><li>知识要点：活动的概念和使用</li><li>分析技巧：如何将实际中的问题进行分析；分析问题和解决问题的方法</li><li>编码技巧：在案例中学习编码技巧</li></ul></li></ul></li><li><p>计算器案例</p><ul><li><p>操作过程：</p><ol><li><p>用户输入两个计算数；</p></li><li><p>选择计算类型；</p></li><li><p>点击计算按钮，进行计算</p></li><li><p>将结果展示给用户</p></li></ol></li></ul></li></ol><h2 id="4-2-活动的创建和使用"><a href="#4-2-活动的创建和使用" class="headerlink" title="4.2 活动的创建和使用"></a>4.2 活动的创建和使用</h2><ol><li><p>创建活动应用程序</p><ul><li>应用程序通常由多个活动松耦合的组成</li><li>活动是界面上的组件在屏幕上展示的容器</li><li>活动通过布局文件展示界面布局的内容</li><li>活动的生命周期，利用周期的方法扩展</li></ul></li><li><p>创建活动步骤</p><ul><li>声明活动类名，继承于活动</li><li>实现<code>onCreate(Bundle bundle)</code>方法，在系统初始化完成活动对象之后，进行用户自定义的初始化活动</li><li>在<code>onCreate(View view)</code>设置用户界面的布局文件</li><li>通过活动中的<code>findViewById(int id)</code>获取各个界面组件，并基于其属性和方法进行相应的操作</li><li>如果需要在销毁活动进行处理，可以实现<code>onDestroy()</code>的方法。</li></ul></li></ol><h2 id="4-3-活动的声明和配置"><a href="#4-3-活动的声明和配置" class="headerlink" title="4.3 活动的声明和配置"></a>4.3 活动的声明和配置</h2><ol><li><p>活动的声明和配置</p><ul><li><p>活动定义后需在AndroidManifest.xml中声明</p></li><li><p>`&lt;application…/&gt;·节点内添加·&lt;activity…/&gt;·子元素</p></li><li><p>在<code>&lt;activity&gt;</code>子节点内定义Activity的类型（入口活动）</p></li></ul></li></ol><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;activity android:name=<span class="string">&quot;com.quck.android.calculator&quot;</span></span><br><span class="line">android:icon=<span class="string">&quot;@drawable/pic.png&quot;</span></span><br><span class="line">android:label=<span class="string">&quot;@string/app_name&quot;</span> &gt;</span><br><span class="line"><span class="comment">//略去其中内容</span></span><br><span class="line">&lt;/activity&gt;</span><br></pre></td></tr></table></figure><ol start="2"><li><p>配置活动——示例分析</p><p>活动的主要配置属性有如下三个：</p><ul><li><p>name：指定该活动的类名</p></li><li><p>icon：是定该活动对象的图标（可选）</p></li><li><p>label：指定该活动的标签</p></li><li><p>在<code>&lt;activity&gt;</code>节点中指定一个或者多个<code>&lt;intent-filter.../&gt;</code>元素Intent的类型和Action决定活动是否会接收消息。</p></li></ul></li></ol><h2 id="4-4-活动之间的数据交换和调用"><a href="#4-4-活动之间的数据交换和调用" class="headerlink" title="4.4 活动之间的数据交换和调用"></a>4.4 活动之间的数据交换和调用</h2><ol><li><p>活动之间的数据交换和调用</p><ul><li>活动之间跳转，需传递数据信息</li><li>通过Intent来进行数据传递</li><li>数据需要放入Intent或者Bundle之内</li></ul></li><li><p>什么是Bundle？</p></li></ol><ul><li>Bundle类是一个key-value对，一个映射，把字符串映射为各种类型。</li></ul><ol start="3"><li><p>数据交换</p><ul><li>写入数据<ul><li><code>putExtras(Bundle data)</code>向Intent中放入需要携带的Bundle数据</li><li><code>putXXX(String key, Xxx data)</code>向Bundle放入Int,Long,String等各种类型的数据</li><li><code>putSerializable(String key, Serialzable data)</code>:向Bundle中放入一份可序列化对象</li></ul></li><li>读取数据<ul><li><code>getExtras()</code>从Intent中读取需要携带的Bundle数据</li><li><code>getXXX(String key)</code>从Bundle，Intent读取int,Long,String等各种类型的数据</li><li><code>getSerializable(String key)</code>从Bundle，Intent中读取一个可序列化的对象</li></ul></li><li>活动交换示例</li><li>Intent vs Bundle<ul><li>相同点：传递数据时，作用相同</li><li>不同点：在多个活动之间传递相同数据时，推荐使用Bundle来储存和传递数据，减少重复的读写操作</li><li>例：活动跳转A-&gt;B-&gt;C传递相同数据<ul><li>如果使用Intent，则需要在A、B、C的Intent之间进行数据的复制</li><li>如果使用Bundle，则可直接传递Bundle对象即可</li></ul></li></ul></li></ul></li><li><p>返回数据</p><ul><li><p><code>startActivityForResult(Intent intent, int requestCode)</code></p><p>跳转到指定的活动</p><p>参数intent：指定目的活动类名</p><p>参数requestCode：由程序中自定义的识别码，用以区分不同的七点活动</p></li><li><p><code>setResult(int resultCode, Intent data)</code></p><p>设置resultCode表示结果的Activity，第二个参数保存传递的结果数据</p></li><li><p><code>onActivityResult(int requestCode, int resultCode, Intent data)</code></p><p>参数requestCode：起点活动定义唯一值</p><p>参数resultCode：目的活动定义的唯一标识值</p><p>参数data：从墓地活动返回的数据</p></li></ul></li><li><p>数据使用步骤</p><ul><li>起点活动，调用<code>startActivityForResult()</code>跳转目的活动</li><li>在目的活动中调用<code>setResult()</code></li><li>在起点活动覆写<code>onActivityResult()</code>在方法内获取目的活动返回的数据</li></ul></li></ol><h1 id="第五章-服务开发和广播事件"><a href="#第五章-服务开发和广播事件" class="headerlink" title="第五章 服务开发和广播事件"></a>第五章 服务开发和广播事件</h1><h2 id="5-1-循序渐进"><a href="#5-1-循序渐进" class="headerlink" title="5.1 循序渐进"></a>5.1 循序渐进</h2><ul><li><p>案列：音乐播放器</p><ul><li><p>任务概述</p></li><li><p>功能分析</p><p>界面设计</p><p>实现暂停、播放和停止</p><p>播放同时，显示歌手和音乐名称</p></li><li><p>用户界面设计</p><p>主界面</p></li><li><p>技术要点</p><p>服务的创建、调用</p><p>服务和活动之间的通信</p><p>Intent对象的使用</p></li><li><p>案例演示</p></li></ul></li><li><p>案例任务分析和设计</p><p>音乐播放器界面分析</p></li><li><p>核心代码设计和实现</p><p>核心代码编写步骤：</p><ol><li>创建安卓项目MusicBox</li><li>在res/loyout目录，创建播放器的主界面布局文件</li><li>定义一个MusicBoxContant的常量类存放程序中用到的静态或不变的信息</li><li>创建音乐播放器的服务类</li><li>在全局配置文件中，声明服务类</li><li>定义实现音乐播放器的主界面</li><li>定义事项ActicityReciver事件接收器，接受音乐服务状态变化广播事件的接收器</li><li>定义实现按钮事件接收器，播放和停止按钮，发送广播事件</li></ol></li></ul><h2 id="5-2-安卓中的系统服务"><a href="#5-2-安卓中的系统服务" class="headerlink" title="5.2 安卓中的系统服务"></a>5.2 安卓中的系统服务</h2><ul><li><p>安卓将诸多常用功能内置为系统服务</p></li><li><p>提供简单的获取系统服务的方式</p></li><li><p>系统服务涵盖了安卓绝大部分常用功能，如，拨打电话，发送短信</p></li></ul><ol><li><p>安卓中获取系统服务</p><ul><li><p>获取系统服务代码示例</p><p><code>TelephonyManager phoneManager=(TelephonyManager)getSystemService(Context.TELEPHONY_SERVICE);</code></p></li><li><p>强制类型转化</p><ul><li>在程序运行过程中，将父类型对象转化为子类型对象。</li><li>由于子类型相比父类型的内涵丰富，属性方法更多，所以要把父类型转化为子类型时，需要强制转化，成为强制类型转换。</li><li>并不是所有父类型都可以转化为子类型，要根据具体的使用情况来做具体的判断。</li></ul></li></ul></li></ol><h2 id="5-3-广播接收机制"><a href="#5-3-广播接收机制" class="headerlink" title="5.3 广播接收机制"></a>5.3 广播接收机制</h2><ol><li><p>广播消息</p><ul><li>广播是一种在应用程序之间传输信息的计指</li><li>BroadcastReceiver广播接收者</li><li>广播消息Intent（消息载体）</li><li>被订阅广播的多个广播接收者接收</li><li>消息订阅者不了解发送者</li></ul></li><li><p>广播接收者</p><ul><li>BroadcastReceiver对发出的广播事件进行过滤，应用程序通知其他应用程序某些数据已经下载完毕。</li><li>广播接收者没有图形界面</li><li>广播可以有多个接收者，彼此不知晓。广播接收者之间匿名</li></ul></li><li><p>监听广播机制</p><ul><li>广播和事件监听器是分离的</li><li>通过安卓系统进行广播、接收广播事件</li><li>注册和移除监听通过安卓系统来完成</li><li>安卓系统提供很多广播定义在<code>android.content.Intent</code>类中</li></ul></li><li><p>广播方法</p><p><code>sendBroadcast()</code>:普通模式</p><ul><li>所有注册了广播的接收者会获得事件通知</li><li>接收者接受顺序不确定并发地在各自的应用进程中执行</li><li>接收者和发送者不知晓</li></ul><p><code>sendOrderedBroadcast()</code>:有序广播模式</p><ul><li><p>接收者依照设定的优先级高低依次接受</p></li><li><p>高优先级接收者可以中断后续广播的接收，<code>BroadcastReceiver.abortBroadcast()</code>终止这个广播事件的传播，低优先级的触发器组件不再有机会接收</p></li><li><p>高优先级接收者可添加额外信息给后续接收者</p><p><code>BroadcastReceiver.setResult()</code></p></li></ul></li><li><p>监听广播实现</p><ul><li>获取广播事件的消息接口名称</li><li>事件定制的广播接收器，添加相应的处理逻辑</li><li>注册广播接收器到安卓系统中</li></ul></li><li><p>监听广播实现示例</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBroadcastReceiver</span> <span class="keyword">extends</span> <span class="title">BroadcastReceiver</span></span>&#123;</span><br><span class="line"><span class="comment">//action名称，此为固定的字符</span></span><br><span class="line">String SMS_RECEIVED=<span class="string">&quot;android.provider.Telephony.SMS_RECEIVED&quot;</span>;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(COntext context, Intent intent)</span></span>&#123;</span><br><span class="line"><span class="comment">//如事件有短信接收，则执行</span></span><br><span class="line"><span class="keyword">if</span>(intent.getAction().quals(SMS_RECEIVED))&#123;</span><br><span class="line"><span class="comment">//进行短信接收到之后的逻辑处理</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="7"><li><p>监听广播注册</p><p>在manifest中注册监听器</p></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--声明接收器--&gt;</span><br><span class="line">&lt;receiver android:name = <span class="string">&quot;.MyBroadReceiver&quot;</span>&gt;</span><br><span class="line">&lt;!--接收事件的过滤条件声明和优先级--&gt;</span><br><span class="line">&lt;intent-filter android:priority=<span class="string">&quot;1000&quot;</span>&gt;</span><br><span class="line">&lt;!--支持接收的事件类型--&gt;</span><br><span class="line">&lt;action android:name=<span class="string">&quot;android.provider.Telephony.SMS_RECEIVED&quot;</span>/&gt;</span><br><span class="line">     &lt;/intent-filter&gt;</span><br><span class="line">&lt;/receiver&gt;</span><br><span class="line">&lt;!--监听系统级事件，需要相应的权限：接收者和发送短信的权限--&gt;</span><br><span class="line">&lt;uses-permission android:name=<span class="string">&quot;android.permission.RECEIVE_SMS&quot;</span>/&gt;</span><br><span class="line">    &lt;uses-permission android:name=<span class="string">&quot;android.permission.SEND_SMS&quot;</span>/&gt;</span><br></pre></td></tr></table></figure><p>   在运行代码中注册广播监听器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建监听器对象</span></span><br><span class="line">MyBroadcastReceiver myMsgInfoReceiver=<span class="keyword">new</span> MyBroadcastReceiver();</span><br><span class="line"><span class="comment">//声明IntentFilter，描述可以接收的广播消息</span></span><br><span class="line">IntentFilter intentFilter=<span class="keyword">new</span> IntentFilter(<span class="string">&quot;android.provider.Telephony.SMS_RECEIED&quot;</span>);</span><br><span class="line"><span class="comment">//调用Activity的方法，注册监听器</span></span><br><span class="line">registerReceiver(mBatteryInfoReceiver,intentFilter)</span><br></pre></td></tr></table></figure><ol start="8"><li><p>广播事件生命周期</p><ul><li>广播消息到来，新建BroadcastReceiver对象</li><li>调用<code>onReceive()</code>方法，执行操作</li><li>操作完成后，对象被销毁</li><li>事件出发—&gt;创建事件监听器对象—&gt;调用监听器的<code>onReceiver()</code>—&gt;销毁事件监听器的对象—&gt;结束操作，返回</li></ul></li><li><p>广播事件注意事项</p><ul><li>在广播接收器中响应逻辑中不能执行比较耗时的操作</li><li>在onReceive()方法中执行超过10秒，就会弹出无响应对话框。</li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 安卓编程 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
